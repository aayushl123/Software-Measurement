<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TestCompositeConfiguration.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_configuration2$Unnamed.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.configuration2</a> &gt; <span class="el_source">TestCompositeConfiguration.java</span></div><h1>TestCompositeConfiguration.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.commons.configuration2;

import static org.junit.Assert.assertArrayEquals;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertNotSame;
import static org.junit.Assert.assertNull;
import static org.junit.Assert.assertSame;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

import java.io.File;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;
import java.util.NoSuchElementException;

import org.apache.commons.configuration2.SynchronizerTestImpl.Methods;
import org.apache.commons.configuration2.convert.DefaultListDelimiterHandler;
import org.apache.commons.configuration2.convert.LegacyListDelimiterHandler;
import org.apache.commons.configuration2.convert.ListDelimiterHandler;
import org.apache.commons.configuration2.event.ConfigurationEvent;
import org.apache.commons.configuration2.event.EventListenerTestImpl;
import org.apache.commons.configuration2.ex.ConfigurationRuntimeException;
import org.apache.commons.configuration2.io.FileHandler;
import org.easymock.EasyMock;
import org.junit.Before;
import org.junit.Test;

/**
 * Test class for {@code CompositeConfiguration}.
 *
 * @version $Id$
 */
<span class="fc" id="L54">public class TestCompositeConfiguration</span>
{
    /** Constant for a test property to be checked.*/
    private static final String TEST_PROPERTY = &quot;test.source.property&quot;;

    protected PropertiesConfiguration conf1;
    protected PropertiesConfiguration conf2;
    protected XMLConfiguration xmlConf;
    protected CompositeConfiguration cc;

    /**
     * The File that we test with
     */
<span class="fc" id="L67">    private final String testProperties = ConfigurationAssert.getTestFile(&quot;test.properties&quot;).getAbsolutePath();</span>
<span class="fc" id="L68">    private final String testProperties2 = ConfigurationAssert.getTestFile(&quot;test2.properties&quot;).getAbsolutePath();</span>
<span class="fc" id="L69">    private final String testPropertiesXML = ConfigurationAssert.getTestFile(&quot;test.xml&quot;).getAbsolutePath();</span>

    @Before
    public void setUp() throws Exception
    {
<span class="fc" id="L74">        cc = new CompositeConfiguration();</span>
<span class="fc" id="L75">        ListDelimiterHandler listHandler = new LegacyListDelimiterHandler(',');</span>
<span class="fc" id="L76">        conf1 = new PropertiesConfiguration();</span>
<span class="fc" id="L77">        conf1.setListDelimiterHandler(listHandler);</span>
<span class="fc" id="L78">        FileHandler handler1 = new FileHandler(conf1);</span>
<span class="fc" id="L79">        handler1.setFileName(testProperties);</span>
<span class="fc" id="L80">        handler1.load();</span>
<span class="fc" id="L81">        conf2 = new PropertiesConfiguration();</span>
<span class="fc" id="L82">        conf2.setListDelimiterHandler(listHandler);</span>
<span class="fc" id="L83">        FileHandler handler2 = new FileHandler(conf2);</span>
<span class="fc" id="L84">        handler2.setFileName(testProperties2);</span>
<span class="fc" id="L85">        handler2.load();</span>
<span class="fc" id="L86">        xmlConf = new XMLConfiguration();</span>
<span class="fc" id="L87">        FileHandler handler3 = new FileHandler(xmlConf);</span>
<span class="fc" id="L88">        handler3.load(new File(testPropertiesXML));</span>

<span class="fc" id="L90">        cc.setThrowExceptionOnMissing(true);</span>
<span class="fc" id="L91">    }</span>

    @Test
    public void testThrowExceptionOnMissing()
    {
<span class="fc" id="L96">        assertTrue(&quot;Throw Exception Property is not set!&quot;, cc.isThrowExceptionOnMissing());</span>
<span class="fc" id="L97">    }</span>

    @Test
    public void testAddRemoveConfigurations() throws Exception
    {
<span class="fc" id="L102">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L103">        assertEquals(&quot;Number of configurations&quot;, 2, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L104">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L105">        assertEquals(&quot;Number of configurations&quot;, 2, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L106">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L107">        assertEquals(&quot;Number of configurations&quot;, 3, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L108">        cc.removeConfiguration(conf1);</span>
<span class="fc" id="L109">        assertEquals(&quot;Number of configurations&quot;, 2, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L110">        cc.clear();</span>
<span class="fc" id="L111">        assertEquals(&quot;Number of configurations&quot;, 1, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L112">    }</span>

    @Test
    public void testGetPropertyWIncludes() throws Exception
    {
<span class="fc" id="L117">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L118">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L119">        List&lt;Object&gt; l = cc.getList(&quot;packages&quot;);</span>
<span class="fc" id="L120">        assertTrue(l.contains(&quot;packagea&quot;));</span>
<span class="fc" id="L121">    }</span>

    @Test
    public void testGetProperty() throws Exception
    {
<span class="fc" id="L126">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L127">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L128">        assertEquals(&quot;Make sure we get the property from conf1 first&quot;, &quot;test.properties&quot;, cc.getString(&quot;propertyInOrder&quot;));</span>
<span class="fc" id="L129">        cc.clear();</span>

<span class="fc" id="L131">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L132">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L133">        assertEquals(&quot;Make sure we get the property from conf2 first&quot;, &quot;test2.properties&quot;, cc.getString(&quot;propertyInOrder&quot;));</span>
<span class="fc" id="L134">    }</span>

    @Test
    public void testCantRemoveMemoryConfig() throws Exception
    {
<span class="fc" id="L139">        cc.clear();</span>
<span class="fc" id="L140">        assertEquals(1, cc.getNumberOfConfigurations());</span>

<span class="fc" id="L142">        Configuration internal = cc.getConfiguration(0);</span>
<span class="fc" id="L143">        cc.removeConfiguration(internal);</span>

<span class="fc" id="L145">        assertEquals(1, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L146">    }</span>

    @Test
    public void testGetPropertyMissing() throws Exception
    {
<span class="fc" id="L151">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L152">        cc.addConfiguration(conf2);</span>
        try
        {
<span class="nc" id="L155">            assertNull(cc.getString(&quot;bogus.property&quot;));</span>
<span class="nc" id="L156">            fail(&quot;Should have thrown a NoSuchElementException&quot;);</span>
        }
<span class="fc" id="L158">        catch (NoSuchElementException nsee)</span>
        {
<span class="fc" id="L160">            assertTrue(nsee.getMessage().contains(&quot;bogus.property&quot;));</span>
<span class="nc" id="L161">        }</span>

<span class="pc bpc" id="L163" title="1 of 2 branches missed.">        assertTrue(&quot;Should be false&quot;, !cc.getBoolean(&quot;test.missing.boolean&quot;, false));</span>
<span class="fc" id="L164">        assertTrue(&quot;Should be true&quot;, cc.getBoolean(&quot;test.missing.boolean.true&quot;, true));</span>
<span class="fc" id="L165">    }</span>

    /**
     * Tests {@code List} parsing.
     */
    @Test
    public void testMultipleTypesOfConfigs() throws Exception
    {
<span class="fc" id="L173">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L174">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L175">        assertEquals(&quot;Make sure we get the property from conf1 first&quot;, 1, cc.getInt(&quot;test.short&quot;));</span>
<span class="fc" id="L176">        cc.clear();</span>

<span class="fc" id="L178">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L179">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L180">        assertEquals(&quot;Make sure we get the property from xml&quot;, 8, cc.getInt(&quot;test.short&quot;));</span>
<span class="fc" id="L181">    }</span>

    @Test
    public void testPropertyExistsInOnlyOneConfig() throws Exception
    {
<span class="fc" id="L186">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L187">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L188">        assertEquals(&quot;value&quot;, cc.getString(&quot;element&quot;));</span>
<span class="fc" id="L189">    }</span>

    /**
     * Tests getting a default when the key doesn't exist
     */
    @Test
    public void testDefaultValueWhenKeyMissing() throws Exception
    {
<span class="fc" id="L197">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L198">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L199">        assertEquals(&quot;default&quot;, cc.getString(&quot;bogus&quot;, &quot;default&quot;));</span>
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">        assertTrue(1.4 == cc.getDouble(&quot;bogus&quot;, 1.4));</span>
<span class="pc bpc" id="L201" title="1 of 2 branches missed.">        assertTrue(1.4 == cc.getDouble(&quot;bogus&quot;, 1.4));</span>
<span class="fc" id="L202">    }</span>

    @Test
    public void testGettingConfiguration() throws Exception
    {
<span class="fc" id="L207">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L208">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L209">        assertEquals(PropertiesConfiguration.class, cc.getConfiguration(0).getClass());</span>
<span class="fc" id="L210">        assertEquals(XMLConfiguration.class, cc.getConfiguration(1).getClass());</span>
<span class="fc" id="L211">    }</span>

    /**
     * Tests setting values.  These are set in memory mode only!
     */
    @Test
    public void testClearingProperty() throws Exception
    {
<span class="fc" id="L219">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L220">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L221">        cc.clearProperty(&quot;test.short&quot;);</span>
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">        assertTrue(&quot;Make sure test.short is gone!&quot;, !cc.containsKey(&quot;test.short&quot;));</span>
<span class="fc" id="L223">    }</span>

    /**
     * Tests adding values.  Make sure they _DON'T_ override any other properties but add to the
     * existing properties  and keep sequence
     */
    @Test
    public void testAddingProperty() throws Exception
    {
<span class="fc" id="L232">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L233">        cc.addConfiguration(xmlConf);</span>

<span class="fc" id="L235">        String[] values = cc.getStringArray(&quot;test.short&quot;);</span>

<span class="fc" id="L237">        assertEquals(&quot;Number of values before add is wrong!&quot;, 1, values.length);</span>
<span class="fc" id="L238">        assertEquals(&quot;First Value before add is wrong&quot;, &quot;1&quot;, values[0]);</span>

<span class="fc" id="L240">        cc.addProperty(&quot;test.short&quot;, &quot;88&quot;);</span>

<span class="fc" id="L242">        values = cc.getStringArray(&quot;test.short&quot;);</span>

<span class="fc" id="L244">        assertEquals(&quot;Number of values is wrong!&quot;, 2, values.length);</span>
<span class="fc" id="L245">        assertEquals(&quot;First Value is wrong&quot;, &quot;1&quot;, values[0]);</span>
<span class="fc" id="L246">        assertEquals(&quot;Third Value is wrong&quot;, &quot;88&quot;, values[1]);</span>
<span class="fc" id="L247">    }</span>

    /**
     * Tests setting values.  These are set in memory mode only!
     */
    @Test
    public void testSettingMissingProperty() throws Exception
    {
<span class="fc" id="L255">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L256">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L257">        cc.setProperty(&quot;my.new.property&quot;, &quot;supernew&quot;);</span>
<span class="fc" id="L258">        assertEquals(&quot;supernew&quot;, cc.getString(&quot;my.new.property&quot;));</span>
<span class="fc" id="L259">    }</span>

    /**
     * Tests retrieving subsets of configurations
     */
    @Test
    public void testGettingSubset() throws Exception
    {
<span class="fc" id="L267">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L268">        cc.addConfiguration(xmlConf);</span>

<span class="fc" id="L270">        Configuration subset = cc.subset(&quot;test&quot;);</span>
<span class="fc" id="L271">        assertNotNull(subset);</span>
<span class="fc" id="L272">        assertFalse(&quot;Shouldn't be empty&quot;, subset.isEmpty());</span>
<span class="fc" id="L273">        assertEquals(&quot;Make sure the initial loaded configs subset overrides any later add configs subset&quot;, &quot;1&quot;, subset.getString(&quot;short&quot;));</span>

<span class="fc" id="L275">        cc.setProperty(&quot;test.short&quot;, &quot;43&quot;);</span>
<span class="fc" id="L276">        subset = cc.subset(&quot;test&quot;);</span>
<span class="fc" id="L277">        assertEquals(&quot;Make sure the initial loaded configs subset overrides any later add configs subset&quot;, &quot;43&quot;, subset.getString(&quot;short&quot;));</span>
<span class="fc" id="L278">    }</span>

    /**
     * Tests subsets and still can resolve elements
     */
    @Test
    public void testSubsetCanResolve() throws Exception
    {
<span class="fc" id="L286">        cc = new CompositeConfiguration();</span>
<span class="fc" id="L287">        final BaseConfiguration config = new BaseConfiguration();</span>
<span class="fc" id="L288">        config.addProperty(&quot;subset.tempfile&quot;, &quot;${java.io.tmpdir}/file.tmp&quot;);</span>
<span class="fc" id="L289">        cc.addConfiguration(config);</span>
<span class="fc" id="L290">        cc.addConfiguration(ConfigurationConverter.getConfiguration(System.getProperties()));</span>

<span class="fc" id="L292">        Configuration subset = cc.subset(&quot;subset&quot;);</span>
<span class="fc" id="L293">        assertEquals(System.getProperty(&quot;java.io.tmpdir&quot;) + &quot;/file.tmp&quot;, subset.getString(&quot;tempfile&quot;));</span>
<span class="fc" id="L294">    }</span>

    /**
     * Tests {@code List} parsing.
     */
    @Test
    public void testList() throws Exception
    {
<span class="fc" id="L302">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L303">        cc.addConfiguration(xmlConf);</span>

<span class="fc" id="L305">        List&lt;Object&gt; packages = cc.getList(&quot;packages&quot;);</span>
        // we should get 3 packages here
<span class="fc" id="L307">        assertEquals(3, packages.size());</span>

<span class="fc" id="L309">        List&lt;Object&gt; defaultList = new ArrayList&lt;Object&gt;();</span>
<span class="fc" id="L310">        defaultList.add(&quot;1&quot;);</span>
<span class="fc" id="L311">        defaultList.add(&quot;2&quot;);</span>

<span class="fc" id="L313">        packages = cc.getList(&quot;packages.which.dont.exist&quot;, defaultList);</span>
        // we should get 2 packages here
<span class="fc" id="L315">        assertEquals(2, packages.size());</span>

<span class="fc" id="L317">    }</span>

    /**
     * Tests {@code String} array parsing.
     */
    @Test
    public void testStringArray() throws Exception
    {
<span class="fc" id="L325">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L326">        cc.addConfiguration(xmlConf);</span>

<span class="fc" id="L328">        String[] packages = cc.getStringArray(&quot;packages&quot;);</span>
        // we should get 3 packages here
<span class="fc" id="L330">        assertEquals(3, packages.length);</span>

<span class="fc" id="L332">        packages = cc.getStringArray(&quot;packages.which.dont.exist&quot;);</span>
        // we should get 0 packages here
<span class="fc" id="L334">        assertEquals(0, packages.length);</span>
<span class="fc" id="L335">    }</span>

    @Test
    public void testGetList()
    {
<span class="fc" id="L340">        Configuration conf1 = new BaseConfiguration();</span>
<span class="fc" id="L341">        conf1.addProperty(&quot;array&quot;, &quot;value1&quot;);</span>
<span class="fc" id="L342">        conf1.addProperty(&quot;array&quot;, &quot;value2&quot;);</span>

<span class="fc" id="L344">        Configuration conf2 = new BaseConfiguration();</span>
<span class="fc" id="L345">        conf2.addProperty(&quot;array&quot;, &quot;value3&quot;);</span>
<span class="fc" id="L346">        conf2.addProperty(&quot;array&quot;, &quot;value4&quot;);</span>

<span class="fc" id="L348">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L349">        cc.addConfiguration(conf2);</span>

        // check the composite 'array' property
<span class="fc" id="L352">        List&lt;Object&gt; list = cc.getList(&quot;array&quot;);</span>
<span class="fc" id="L353">        assertNotNull(&quot;null list&quot;, list);</span>
<span class="fc" id="L354">        assertEquals(&quot;list size&quot;, 2, list.size());</span>
<span class="fc" id="L355">        assertTrue(&quot;'value1' not found in the list&quot;, list.contains(&quot;value1&quot;));</span>
<span class="fc" id="L356">        assertTrue(&quot;'value2' not found in the list&quot;, list.contains(&quot;value2&quot;));</span>

        // add an element to the list in the composite configuration
<span class="fc" id="L359">        cc.addProperty(&quot;array&quot;, &quot;value5&quot;);</span>

        // test the new list
<span class="fc" id="L362">        list = cc.getList(&quot;array&quot;);</span>
<span class="fc" id="L363">        assertNotNull(&quot;null list&quot;, list);</span>
<span class="fc" id="L364">        assertEquals(&quot;list size&quot;, 3, list.size());</span>
<span class="fc" id="L365">        assertTrue(&quot;'value1' not found in the list&quot;, list.contains(&quot;value1&quot;));</span>
<span class="fc" id="L366">        assertTrue(&quot;'value2' not found in the list&quot;, list.contains(&quot;value2&quot;));</span>
<span class="fc" id="L367">        assertTrue(&quot;'value5' not found in the list&quot;, list.contains(&quot;value5&quot;));</span>
<span class="fc" id="L368">    }</span>

    /**
     * Tests {@code getKeys} preserves the order
     */
    @Test
    public void testGetKeysPreservesOrder() throws Exception
    {
<span class="fc" id="L376">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L377">        List&lt;String&gt; orderedList = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L378" title="All 2 branches covered.">        for (Iterator&lt;String&gt; keys = conf1.getKeys(); keys.hasNext();)</span>
        {
<span class="fc" id="L380">            orderedList.add(keys.next());</span>
        }
<span class="fc" id="L382">        List&lt;String&gt; iteratedList = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L383" title="All 2 branches covered.">        for (Iterator&lt;String&gt; keys = cc.getKeys(); keys.hasNext();)</span>
        {
<span class="fc" id="L385">            iteratedList.add(keys.next());</span>
        }
<span class="fc" id="L387">        assertEquals(orderedList.size(), iteratedList.size());</span>
<span class="fc bfc" id="L388" title="All 2 branches covered.">        for (int i = 0; i &lt; orderedList.size(); i++)</span>
        {
<span class="fc" id="L390">            assertEquals(orderedList.get(i), iteratedList.get(i));</span>
        }
<span class="fc" id="L392">    }</span>

    /**
     * Tests {@code getKeys(String key)} preserves the order
     */
    @Test
    public void testGetKeys2PreservesOrder() throws Exception
    {
<span class="fc" id="L400">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L401">        List&lt;String&gt; orderedList = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L402" title="All 2 branches covered.">        for (Iterator&lt;String&gt; keys = conf1.getKeys(&quot;test&quot;); keys.hasNext();)</span>
        {
<span class="fc" id="L404">            orderedList.add(keys.next());</span>
        }
<span class="fc" id="L406">        List&lt;String&gt; iteratedList = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L407" title="All 2 branches covered.">        for (Iterator&lt;String&gt; keys = cc.getKeys(&quot;test&quot;); keys.hasNext();)</span>
        {
<span class="fc" id="L409">            iteratedList.add(keys.next());</span>
        }
<span class="fc" id="L411">        assertEquals(orderedList.size(), iteratedList.size());</span>
<span class="fc bfc" id="L412" title="All 2 branches covered.">        for (int i = 0; i &lt; orderedList.size(); i++)</span>
        {
<span class="fc" id="L414">            assertEquals(orderedList.get(i), iteratedList.get(i));</span>
        }
<span class="fc" id="L416">    }</span>

    @Test
    public void testGetStringWithDefaults()
    {
<span class="fc" id="L421">        BaseConfiguration defaults = new BaseConfiguration();</span>
<span class="fc" id="L422">        defaults.addProperty(&quot;default&quot;, &quot;default string&quot;);</span>

<span class="fc" id="L424">        CompositeConfiguration c = new CompositeConfiguration(defaults);</span>
<span class="fc" id="L425">        c.setThrowExceptionOnMissing(cc.isThrowExceptionOnMissing());</span>
<span class="fc" id="L426">        c.addProperty(&quot;string&quot;, &quot;test string&quot;);</span>

<span class="fc" id="L428">        assertEquals(&quot;test string&quot;, c.getString(&quot;string&quot;));</span>
        try
        {
<span class="nc" id="L431">            c.getString(&quot;XXX&quot;);</span>
<span class="nc" id="L432">            fail(&quot;Should throw NoSuchElementException exception&quot;);</span>
        }
<span class="fc" id="L434">        catch (NoSuchElementException e)</span>
        {
            //ok
        }
<span class="nc" id="L438">        catch (Exception e)</span>
        {
<span class="nc" id="L440">            fail(&quot;Should throw NoSuchElementException exception, not &quot; + e);</span>
<span class="pc" id="L441">        }</span>

        //test defaults
<span class="fc" id="L444">        assertEquals(&quot;test string&quot;, c.getString(&quot;string&quot;, &quot;some default value&quot;));</span>
<span class="fc" id="L445">        assertEquals(&quot;default string&quot;, c.getString(&quot;default&quot;));</span>
<span class="fc" id="L446">        assertEquals(&quot;default string&quot;, c.getString(&quot;default&quot;, &quot;some default value&quot;));</span>
<span class="fc" id="L447">        assertEquals(&quot;some default value&quot;, c.getString(&quot;XXX&quot;, &quot;some default value&quot;));</span>
<span class="fc" id="L448">    }</span>

    @Test
    public void testCheckingInMemoryConfiguration() throws Exception
    {
<span class="fc" id="L453">        String TEST_KEY = &quot;testKey&quot;;</span>
<span class="fc" id="L454">        Configuration defaults = new PropertiesConfiguration();</span>
<span class="fc" id="L455">        defaults.setProperty(TEST_KEY, &quot;testValue&quot;);</span>
<span class="fc" id="L456">        Configuration testConfiguration = new CompositeConfiguration(defaults);</span>
<span class="fc" id="L457">        assertTrue(testConfiguration.containsKey(TEST_KEY));</span>
<span class="fc" id="L458">        assertFalse(testConfiguration.isEmpty());</span>
<span class="fc" id="L459">        boolean foundTestKey = false;</span>
<span class="fc" id="L460">        Iterator&lt;String&gt; i = testConfiguration.getKeys();</span>
        //assertTrue(i instanceof IteratorChain);
        //IteratorChain ic = (IteratorChain)i;
        //assertEquals(2,i.size());
<span class="fc bfc" id="L464" title="All 2 branches covered.">        for (; i.hasNext();)</span>
        {
<span class="fc" id="L466">            String key = i.next();</span>
<span class="pc bpc" id="L467" title="1 of 2 branches missed.">            if (key.equals(TEST_KEY))</span>
            {
<span class="fc" id="L469">                foundTestKey = true;</span>
            }
<span class="fc" id="L471">        }</span>
<span class="fc" id="L472">        assertTrue(foundTestKey);</span>
<span class="fc" id="L473">        testConfiguration.clearProperty(TEST_KEY);</span>
<span class="fc" id="L474">        assertFalse(testConfiguration.containsKey(TEST_KEY));</span>
<span class="fc" id="L475">    }</span>

    @Test
    public void testStringArrayInterpolation()
    {
<span class="fc" id="L480">        CompositeConfiguration config = new CompositeConfiguration();</span>
<span class="fc" id="L481">        config.addProperty(&quot;base&quot;, &quot;foo&quot;);</span>
<span class="fc" id="L482">        config.addProperty(&quot;list&quot;, &quot;${base}.bar1&quot;);</span>
<span class="fc" id="L483">        config.addProperty(&quot;list&quot;, &quot;${base}.bar2&quot;);</span>
<span class="fc" id="L484">        config.addProperty(&quot;list&quot;, &quot;${base}.bar3&quot;);</span>

<span class="fc" id="L486">        String[] array = config.getStringArray(&quot;list&quot;);</span>
<span class="fc" id="L487">        assertEquals(&quot;size&quot;, 3, array.length);</span>
<span class="fc" id="L488">        assertEquals(&quot;1st element&quot;, &quot;foo.bar1&quot;, array[0]);</span>
<span class="fc" id="L489">        assertEquals(&quot;2nd element&quot;, &quot;foo.bar2&quot;, array[1]);</span>
<span class="fc" id="L490">        assertEquals(&quot;3rd element&quot;, &quot;foo.bar3&quot;, array[2]);</span>
<span class="fc" id="L491">    }</span>

    /**
     * Tests whether global interpolation works with lists.
     */
    @Test
    public void testListInterpolation()
    {
<span class="fc" id="L499">        PropertiesConfiguration c1 = new PropertiesConfiguration();</span>
<span class="fc" id="L500">        c1.addProperty(&quot;c1.value&quot;, &quot;test1&quot;);</span>
<span class="fc" id="L501">        c1.addProperty(&quot;c1.value&quot;, &quot;${c2.value}&quot;);</span>
<span class="fc" id="L502">        cc.addConfiguration(c1);</span>
<span class="fc" id="L503">        PropertiesConfiguration c2 = new PropertiesConfiguration();</span>
<span class="fc" id="L504">        c2.addProperty(&quot;c2.value&quot;, &quot;test2&quot;);</span>
<span class="fc" id="L505">        cc.addConfiguration(c2);</span>
<span class="fc" id="L506">        List&lt;Object&gt; lst = cc.getList(&quot;c1.value&quot;);</span>
<span class="fc" id="L507">        assertEquals(&quot;Wrong list size&quot;, 2, lst.size());</span>
<span class="fc" id="L508">        assertEquals(&quot;Wrong first element&quot;, &quot;test1&quot;, lst.get(0));</span>
<span class="fc" id="L509">        assertEquals(&quot;Wrong second element&quot;, &quot;test2&quot;, lst.get(1));</span>
<span class="fc" id="L510">    }</span>

    @Test
    public void testInstanciateWithCollection()
    {
<span class="fc" id="L515">        Collection&lt;Configuration&gt; configs = new ArrayList&lt;Configuration&gt;();</span>
<span class="fc" id="L516">        configs.add(xmlConf);</span>
<span class="fc" id="L517">        configs.add(conf1);</span>
<span class="fc" id="L518">        configs.add(conf2);</span>

<span class="fc" id="L520">        CompositeConfiguration config = new CompositeConfiguration(configs);</span>
<span class="fc" id="L521">        assertEquals(&quot;Number of configurations&quot;, 4, config.getNumberOfConfigurations());</span>
<span class="fc" id="L522">        assertTrue(&quot;The in memory configuration is not empty&quot;, config.getInMemoryConfiguration().isEmpty());</span>
<span class="fc" id="L523">    }</span>

    @Test
    public void testClone()
    {
<span class="fc" id="L528">        CompositeConfiguration cc2 = (CompositeConfiguration) cc.clone();</span>
<span class="fc" id="L529">        assertEquals(&quot;Wrong number of contained configurations&quot;, cc</span>
<span class="fc" id="L530">                .getNumberOfConfigurations(), cc2.getNumberOfConfigurations());</span>

<span class="fc" id="L532">        StrictConfigurationComparator comp = new StrictConfigurationComparator();</span>
<span class="fc bfc" id="L533" title="All 2 branches covered.">        for (int i = 0; i &lt; cc.getNumberOfConfigurations(); i++)</span>
        {
<span class="fc" id="L535">            assertEquals(&quot;Wrong configuration class at &quot; + i, cc</span>
<span class="fc" id="L536">                    .getConfiguration(i).getClass(), cc2.getConfiguration(i)</span>
<span class="fc" id="L537">                    .getClass());</span>
<span class="fc" id="L538">            assertNotSame(&quot;Configuration was not cloned&quot;, cc</span>
<span class="fc" id="L539">                    .getConfiguration(i), cc2.getConfiguration(i));</span>
<span class="fc" id="L540">            assertTrue(&quot;Configurations at &quot; + i + &quot; not equal&quot;, comp.compare(cc</span>
<span class="fc" id="L541">                    .getConfiguration(i), cc2.getConfiguration(i)));</span>
        }

<span class="fc" id="L544">        assertTrue(&quot;Configurations are not equal&quot;, comp.compare(cc, cc2));</span>
<span class="fc" id="L545">    }</span>

    /**
     * Tests cloning if one of the contained configurations does not support
     * this operation. This should cause an exception.
     */
    @Test(expected = ConfigurationRuntimeException.class)
    public void testCloneNotSupported()
    {
<span class="fc" id="L554">        cc.addConfiguration(new NonCloneableConfiguration());</span>
<span class="nc" id="L555">        cc.clone();</span>
<span class="nc" id="L556">    }</span>

    /**
     * Ensures that event listeners are not cloned.
     */
    @Test
    public void testCloneEventListener()
    {
<span class="fc" id="L564">        cc.addEventListener(ConfigurationEvent.ANY, new EventListenerTestImpl(null));</span>
<span class="fc" id="L565">        CompositeConfiguration cc2 = (CompositeConfiguration) cc.clone();</span>
<span class="fc" id="L566">        assertTrue(&quot;Listeners have been cloned&quot;, cc2</span>
<span class="fc" id="L567">                .getEventListeners(ConfigurationEvent.ANY).isEmpty());</span>
<span class="fc" id="L568">    }</span>

    /**
     * Tests whether interpolation works as expected after cloning.
     */
    @Test
    public void testCloneInterpolation()
    {
<span class="fc" id="L576">        CompositeConfiguration cc2 = (CompositeConfiguration) cc.clone();</span>
<span class="fc" id="L577">        assertNotSame(&quot;Interpolator was not cloned&quot;, cc.getInterpolator(),</span>
<span class="fc" id="L578">                cc2.getInterpolator());</span>
<span class="fc" id="L579">    }</span>

    /**
     * Tests whether add property events are triggered.
     */
    @Test
    public void testEventAddProperty()
    {
<span class="fc" id="L587">        EventListenerTestImpl listener = new EventListenerTestImpl(cc);</span>
<span class="fc" id="L588">        cc.addEventListener(ConfigurationEvent.ANY, listener);</span>
<span class="fc" id="L589">        cc.addProperty(&quot;test&quot;, &quot;value&quot;);</span>
<span class="fc" id="L590">        listener.checkEvent(ConfigurationEvent.ADD_PROPERTY, &quot;test&quot;, &quot;value&quot;, true);</span>
<span class="fc" id="L591">        listener.checkEvent(ConfigurationEvent.ADD_PROPERTY, &quot;test&quot;, &quot;value&quot;, false);</span>
<span class="fc" id="L592">        listener.done();</span>
<span class="fc" id="L593">    }</span>

    /**
     * Tests whether set property events are triggered.
     */
    @Test
    public void testEventSetProperty()
    {
<span class="fc" id="L601">        EventListenerTestImpl listener = new EventListenerTestImpl(cc);</span>
<span class="fc" id="L602">        cc.addEventListener(ConfigurationEvent.ANY, listener);</span>
<span class="fc" id="L603">        cc.setProperty(&quot;test&quot;, &quot;value&quot;);</span>
<span class="fc" id="L604">        listener.checkEvent(ConfigurationEvent.SET_PROPERTY, &quot;test&quot;, &quot;value&quot;, true);</span>
<span class="fc" id="L605">        listener.checkEvent(ConfigurationEvent.SET_PROPERTY, &quot;test&quot;, &quot;value&quot;, false);</span>
<span class="fc" id="L606">        listener.done();</span>
<span class="fc" id="L607">    }</span>

    /**
     * Tests whether clear property events are triggered.
     */
    @Test
    public void testEventClearProperty()
    {
<span class="fc" id="L615">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L616">        String key = &quot;configuration.loaded&quot;;</span>
<span class="fc" id="L617">        assertTrue(&quot;Wrong value for property&quot;, cc</span>
<span class="fc" id="L618">                .getBoolean(key));</span>
<span class="fc" id="L619">        EventListenerTestImpl listener = new EventListenerTestImpl(cc);</span>
<span class="fc" id="L620">        cc.addEventListener(ConfigurationEvent.ANY, listener);</span>
<span class="fc" id="L621">        cc.clearProperty(key);</span>
<span class="fc" id="L622">        assertFalse(&quot;Key still present&quot;, cc.containsKey(key));</span>
<span class="fc" id="L623">        listener.checkEvent(ConfigurationEvent.CLEAR_PROPERTY, key, null, true);</span>
<span class="fc" id="L624">        listener.checkEvent(ConfigurationEvent.CLEAR_PROPERTY, key, null, false);</span>
<span class="fc" id="L625">        listener.done();</span>
<span class="fc" id="L626">    }</span>

    /**
     * Tests changing the list delimiter handler.
     */
    @Test
    public void testSetListDelimiter()
    {
<span class="fc" id="L634">        cc.setListDelimiterHandler(new DefaultListDelimiterHandler('/'));</span>
<span class="fc" id="L635">        checkSetListDelimiterHandler();</span>
<span class="fc" id="L636">    }</span>

    /**
     * Tests whether the correct list delimiter handler is set after a clear
     * operation.
     */
    @Test
    public void testSetListDelimiterAfterClear()
    {
<span class="fc" id="L645">        cc.setListDelimiterHandler(new DefaultListDelimiterHandler('/'));</span>
<span class="fc" id="L646">        cc.clear();</span>
<span class="fc" id="L647">        checkSetListDelimiterHandler();</span>
<span class="fc" id="L648">    }</span>

    /**
     * Helper method for testing whether the list delimiter is correctly
     * handled.
     */
    private void checkSetListDelimiterHandler()
    {
<span class="fc" id="L656">        cc.addProperty(&quot;test.list&quot;, &quot;a/b/c&quot;);</span>
<span class="fc" id="L657">        cc.addProperty(&quot;test.property&quot;, &quot;a,b,c&quot;);</span>
<span class="fc" id="L658">        assertEquals(&quot;Wrong number of list elements&quot;, 3, cc</span>
<span class="fc" id="L659">                .getList(&quot;test.list&quot;).size());</span>
<span class="fc" id="L660">        assertEquals(&quot;Wrong value of property&quot;, &quot;a,b,c&quot;, cc</span>
<span class="fc" id="L661">                .getString(&quot;test.property&quot;));</span>

<span class="fc" id="L663">        AbstractConfiguration config =</span>
<span class="fc" id="L664">                (AbstractConfiguration) cc.getInMemoryConfiguration();</span>
<span class="fc" id="L665">        DefaultListDelimiterHandler listHandler =</span>
<span class="fc" id="L666">                (DefaultListDelimiterHandler) config.getListDelimiterHandler();</span>
<span class="fc" id="L667">        assertEquals(&quot;Wrong list delimiter&quot;, '/', listHandler.getDelimiter());</span>
<span class="fc" id="L668">    }</span>

    /**
     * Prepares a test of the getSource() method.
     */
    private void setUpSourceTest()
    {
<span class="fc" id="L675">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L676">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L677">    }</span>

    /**
     * Tests the getSource() method if the property is defined in a single child
     * configuration.
     */
    @Test
    public void testGetSourceSingle()
    {
<span class="fc" id="L686">        setUpSourceTest();</span>
<span class="fc" id="L687">        conf1.addProperty(TEST_PROPERTY, Boolean.TRUE);</span>
<span class="fc" id="L688">        assertSame(&quot;Wrong source configuration&quot;, conf1, cc</span>
<span class="fc" id="L689">                .getSource(TEST_PROPERTY));</span>
<span class="fc" id="L690">    }</span>

    /**
     * Tests the getSource() method for an unknown property key.
     */
    @Test
    public void testGetSourceUnknown()
    {
<span class="fc" id="L698">        setUpSourceTest();</span>
<span class="fc" id="L699">        assertNull(&quot;Wrong source for unknown key&quot;, cc.getSource(TEST_PROPERTY));</span>
<span class="fc" id="L700">    }</span>

    /**
     * Tests the getSource() method for a property contained in the in memory
     * configuration.
     */
    @Test
    public void testGetSourceInMemory()
    {
<span class="fc" id="L709">        setUpSourceTest();</span>
<span class="fc" id="L710">        cc.addProperty(TEST_PROPERTY, Boolean.TRUE);</span>
<span class="fc" id="L711">        assertSame(&quot;Source not found in in-memory config&quot;, cc</span>
<span class="fc" id="L712">                .getInMemoryConfiguration(), cc.getSource(TEST_PROPERTY));</span>
<span class="fc" id="L713">    }</span>

    /**
     * Tests the getSource() method if the property is defined by multiple child
     * configurations. In this case an exception should be thrown.
     */
    @Test(expected = IllegalArgumentException.class)
    public void testGetSourceMultiple()
    {
<span class="fc" id="L722">        setUpSourceTest();</span>
<span class="fc" id="L723">        conf1.addProperty(TEST_PROPERTY, Boolean.TRUE);</span>
<span class="fc" id="L724">        cc.addProperty(TEST_PROPERTY, &quot;a value&quot;);</span>
<span class="nc" id="L725">        cc.getSource(TEST_PROPERTY);</span>
<span class="nc" id="L726">    }</span>

    /**
     * Tests the getSource() method for a null key. This should cause an
     * exception.
     */
    @Test(expected = IllegalArgumentException.class)
    public void testGetSourceNull()
    {
<span class="nc" id="L735">        cc.getSource(null);</span>
<span class="nc" id="L736">    }</span>

    /**
     * Prepares a test for interpolation with multiple configurations and
     * similar properties.
     */
    private void prepareInterpolationTest()
    {
<span class="fc" id="L744">        PropertiesConfiguration p = new PropertiesConfiguration();</span>
<span class="fc" id="L745">        p.addProperty(&quot;foo&quot;, &quot;initial&quot;);</span>
<span class="fc" id="L746">        p.addProperty(&quot;bar&quot;, &quot;${foo}&quot;);</span>
<span class="fc" id="L747">        p.addProperty(&quot;prefix.foo&quot;, &quot;override&quot;);</span>

<span class="fc" id="L749">        cc.addConfiguration(p.subset(&quot;prefix&quot;));</span>
<span class="fc" id="L750">        cc.addConfiguration(p);</span>
<span class="fc" id="L751">        assertEquals(&quot;Wrong value on direct access&quot;, &quot;override&quot;, cc</span>
<span class="fc" id="L752">                .getString(&quot;bar&quot;));</span>
<span class="fc" id="L753">    }</span>

    /**
     * Tests querying a list when a tricky interpolation is involved. This is
     * related to CONFIGURATION-339.
     */
    @Test
    public void testGetListWithInterpolation()
    {
<span class="fc" id="L762">        prepareInterpolationTest();</span>
<span class="fc" id="L763">        List&lt;Object&gt; lst = cc.getList(&quot;bar&quot;);</span>
<span class="fc" id="L764">        assertEquals(&quot;Wrong number of values&quot;, 1, lst.size());</span>
<span class="fc" id="L765">        assertEquals(&quot;Wrong value in list&quot;, &quot;override&quot;, lst.get(0));</span>
<span class="fc" id="L766">    }</span>

    /**
     * Tests querying a string array when a tricky interpolation is involved.
     */
    @Test
    public void testGetStringArrayWithInterpolation()
    {
<span class="fc" id="L774">        prepareInterpolationTest();</span>
<span class="fc" id="L775">        String[] values = cc.getStringArray(&quot;bar&quot;);</span>
<span class="fc" id="L776">        assertEquals(&quot;Wrong number of values&quot;, 1, values.length);</span>
<span class="fc" id="L777">        assertEquals(&quot;Wrong value in array&quot;, &quot;override&quot;, values[0]);</span>
<span class="fc" id="L778">    }</span>

    /**
     * Tests whether interpolation works if multiple configurations are
     * involved. This test is related to CONFIGURATION-441.
     */
    @Test
    public void testInterpolationInMultipleConfigs()
    {
<span class="fc" id="L787">        Configuration c1 = new PropertiesConfiguration();</span>
<span class="fc" id="L788">        c1.addProperty(&quot;property.one&quot;, &quot;one&quot;);</span>
<span class="fc" id="L789">        c1.addProperty(&quot;property.two&quot;, &quot;two&quot;);</span>
<span class="fc" id="L790">        Configuration c2 = new PropertiesConfiguration();</span>
<span class="fc" id="L791">        c2.addProperty(&quot;property.one.ref&quot;, &quot;${property.one}&quot;);</span>
<span class="fc" id="L792">        cc.addConfiguration(c1);</span>
<span class="fc" id="L793">        cc.addConfiguration(c2);</span>
<span class="fc" id="L794">        assertEquals(&quot;Wrong interpolated value&quot;, &quot;one&quot;,</span>
<span class="fc" id="L795">                cc.getString(&quot;property.one.ref&quot;));</span>
<span class="fc" id="L796">    }</span>

    /**
     * Tests whether interpolation works if a variable references a property
     * with multiple values. This test is related to CONFIGURATION-632.
     */
    @Test
    public void testInterpolationArrayReference()
    {
<span class="fc" id="L805">        Configuration props = new PropertiesConfiguration();</span>
<span class="fc" id="L806">        String[] values = { &quot;a&quot;, &quot;property&quot;, &quot;with&quot;, &quot;multiple&quot;, &quot;values&quot; };</span>
<span class="fc" id="L807">        props.addProperty(&quot;keyMultiValues&quot;, values);</span>
<span class="fc" id="L808">        props.addProperty(&quot;keyReference&quot;, &quot;${keyMultiValues}&quot;);</span>
<span class="fc" id="L809">        cc.addConfiguration(props);</span>
<span class="fc" id="L810">        assertArrayEquals(&quot;Wrong interpolated value&quot;, values,</span>
<span class="fc" id="L811">                cc.getStringArray(&quot;keyReference&quot;));</span>
<span class="fc" id="L812">    }</span>

    /**
     * Tests the behavior of setListDelimiterHandler() if the in-memory configuration
     * is not derived from BaseConfiguration. This test is related to
     * CONFIGURATION-476.
     */
    @Test
    public void testSetListDelimiterInMemoryConfigNonBaseConfig()
    {
<span class="fc" id="L822">        Configuration inMemoryConfig = EasyMock.createMock(Configuration.class);</span>
<span class="fc" id="L823">        EasyMock.replay(inMemoryConfig);</span>
<span class="fc" id="L824">        cc = new CompositeConfiguration(inMemoryConfig);</span>
<span class="fc" id="L825">        cc.setListDelimiterHandler(new DefaultListDelimiterHandler(';'));</span>
<span class="fc" id="L826">    }</span>

    /**
     * Tests whether a configuration can act as both regular child configuration
     * and in-memory configuration. This test is related to CONFIGURATION-471.
     */
    @Test
    public void testUseChildConfigAsInMemoryConfig()
    {
<span class="fc" id="L835">        conf1.setProperty(TEST_PROPERTY, &quot;conf1&quot;);</span>
<span class="fc" id="L836">        conf2.setProperty(TEST_PROPERTY, &quot;conf2&quot;);</span>
<span class="fc" id="L837">        cc.addConfiguration(conf1, true);</span>
<span class="fc" id="L838">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L839">        assertEquals(&quot;Wrong number of configurations&quot;, 2,</span>
<span class="fc" id="L840">                cc.getNumberOfConfigurations());</span>
<span class="fc" id="L841">        assertEquals(&quot;Wrong property&quot;, &quot;conf1&quot;, cc.getString(TEST_PROPERTY));</span>
<span class="fc" id="L842">        cc.addProperty(&quot;newProperty&quot;, &quot;newValue&quot;);</span>
<span class="fc" id="L843">        assertEquals(&quot;Not added to in-memory config&quot;, &quot;newValue&quot;,</span>
<span class="fc" id="L844">                conf1.getString(&quot;newProperty&quot;));</span>
<span class="fc" id="L845">    }</span>

    /**
     * Tests whether the in-memory configuration can be replaced by a new child
     * configuration.
     */
    @Test
    public void testReplaceInMemoryConfig()
    {
<span class="fc" id="L854">        conf1.setProperty(TEST_PROPERTY, &quot;conf1&quot;);</span>
<span class="fc" id="L855">        conf2.setProperty(TEST_PROPERTY, &quot;conf2&quot;);</span>
<span class="fc" id="L856">        cc.addConfiguration(conf1, true);</span>
<span class="fc" id="L857">        cc.addProperty(&quot;newProperty1&quot;, &quot;newValue1&quot;);</span>
<span class="fc" id="L858">        cc.addConfiguration(conf2, true);</span>
<span class="fc" id="L859">        cc.addProperty(&quot;newProperty2&quot;, &quot;newValue2&quot;);</span>
<span class="fc" id="L860">        assertEquals(&quot;Wrong property&quot;, &quot;conf1&quot;, cc.getString(TEST_PROPERTY));</span>
<span class="fc" id="L861">        assertEquals(&quot;Not added to in-memory config&quot;, &quot;newValue1&quot;,</span>
<span class="fc" id="L862">                conf1.getString(&quot;newProperty1&quot;));</span>
<span class="fc" id="L863">        assertEquals(&quot;In-memory config not changed&quot;, &quot;newValue2&quot;,</span>
<span class="fc" id="L864">                conf2.getString(&quot;newProperty2&quot;));</span>
<span class="fc" id="L865">    }</span>

    /**
     * Creates a test synchronizer and installs it at the test configuration.
     *
     * @return the test synchronizer
     */
    private SynchronizerTestImpl installSynchronizer()
    {
<span class="fc" id="L874">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L875">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L876">        SynchronizerTestImpl sync = new SynchronizerTestImpl();</span>
<span class="fc" id="L877">        cc.setSynchronizer(sync);</span>
<span class="fc" id="L878">        return sync;</span>
    }

    /**
     * Tests whether adding a child configuration is synchronized.
     */
    @Test
    public void testAddConfigurationSynchronized()
    {
<span class="fc" id="L887">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L888">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L889">        sync.verify(Methods.BEGIN_WRITE, Methods.END_WRITE);</span>
<span class="fc" id="L890">    }</span>

    /**
     * Tests whether removing a child configuration is synchronized.
     */
    @Test
    public void testRemoveConfigurationSynchronized()
    {
<span class="fc" id="L898">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L899">        cc.removeConfiguration(conf1);</span>
<span class="fc" id="L900">        sync.verify(Methods.BEGIN_WRITE, Methods.END_WRITE);</span>
<span class="fc" id="L901">    }</span>

    /**
     * Tests whether access to a configuration by index is synchronized.
     */
    @Test
    public void testGetConfigurationSynchronized()
    {
<span class="fc" id="L909">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L910">        assertEquals(&quot;Wrong result&quot;, conf1, cc.getConfiguration(0));</span>
<span class="fc" id="L911">        sync.verify(Methods.BEGIN_READ, Methods.END_READ);</span>
<span class="fc" id="L912">    }</span>

    /**
     * Tests whether access to the in-memory configuration is synchronized.
     */
    @Test
    public void testGetInMemoryConfigurationSynchronized()
    {
<span class="fc" id="L920">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L921">        cc.getInMemoryConfiguration();</span>
<span class="fc" id="L922">        sync.verify(Methods.BEGIN_READ, Methods.END_READ);</span>
<span class="fc" id="L923">    }</span>

    /**
     * Tests whether querying the number of child configurations is
     * synchronized.
     */
    @Test
    public void testGetNumberOfConfigurationsSynchronized()
    {
<span class="fc" id="L932">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L933">        assertEquals(&quot;Wrong number of configurations&quot;, 3,</span>
<span class="fc" id="L934">                cc.getNumberOfConfigurations());</span>
<span class="fc" id="L935">        sync.verify(Methods.BEGIN_READ, Methods.END_READ);</span>
<span class="fc" id="L936">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>