<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TestCompositeConfiguration.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_configuration2$Unnamed.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.configuration2</a> &gt; <span class="el_source">TestCompositeConfiguration.java</span></div><h1>TestCompositeConfiguration.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.commons.configuration2;

import static org.junit.Assert.assertArrayEquals;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertNotSame;
import static org.junit.Assert.assertNull;
import static org.junit.Assert.assertSame;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

import java.io.File;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;
import java.util.NoSuchElementException;

import org.apache.commons.configuration2.SynchronizerTestImpl.Methods;
import org.apache.commons.configuration2.convert.DefaultListDelimiterHandler;
import org.apache.commons.configuration2.convert.LegacyListDelimiterHandler;
import org.apache.commons.configuration2.convert.ListDelimiterHandler;
import org.apache.commons.configuration2.event.ConfigurationEvent;
import org.apache.commons.configuration2.event.EventListenerTestImpl;
import org.apache.commons.configuration2.ex.ConfigurationRuntimeException;
import org.apache.commons.configuration2.io.FileHandler;
import org.easymock.EasyMock;
import org.junit.Before;
import org.junit.Test;

/**
 * Test class for {@code CompositeConfiguration}.
 *
 * @version $Id$
 */
<span class="fc" id="L54">public class TestCompositeConfiguration</span>
{
    /** Constant for a test property to be checked.*/
    private static final String TEST_PROPERTY = &quot;test.source.property&quot;;

    protected PropertiesConfiguration conf1;
    protected PropertiesConfiguration conf2;
    protected XMLConfiguration xmlConf;
    protected CompositeConfiguration cc;

    /**
     * The File that we test with
     */
<span class="fc" id="L67">    private final String testProperties = ConfigurationAssert.getTestFile(&quot;test.properties&quot;).getAbsolutePath();</span>
<span class="fc" id="L68">    private final String testProperties2 = ConfigurationAssert.getTestFile(&quot;test2.properties&quot;).getAbsolutePath();</span>
<span class="fc" id="L69">    private final String testPropertiesXML = ConfigurationAssert.getTestFile(&quot;test.xml&quot;).getAbsolutePath();</span>

    @Before
    public void setUp() throws Exception
    {
<span class="fc" id="L74">        cc = new CompositeConfiguration();</span>
<span class="fc" id="L75">        ListDelimiterHandler listHandler = new LegacyListDelimiterHandler(',');</span>
<span class="fc" id="L76">        conf1 = new PropertiesConfiguration();</span>
<span class="fc" id="L77">        conf1.setListDelimiterHandler(listHandler);</span>
<span class="fc" id="L78">        FileHandler handler1 = new FileHandler(conf1);</span>
<span class="fc" id="L79">        handler1.setFileName(testProperties);</span>
<span class="fc" id="L80">        handler1.load();</span>
<span class="fc" id="L81">        conf2 = new PropertiesConfiguration();</span>
<span class="fc" id="L82">        conf2.setListDelimiterHandler(listHandler);</span>
<span class="fc" id="L83">        FileHandler handler2 = new FileHandler(conf2);</span>
<span class="fc" id="L84">        handler2.setFileName(testProperties2);</span>
<span class="fc" id="L85">        handler2.load();</span>
<span class="fc" id="L86">        xmlConf = new XMLConfiguration();</span>
<span class="fc" id="L87">        FileHandler handler3 = new FileHandler(xmlConf);</span>
<span class="fc" id="L88">        handler3.load(new File(testPropertiesXML));</span>

<span class="fc" id="L90">        cc.setThrowExceptionOnMissing(true);</span>
<span class="fc" id="L91">    }</span>

    @Test
    public void testThrowExceptionOnMissing()
    {
<span class="fc" id="L96">        assertTrue(&quot;Throw Exception Property is not set!&quot;, cc.isThrowExceptionOnMissing());</span>
<span class="fc" id="L97">    }</span>

    @Test
    public void testAddRemoveConfigurations() throws Exception
    {
<span class="fc" id="L102">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L103">        assertEquals(&quot;Number of configurations&quot;, 2, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L104">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L105">        assertEquals(&quot;Number of configurations&quot;, 2, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L106">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L107">        assertEquals(&quot;Number of configurations&quot;, 3, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L108">        cc.removeConfiguration(conf1);</span>
<span class="fc" id="L109">        assertEquals(&quot;Number of configurations&quot;, 2, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L110">        cc.clear();</span>
<span class="fc" id="L111">        assertEquals(&quot;Number of configurations&quot;, 1, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L112">    }</span>

    @Test
    public void testAddFirstRemoveConfigurations() throws Exception
    {
<span class="fc" id="L117">        cc.addConfigurationFirst(conf1);</span>
<span class="fc" id="L118">        assertEquals(&quot;Number of configurations&quot;, 2, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L119">        cc.addConfigurationFirst(conf1);</span>
<span class="fc" id="L120">        assertEquals(&quot;Number of configurations&quot;, 2, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L121">        cc.addConfigurationFirst(conf2);</span>
<span class="fc" id="L122">        assertEquals(&quot;Number of configurations&quot;, 3, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L123">        cc.removeConfiguration(conf1);</span>
<span class="fc" id="L124">        assertEquals(&quot;Number of configurations&quot;, 2, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L125">        cc.clear();</span>
<span class="fc" id="L126">        assertEquals(&quot;Number of configurations&quot;, 1, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L127">    }</span>

    @Test
    public void testGetPropertyWIncludes() throws Exception
    {
<span class="fc" id="L132">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L133">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L134">        List&lt;Object&gt; l = cc.getList(&quot;packages&quot;);</span>
<span class="fc" id="L135">        assertTrue(l.contains(&quot;packagea&quot;));</span>
<span class="fc" id="L136">    }</span>

    @Test
    public void testGetProperty() throws Exception
    {
<span class="fc" id="L141">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L142">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L143">        assertEquals(&quot;Make sure we get the property from conf1 first&quot;, &quot;test.properties&quot;, cc.getString(&quot;propertyInOrder&quot;));</span>
<span class="fc" id="L144">        cc.clear();</span>

<span class="fc" id="L146">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L147">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L148">        assertEquals(&quot;Make sure we get the property from conf2 first&quot;, &quot;test2.properties&quot;, cc.getString(&quot;propertyInOrder&quot;));</span>
<span class="fc" id="L149">        cc.clear();</span>

<span class="fc" id="L151">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L152">        cc.addConfigurationFirst(conf2);</span>
<span class="fc" id="L153">        assertEquals(&quot;Make sure we get the property from conf2 first&quot;, &quot;test2.properties&quot;, cc.getString(&quot;propertyInOrder&quot;));</span>
<span class="fc" id="L154">        cc.clear();</span>
<span class="fc" id="L155">    }</span>

    @Test
    public void testCantRemoveMemoryConfig() throws Exception
    {
<span class="fc" id="L160">        cc.clear();</span>
<span class="fc" id="L161">        assertEquals(1, cc.getNumberOfConfigurations());</span>

<span class="fc" id="L163">        Configuration internal = cc.getConfiguration(0);</span>
<span class="fc" id="L164">        cc.removeConfiguration(internal);</span>

<span class="fc" id="L166">        assertEquals(1, cc.getNumberOfConfigurations());</span>
<span class="fc" id="L167">    }</span>

    @Test
    public void testGetPropertyMissing() throws Exception
    {
<span class="fc" id="L172">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L173">        cc.addConfiguration(conf2);</span>
        try
        {
<span class="nc" id="L176">            assertNull(cc.getString(&quot;bogus.property&quot;));</span>
<span class="nc" id="L177">            fail(&quot;Should have thrown a NoSuchElementException&quot;);</span>
        }
<span class="fc" id="L179">        catch (NoSuchElementException nsee)</span>
        {
<span class="fc" id="L181">            assertTrue(nsee.getMessage().contains(&quot;bogus.property&quot;));</span>
<span class="nc" id="L182">        }</span>

<span class="pc bpc" id="L184" title="1 of 2 branches missed.">        assertTrue(&quot;Should be false&quot;, !cc.getBoolean(&quot;test.missing.boolean&quot;, false));</span>
<span class="fc" id="L185">        assertTrue(&quot;Should be true&quot;, cc.getBoolean(&quot;test.missing.boolean.true&quot;, true));</span>
<span class="fc" id="L186">    }</span>

    /**
     * Tests {@code List} parsing.
     */
    @Test
    public void testMultipleTypesOfConfigs() throws Exception
    {
<span class="fc" id="L194">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L195">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L196">        assertEquals(&quot;Make sure we get the property from conf1 first&quot;, 1, cc.getInt(&quot;test.short&quot;));</span>
<span class="fc" id="L197">        cc.clear();</span>

<span class="fc" id="L199">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L200">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L201">        assertEquals(&quot;Make sure we get the property from xml&quot;, 8, cc.getInt(&quot;test.short&quot;));</span>
<span class="fc" id="L202">    }</span>

    @Test
    public void testPropertyExistsInOnlyOneConfig() throws Exception
    {
<span class="fc" id="L207">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L208">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L209">        assertEquals(&quot;value&quot;, cc.getString(&quot;element&quot;));</span>
<span class="fc" id="L210">    }</span>

    /**
     * Tests getting a default when the key doesn't exist
     */
    @Test
    public void testDefaultValueWhenKeyMissing() throws Exception
    {
<span class="fc" id="L218">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L219">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L220">        assertEquals(&quot;default&quot;, cc.getString(&quot;bogus&quot;, &quot;default&quot;));</span>
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">        assertTrue(1.4 == cc.getDouble(&quot;bogus&quot;, 1.4));</span>
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">        assertTrue(1.4 == cc.getDouble(&quot;bogus&quot;, 1.4));</span>
<span class="fc" id="L223">    }</span>

    @Test
    public void testGettingConfiguration() throws Exception
    {
<span class="fc" id="L228">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L229">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L230">        assertEquals(PropertiesConfiguration.class, cc.getConfiguration(0).getClass());</span>
<span class="fc" id="L231">        assertEquals(XMLConfiguration.class, cc.getConfiguration(1).getClass());</span>
<span class="fc" id="L232">    }</span>

    /**
     * Tests setting values.  These are set in memory mode only!
     */
    @Test
    public void testClearingProperty() throws Exception
    {
<span class="fc" id="L240">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L241">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L242">        cc.clearProperty(&quot;test.short&quot;);</span>
<span class="pc bpc" id="L243" title="1 of 2 branches missed.">        assertTrue(&quot;Make sure test.short is gone!&quot;, !cc.containsKey(&quot;test.short&quot;));</span>
<span class="fc" id="L244">    }</span>

    /**
     * Tests adding values.  Make sure they _DON'T_ override any other properties but add to the
     * existing properties  and keep sequence
     */
    @Test
    public void testAddingProperty() throws Exception
    {
<span class="fc" id="L253">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L254">        cc.addConfiguration(xmlConf);</span>

<span class="fc" id="L256">        String[] values = cc.getStringArray(&quot;test.short&quot;);</span>

<span class="fc" id="L258">        assertEquals(&quot;Number of values before add is wrong!&quot;, 1, values.length);</span>
<span class="fc" id="L259">        assertEquals(&quot;First Value before add is wrong&quot;, &quot;1&quot;, values[0]);</span>

<span class="fc" id="L261">        cc.addProperty(&quot;test.short&quot;, &quot;88&quot;);</span>

<span class="fc" id="L263">        values = cc.getStringArray(&quot;test.short&quot;);</span>

<span class="fc" id="L265">        assertEquals(&quot;Number of values is wrong!&quot;, 2, values.length);</span>
<span class="fc" id="L266">        assertEquals(&quot;First Value is wrong&quot;, &quot;1&quot;, values[0]);</span>
<span class="fc" id="L267">        assertEquals(&quot;Third Value is wrong&quot;, &quot;88&quot;, values[1]);</span>
<span class="fc" id="L268">    }</span>

    /**
     * Tests setting values.  These are set in memory mode only!
     */
    @Test
    public void testSettingMissingProperty() throws Exception
    {
<span class="fc" id="L276">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L277">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L278">        cc.setProperty(&quot;my.new.property&quot;, &quot;supernew&quot;);</span>
<span class="fc" id="L279">        assertEquals(&quot;supernew&quot;, cc.getString(&quot;my.new.property&quot;));</span>
<span class="fc" id="L280">    }</span>

    /**
     * Tests retrieving subsets of configurations
     */
    @Test
    public void testGettingSubset() throws Exception
    {
<span class="fc" id="L288">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L289">        cc.addConfiguration(xmlConf);</span>

<span class="fc" id="L291">        Configuration subset = cc.subset(&quot;test&quot;);</span>
<span class="fc" id="L292">        assertNotNull(subset);</span>
<span class="fc" id="L293">        assertFalse(&quot;Shouldn't be empty&quot;, subset.isEmpty());</span>
<span class="fc" id="L294">        assertEquals(&quot;Make sure the initial loaded configs subset overrides any later add configs subset&quot;, &quot;1&quot;, subset.getString(&quot;short&quot;));</span>

<span class="fc" id="L296">        cc.setProperty(&quot;test.short&quot;, &quot;43&quot;);</span>
<span class="fc" id="L297">        subset = cc.subset(&quot;test&quot;);</span>
<span class="fc" id="L298">        assertEquals(&quot;Make sure the initial loaded configs subset overrides any later add configs subset&quot;, &quot;43&quot;, subset.getString(&quot;short&quot;));</span>
<span class="fc" id="L299">    }</span>

    /**
     * Tests subsets and still can resolve elements
     */
    @Test
    public void testSubsetCanResolve() throws Exception
    {
<span class="fc" id="L307">        cc = new CompositeConfiguration();</span>
<span class="fc" id="L308">        final BaseConfiguration config = new BaseConfiguration();</span>
<span class="fc" id="L309">        config.addProperty(&quot;subset.tempfile&quot;, &quot;${java.io.tmpdir}/file.tmp&quot;);</span>
<span class="fc" id="L310">        cc.addConfiguration(config);</span>
<span class="fc" id="L311">        cc.addConfiguration(ConfigurationConverter.getConfiguration(System.getProperties()));</span>

<span class="fc" id="L313">        Configuration subset = cc.subset(&quot;subset&quot;);</span>
<span class="fc" id="L314">        assertEquals(System.getProperty(&quot;java.io.tmpdir&quot;) + &quot;/file.tmp&quot;, subset.getString(&quot;tempfile&quot;));</span>
<span class="fc" id="L315">    }</span>

    /**
     * Tests {@code List} parsing.
     */
    @Test
    public void testList() throws Exception
    {
<span class="fc" id="L323">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L324">        cc.addConfiguration(xmlConf);</span>

<span class="fc" id="L326">        List&lt;Object&gt; packages = cc.getList(&quot;packages&quot;);</span>
        // we should get 3 packages here
<span class="fc" id="L328">        assertEquals(3, packages.size());</span>

<span class="fc" id="L330">        List&lt;Object&gt; defaultList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L331">        defaultList.add(&quot;1&quot;);</span>
<span class="fc" id="L332">        defaultList.add(&quot;2&quot;);</span>

<span class="fc" id="L334">        packages = cc.getList(&quot;packages.which.dont.exist&quot;, defaultList);</span>
        // we should get 2 packages here
<span class="fc" id="L336">        assertEquals(2, packages.size());</span>

<span class="fc" id="L338">    }</span>

    /**
     * Tests {@code String} array parsing.
     */
    @Test
    public void testStringArray() throws Exception
    {
<span class="fc" id="L346">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L347">        cc.addConfiguration(xmlConf);</span>

<span class="fc" id="L349">        String[] packages = cc.getStringArray(&quot;packages&quot;);</span>
        // we should get 3 packages here
<span class="fc" id="L351">        assertEquals(3, packages.length);</span>

<span class="fc" id="L353">        packages = cc.getStringArray(&quot;packages.which.dont.exist&quot;);</span>
        // we should get 0 packages here
<span class="fc" id="L355">        assertEquals(0, packages.length);</span>
<span class="fc" id="L356">    }</span>

    @Test
    public void testGetList()
    {
<span class="fc" id="L361">        Configuration conf1 = new BaseConfiguration();</span>
<span class="fc" id="L362">        conf1.addProperty(&quot;array&quot;, &quot;value1&quot;);</span>
<span class="fc" id="L363">        conf1.addProperty(&quot;array&quot;, &quot;value2&quot;);</span>

<span class="fc" id="L365">        Configuration conf2 = new BaseConfiguration();</span>
<span class="fc" id="L366">        conf2.addProperty(&quot;array&quot;, &quot;value3&quot;);</span>
<span class="fc" id="L367">        conf2.addProperty(&quot;array&quot;, &quot;value4&quot;);</span>

<span class="fc" id="L369">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L370">        cc.addConfiguration(conf2);</span>

        // check the composite 'array' property
<span class="fc" id="L373">        List&lt;Object&gt; list = cc.getList(&quot;array&quot;);</span>
<span class="fc" id="L374">        assertNotNull(&quot;null list&quot;, list);</span>
<span class="fc" id="L375">        assertEquals(&quot;list size&quot;, 2, list.size());</span>
<span class="fc" id="L376">        assertTrue(&quot;'value1' not found in the list&quot;, list.contains(&quot;value1&quot;));</span>
<span class="fc" id="L377">        assertTrue(&quot;'value2' not found in the list&quot;, list.contains(&quot;value2&quot;));</span>

        // add an element to the list in the composite configuration
<span class="fc" id="L380">        cc.addProperty(&quot;array&quot;, &quot;value5&quot;);</span>

        // test the new list
<span class="fc" id="L383">        list = cc.getList(&quot;array&quot;);</span>
<span class="fc" id="L384">        assertNotNull(&quot;null list&quot;, list);</span>
<span class="fc" id="L385">        assertEquals(&quot;list size&quot;, 3, list.size());</span>
<span class="fc" id="L386">        assertTrue(&quot;'value1' not found in the list&quot;, list.contains(&quot;value1&quot;));</span>
<span class="fc" id="L387">        assertTrue(&quot;'value2' not found in the list&quot;, list.contains(&quot;value2&quot;));</span>
<span class="fc" id="L388">        assertTrue(&quot;'value5' not found in the list&quot;, list.contains(&quot;value5&quot;));</span>
<span class="fc" id="L389">    }</span>

    /**
     * Tests {@code getKeys} preserves the order
     */
    @Test
    public void testGetKeysPreservesOrder() throws Exception
    {
<span class="fc" id="L397">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L398">        List&lt;String&gt; orderedList = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L399" title="All 2 branches covered.">        for (Iterator&lt;String&gt; keys = conf1.getKeys(); keys.hasNext();)</span>
        {
<span class="fc" id="L401">            orderedList.add(keys.next());</span>
        }
<span class="fc" id="L403">        List&lt;String&gt; iteratedList = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L404" title="All 2 branches covered.">        for (Iterator&lt;String&gt; keys = cc.getKeys(); keys.hasNext();)</span>
        {
<span class="fc" id="L406">            iteratedList.add(keys.next());</span>
        }
<span class="fc" id="L408">        assertEquals(orderedList.size(), iteratedList.size());</span>
<span class="fc bfc" id="L409" title="All 2 branches covered.">        for (int i = 0; i &lt; orderedList.size(); i++)</span>
        {
<span class="fc" id="L411">            assertEquals(orderedList.get(i), iteratedList.get(i));</span>
        }
<span class="fc" id="L413">    }</span>

    /**
     * Tests {@code getKeys(String key)} preserves the order
     */
    @Test
    public void testGetKeys2PreservesOrder() throws Exception
    {
<span class="fc" id="L421">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L422">        List&lt;String&gt; orderedList = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L423" title="All 2 branches covered.">        for (Iterator&lt;String&gt; keys = conf1.getKeys(&quot;test&quot;); keys.hasNext();)</span>
        {
<span class="fc" id="L425">            orderedList.add(keys.next());</span>
        }
<span class="fc" id="L427">        List&lt;String&gt; iteratedList = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L428" title="All 2 branches covered.">        for (Iterator&lt;String&gt; keys = cc.getKeys(&quot;test&quot;); keys.hasNext();)</span>
        {
<span class="fc" id="L430">            iteratedList.add(keys.next());</span>
        }
<span class="fc" id="L432">        assertEquals(orderedList.size(), iteratedList.size());</span>
<span class="fc bfc" id="L433" title="All 2 branches covered.">        for (int i = 0; i &lt; orderedList.size(); i++)</span>
        {
<span class="fc" id="L435">            assertEquals(orderedList.get(i), iteratedList.get(i));</span>
        }
<span class="fc" id="L437">    }</span>

    @Test
    public void testGetStringWithDefaults()
    {
<span class="fc" id="L442">        BaseConfiguration defaults = new BaseConfiguration();</span>
<span class="fc" id="L443">        defaults.addProperty(&quot;default&quot;, &quot;default string&quot;);</span>

<span class="fc" id="L445">        CompositeConfiguration c = new CompositeConfiguration(defaults);</span>
<span class="fc" id="L446">        c.setThrowExceptionOnMissing(cc.isThrowExceptionOnMissing());</span>
<span class="fc" id="L447">        c.addProperty(&quot;string&quot;, &quot;test string&quot;);</span>

<span class="fc" id="L449">        assertEquals(&quot;test string&quot;, c.getString(&quot;string&quot;));</span>
        try
        {
<span class="nc" id="L452">            c.getString(&quot;XXX&quot;);</span>
<span class="nc" id="L453">            fail(&quot;Should throw NoSuchElementException exception&quot;);</span>
        }
<span class="fc" id="L455">        catch (NoSuchElementException e)</span>
        {
            //ok
        }
<span class="nc" id="L459">        catch (Exception e)</span>
        {
<span class="nc" id="L461">            fail(&quot;Should throw NoSuchElementException exception, not &quot; + e);</span>
<span class="pc" id="L462">        }</span>

        //test defaults
<span class="fc" id="L465">        assertEquals(&quot;test string&quot;, c.getString(&quot;string&quot;, &quot;some default value&quot;));</span>
<span class="fc" id="L466">        assertEquals(&quot;default string&quot;, c.getString(&quot;default&quot;));</span>
<span class="fc" id="L467">        assertEquals(&quot;default string&quot;, c.getString(&quot;default&quot;, &quot;some default value&quot;));</span>
<span class="fc" id="L468">        assertEquals(&quot;some default value&quot;, c.getString(&quot;XXX&quot;, &quot;some default value&quot;));</span>
<span class="fc" id="L469">    }</span>

    @Test
    public void testCheckingInMemoryConfiguration() throws Exception
    {
<span class="fc" id="L474">        String TEST_KEY = &quot;testKey&quot;;</span>
<span class="fc" id="L475">        Configuration defaults = new PropertiesConfiguration();</span>
<span class="fc" id="L476">        defaults.setProperty(TEST_KEY, &quot;testValue&quot;);</span>
<span class="fc" id="L477">        Configuration testConfiguration = new CompositeConfiguration(defaults);</span>
<span class="fc" id="L478">        assertTrue(testConfiguration.containsKey(TEST_KEY));</span>
<span class="fc" id="L479">        assertFalse(testConfiguration.isEmpty());</span>
<span class="fc" id="L480">        boolean foundTestKey = false;</span>
<span class="fc" id="L481">        Iterator&lt;String&gt; i = testConfiguration.getKeys();</span>
        //assertTrue(i instanceof IteratorChain);
        //IteratorChain ic = (IteratorChain)i;
        //assertEquals(2,i.size());
<span class="fc bfc" id="L485" title="All 2 branches covered.">        for (; i.hasNext();)</span>
        {
<span class="fc" id="L487">            String key = i.next();</span>
<span class="pc bpc" id="L488" title="1 of 2 branches missed.">            if (key.equals(TEST_KEY))</span>
            {
<span class="fc" id="L490">                foundTestKey = true;</span>
            }
<span class="fc" id="L492">        }</span>
<span class="fc" id="L493">        assertTrue(foundTestKey);</span>
<span class="fc" id="L494">        testConfiguration.clearProperty(TEST_KEY);</span>
<span class="fc" id="L495">        assertFalse(testConfiguration.containsKey(TEST_KEY));</span>
<span class="fc" id="L496">    }</span>

    @Test
    public void testStringArrayInterpolation()
    {
<span class="fc" id="L501">        CompositeConfiguration config = new CompositeConfiguration();</span>
<span class="fc" id="L502">        config.addProperty(&quot;base&quot;, &quot;foo&quot;);</span>
<span class="fc" id="L503">        config.addProperty(&quot;list&quot;, &quot;${base}.bar1&quot;);</span>
<span class="fc" id="L504">        config.addProperty(&quot;list&quot;, &quot;${base}.bar2&quot;);</span>
<span class="fc" id="L505">        config.addProperty(&quot;list&quot;, &quot;${base}.bar3&quot;);</span>

<span class="fc" id="L507">        String[] array = config.getStringArray(&quot;list&quot;);</span>
<span class="fc" id="L508">        assertEquals(&quot;size&quot;, 3, array.length);</span>
<span class="fc" id="L509">        assertEquals(&quot;1st element&quot;, &quot;foo.bar1&quot;, array[0]);</span>
<span class="fc" id="L510">        assertEquals(&quot;2nd element&quot;, &quot;foo.bar2&quot;, array[1]);</span>
<span class="fc" id="L511">        assertEquals(&quot;3rd element&quot;, &quot;foo.bar3&quot;, array[2]);</span>
<span class="fc" id="L512">    }</span>

    /**
     * Tests whether global interpolation works with lists.
     */
    @Test
    public void testListInterpolation()
    {
<span class="fc" id="L520">        PropertiesConfiguration c1 = new PropertiesConfiguration();</span>
<span class="fc" id="L521">        c1.addProperty(&quot;c1.value&quot;, &quot;test1&quot;);</span>
<span class="fc" id="L522">        c1.addProperty(&quot;c1.value&quot;, &quot;${c2.value}&quot;);</span>
<span class="fc" id="L523">        cc.addConfiguration(c1);</span>
<span class="fc" id="L524">        PropertiesConfiguration c2 = new PropertiesConfiguration();</span>
<span class="fc" id="L525">        c2.addProperty(&quot;c2.value&quot;, &quot;test2&quot;);</span>
<span class="fc" id="L526">        cc.addConfiguration(c2);</span>
<span class="fc" id="L527">        List&lt;Object&gt; lst = cc.getList(&quot;c1.value&quot;);</span>
<span class="fc" id="L528">        assertEquals(&quot;Wrong list size&quot;, 2, lst.size());</span>
<span class="fc" id="L529">        assertEquals(&quot;Wrong first element&quot;, &quot;test1&quot;, lst.get(0));</span>
<span class="fc" id="L530">        assertEquals(&quot;Wrong second element&quot;, &quot;test2&quot;, lst.get(1));</span>
<span class="fc" id="L531">    }</span>

    @Test
    public void testInstanciateWithCollection()
    {
<span class="fc" id="L536">        Collection&lt;Configuration&gt; configs = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L537">        configs.add(xmlConf);</span>
<span class="fc" id="L538">        configs.add(conf1);</span>
<span class="fc" id="L539">        configs.add(conf2);</span>

<span class="fc" id="L541">        CompositeConfiguration config = new CompositeConfiguration(configs);</span>
<span class="fc" id="L542">        assertEquals(&quot;Number of configurations&quot;, 4, config.getNumberOfConfigurations());</span>
<span class="fc" id="L543">        assertTrue(&quot;The in memory configuration is not empty&quot;, config.getInMemoryConfiguration().isEmpty());</span>
<span class="fc" id="L544">    }</span>

    @Test
    public void testClone()
    {
<span class="fc" id="L549">        CompositeConfiguration cc2 = (CompositeConfiguration) cc.clone();</span>
<span class="fc" id="L550">        assertEquals(&quot;Wrong number of contained configurations&quot;, cc</span>
<span class="fc" id="L551">                .getNumberOfConfigurations(), cc2.getNumberOfConfigurations());</span>

<span class="fc" id="L553">        StrictConfigurationComparator comp = new StrictConfigurationComparator();</span>
<span class="fc bfc" id="L554" title="All 2 branches covered.">        for (int i = 0; i &lt; cc.getNumberOfConfigurations(); i++)</span>
        {
<span class="fc" id="L556">            assertEquals(&quot;Wrong configuration class at &quot; + i, cc</span>
<span class="fc" id="L557">                    .getConfiguration(i).getClass(), cc2.getConfiguration(i)</span>
<span class="fc" id="L558">                    .getClass());</span>
<span class="fc" id="L559">            assertNotSame(&quot;Configuration was not cloned&quot;, cc</span>
<span class="fc" id="L560">                    .getConfiguration(i), cc2.getConfiguration(i));</span>
<span class="fc" id="L561">            assertTrue(&quot;Configurations at &quot; + i + &quot; not equal&quot;, comp.compare(cc</span>
<span class="fc" id="L562">                    .getConfiguration(i), cc2.getConfiguration(i)));</span>
        }

<span class="fc" id="L565">        assertTrue(&quot;Configurations are not equal&quot;, comp.compare(cc, cc2));</span>
<span class="fc" id="L566">    }</span>

    /**
     * Tests cloning if one of the contained configurations does not support
     * this operation. This should cause an exception.
     */
    @Test(expected = ConfigurationRuntimeException.class)
    public void testCloneNotSupported()
    {
<span class="fc" id="L575">        cc.addConfiguration(new NonCloneableConfiguration());</span>
<span class="nc" id="L576">        cc.clone();</span>
<span class="nc" id="L577">    }</span>

    /**
     * Ensures that event listeners are not cloned.
     */
    @Test
    public void testCloneEventListener()
    {
<span class="fc" id="L585">        cc.addEventListener(ConfigurationEvent.ANY, new EventListenerTestImpl(null));</span>
<span class="fc" id="L586">        CompositeConfiguration cc2 = (CompositeConfiguration) cc.clone();</span>
<span class="fc" id="L587">        assertTrue(&quot;Listeners have been cloned&quot;, cc2</span>
<span class="fc" id="L588">                .getEventListeners(ConfigurationEvent.ANY).isEmpty());</span>
<span class="fc" id="L589">    }</span>

    /**
     * Tests whether interpolation works as expected after cloning.
     */
    @Test
    public void testCloneInterpolation()
    {
<span class="fc" id="L597">        CompositeConfiguration cc2 = (CompositeConfiguration) cc.clone();</span>
<span class="fc" id="L598">        assertNotSame(&quot;Interpolator was not cloned&quot;, cc.getInterpolator(),</span>
<span class="fc" id="L599">                cc2.getInterpolator());</span>
<span class="fc" id="L600">    }</span>

    /**
     * Tests whether add property events are triggered.
     */
    @Test
    public void testEventAddProperty()
    {
<span class="fc" id="L608">        EventListenerTestImpl listener = new EventListenerTestImpl(cc);</span>
<span class="fc" id="L609">        cc.addEventListener(ConfigurationEvent.ANY, listener);</span>
<span class="fc" id="L610">        cc.addProperty(&quot;test&quot;, &quot;value&quot;);</span>
<span class="fc" id="L611">        listener.checkEvent(ConfigurationEvent.ADD_PROPERTY, &quot;test&quot;, &quot;value&quot;, true);</span>
<span class="fc" id="L612">        listener.checkEvent(ConfigurationEvent.ADD_PROPERTY, &quot;test&quot;, &quot;value&quot;, false);</span>
<span class="fc" id="L613">        listener.done();</span>
<span class="fc" id="L614">    }</span>

    /**
     * Tests whether set property events are triggered.
     */
    @Test
    public void testEventSetProperty()
    {
<span class="fc" id="L622">        EventListenerTestImpl listener = new EventListenerTestImpl(cc);</span>
<span class="fc" id="L623">        cc.addEventListener(ConfigurationEvent.ANY, listener);</span>
<span class="fc" id="L624">        cc.setProperty(&quot;test&quot;, &quot;value&quot;);</span>
<span class="fc" id="L625">        listener.checkEvent(ConfigurationEvent.SET_PROPERTY, &quot;test&quot;, &quot;value&quot;, true);</span>
<span class="fc" id="L626">        listener.checkEvent(ConfigurationEvent.SET_PROPERTY, &quot;test&quot;, &quot;value&quot;, false);</span>
<span class="fc" id="L627">        listener.done();</span>
<span class="fc" id="L628">    }</span>

    /**
     * Tests whether clear property events are triggered.
     */
    @Test
    public void testEventClearProperty()
    {
<span class="fc" id="L636">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L637">        String key = &quot;configuration.loaded&quot;;</span>
<span class="fc" id="L638">        assertTrue(&quot;Wrong value for property&quot;, cc</span>
<span class="fc" id="L639">                .getBoolean(key));</span>
<span class="fc" id="L640">        EventListenerTestImpl listener = new EventListenerTestImpl(cc);</span>
<span class="fc" id="L641">        cc.addEventListener(ConfigurationEvent.ANY, listener);</span>
<span class="fc" id="L642">        cc.clearProperty(key);</span>
<span class="fc" id="L643">        assertFalse(&quot;Key still present&quot;, cc.containsKey(key));</span>
<span class="fc" id="L644">        listener.checkEvent(ConfigurationEvent.CLEAR_PROPERTY, key, null, true);</span>
<span class="fc" id="L645">        listener.checkEvent(ConfigurationEvent.CLEAR_PROPERTY, key, null, false);</span>
<span class="fc" id="L646">        listener.done();</span>
<span class="fc" id="L647">    }</span>

    /**
     * Tests changing the list delimiter handler.
     */
    @Test
    public void testSetListDelimiter()
    {
<span class="fc" id="L655">        cc.setListDelimiterHandler(new DefaultListDelimiterHandler('/'));</span>
<span class="fc" id="L656">        checkSetListDelimiterHandler();</span>
<span class="fc" id="L657">    }</span>

    /**
     * Tests whether the correct list delimiter handler is set after a clear
     * operation.
     */
    @Test
    public void testSetListDelimiterAfterClear()
    {
<span class="fc" id="L666">        cc.setListDelimiterHandler(new DefaultListDelimiterHandler('/'));</span>
<span class="fc" id="L667">        cc.clear();</span>
<span class="fc" id="L668">        checkSetListDelimiterHandler();</span>
<span class="fc" id="L669">    }</span>

    /**
     * Helper method for testing whether the list delimiter is correctly
     * handled.
     */
    private void checkSetListDelimiterHandler()
    {
<span class="fc" id="L677">        cc.addProperty(&quot;test.list&quot;, &quot;a/b/c&quot;);</span>
<span class="fc" id="L678">        cc.addProperty(&quot;test.property&quot;, &quot;a,b,c&quot;);</span>
<span class="fc" id="L679">        assertEquals(&quot;Wrong number of list elements&quot;, 3, cc</span>
<span class="fc" id="L680">                .getList(&quot;test.list&quot;).size());</span>
<span class="fc" id="L681">        assertEquals(&quot;Wrong value of property&quot;, &quot;a,b,c&quot;, cc</span>
<span class="fc" id="L682">                .getString(&quot;test.property&quot;));</span>

<span class="fc" id="L684">        AbstractConfiguration config =</span>
<span class="fc" id="L685">                (AbstractConfiguration) cc.getInMemoryConfiguration();</span>
<span class="fc" id="L686">        DefaultListDelimiterHandler listHandler =</span>
<span class="fc" id="L687">                (DefaultListDelimiterHandler) config.getListDelimiterHandler();</span>
<span class="fc" id="L688">        assertEquals(&quot;Wrong list delimiter&quot;, '/', listHandler.getDelimiter());</span>
<span class="fc" id="L689">    }</span>

    /**
     * Prepares a test of the getSource() method.
     */
    private void setUpSourceTest()
    {
<span class="fc" id="L696">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L697">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L698">    }</span>

    /**
     * Tests the getSource() method if the property is defined in a single child
     * configuration.
     */
    @Test
    public void testGetSourceSingle()
    {
<span class="fc" id="L707">        setUpSourceTest();</span>
<span class="fc" id="L708">        conf1.addProperty(TEST_PROPERTY, Boolean.TRUE);</span>
<span class="fc" id="L709">        assertSame(&quot;Wrong source configuration&quot;, conf1, cc</span>
<span class="fc" id="L710">                .getSource(TEST_PROPERTY));</span>
<span class="fc" id="L711">    }</span>

    /**
     * Tests the getSource() method for an unknown property key.
     */
    @Test
    public void testGetSourceUnknown()
    {
<span class="fc" id="L719">        setUpSourceTest();</span>
<span class="fc" id="L720">        assertNull(&quot;Wrong source for unknown key&quot;, cc.getSource(TEST_PROPERTY));</span>
<span class="fc" id="L721">    }</span>

    /**
     * Tests the getSource() method for a property contained in the in memory
     * configuration.
     */
    @Test
    public void testGetSourceInMemory()
    {
<span class="fc" id="L730">        setUpSourceTest();</span>
<span class="fc" id="L731">        cc.addProperty(TEST_PROPERTY, Boolean.TRUE);</span>
<span class="fc" id="L732">        assertSame(&quot;Source not found in in-memory config&quot;, cc</span>
<span class="fc" id="L733">                .getInMemoryConfiguration(), cc.getSource(TEST_PROPERTY));</span>
<span class="fc" id="L734">    }</span>

    /**
     * Tests the getSource() method if the property is defined by multiple child
     * configurations. In this case an exception should be thrown.
     */
    @Test(expected = IllegalArgumentException.class)
    public void testGetSourceMultiple()
    {
<span class="fc" id="L743">        setUpSourceTest();</span>
<span class="fc" id="L744">        conf1.addProperty(TEST_PROPERTY, Boolean.TRUE);</span>
<span class="fc" id="L745">        cc.addProperty(TEST_PROPERTY, &quot;a value&quot;);</span>
<span class="nc" id="L746">        cc.getSource(TEST_PROPERTY);</span>
<span class="nc" id="L747">    }</span>

    /**
     * Tests the getSource() method for a null key. This should cause an
     * exception.
     */
    @Test(expected = IllegalArgumentException.class)
    public void testGetSourceNull()
    {
<span class="nc" id="L756">        cc.getSource(null);</span>
<span class="nc" id="L757">    }</span>

    /**
     * Prepares a test for interpolation with multiple configurations and
     * similar properties.
     */
    private void prepareInterpolationTest()
    {
<span class="fc" id="L765">        PropertiesConfiguration p = new PropertiesConfiguration();</span>
<span class="fc" id="L766">        p.addProperty(&quot;foo&quot;, &quot;initial&quot;);</span>
<span class="fc" id="L767">        p.addProperty(&quot;bar&quot;, &quot;${foo}&quot;);</span>
<span class="fc" id="L768">        p.addProperty(&quot;prefix.foo&quot;, &quot;override&quot;);</span>

<span class="fc" id="L770">        cc.addConfiguration(p.subset(&quot;prefix&quot;));</span>
<span class="fc" id="L771">        cc.addConfiguration(p);</span>
<span class="fc" id="L772">        assertEquals(&quot;Wrong value on direct access&quot;, &quot;override&quot;, cc</span>
<span class="fc" id="L773">                .getString(&quot;bar&quot;));</span>
<span class="fc" id="L774">    }</span>

    /**
     * Tests querying a list when a tricky interpolation is involved. This is
     * related to CONFIGURATION-339.
     */
    @Test
    public void testGetListWithInterpolation()
    {
<span class="fc" id="L783">        prepareInterpolationTest();</span>
<span class="fc" id="L784">        List&lt;Object&gt; lst = cc.getList(&quot;bar&quot;);</span>
<span class="fc" id="L785">        assertEquals(&quot;Wrong number of values&quot;, 1, lst.size());</span>
<span class="fc" id="L786">        assertEquals(&quot;Wrong value in list&quot;, &quot;override&quot;, lst.get(0));</span>
<span class="fc" id="L787">    }</span>

    /**
     * Tests querying a string array when a tricky interpolation is involved.
     */
    @Test
    public void testGetStringArrayWithInterpolation()
    {
<span class="fc" id="L795">        prepareInterpolationTest();</span>
<span class="fc" id="L796">        String[] values = cc.getStringArray(&quot;bar&quot;);</span>
<span class="fc" id="L797">        assertEquals(&quot;Wrong number of values&quot;, 1, values.length);</span>
<span class="fc" id="L798">        assertEquals(&quot;Wrong value in array&quot;, &quot;override&quot;, values[0]);</span>
<span class="fc" id="L799">    }</span>

    /**
     * Tests whether interpolation works if multiple configurations are
     * involved. This test is related to CONFIGURATION-441.
     */
    @Test
    public void testInterpolationInMultipleConfigs()
    {
<span class="fc" id="L808">        Configuration c1 = new PropertiesConfiguration();</span>
<span class="fc" id="L809">        c1.addProperty(&quot;property.one&quot;, &quot;one&quot;);</span>
<span class="fc" id="L810">        c1.addProperty(&quot;property.two&quot;, &quot;two&quot;);</span>
<span class="fc" id="L811">        Configuration c2 = new PropertiesConfiguration();</span>
<span class="fc" id="L812">        c2.addProperty(&quot;property.one.ref&quot;, &quot;${property.one}&quot;);</span>
<span class="fc" id="L813">        cc.addConfiguration(c1);</span>
<span class="fc" id="L814">        cc.addConfiguration(c2);</span>
<span class="fc" id="L815">        assertEquals(&quot;Wrong interpolated value&quot;, &quot;one&quot;,</span>
<span class="fc" id="L816">                cc.getString(&quot;property.one.ref&quot;));</span>
<span class="fc" id="L817">    }</span>

    /**
     * Tests whether interpolation works if a variable references a property
     * with multiple values. This test is related to CONFIGURATION-632.
     */
    @Test
    public void testInterpolationArrayReference()
    {
<span class="fc" id="L826">        Configuration props = new PropertiesConfiguration();</span>
<span class="fc" id="L827">        String[] values = { &quot;a&quot;, &quot;property&quot;, &quot;with&quot;, &quot;multiple&quot;, &quot;values&quot; };</span>
<span class="fc" id="L828">        props.addProperty(&quot;keyMultiValues&quot;, values);</span>
<span class="fc" id="L829">        props.addProperty(&quot;keyReference&quot;, &quot;${keyMultiValues}&quot;);</span>
<span class="fc" id="L830">        cc.addConfiguration(props);</span>
<span class="fc" id="L831">        assertArrayEquals(&quot;Wrong interpolated value&quot;, values,</span>
<span class="fc" id="L832">                cc.getStringArray(&quot;keyReference&quot;));</span>
<span class="fc" id="L833">    }</span>

    /**
     * Tests the behavior of setListDelimiterHandler() if the in-memory configuration
     * is not derived from BaseConfiguration. This test is related to
     * CONFIGURATION-476.
     */
    @Test
    public void testSetListDelimiterInMemoryConfigNonBaseConfig()
    {
<span class="fc" id="L843">        Configuration inMemoryConfig = EasyMock.createMock(Configuration.class);</span>
<span class="fc" id="L844">        EasyMock.replay(inMemoryConfig);</span>
<span class="fc" id="L845">        cc = new CompositeConfiguration(inMemoryConfig);</span>
<span class="fc" id="L846">        cc.setListDelimiterHandler(new DefaultListDelimiterHandler(';'));</span>
<span class="fc" id="L847">    }</span>

    /**
     * Tests whether a configuration can act as both regular child configuration
     * and in-memory configuration. This test is related to CONFIGURATION-471.
     */
    @Test
    public void testUseChildConfigAsInMemoryConfig()
    {
<span class="fc" id="L856">        conf1.setProperty(TEST_PROPERTY, &quot;conf1&quot;);</span>
<span class="fc" id="L857">        conf2.setProperty(TEST_PROPERTY, &quot;conf2&quot;);</span>
<span class="fc" id="L858">        cc.addConfiguration(conf1, true);</span>
<span class="fc" id="L859">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L860">        assertEquals(&quot;Wrong number of configurations&quot;, 2,</span>
<span class="fc" id="L861">                cc.getNumberOfConfigurations());</span>
<span class="fc" id="L862">        assertEquals(&quot;Wrong property&quot;, &quot;conf1&quot;, cc.getString(TEST_PROPERTY));</span>
<span class="fc" id="L863">        cc.addProperty(&quot;newProperty&quot;, &quot;newValue&quot;);</span>
<span class="fc" id="L864">        assertEquals(&quot;Not added to in-memory config&quot;, &quot;newValue&quot;,</span>
<span class="fc" id="L865">                conf1.getString(&quot;newProperty&quot;));</span>
<span class="fc" id="L866">    }</span>

    /**
     * Tests whether the in-memory configuration can be replaced by a new child
     * configuration.
     */
    @Test
    public void testReplaceInMemoryConfig()
    {
<span class="fc" id="L875">        conf1.setProperty(TEST_PROPERTY, &quot;conf1&quot;);</span>
<span class="fc" id="L876">        conf2.setProperty(TEST_PROPERTY, &quot;conf2&quot;);</span>
<span class="fc" id="L877">        cc.addConfiguration(conf1, true);</span>
<span class="fc" id="L878">        cc.addProperty(&quot;newProperty1&quot;, &quot;newValue1&quot;);</span>
<span class="fc" id="L879">        cc.addConfiguration(conf2, true);</span>
<span class="fc" id="L880">        cc.addProperty(&quot;newProperty2&quot;, &quot;newValue2&quot;);</span>
<span class="fc" id="L881">        assertEquals(&quot;Wrong property&quot;, &quot;conf1&quot;, cc.getString(TEST_PROPERTY));</span>
<span class="fc" id="L882">        assertEquals(&quot;Not added to in-memory config&quot;, &quot;newValue1&quot;,</span>
<span class="fc" id="L883">                conf1.getString(&quot;newProperty1&quot;));</span>
<span class="fc" id="L884">        assertEquals(&quot;In-memory config not changed&quot;, &quot;newValue2&quot;,</span>
<span class="fc" id="L885">                conf2.getString(&quot;newProperty2&quot;));</span>
<span class="fc" id="L886">    }</span>

    /**
     * Creates a test synchronizer and installs it at the test configuration.
     *
     * @return the test synchronizer
     */
    private SynchronizerTestImpl installSynchronizer()
    {
<span class="fc" id="L895">        cc.addConfiguration(conf1);</span>
<span class="fc" id="L896">        cc.addConfiguration(conf2);</span>
<span class="fc" id="L897">        SynchronizerTestImpl sync = new SynchronizerTestImpl();</span>
<span class="fc" id="L898">        cc.setSynchronizer(sync);</span>
<span class="fc" id="L899">        return sync;</span>
    }

    /**
     * Tests whether adding a child configuration is synchronized.
     */
    @Test
    public void testAddConfigurationSynchronized()
    {
<span class="fc" id="L908">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L909">        cc.addConfiguration(xmlConf);</span>
<span class="fc" id="L910">        sync.verify(Methods.BEGIN_WRITE, Methods.END_WRITE);</span>
<span class="fc" id="L911">    }</span>

    /**
     * Tests whether removing a child configuration is synchronized.
     */
    @Test
    public void testRemoveConfigurationSynchronized()
    {
<span class="fc" id="L919">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L920">        cc.removeConfiguration(conf1);</span>
<span class="fc" id="L921">        sync.verify(Methods.BEGIN_WRITE, Methods.END_WRITE);</span>
<span class="fc" id="L922">    }</span>

    /**
     * Tests whether access to a configuration by index is synchronized.
     */
    @Test
    public void testGetConfigurationSynchronized()
    {
<span class="fc" id="L930">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L931">        assertEquals(&quot;Wrong result&quot;, conf1, cc.getConfiguration(0));</span>
<span class="fc" id="L932">        sync.verify(Methods.BEGIN_READ, Methods.END_READ);</span>
<span class="fc" id="L933">    }</span>

    /**
     * Tests whether access to the in-memory configuration is synchronized.
     */
    @Test
    public void testGetInMemoryConfigurationSynchronized()
    {
<span class="fc" id="L941">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L942">        cc.getInMemoryConfiguration();</span>
<span class="fc" id="L943">        sync.verify(Methods.BEGIN_READ, Methods.END_READ);</span>
<span class="fc" id="L944">    }</span>

    /**
     * Tests whether querying the number of child configurations is
     * synchronized.
     */
    @Test
    public void testGetNumberOfConfigurationsSynchronized()
    {
<span class="fc" id="L953">        SynchronizerTestImpl sync = installSynchronizer();</span>
<span class="fc" id="L954">        assertEquals(&quot;Wrong number of configurations&quot;, 3,</span>
<span class="fc" id="L955">                cc.getNumberOfConfigurations());</span>
<span class="fc" id="L956">        sync.verify(Methods.BEGIN_READ, Methods.END_READ);</span>
<span class="fc" id="L957">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>