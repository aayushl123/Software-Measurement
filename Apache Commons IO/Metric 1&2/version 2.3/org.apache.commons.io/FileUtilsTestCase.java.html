<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileUtilsTestCase.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_io$Whole_project.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.io</a> &gt; <span class="el_source">FileUtilsTestCase.java</span></div><h1>FileUtilsTestCase.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.io;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.net.URL;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Date;
import java.util.GregorianCalendar;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.zip.CRC32;
import java.util.zip.Checksum;

import org.apache.commons.io.filefilter.NameFileFilter;
import org.apache.commons.io.filefilter.WildcardFileFilter;
import org.apache.commons.io.testtools.FileBasedTestCase;
import org.junit.Assert;

/**
 * This is used to test FileUtils for correctness.
 *
 * @version $Id$
 * @see FileUtils
 */
public class FileUtilsTestCase extends FileBasedTestCase {

    // Test data

    /**
     * Size of test directory.
     */
    private static final int TEST_DIRECTORY_SIZE = 0;
    
    /**
     * List files recursively
     */
<span class="fc" id="L62">    private static final ListDirectoryWalker LIST_WALKER = new ListDirectoryWalker();</span>

    /** Delay in milliseconds to make sure test for &quot;last modified date&quot; are accurate */
    //private static final int LAST_MODIFIED_DELAY = 600;

    private File testFile1;
    private File testFile2;

    private int testFile1Size;
    private int testFile2Size;

    public FileUtilsTestCase(String name) {
<span class="fc" id="L74">        super(name);</span>

<span class="fc" id="L76">        testFile1 = new File(getTestDirectory(), &quot;file1-test.txt&quot;);</span>
<span class="fc" id="L77">        testFile2 = new File(getTestDirectory(), &quot;file1a-test.txt&quot;);</span>

<span class="fc" id="L79">        testFile1Size = (int)testFile1.length();</span>
<span class="fc" id="L80">        testFile2Size = (int)testFile2.length();</span>
<span class="fc" id="L81">    }</span>

    /** @see junit.framework.TestCase#setUp() */
    @Override
    protected void setUp() throws Exception {
<span class="fc" id="L86">        getTestDirectory().mkdirs();</span>
<span class="fc" id="L87">        createFile(testFile1, testFile1Size);</span>
<span class="fc" id="L88">        createFile(testFile2, testFile2Size);</span>
<span class="fc" id="L89">        FileUtils.deleteDirectory(getTestDirectory());</span>
<span class="fc" id="L90">        getTestDirectory().mkdirs();</span>
<span class="fc" id="L91">        createFile(testFile1, testFile1Size);</span>
<span class="fc" id="L92">        createFile(testFile2, testFile2Size);</span>
<span class="fc" id="L93">    }</span>

    /** @see junit.framework.TestCase#tearDown() */
    @Override
    protected void tearDown() throws Exception {
<span class="fc" id="L98">        FileUtils.deleteDirectory(getTestDirectory());</span>
<span class="fc" id="L99">    }</span>

    //-----------------------------------------------------------------------
    /**
     * Tests the {@link FileUtils#getFile(String...)} method.
     */
    public void testGetFile() {
<span class="fc" id="L106">        File expected_A = new File(&quot;src&quot;);</span>
<span class="fc" id="L107">        File expected_B = new File(expected_A, &quot;main&quot;);</span>
<span class="fc" id="L108">        File expected_C = new File(expected_B, &quot;java&quot;);</span>
<span class="fc" id="L109">        assertEquals(&quot;A&quot;, expected_A, FileUtils.getFile(&quot;src&quot;));</span>
<span class="fc" id="L110">        assertEquals(&quot;B&quot;, expected_B, FileUtils.getFile(&quot;src&quot;, &quot;main&quot;));</span>
<span class="fc" id="L111">        assertEquals(&quot;C&quot;, expected_C, FileUtils.getFile(&quot;src&quot;, &quot;main&quot;, &quot;java&quot;));</span>
        try {
<span class="nc" id="L113">            FileUtils.getFile((String[])null);</span>
<span class="nc" id="L114">            fail(&quot;Expected NullPointerException&quot;);</span>
<span class="fc" id="L115">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L117">        }</span>
<span class="fc" id="L118">    }</span>

    /**
     * Tests the {@link FileUtils#getFile(File, String...)} method.
     */
    public void testGetFile_Parent() {
<span class="fc" id="L124">        File parent = new File(&quot;parent&quot;);</span>
<span class="fc" id="L125">        File expected_A = new File(parent, &quot;src&quot;);</span>
<span class="fc" id="L126">        File expected_B = new File(expected_A, &quot;main&quot;);</span>
<span class="fc" id="L127">        File expected_C = new File(expected_B, &quot;java&quot;);</span>
<span class="fc" id="L128">        assertEquals(&quot;A&quot;, expected_A, FileUtils.getFile(parent, &quot;src&quot;));</span>
<span class="fc" id="L129">        assertEquals(&quot;B&quot;, expected_B, FileUtils.getFile(parent, &quot;src&quot;, &quot;main&quot;));</span>
<span class="fc" id="L130">        assertEquals(&quot;C&quot;, expected_C, FileUtils.getFile(parent, &quot;src&quot;, &quot;main&quot;, &quot;java&quot;));</span>
        try {
<span class="nc" id="L132">            FileUtils.getFile(parent, (String[])null);</span>
<span class="nc" id="L133">            fail(&quot;Expected NullPointerException&quot;);</span>
<span class="fc" id="L134">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L136">        }</span>
        try {
<span class="nc" id="L138">            FileUtils.getFile((File)null, &quot;src&quot;);</span>
<span class="nc" id="L139">            fail(&quot;Expected NullPointerException&quot;);</span>
<span class="fc" id="L140">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L142">        }</span>
<span class="fc" id="L143">    }</span>

    /**
     * Tests the {@link FileUtils#getTempDirectoryPath()} method.
     */
    public void testGetTempDirectoryPath() {
<span class="fc" id="L149">        assertEquals(System.getProperty(&quot;java.io.tmpdir&quot;), </span>
<span class="fc" id="L150">            FileUtils.getTempDirectoryPath());</span>
<span class="fc" id="L151">    }</span>
    
    /**
     * Tests the {@link FileUtils#getTempDirectory()} method.
     */
    public void testGetTempDirectory() {
<span class="fc" id="L157">        File tempDirectory = new File(System.getProperty(&quot;java.io.tmpdir&quot;));</span>
<span class="fc" id="L158">        assertEquals(tempDirectory, FileUtils.getTempDirectory());</span>
<span class="fc" id="L159">    }</span>
    
    /**
     * Tests the {@link FileUtils#getUserDirectoryPath()} method.
     */
    public void testGetUserDirectoryPath() {
<span class="fc" id="L165">        assertEquals(System.getProperty(&quot;user.home&quot;), </span>
<span class="fc" id="L166">            FileUtils.getUserDirectoryPath());</span>
<span class="fc" id="L167">    }</span>
    
    /**
     * Tests the {@link FileUtils#getUserDirectory()} method.
     */
    public void testGetUserDirectory() {
<span class="fc" id="L173">        File userDirectory = new File(System.getProperty(&quot;user.home&quot;));</span>
<span class="fc" id="L174">        assertEquals(userDirectory, FileUtils.getUserDirectory());</span>
<span class="fc" id="L175">    }</span>
    
    //-----------------------------------------------------------------------
    public void test_openInputStream_exists() throws Exception {
<span class="fc" id="L179">        File file = new File(getTestDirectory(), &quot;test.txt&quot;);</span>
<span class="fc" id="L180">        createLineBasedFile(file, new String[] {&quot;Hello&quot;});</span>
<span class="fc" id="L181">        FileInputStream in = null;</span>
        try {
<span class="fc" id="L183">            in = FileUtils.openInputStream(file);</span>
<span class="fc" id="L184">            assertEquals('H', in.read());</span>
        } finally {
<span class="fc" id="L186">            IOUtils.closeQuietly(in);</span>
        }
<span class="fc" id="L188">    }</span>

    public void test_openInputStream_existsButIsDirectory() throws Exception {
<span class="fc" id="L191">        File directory = new File(getTestDirectory(), &quot;subdir&quot;);</span>
<span class="fc" id="L192">        directory.mkdirs();</span>
<span class="fc" id="L193">        FileInputStream in = null;</span>
        try {
<span class="nc" id="L195">            in = FileUtils.openInputStream(directory);</span>
<span class="nc" id="L196">            fail();</span>
<span class="fc" id="L197">        } catch (IOException ioe) {</span>
            // expected
        } finally {
<span class="fc" id="L200">            IOUtils.closeQuietly(in);</span>
        }
<span class="fc" id="L202">    }</span>

    public void test_openInputStream_notExists() throws Exception {
<span class="fc" id="L205">        File directory = new File(getTestDirectory(), &quot;test.txt&quot;);</span>
<span class="fc" id="L206">        FileInputStream in = null;</span>
        try {
<span class="nc" id="L208">            in = FileUtils.openInputStream(directory);</span>
<span class="nc" id="L209">            fail();</span>
<span class="fc" id="L210">        } catch (IOException ioe) {</span>
            // expected
        } finally {
<span class="fc" id="L213">            IOUtils.closeQuietly(in);</span>
        }
<span class="fc" id="L215">    }</span>

    //-----------------------------------------------------------------------
    void openOutputStream_noParent(boolean createFile) throws Exception {
<span class="fc" id="L219">        File file = new File(&quot;test.txt&quot;);</span>
<span class="fc" id="L220">        assertNull(file.getParentFile());</span>
        try {
<span class="fc bfc" id="L222" title="All 2 branches covered.">            if (createFile) {</span>
<span class="fc" id="L223">            createLineBasedFile(file, new String[]{&quot;Hello&quot;});}</span>
<span class="fc" id="L224">            FileOutputStream out = null;</span>
            try {
<span class="fc" id="L226">                out = FileUtils.openOutputStream(file);</span>
<span class="fc" id="L227">                out.write(0);</span>
            } finally {
<span class="fc" id="L229">                IOUtils.closeQuietly(out);</span>
            }
<span class="fc" id="L231">            assertTrue(file.exists());</span>
        } finally {
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">            if (file.delete() == false) {</span>
<span class="nc" id="L234">                file.deleteOnExit();</span>
            }
        }
<span class="fc" id="L237">    }</span>

    public void test_openOutputStream_noParentCreateFile() throws Exception {
<span class="fc" id="L240">        openOutputStream_noParent(true);</span>
<span class="fc" id="L241">    }</span>

    public void test_openOutputStream_noParentNoFile() throws Exception {
<span class="fc" id="L244">        openOutputStream_noParent(false);</span>
<span class="fc" id="L245">    }</span>


    public void test_openOutputStream_exists() throws Exception {
<span class="fc" id="L249">        File file = new File(getTestDirectory(), &quot;test.txt&quot;);</span>
<span class="fc" id="L250">        createLineBasedFile(file, new String[] {&quot;Hello&quot;});</span>
<span class="fc" id="L251">        FileOutputStream out = null;</span>
        try {
<span class="fc" id="L253">            out = FileUtils.openOutputStream(file);</span>
<span class="fc" id="L254">            out.write(0);</span>
        } finally {
<span class="fc" id="L256">            IOUtils.closeQuietly(out);</span>
        }
<span class="fc" id="L258">        assertTrue(file.exists());</span>
<span class="fc" id="L259">    }</span>

    public void test_openOutputStream_existsButIsDirectory() throws Exception {
<span class="fc" id="L262">        File directory = new File(getTestDirectory(), &quot;subdir&quot;);</span>
<span class="fc" id="L263">        directory.mkdirs();</span>
<span class="fc" id="L264">        FileOutputStream out = null;</span>
        try {
<span class="nc" id="L266">            out = FileUtils.openOutputStream(directory);</span>
<span class="nc" id="L267">            fail();</span>
<span class="fc" id="L268">        } catch (IOException ioe) {</span>
            // expected
        } finally {
<span class="fc" id="L271">            IOUtils.closeQuietly(out);</span>
        }
<span class="fc" id="L273">    }</span>

    public void test_openOutputStream_notExists() throws Exception {
<span class="fc" id="L276">        File file = new File(getTestDirectory(), &quot;a/test.txt&quot;);</span>
<span class="fc" id="L277">        FileOutputStream out = null;</span>
        try {
<span class="fc" id="L279">            out = FileUtils.openOutputStream(file);</span>
<span class="fc" id="L280">            out.write(0);</span>
        } finally {
<span class="fc" id="L282">            IOUtils.closeQuietly(out);</span>
        }
<span class="fc" id="L284">        assertTrue(file.exists());</span>
<span class="fc" id="L285">    }</span>

    public void test_openOutputStream_notExistsCannotCreate() throws Exception {
        // according to Wikipedia, most filing systems have a 256 limit on filename
<span class="fc" id="L289">        String longStr =</span>
            &quot;abcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyz&quot; +
            &quot;abcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyz&quot; +
            &quot;abcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyz&quot; +
            &quot;abcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyz&quot; +
            &quot;abcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyz&quot; +
            &quot;abcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyzabcdevwxyz&quot;;  // 300 chars
<span class="fc" id="L296">        File file = new File(getTestDirectory(), &quot;a/&quot; + longStr + &quot;/test.txt&quot;);</span>
<span class="fc" id="L297">        FileOutputStream out = null;</span>
        try {
<span class="nc" id="L299">            out = FileUtils.openOutputStream(file);</span>
<span class="nc" id="L300">            fail();</span>
<span class="fc" id="L301">        } catch (IOException ioe) {</span>
            // expected
        } finally {
<span class="fc" id="L304">            IOUtils.closeQuietly(out);</span>
        }
<span class="fc" id="L306">    }</span>

    //-----------------------------------------------------------------------
    // byteCountToDisplaySize
    public void testByteCountToDisplaySize() {
<span class="fc" id="L311">        assertEquals(FileUtils.byteCountToDisplaySize(0), &quot;0 bytes&quot;);</span>
<span class="fc" id="L312">        assertEquals(FileUtils.byteCountToDisplaySize(1), &quot;1 bytes&quot;);</span>
<span class="fc" id="L313">        assertEquals(FileUtils.byteCountToDisplaySize(1023), &quot;1023 bytes&quot;);</span>
<span class="fc" id="L314">        assertEquals(FileUtils.byteCountToDisplaySize(1024), &quot;1 KB&quot;);</span>
<span class="fc" id="L315">        assertEquals(FileUtils.byteCountToDisplaySize(1025), &quot;1 KB&quot;);</span>
<span class="fc" id="L316">        assertEquals(FileUtils.byteCountToDisplaySize(1024 * 1023), &quot;1023 KB&quot;);</span>
<span class="fc" id="L317">        assertEquals(FileUtils.byteCountToDisplaySize(1024 * 1024), &quot;1 MB&quot;);</span>
<span class="fc" id="L318">        assertEquals(FileUtils.byteCountToDisplaySize(1024 * 1025), &quot;1 MB&quot;);</span>
<span class="fc" id="L319">        assertEquals(FileUtils.byteCountToDisplaySize(1024 * 1024 * 1023), &quot;1023 MB&quot;);</span>
<span class="fc" id="L320">        assertEquals(FileUtils.byteCountToDisplaySize(1024 * 1024 * 1024), &quot;1 GB&quot;);</span>
<span class="fc" id="L321">        assertEquals(FileUtils.byteCountToDisplaySize(1024 * 1024 * 1025), &quot;1 GB&quot;);</span>
<span class="fc" id="L322">        assertEquals(FileUtils.byteCountToDisplaySize(1024 * 1024 * 1024 * 2 - 1), &quot;1 GB&quot;);</span>
<span class="fc" id="L323">        assertEquals(FileUtils.byteCountToDisplaySize(1024L * 1024 * 1024 * 1024), &quot;1 TB&quot;);</span>
<span class="fc" id="L324">        assertEquals(FileUtils.byteCountToDisplaySize(1024L * 1024 * 1024 * 1024 * 1024), &quot;1 PB&quot;);</span>
<span class="fc" id="L325">        assertEquals(FileUtils.byteCountToDisplaySize(1024L * 1024 * 1024 * 1024 * 1024 * 1024), &quot;1 EB&quot;);</span>
<span class="fc" id="L326">        assertEquals(FileUtils.byteCountToDisplaySize(Long.MAX_VALUE), &quot;7 EB&quot;);</span>
        // Other MAX_VALUEs
<span class="fc" id="L328">        assertEquals(FileUtils.byteCountToDisplaySize(Character.MAX_VALUE), &quot;63 KB&quot;);</span>
<span class="fc" id="L329">        assertEquals(FileUtils.byteCountToDisplaySize(Short.MAX_VALUE), &quot;31 KB&quot;);</span>
<span class="fc" id="L330">        assertEquals(FileUtils.byteCountToDisplaySize(Integer.MAX_VALUE), &quot;1 GB&quot;);</span>
<span class="fc" id="L331">    }</span>

    //-----------------------------------------------------------------------
    public void testToFile1() throws Exception {
<span class="fc" id="L335">        URL url = new URL(&quot;file&quot;, null, &quot;a/b/c/file.txt&quot;);</span>
<span class="fc" id="L336">        File file = FileUtils.toFile(url);</span>
<span class="pc bpc" id="L337" title="1 of 2 branches missed.">        assertTrue(file.toString().indexOf(&quot;file.txt&quot;) &gt;= 0);</span>
<span class="fc" id="L338">    }</span>

    public void testToFile2() throws Exception {
<span class="fc" id="L341">        URL url = new URL(&quot;file&quot;, null, &quot;a/b/c/file%20n%61me%2520.tx%74&quot;);</span>
<span class="fc" id="L342">        File file = FileUtils.toFile(url);</span>
<span class="pc bpc" id="L343" title="1 of 2 branches missed.">        assertTrue(file.toString().indexOf(&quot;file name%20.txt&quot;) &gt;= 0);</span>
<span class="fc" id="L344">    }</span>

    public void testToFile3() throws Exception {
<span class="fc" id="L347">        assertEquals(null, FileUtils.toFile((URL) null));</span>
<span class="fc" id="L348">        assertEquals(null, FileUtils.toFile(new URL(&quot;http://jakarta.apache.org&quot;)));</span>
<span class="fc" id="L349">    }</span>

    public void testToFile4() throws Exception {
<span class="fc" id="L352">        URL url = new URL(&quot;file&quot;, null, &quot;a/b/c/file%%20%me.txt%&quot;);</span>
<span class="fc" id="L353">        File file = FileUtils.toFile(url);</span>
<span class="pc bpc" id="L354" title="1 of 2 branches missed.">        assertTrue(file.toString().indexOf(&quot;file% %me.txt%&quot;) &gt;= 0);</span>
<span class="fc" id="L355">    }</span>

    /** IO-252 */
    public void testToFile5() throws Exception {
<span class="fc" id="L359">        URL url = new URL(&quot;file&quot;, null, &quot;both%20are%20100%20%25%20true&quot;);</span>
<span class="fc" id="L360">        File file = FileUtils.toFile(url);</span>
<span class="fc" id="L361">        assertEquals(&quot;both are 100 % true&quot;, file.toString());</span>
<span class="fc" id="L362">    }</span>
    public void testToFileUtf8() throws Exception {
<span class="fc" id="L364">        URL url = new URL(&quot;file&quot;, null, &quot;/home/%C3%A4%C3%B6%C3%BC%C3%9F&quot;);</span>
<span class="fc" id="L365">        File file = FileUtils.toFile(url);</span>
<span class="pc bpc" id="L366" title="1 of 2 branches missed.">        assertTrue(file.toString().indexOf(&quot;\u00E4\u00F6\u00FC\u00DF&quot;) &gt;= 0);</span>
<span class="fc" id="L367">    }</span>

    public void testDecodeUrl() {
<span class="fc" id="L370">        assertEquals(&quot;&quot;, FileUtils.decodeUrl(&quot;&quot;));</span>
<span class="fc" id="L371">        assertEquals(&quot;foo&quot;, FileUtils.decodeUrl(&quot;foo&quot;));</span>
<span class="fc" id="L372">        assertEquals(&quot;+&quot;, FileUtils.decodeUrl(&quot;+&quot;));</span>
<span class="fc" id="L373">        assertEquals(&quot;% &quot;, FileUtils.decodeUrl(&quot;%25%20&quot;));</span>
<span class="fc" id="L374">        assertEquals(&quot;%20&quot;, FileUtils.decodeUrl(&quot;%2520&quot;));</span>
<span class="fc" id="L375">        assertEquals(&quot;jar:file:/C:/dir/sub dir/1.0/foo-1.0.jar!/org/Bar.class&quot;, FileUtils</span>
<span class="fc" id="L376">                .decodeUrl(&quot;jar:file:/C:/dir/sub%20dir/1.0/foo-1.0.jar!/org/Bar.class&quot;));</span>
<span class="fc" id="L377">    }</span>

    public void testDecodeUrlLenient() {
<span class="fc" id="L380">        assertEquals(&quot; &quot;, FileUtils.decodeUrl(&quot; &quot;));</span>
<span class="fc" id="L381">        assertEquals(&quot;\u00E4\u00F6\u00FC\u00DF&quot;, FileUtils.decodeUrl(&quot;\u00E4\u00F6\u00FC\u00DF&quot;));</span>
<span class="fc" id="L382">        assertEquals(&quot;%&quot;, FileUtils.decodeUrl(&quot;%&quot;));</span>
<span class="fc" id="L383">        assertEquals(&quot;% &quot;, FileUtils.decodeUrl(&quot;%%20&quot;));</span>
<span class="fc" id="L384">        assertEquals(&quot;%2&quot;, FileUtils.decodeUrl(&quot;%2&quot;));</span>
<span class="fc" id="L385">        assertEquals(&quot;%2G&quot;, FileUtils.decodeUrl(&quot;%2G&quot;));</span>
<span class="fc" id="L386">    }</span>

    public void testDecodeUrlNullSafe() {
<span class="fc" id="L389">        assertNull(FileUtils.decodeUrl(null));</span>
<span class="fc" id="L390">    }</span>

    public void testDecodeUrlEncodingUtf8() {
<span class="fc" id="L393">        assertEquals(&quot;\u00E4\u00F6\u00FC\u00DF&quot;, FileUtils.decodeUrl(&quot;%C3%A4%C3%B6%C3%BC%C3%9F&quot;));</span>
<span class="fc" id="L394">    }</span>

    // toFiles

    public void testToFiles1() throws Exception {
<span class="fc" id="L399">        URL[] urls = new URL[] {</span>
            new URL(&quot;file&quot;, null, &quot;file1.txt&quot;),
            new URL(&quot;file&quot;, null, &quot;file2.txt&quot;),
        };
<span class="fc" id="L403">        File[] files = FileUtils.toFiles(urls);</span>
        
<span class="fc" id="L405">        assertEquals(urls.length, files.length);</span>
<span class="pc bpc" id="L406" title="1 of 2 branches missed.">        assertEquals(&quot;File: &quot; + files[0], true, files[0].toString().indexOf(&quot;file1.txt&quot;) &gt;= 0);</span>
<span class="pc bpc" id="L407" title="1 of 2 branches missed.">        assertEquals(&quot;File: &quot; + files[1], true, files[1].toString().indexOf(&quot;file2.txt&quot;) &gt;= 0);</span>
<span class="fc" id="L408">    }</span>

    public void testToFiles2() throws Exception {
<span class="fc" id="L411">        URL[] urls = new URL[] {</span>
            new URL(&quot;file&quot;, null, &quot;file1.txt&quot;),
            null,
        };
<span class="fc" id="L415">        File[] files = FileUtils.toFiles(urls);</span>
        
<span class="fc" id="L417">        assertEquals(urls.length, files.length);</span>
<span class="pc bpc" id="L418" title="1 of 2 branches missed.">        assertEquals(&quot;File: &quot; + files[0], true, files[0].toString().indexOf(&quot;file1.txt&quot;) &gt;= 0);</span>
<span class="fc" id="L419">        assertEquals(&quot;File: &quot; + files[1], null, files[1]);</span>
<span class="fc" id="L420">    }</span>

    public void testToFiles3() throws Exception {
<span class="fc" id="L423">        URL[] urls = null;</span>
<span class="fc" id="L424">        File[] files = FileUtils.toFiles(urls);</span>
        
<span class="fc" id="L426">        assertEquals(0, files.length);</span>
<span class="fc" id="L427">    }</span>

    public void testToFiles4() throws Exception {
<span class="fc" id="L430">        URL[] urls = new URL[] {</span>
            new URL(&quot;file&quot;, null, &quot;file1.txt&quot;),
            new URL(&quot;http&quot;, &quot;jakarta.apache.org&quot;, &quot;file1.txt&quot;),
        };
        try {
<span class="nc" id="L435">            FileUtils.toFiles(urls);</span>
<span class="nc" id="L436">            fail();</span>
<span class="pc" id="L437">        } catch (IllegalArgumentException ex) {}</span>
<span class="fc" id="L438">    }</span>

    // toURLs

    public void testToURLs1() throws Exception {
<span class="fc" id="L443">        File[] files = new File[] {</span>
<span class="fc" id="L444">            new File(getTestDirectory(), &quot;file1.txt&quot;),</span>
<span class="fc" id="L445">            new File(getTestDirectory(), &quot;file2.txt&quot;),</span>
<span class="fc" id="L446">            new File(getTestDirectory(), &quot;test file.txt&quot;),</span>
        };
<span class="fc" id="L448">        URL[] urls = FileUtils.toURLs(files);</span>
        
<span class="fc" id="L450">        assertEquals(files.length, urls.length);</span>
<span class="fc" id="L451">        assertTrue(urls[0].toExternalForm().startsWith(&quot;file:&quot;));</span>
<span class="pc bpc" id="L452" title="1 of 2 branches missed.">        assertTrue(urls[0].toExternalForm().indexOf(&quot;file1.txt&quot;) &gt;= 0);</span>
<span class="fc" id="L453">        assertTrue(urls[1].toExternalForm().startsWith(&quot;file:&quot;));</span>
<span class="pc bpc" id="L454" title="1 of 2 branches missed.">        assertTrue(urls[1].toExternalForm().indexOf(&quot;file2.txt&quot;) &gt;= 0);</span>

        // Test escaped char
<span class="fc" id="L457">        assertTrue(urls[2].toExternalForm().startsWith(&quot;file:&quot;));</span>
<span class="pc bpc" id="L458" title="1 of 2 branches missed.">        assertTrue(urls[2].toExternalForm().indexOf(&quot;test%20file.txt&quot;) &gt;= 0);</span>
<span class="fc" id="L459">    }</span>

//    public void testToURLs2() throws Exception {
//        File[] files = new File[] {
//            new File(getTestDirectory(), &quot;file1.txt&quot;),
//            null,
//        };
//        URL[] urls = FileUtils.toURLs(files);
//        
//        assertEquals(files.length, urls.length);
//        assertTrue(urls[0].toExternalForm().startsWith(&quot;file:&quot;));
//        assertTrue(urls[0].toExternalForm().indexOf(&quot;file1.txt&quot;) &gt; 0);
//        assertEquals(null, urls[1]);
//    }
//
//    public void testToURLs3() throws Exception {
//        File[] files = null;
//        URL[] urls = FileUtils.toURLs(files);
//        
//        assertEquals(0, urls.length);
//    }

    // contentEquals

    public void testContentEquals() throws Exception {
        // Non-existent files
<span class="fc" id="L485">        File file = new File(getTestDirectory(), getName());</span>
<span class="fc" id="L486">        File file2 = new File(getTestDirectory(), getName() + &quot;2&quot;);</span>
        // both don't  exist
<span class="fc" id="L488">        assertTrue(FileUtils.contentEquals(file, file));</span>
<span class="fc" id="L489">        assertTrue(FileUtils.contentEquals(file, file2));</span>
<span class="fc" id="L490">        assertTrue(FileUtils.contentEquals(file2, file2));</span>
<span class="fc" id="L491">        assertTrue(FileUtils.contentEquals(file2, file));</span>

        // Directories
        try {
<span class="nc" id="L495">            FileUtils.contentEquals(getTestDirectory(), getTestDirectory());</span>
<span class="nc" id="L496">            fail(&quot;Comparing directories should fail with an IOException&quot;);</span>
<span class="fc" id="L497">        } catch (IOException ioe) {</span>
            //expected
<span class="nc" id="L499">        }</span>

        // Different files
<span class="fc" id="L502">        File objFile1 =</span>
<span class="fc" id="L503">            new File(getTestDirectory(), getName() + &quot;.object&quot;);</span>
<span class="fc" id="L504">        objFile1.deleteOnExit();</span>
<span class="fc" id="L505">        FileUtils.copyURLToFile(</span>
<span class="fc" id="L506">            getClass().getResource(&quot;/java/lang/Object.class&quot;),</span>
            objFile1);

<span class="fc" id="L509">        File objFile1b =</span>
<span class="fc" id="L510">            new File(getTestDirectory(), getName() + &quot;.object2&quot;);</span>
<span class="fc" id="L511">        objFile1.deleteOnExit();</span>
<span class="fc" id="L512">        FileUtils.copyURLToFile(</span>
<span class="fc" id="L513">            getClass().getResource(&quot;/java/lang/Object.class&quot;),</span>
            objFile1b);

<span class="fc" id="L516">        File objFile2 =</span>
<span class="fc" id="L517">            new File(getTestDirectory(), getName() + &quot;.collection&quot;);</span>
<span class="fc" id="L518">        objFile2.deleteOnExit();</span>
<span class="fc" id="L519">        FileUtils.copyURLToFile(</span>
<span class="fc" id="L520">            getClass().getResource(&quot;/java/util/Collection.class&quot;),</span>
            objFile2);

<span class="fc" id="L523">        assertFalse(FileUtils.contentEquals(objFile1, objFile2));</span>
<span class="fc" id="L524">        assertFalse(FileUtils.contentEquals(objFile1b, objFile2));</span>
<span class="fc" id="L525">        assertTrue(FileUtils.contentEquals(objFile1, objFile1b));</span>

<span class="fc" id="L527">        assertTrue(FileUtils.contentEquals(objFile1, objFile1));</span>
<span class="fc" id="L528">        assertTrue(FileUtils.contentEquals(objFile1b, objFile1b));</span>
<span class="fc" id="L529">        assertTrue(FileUtils.contentEquals(objFile2, objFile2));</span>

        // Equal files
<span class="fc" id="L532">        file.createNewFile();</span>
<span class="fc" id="L533">        file2.createNewFile();</span>
<span class="fc" id="L534">        assertTrue(FileUtils.contentEquals(file, file));</span>
<span class="fc" id="L535">        assertTrue(FileUtils.contentEquals(file, file2));</span>
<span class="fc" id="L536">    }</span>

    public void testContentEqualsIgnoreEOL() throws Exception {
        // Non-existent files
<span class="fc" id="L540">        File file1 = new File(getTestDirectory(), getName());</span>
<span class="fc" id="L541">        File file2 = new File(getTestDirectory(), getName() + &quot;2&quot;);</span>
        // both don't  exist
<span class="fc" id="L543">        assertTrue(FileUtils.contentEqualsIgnoreEOL(file1, file1, null));</span>
<span class="fc" id="L544">        assertTrue(FileUtils.contentEqualsIgnoreEOL(file1, file2, null));</span>
<span class="fc" id="L545">        assertTrue(FileUtils.contentEqualsIgnoreEOL(file2, file2, null));</span>
<span class="fc" id="L546">        assertTrue(FileUtils.contentEqualsIgnoreEOL(file2, file1, null));</span>

        // Directories
        try {
<span class="nc" id="L550">            FileUtils.contentEqualsIgnoreEOL(getTestDirectory(), getTestDirectory(), null);</span>
<span class="nc" id="L551">            fail(&quot;Comparing directories should fail with an IOException&quot;);</span>
<span class="fc" id="L552">        } catch (IOException ioe) {</span>
            //expected
<span class="nc" id="L554">        }</span>

        // Different files
<span class="fc" id="L557">        File tfile1 = new File(getTestDirectory(), getName() + &quot;.txt1&quot;);</span>
<span class="fc" id="L558">        tfile1.deleteOnExit();</span>
<span class="fc" id="L559">        FileUtils.write(tfile1,&quot;123\r&quot;);</span>

<span class="fc" id="L561">        File tfile2 = new File(getTestDirectory(), getName() + &quot;.txt2&quot;);</span>
<span class="fc" id="L562">        tfile1.deleteOnExit();</span>
<span class="fc" id="L563">        FileUtils.write(tfile2,&quot;123\n&quot;);</span>

<span class="fc" id="L565">        File tfile3 = new File(getTestDirectory(), getName() + &quot;.collection&quot;);</span>
<span class="fc" id="L566">        tfile3.deleteOnExit();</span>
<span class="fc" id="L567">        FileUtils.write(tfile3,&quot;123\r\n2&quot;);</span>

<span class="fc" id="L569">        assertTrue(FileUtils.contentEqualsIgnoreEOL(tfile1, tfile1, null));</span>
<span class="fc" id="L570">        assertTrue(FileUtils.contentEqualsIgnoreEOL(tfile2, tfile2, null));</span>
<span class="fc" id="L571">        assertTrue(FileUtils.contentEqualsIgnoreEOL(tfile3, tfile3, null));</span>

<span class="fc" id="L573">        assertTrue(FileUtils.contentEqualsIgnoreEOL(tfile1, tfile2, null));</span>
<span class="fc" id="L574">        assertFalse(FileUtils.contentEqualsIgnoreEOL(tfile1, tfile3, null));</span>
<span class="fc" id="L575">        assertFalse(FileUtils.contentEqualsIgnoreEOL(tfile2, tfile3, null));</span>

<span class="fc" id="L577">        URL urlCR = getClass().getResource(&quot;FileUtilsTestDataCR.dat&quot;);</span>
<span class="fc" id="L578">        assertNotNull(urlCR);</span>
<span class="fc" id="L579">        File cr = new File(urlCR.getPath());</span>
<span class="nc" id="L580">        assertTrue(cr.exists());</span>

<span class="nc" id="L582">        URL urlCRLF = getClass().getResource(&quot;FileUtilsTestDataCRLF.dat&quot;);</span>
<span class="nc" id="L583">        assertNotNull(urlCRLF);</span>
<span class="nc" id="L584">        File crlf = new File(urlCRLF.getPath());</span>
<span class="nc" id="L585">        assertTrue(crlf.exists());</span>

<span class="nc" id="L587">        URL urlLF = getClass().getResource(&quot;FileUtilsTestDataLF.dat&quot;);</span>
<span class="nc" id="L588">        assertNotNull(urlLF);</span>
<span class="nc" id="L589">        File lf = new File(urlLF.getPath());</span>
<span class="nc" id="L590">        assertTrue(lf.exists());</span>

<span class="nc" id="L592">        assertTrue(FileUtils.contentEqualsIgnoreEOL(cr, cr, null));</span>
<span class="nc" id="L593">        assertTrue(FileUtils.contentEqualsIgnoreEOL(crlf, crlf, null));</span>
<span class="nc" id="L594">        assertTrue(FileUtils.contentEqualsIgnoreEOL(lf, lf, null));</span>

<span class="nc" id="L596">        assertTrue(FileUtils.contentEqualsIgnoreEOL(cr, crlf, null));</span>
<span class="nc" id="L597">        assertTrue(FileUtils.contentEqualsIgnoreEOL(cr, lf, null));</span>
<span class="nc" id="L598">        assertTrue(FileUtils.contentEqualsIgnoreEOL(crlf, lf, null));</span>

        // Check the files behave OK when EOL is not ignored
<span class="nc" id="L601">        assertTrue(FileUtils.contentEquals(cr, cr));</span>
<span class="nc" id="L602">        assertTrue(FileUtils.contentEquals(crlf, crlf));</span>
<span class="nc" id="L603">        assertTrue(FileUtils.contentEquals(lf, lf));</span>

<span class="nc" id="L605">        assertFalse(FileUtils.contentEquals(cr, crlf));</span>
<span class="nc" id="L606">        assertFalse(FileUtils.contentEquals(cr, lf));</span>
<span class="nc" id="L607">        assertFalse(FileUtils.contentEquals(crlf, lf));</span>

        // Equal files
<span class="nc" id="L610">        file1.createNewFile();</span>
<span class="nc" id="L611">        file2.createNewFile();</span>
<span class="nc" id="L612">        assertTrue(FileUtils.contentEqualsIgnoreEOL(file1, file1, null));</span>
<span class="nc" id="L613">        assertTrue(FileUtils.contentEqualsIgnoreEOL(file1, file2, null));</span>
<span class="nc" id="L614">    }</span>

    // copyURLToFile

    public void testCopyURLToFile() throws Exception {
        // Creates file
<span class="fc" id="L620">        File file = new File(getTestDirectory(), getName());</span>
<span class="fc" id="L621">        file.deleteOnExit();</span>

        // Loads resource
<span class="fc" id="L624">        String resourceName = &quot;/java/lang/Object.class&quot;;</span>
<span class="fc" id="L625">        FileUtils.copyURLToFile(getClass().getResource(resourceName), file);</span>

        // Tests that resuorce was copied correctly
<span class="fc" id="L628">        FileInputStream fis = new FileInputStream(file);</span>
        try {
<span class="fc" id="L630">            assertTrue(</span>
                &quot;Content is not equal.&quot;,
<span class="fc" id="L632">                IOUtils.contentEquals(</span>
<span class="fc" id="L633">                    getClass().getResourceAsStream(resourceName),</span>
                    fis));
        } finally {
<span class="fc" id="L636">            fis.close();</span>
        }
        //TODO Maybe test copy to itself like for copyFile()
<span class="fc" id="L639">    }</span>

    public void testCopyURLToFileWithTimeout() throws Exception {
        // Creates file
<span class="fc" id="L643">        File file = new File(getTestDirectory(), &quot;testCopyURLToFileWithTimeout&quot;);</span>
<span class="fc" id="L644">        file.deleteOnExit();</span>

        // Loads resource
<span class="fc" id="L647">        String resourceName = &quot;/java/lang/Object.class&quot;;</span>
<span class="fc" id="L648">        FileUtils.copyURLToFile(getClass().getResource(resourceName), file, 500, 500);</span>

        // Tests that resuorce was copied correctly
<span class="fc" id="L651">        FileInputStream fis = new FileInputStream(file);</span>
        try {
<span class="fc" id="L653">            assertTrue(</span>
                &quot;Content is not equal.&quot;,
<span class="fc" id="L655">                IOUtils.contentEquals(</span>
<span class="fc" id="L656">                    getClass().getResourceAsStream(resourceName),</span>
                    fis));
        } finally {
<span class="fc" id="L659">            fis.close();</span>
        }
        //TODO Maybe test copy to itself like for copyFile()
<span class="fc" id="L662">    }</span>

    // forceMkdir

    public void testForceMkdir() throws Exception {
        // Tests with existing directory
<span class="fc" id="L668">        FileUtils.forceMkdir(getTestDirectory());</span>

        // Creates test file
<span class="fc" id="L671">        File testFile = new File(getTestDirectory(), getName());</span>
<span class="fc" id="L672">        testFile.deleteOnExit();</span>
<span class="fc" id="L673">        testFile.createNewFile();</span>
<span class="fc" id="L674">        assertTrue(&quot;Test file does not exist.&quot;, testFile.exists());</span>

        // Tests with existing file
        try {
<span class="nc" id="L678">            FileUtils.forceMkdir(testFile);</span>
<span class="nc" id="L679">            fail(&quot;Exception expected.&quot;);</span>
<span class="pc" id="L680">        } catch (IOException ex) {}</span>

<span class="fc" id="L682">        testFile.delete();</span>

        // Tests with non-existent directory
<span class="fc" id="L685">        FileUtils.forceMkdir(testFile);</span>
<span class="fc" id="L686">        assertTrue(&quot;Directory was not created.&quot;, testFile.exists());</span>
<span class="fc" id="L687">    }</span>

    // sizeOfDirectory

    public void testSizeOfDirectory() throws Exception {
<span class="fc" id="L692">        File file = new File(getTestDirectory(), getName());</span>

        // Non-existent file
        try {
<span class="nc" id="L696">            FileUtils.sizeOfDirectory(file);</span>
<span class="nc" id="L697">            fail(&quot;Exception expected.&quot;);</span>
<span class="pc" id="L698">        } catch (IllegalArgumentException ex) {}</span>

        // Creates file
<span class="fc" id="L701">        file.createNewFile();</span>
<span class="fc" id="L702">        file.deleteOnExit();</span>

        // Existing file
        try {
<span class="nc" id="L706">            FileUtils.sizeOfDirectory(file);</span>
<span class="nc" id="L707">            fail(&quot;Exception expected.&quot;);</span>
<span class="pc" id="L708">        } catch (IllegalArgumentException ex) {}</span>

        // Existing directory
<span class="fc" id="L711">        file.delete();</span>
<span class="fc" id="L712">        file.mkdir();</span>

<span class="fc" id="L714">        assertEquals(</span>
            &quot;Unexpected directory size&quot;,
            TEST_DIRECTORY_SIZE,
<span class="fc" id="L717">            FileUtils.sizeOfDirectory(file));</span>
<span class="fc" id="L718">    }</span>

    /**
     * Tests the {@link FileUtils#sizeOf(File)} method.
     * @throws Exception
     */
    public void testSizeOf() throws Exception {
<span class="fc" id="L725">        File file = new File(getTestDirectory(), getName());</span>

        // Null argument
        try {
<span class="nc" id="L729">            FileUtils.sizeOf(null);</span>
<span class="nc" id="L730">            fail(&quot;Exception expected.&quot;);</span>
<span class="pc" id="L731">        } catch (NullPointerException ex) {}</span>
        
        // Non-existent file
        try {
<span class="nc" id="L735">            FileUtils.sizeOf(file);</span>
<span class="nc" id="L736">            fail(&quot;Exception expected.&quot;);</span>
<span class="pc" id="L737">        } catch (IllegalArgumentException ex) {}</span>

        // Creates file
<span class="fc" id="L740">        file.createNewFile();</span>
<span class="fc" id="L741">        file.deleteOnExit();</span>

        // New file
<span class="fc" id="L744">        assertEquals(0, FileUtils.sizeOf(file));</span>
<span class="fc" id="L745">        file.delete();</span>

        // Existing file
<span class="fc" id="L748">        assertEquals(&quot;Unexpected files size&quot;,</span>
            testFile1Size, 
<span class="fc" id="L750">            FileUtils.sizeOf(testFile1));</span>
        
        // Existing directory
<span class="fc" id="L753">        assertEquals(&quot;Unexpected directory size&quot;,</span>
            TEST_DIRECTORY_SIZE,
<span class="fc" id="L755">            FileUtils.sizeOf(getTestDirectory()));</span>
<span class="fc" id="L756">    }</span>
    
    // isFileNewer / isFileOlder
    public void testIsFileNewerOlder() throws Exception {
<span class="fc" id="L760">        File reference   = new File(getTestDirectory(), &quot;FileUtils-reference.txt&quot;);</span>
<span class="fc" id="L761">        File oldFile     = new File(getTestDirectory(), &quot;FileUtils-old.txt&quot;);</span>
<span class="fc" id="L762">        File newFile     = new File(getTestDirectory(), &quot;FileUtils-new.txt&quot;);</span>
<span class="fc" id="L763">        File invalidFile = new File(getTestDirectory(), &quot;FileUtils-invalid-file.txt&quot;);</span>

        // Create Files
<span class="fc" id="L766">        createFile(oldFile, 0);</span>

        do {
            try {
<span class="fc" id="L770">                Thread.sleep(1000);</span>
<span class="nc" id="L771">            } catch(InterruptedException ie) {</span>
                // ignore
<span class="fc" id="L773">            }</span>
<span class="fc" id="L774">            createFile(reference, 0);</span>
<span class="pc bpc" id="L775" title="1 of 2 branches missed.">        } while( oldFile.lastModified() == reference.lastModified() );</span>

<span class="fc" id="L777">        Date date = new Date();</span>
<span class="fc" id="L778">        long now = date.getTime();</span>

        do {
            try {
<span class="fc" id="L782">                Thread.sleep(1000);</span>
<span class="nc" id="L783">            } catch(InterruptedException ie) {</span>
                // ignore
<span class="fc" id="L785">            }</span>
<span class="fc" id="L786">            createFile(newFile, 0);</span>
<span class="pc bpc" id="L787" title="1 of 2 branches missed.">        } while( reference.lastModified() == newFile.lastModified() );</span>

        // Test isFileNewer()
<span class="fc" id="L790">        assertFalse(&quot;Old File - Newer - File&quot;, FileUtils.isFileNewer(oldFile, reference));</span>
<span class="fc" id="L791">        assertFalse(&quot;Old File - Newer - Date&quot;, FileUtils.isFileNewer(oldFile, date));</span>
<span class="fc" id="L792">        assertFalse(&quot;Old File - Newer - Mili&quot;, FileUtils.isFileNewer(oldFile, now));</span>
<span class="fc" id="L793">        assertTrue(&quot;New File - Newer - File&quot;, FileUtils.isFileNewer(newFile, reference));</span>
<span class="fc" id="L794">        assertTrue(&quot;New File - Newer - Date&quot;, FileUtils.isFileNewer(newFile, date));</span>
<span class="fc" id="L795">        assertTrue(&quot;New File - Newer - Mili&quot;, FileUtils.isFileNewer(newFile, now));</span>
<span class="fc" id="L796">        assertFalse(&quot;Invalid - Newer - File&quot;, FileUtils.isFileNewer(invalidFile, reference));</span>
<span class="fc" id="L797">        final String invalidFileName = invalidFile.getName();</span>
        try {
<span class="nc" id="L799">            FileUtils.isFileNewer(newFile, invalidFile);</span>
<span class="nc" id="L800">            fail(&quot;Should have cause IllegalArgumentException&quot;);</span>
<span class="fc" id="L801">        } catch (IllegalArgumentException iae){</span>
<span class="fc" id="L802">            final String message = iae.getMessage();</span>
<span class="fc" id="L803">            assertTrue(&quot;Message should contain: &quot;+invalidFileName+ &quot; but was: &quot;+message,message.contains(invalidFileName));</span>
<span class="nc" id="L804">        }</span>
        
        // Test isFileOlder()
<span class="fc" id="L807">        assertTrue(&quot;Old File - Older - File&quot;, FileUtils.isFileOlder(oldFile, reference));</span>
<span class="fc" id="L808">        assertTrue(&quot;Old File - Older - Date&quot;, FileUtils.isFileOlder(oldFile, date));</span>
<span class="fc" id="L809">        assertTrue(&quot;Old File - Older - Mili&quot;, FileUtils.isFileOlder(oldFile, now));</span>
<span class="fc" id="L810">        assertFalse(&quot;New File - Older - File&quot;, FileUtils.isFileOlder(newFile, reference));</span>
<span class="fc" id="L811">        assertFalse(&quot;New File - Older - Date&quot;, FileUtils.isFileOlder(newFile, date));</span>
<span class="fc" id="L812">        assertFalse(&quot;New File - Older - Mili&quot;, FileUtils.isFileOlder(newFile, now));</span>
<span class="fc" id="L813">        assertFalse(&quot;Invalid - Older - File&quot;, FileUtils.isFileOlder(invalidFile, reference));</span>
        try {
<span class="nc" id="L815">            FileUtils.isFileOlder(newFile, invalidFile);</span>
<span class="nc" id="L816">            fail(&quot;Should have cause IllegalArgumentException&quot;);</span>
<span class="fc" id="L817">        } catch (IllegalArgumentException iae){</span>
<span class="fc" id="L818">            final String message = iae.getMessage();</span>
<span class="fc" id="L819">            assertTrue(&quot;Message should contain: &quot;+invalidFileName+ &quot; but was: &quot;+message,message.contains(invalidFileName));</span>
<span class="nc" id="L820">        }</span>
        
        
        // ----- Test isFileNewer() exceptions -----
        // Null File
        try {
<span class="nc" id="L826">            FileUtils.isFileNewer(null, now);</span>
<span class="nc" id="L827">            fail(&quot;Newer Null, expected IllegalArgumentExcepion&quot;);</span>
<span class="fc" id="L828">        } catch (IllegalArgumentException expected) {</span>
            // expected result
<span class="nc" id="L830">        }</span>
        
        // Null reference File
        try {
<span class="nc" id="L834">            FileUtils.isFileNewer(oldFile, (File)null);</span>
<span class="nc" id="L835">            fail(&quot;Newer Null reference, expected IllegalArgumentExcepion&quot;);</span>
<span class="fc" id="L836">        } catch (IllegalArgumentException expected) {</span>
            // expected result
<span class="nc" id="L838">        }</span>
        
        // Invalid reference File
        try {
<span class="nc" id="L842">            FileUtils.isFileNewer(oldFile, invalidFile);</span>
<span class="nc" id="L843">            fail(&quot;Newer invalid reference, expected IllegalArgumentExcepion&quot;);</span>
<span class="fc" id="L844">        } catch (IllegalArgumentException expected) {</span>
            // expected result
<span class="nc" id="L846">        }</span>
        
        // Null reference Date
        try {
<span class="nc" id="L850">            FileUtils.isFileNewer(oldFile, (Date)null);</span>
<span class="nc" id="L851">            fail(&quot;Newer Null date, expected IllegalArgumentExcepion&quot;);</span>
<span class="fc" id="L852">        } catch (IllegalArgumentException expected) {</span>
            // expected result
<span class="nc" id="L854">        }</span>


        // ----- Test isFileOlder() exceptions -----
        // Null File
        try {
<span class="nc" id="L860">            FileUtils.isFileOlder(null, now);</span>
<span class="nc" id="L861">            fail(&quot;Older Null, expected IllegalArgumentExcepion&quot;);</span>
<span class="fc" id="L862">        } catch (IllegalArgumentException expected) {</span>
            // expected result
<span class="nc" id="L864">        }</span>
        
        // Null reference File
        try {
<span class="nc" id="L868">            FileUtils.isFileOlder(oldFile, (File)null);</span>
<span class="nc" id="L869">            fail(&quot;Older Null reference, expected IllegalArgumentExcepion&quot;);</span>
<span class="fc" id="L870">        } catch (IllegalArgumentException expected) {</span>
            // expected result
<span class="nc" id="L872">        }</span>
        
        // Invalid reference File
        try {
<span class="nc" id="L876">            FileUtils.isFileOlder(oldFile, invalidFile);</span>
<span class="nc" id="L877">            fail(&quot;Older invalid reference, expected IllegalArgumentExcepion&quot;);</span>
<span class="fc" id="L878">        } catch (IllegalArgumentException expected) {</span>
            // expected result
<span class="nc" id="L880">        }</span>
        
        // Null reference Date
        try {
<span class="nc" id="L884">            FileUtils.isFileOlder(oldFile, (Date)null);</span>
<span class="nc" id="L885">            fail(&quot;Older Null date, expected IllegalArgumentExcepion&quot;);</span>
<span class="fc" id="L886">        } catch (IllegalArgumentException expected) {</span>
            // expected result
<span class="nc" id="L888">        }</span>

<span class="fc" id="L890">    }</span>

//    // TODO Remove after debugging
//    private void log(Object obj) {
//        System.out.println(
//            FileUtilsTestCase.class +&quot; &quot; + getName() + &quot; &quot; + obj);
//    }

    // copyFile

    public void testCopyFile1() throws Exception {
<span class="fc" id="L901">        File destination = new File(getTestDirectory(), &quot;copy1.txt&quot;);</span>
        
        //Thread.sleep(LAST_MODIFIED_DELAY);
        //This is to slow things down so we can catch if 
        //the lastModified date is not ok
        
<span class="fc" id="L907">        FileUtils.copyFile(testFile1, destination);</span>
<span class="fc" id="L908">        assertTrue(&quot;Check Exist&quot;, destination.exists());</span>
<span class="fc" id="L909">        assertEquals(&quot;Check Full copy&quot;, testFile1Size, destination.length());</span>
        /* disabled: Thread.sleep doesn't work reliantly for this case
        assertTrue(&quot;Check last modified date preserved&quot;, 
            testFile1.lastModified() == destination.lastModified());*/  
<span class="fc" id="L913">    }</span>

    public void testCopyFileToOutputStream() throws Exception {
<span class="fc" id="L916">        ByteArrayOutputStream destination = new ByteArrayOutputStream();</span>
<span class="fc" id="L917">        FileUtils.copyFile(testFile1, destination);</span>
<span class="fc" id="L918">        assertEquals(&quot;Check Full copy size&quot;, testFile1Size, destination.size());</span>
<span class="fc" id="L919">        byte[] expected = FileUtils.readFileToByteArray(testFile1);</span>
<span class="fc" id="L920">        Assert.assertArrayEquals(&quot;Check Full copy&quot;, expected, destination.toByteArray());</span>
<span class="fc" id="L921">    }</span>

    public void IGNOREtestCopyFileLarge() throws Exception {

<span class="nc" id="L925">        File largeFile = new File(getTestDirectory(), &quot;large.txt&quot;);</span>
<span class="nc" id="L926">        File destination = new File(getTestDirectory(), &quot;copylarge.txt&quot;);</span>

<span class="nc" id="L928">        System.out.println(&quot;START:   &quot; + new java.util.Date());</span>
<span class="nc" id="L929">        createFile(largeFile, FileUtils.ONE_GB);</span>
<span class="nc" id="L930">        System.out.println(&quot;CREATED: &quot; + new java.util.Date());</span>
<span class="nc" id="L931">        FileUtils.copyFile(largeFile, destination);</span>
<span class="nc" id="L932">        System.out.println(&quot;COPIED:  &quot; + new java.util.Date());</span>

<span class="nc" id="L934">        assertTrue(&quot;Check Exist&quot;, destination.exists());</span>
<span class="nc" id="L935">        assertEquals(&quot;Check Full copy&quot;, largeFile.length(), destination.length());</span>
<span class="nc" id="L936">    }</span>

    public void testCopyFile2() throws Exception {
<span class="fc" id="L939">        File destination = new File(getTestDirectory(), &quot;copy2.txt&quot;);</span>
        
        //Thread.sleep(LAST_MODIFIED_DELAY);
        //This is to slow things down so we can catch if 
        //the lastModified date is not ok
        
<span class="fc" id="L945">        FileUtils.copyFile(testFile1, destination);</span>
<span class="fc" id="L946">        assertTrue(&quot;Check Exist&quot;, destination.exists());</span>
<span class="fc" id="L947">        assertEquals(&quot;Check Full copy&quot;, testFile2Size, destination.length());</span>
        /* disabled: Thread.sleep doesn't work reliably for this case
        assertTrue(&quot;Check last modified date preserved&quot;, 
            testFile1.lastModified() == destination.lastModified());*/
<span class="fc" id="L951">    }</span>
    
    public void testCopyToSelf() throws Exception {
<span class="fc" id="L954">        File destination = new File(getTestDirectory(), &quot;copy3.txt&quot;);</span>
        //Prepare a test file
<span class="fc" id="L956">        FileUtils.copyFile(testFile1, destination);</span>
        
        try {
<span class="nc" id="L959">            FileUtils.copyFile(destination, destination);</span>
<span class="nc" id="L960">            fail(&quot;file copy to self should not be possible&quot;);</span>
<span class="fc" id="L961">        } catch (IOException ioe) {</span>
            //we want the exception, copy to self should be illegal
<span class="nc" id="L963">        }</span>
<span class="fc" id="L964">    }</span>

    public void testCopyFile2WithoutFileDatePreservation() throws Exception {
<span class="fc" id="L967">        File destination = new File(getTestDirectory(), &quot;copy2.txt&quot;);</span>
        
        //Thread.sleep(LAST_MODIFIED_DELAY);
        //This is to slow things down so we can catch if 
        //the lastModified date is not ok
        
<span class="fc" id="L973">        FileUtils.copyFile(testFile1, destination, false);</span>
<span class="fc" id="L974">        assertTrue(&quot;Check Exist&quot;, destination.exists());</span>
<span class="fc" id="L975">        assertEquals(&quot;Check Full copy&quot;, testFile2Size, destination.length());</span>
        /* disabled: Thread.sleep doesn't work reliantly for this case
        assertTrue(&quot;Check last modified date modified&quot;, 
            testFile1.lastModified() != destination.lastModified());*/    
<span class="fc" id="L979">    }</span>

    public void testCopyDirectoryToDirectory_NonExistingDest() throws Exception {
<span class="fc" id="L982">        createFile(testFile1, 1234);</span>
<span class="fc" id="L983">        createFile(testFile2, 4321);</span>
<span class="fc" id="L984">        File srcDir = getTestDirectory();</span>
<span class="fc" id="L985">        File subDir = new File(srcDir, &quot;sub&quot;);</span>
<span class="fc" id="L986">        subDir.mkdir();</span>
<span class="fc" id="L987">        File subFile = new File(subDir, &quot;A.txt&quot;);</span>
<span class="fc" id="L988">        FileUtils.writeStringToFile(subFile, &quot;HELLO WORLD&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L989">        File destDir = new File(System.getProperty(&quot;java.io.tmpdir&quot;), &quot;tmp-FileUtilsTestCase&quot;);</span>
<span class="fc" id="L990">        FileUtils.deleteDirectory(destDir);</span>
<span class="fc" id="L991">        File actualDestDir = new File(destDir, srcDir.getName());</span>
        
<span class="fc" id="L993">        FileUtils.copyDirectoryToDirectory(srcDir, destDir);</span>
        
<span class="fc" id="L995">        assertTrue(&quot;Check exists&quot;, destDir.exists());</span>
<span class="fc" id="L996">        assertTrue(&quot;Check exists&quot;, actualDestDir.exists());</span>
<span class="fc" id="L997">        assertEquals(&quot;Check size&quot;, FileUtils.sizeOfDirectory(srcDir), FileUtils.sizeOfDirectory(actualDestDir));</span>
<span class="fc" id="L998">        assertTrue(new File(actualDestDir, &quot;sub/A.txt&quot;).exists());</span>
<span class="fc" id="L999">        FileUtils.deleteDirectory(destDir);</span>
<span class="fc" id="L1000">    }</span>

    public void testCopyDirectoryToNonExistingDest() throws Exception {
<span class="fc" id="L1003">        createFile(testFile1, 1234);</span>
<span class="fc" id="L1004">        createFile(testFile2, 4321);</span>
<span class="fc" id="L1005">        File srcDir = getTestDirectory();</span>
<span class="fc" id="L1006">        File subDir = new File(srcDir, &quot;sub&quot;);</span>
<span class="fc" id="L1007">        subDir.mkdir();</span>
<span class="fc" id="L1008">        File subFile = new File(subDir, &quot;A.txt&quot;);</span>
<span class="fc" id="L1009">        FileUtils.writeStringToFile(subFile, &quot;HELLO WORLD&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1010">        File destDir = new File(System.getProperty(&quot;java.io.tmpdir&quot;), &quot;tmp-FileUtilsTestCase&quot;);</span>
<span class="fc" id="L1011">        FileUtils.deleteDirectory(destDir);</span>
        
<span class="fc" id="L1013">        FileUtils.copyDirectory(srcDir, destDir);</span>
        
<span class="fc" id="L1015">        assertTrue(&quot;Check exists&quot;, destDir.exists());</span>
<span class="fc" id="L1016">        assertEquals(&quot;Check size&quot;, FileUtils.sizeOfDirectory(srcDir), FileUtils.sizeOfDirectory(destDir));</span>
<span class="fc" id="L1017">        assertTrue(new File(destDir, &quot;sub/A.txt&quot;).exists());</span>
<span class="fc" id="L1018">        FileUtils.deleteDirectory(destDir);</span>
<span class="fc" id="L1019">    }</span>

    public void testCopyDirectoryToExistingDest() throws Exception {
<span class="fc" id="L1022">        createFile(testFile1, 1234);</span>
<span class="fc" id="L1023">        createFile(testFile2, 4321);</span>
<span class="fc" id="L1024">        File srcDir = getTestDirectory();</span>
<span class="fc" id="L1025">        File subDir = new File(srcDir, &quot;sub&quot;);</span>
<span class="fc" id="L1026">        subDir.mkdir();</span>
<span class="fc" id="L1027">        File subFile = new File(subDir, &quot;A.txt&quot;);</span>
<span class="fc" id="L1028">        FileUtils.writeStringToFile(subFile, &quot;HELLO WORLD&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1029">        File destDir = new File(System.getProperty(&quot;java.io.tmpdir&quot;), &quot;tmp-FileUtilsTestCase&quot;);</span>
<span class="fc" id="L1030">        FileUtils.deleteDirectory(destDir);</span>
<span class="fc" id="L1031">        destDir.mkdirs();</span>
        
<span class="fc" id="L1033">        FileUtils.copyDirectory(srcDir, destDir);</span>
        
<span class="fc" id="L1035">        assertEquals(FileUtils.sizeOfDirectory(srcDir), FileUtils.sizeOfDirectory(destDir));</span>
<span class="fc" id="L1036">        assertTrue(new File(destDir, &quot;sub/A.txt&quot;).exists());</span>
<span class="fc" id="L1037">    }</span>

    public void testCopyDirectoryFiltered() throws Exception {
<span class="fc" id="L1040">        File grandParentDir = new File(getTestDirectory(), &quot;grandparent&quot;);</span>
<span class="fc" id="L1041">        File parentDir      = new File(grandParentDir, &quot;parent&quot;);</span>
<span class="fc" id="L1042">        File childDir       = new File(parentDir, &quot;child&quot;);</span>
<span class="fc" id="L1043">        createFilesForTestCopyDirectory(grandParentDir, parentDir, childDir);</span>

<span class="fc" id="L1045">        NameFileFilter filter = new NameFileFilter(new String[] {&quot;parent&quot;, &quot;child&quot;, &quot;file3.txt&quot;});</span>
<span class="fc" id="L1046">        File destDir       = new File(getTestDirectory(), &quot;copydest&quot;);</span>

<span class="fc" id="L1048">        FileUtils.copyDirectory(grandParentDir, destDir, filter);</span>
<span class="fc" id="L1049">        List&lt;File&gt; files  = LIST_WALKER.list(destDir);</span>
<span class="fc" id="L1050">        assertEquals(3, files.size());</span>
<span class="fc" id="L1051">        assertEquals(&quot;parent&quot;, files.get(0).getName());</span>
<span class="fc" id="L1052">        assertEquals(&quot;child&quot;, files.get(1).getName());</span>
<span class="fc" id="L1053">        assertEquals(&quot;file3.txt&quot;, files.get(2).getName());</span>
<span class="fc" id="L1054">   }</span>

    public void testCopyDirectoryPreserveDates() throws Exception {
<span class="fc" id="L1057">        File source = new File(getTestDirectory(), &quot;source&quot;);</span>
<span class="fc" id="L1058">        File sourceDirectory = new File(source, &quot;directory&quot;);</span>
<span class="fc" id="L1059">        File sourceFile = new File(sourceDirectory, &quot;hello.txt&quot;);</span>

        // Prepare source data
<span class="fc" id="L1062">        source.mkdirs();</span>
<span class="fc" id="L1063">        sourceDirectory.mkdir();</span>
<span class="fc" id="L1064">        FileUtils.writeStringToFile(sourceFile, &quot;HELLO WORLD&quot;, &quot;UTF8&quot;);</span>
        // Set dates in reverse order to avoid overwriting previous values
        // Also, use full seconds (arguments are in ms) close to today
        // but still highly unlikely to occur in the real world
<span class="fc" id="L1068">        sourceFile.setLastModified(1000000002000L);</span>
<span class="fc" id="L1069">        sourceDirectory.setLastModified(1000000001000L);</span>
<span class="fc" id="L1070">        source.setLastModified(1000000000000L);</span>

<span class="fc" id="L1072">        File target = new File(getTestDirectory(), &quot;target&quot;);</span>
<span class="fc" id="L1073">        File targetDirectory = new File(target, &quot;directory&quot;);</span>
<span class="fc" id="L1074">        File targetFile = new File(targetDirectory, &quot;hello.txt&quot;);</span>

        // Test with preserveFileDate disabled
<span class="fc" id="L1077">        FileUtils.copyDirectory(source, target, false);</span>
<span class="pc bpc" id="L1078" title="1 of 2 branches missed.">        assertTrue(1000000000000L != target.lastModified());</span>
<span class="pc bpc" id="L1079" title="1 of 2 branches missed.">        assertTrue(1000000001000L != targetDirectory.lastModified());</span>
<span class="pc bpc" id="L1080" title="1 of 2 branches missed.">        assertTrue(1000000002000L != targetFile.lastModified());</span>
<span class="fc" id="L1081">        FileUtils.deleteDirectory(target);</span>

        // Test with preserveFileDate enabled
<span class="fc" id="L1084">        FileUtils.copyDirectory(source, target, true);</span>
<span class="fc" id="L1085">        assertEquals(1000000000000L, target.lastModified());</span>
<span class="fc" id="L1086">        assertEquals(1000000001000L, targetDirectory.lastModified());</span>
<span class="fc" id="L1087">        assertEquals(1000000002000L, targetFile.lastModified());</span>
<span class="fc" id="L1088">        FileUtils.deleteDirectory(target);</span>

        // also if the target directory already exists (IO-190)
<span class="fc" id="L1091">        target.mkdirs();</span>
<span class="fc" id="L1092">        FileUtils.copyDirectory(source, target, true);</span>
<span class="fc" id="L1093">        assertEquals(1000000000000L, target.lastModified());</span>
<span class="fc" id="L1094">        assertEquals(1000000001000L, targetDirectory.lastModified());</span>
<span class="fc" id="L1095">        assertEquals(1000000002000L, targetFile.lastModified());</span>
<span class="fc" id="L1096">        FileUtils.deleteDirectory(target);</span>

        // also if the target subdirectory already exists (IO-190)
<span class="fc" id="L1099">        targetDirectory.mkdirs();</span>
<span class="fc" id="L1100">        FileUtils.copyDirectory(source, target, true);</span>
<span class="fc" id="L1101">        assertEquals(1000000000000L, target.lastModified());</span>
<span class="fc" id="L1102">        assertEquals(1000000001000L, targetDirectory.lastModified());</span>
<span class="fc" id="L1103">        assertEquals(1000000002000L, targetFile.lastModified());</span>
<span class="fc" id="L1104">        FileUtils.deleteDirectory(target);</span>
<span class="fc" id="L1105">    }</span>

    /** Test for IO-141 */
    public void testCopyDirectoryToChild() throws Exception {
<span class="fc" id="L1109">        File grandParentDir = new File(getTestDirectory(), &quot;grandparent&quot;);</span>
<span class="fc" id="L1110">        File parentDir      = new File(grandParentDir, &quot;parent&quot;);</span>
<span class="fc" id="L1111">        File childDir       = new File(parentDir, &quot;child&quot;);</span>
<span class="fc" id="L1112">        createFilesForTestCopyDirectory(grandParentDir, parentDir, childDir);</span>

<span class="fc" id="L1114">        long expectedCount = LIST_WALKER.list(grandParentDir).size() +</span>
<span class="fc" id="L1115">                             LIST_WALKER.list(parentDir).size();</span>
<span class="fc" id="L1116">        long expectedSize =  FileUtils.sizeOfDirectory(grandParentDir) +</span>
<span class="fc" id="L1117">                             FileUtils.sizeOfDirectory(parentDir);</span>
<span class="fc" id="L1118">        FileUtils.copyDirectory(parentDir, childDir);</span>
<span class="fc" id="L1119">        assertEquals(expectedCount, LIST_WALKER.list(grandParentDir).size());</span>
<span class="fc" id="L1120">        assertEquals(expectedSize, FileUtils.sizeOfDirectory(grandParentDir));</span>
<span class="fc" id="L1121">    }</span>

    /** Test for IO-141 */
    public void testCopyDirectoryToGrandChild() throws Exception {
<span class="fc" id="L1125">        File grandParentDir = new File(getTestDirectory(), &quot;grandparent&quot;);</span>
<span class="fc" id="L1126">        File parentDir      = new File(grandParentDir, &quot;parent&quot;);</span>
<span class="fc" id="L1127">        File childDir       = new File(parentDir, &quot;child&quot;);</span>
<span class="fc" id="L1128">        createFilesForTestCopyDirectory(grandParentDir, parentDir, childDir);</span>

<span class="fc" id="L1130">        long expectedCount = LIST_WALKER.list(grandParentDir).size() * 2;</span>
<span class="fc" id="L1131">        long expectedSize =  FileUtils.sizeOfDirectory(grandParentDir) * 2;</span>
<span class="fc" id="L1132">        FileUtils.copyDirectory(grandParentDir, childDir);</span>
<span class="fc" id="L1133">        assertEquals(expectedCount, LIST_WALKER.list(grandParentDir).size());</span>
<span class="fc" id="L1134">        assertEquals(expectedSize, FileUtils.sizeOfDirectory(grandParentDir));</span>
<span class="fc" id="L1135">    }</span>

    /** Test for IO-217 FileUtils.copyDirectoryToDirectory makes infinite loops */
    public void testCopyDirectoryToItself() throws Exception {
<span class="fc" id="L1139">        File dir = new File(getTestDirectory(), &quot;itself&quot;);</span>
<span class="fc" id="L1140">        dir.mkdirs();</span>
<span class="fc" id="L1141">        FileUtils.copyDirectoryToDirectory(dir, dir);</span>
<span class="fc" id="L1142">        assertEquals(1, LIST_WALKER.list(dir).size());</span>
<span class="fc" id="L1143">    }</span>

    private void createFilesForTestCopyDirectory(File grandParentDir, File parentDir, File childDir) throws Exception {
<span class="fc" id="L1146">        File childDir2 = new File(parentDir, &quot;child2&quot;);</span>
<span class="fc" id="L1147">        File grandChildDir = new File(childDir, &quot;grandChild&quot;);</span>
<span class="fc" id="L1148">        File grandChild2Dir = new File(childDir2, &quot;grandChild2&quot;);</span>
<span class="fc" id="L1149">        File file1 = new File(grandParentDir, &quot;file1.txt&quot;);</span>
<span class="fc" id="L1150">        File file2 = new File(parentDir, &quot;file2.txt&quot;);</span>
<span class="fc" id="L1151">        File file3 = new File(childDir, &quot;file3.txt&quot;);</span>
<span class="fc" id="L1152">        File file4 = new File(childDir2, &quot;file4.txt&quot;);</span>
<span class="fc" id="L1153">        File file5 = new File(grandChildDir, &quot;file5.txt&quot;);</span>
<span class="fc" id="L1154">        File file6 = new File(grandChild2Dir, &quot;file6.txt&quot;);</span>
<span class="fc" id="L1155">        FileUtils.deleteDirectory(grandParentDir);</span>
<span class="fc" id="L1156">        grandChildDir.mkdirs();</span>
<span class="fc" id="L1157">        grandChild2Dir.mkdirs();</span>
<span class="fc" id="L1158">        FileUtils.writeStringToFile(file1, &quot;File 1 in grandparent&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1159">        FileUtils.writeStringToFile(file2, &quot;File 2 in parent&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1160">        FileUtils.writeStringToFile(file3, &quot;File 3 in child&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1161">        FileUtils.writeStringToFile(file4, &quot;File 4 in child2&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1162">        FileUtils.writeStringToFile(file5, &quot;File 5 in grandChild&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1163">        FileUtils.writeStringToFile(file6, &quot;File 6 in grandChild2&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1164">    }</span>

    public void testCopyDirectoryErrors() throws Exception {
        try {
<span class="nc" id="L1168">            FileUtils.copyDirectory(null, null);</span>
<span class="nc" id="L1169">            fail();</span>
<span class="pc" id="L1170">        } catch (NullPointerException ex) {}</span>
        try {
<span class="nc" id="L1172">            FileUtils.copyDirectory(new File(&quot;a&quot;), null);</span>
<span class="nc" id="L1173">            fail();</span>
<span class="pc" id="L1174">        } catch (NullPointerException ex) {}</span>
        try {
<span class="nc" id="L1176">            FileUtils.copyDirectory(null, new File(&quot;a&quot;));</span>
<span class="nc" id="L1177">            fail();</span>
<span class="pc" id="L1178">        } catch (NullPointerException ex) {}</span>
        try {
<span class="nc" id="L1180">            FileUtils.copyDirectory(new File(&quot;doesnt-exist&quot;), new File(&quot;a&quot;));</span>
<span class="nc" id="L1181">            fail();</span>
<span class="pc" id="L1182">        } catch (IOException ex) {}</span>
        try {
<span class="nc" id="L1184">            FileUtils.copyDirectory(testFile1, new File(&quot;a&quot;));</span>
<span class="nc" id="L1185">            fail();</span>
<span class="pc" id="L1186">        } catch (IOException ex) {}</span>
        try {
<span class="nc" id="L1188">            FileUtils.copyDirectory(getTestDirectory(), testFile1);</span>
<span class="nc" id="L1189">            fail();</span>
<span class="pc" id="L1190">        } catch (IOException ex) {}</span>
        try {
<span class="nc" id="L1192">            FileUtils.copyDirectory(getTestDirectory(), getTestDirectory());</span>
<span class="nc" id="L1193">            fail();</span>
<span class="pc" id="L1194">        } catch (IOException ex) {}</span>
<span class="fc" id="L1195">    }</span>

    // forceDelete

    public void testForceDeleteAFile1() throws Exception {
<span class="fc" id="L1200">        File destination = new File(getTestDirectory(), &quot;copy1.txt&quot;);</span>
<span class="fc" id="L1201">        destination.createNewFile();</span>
<span class="fc" id="L1202">        assertTrue(&quot;Copy1.txt doesn't exist to delete&quot;, destination.exists());</span>
<span class="fc" id="L1203">        FileUtils.forceDelete(destination);</span>
<span class="pc bpc" id="L1204" title="1 of 2 branches missed.">        assertTrue(&quot;Check No Exist&quot;, !destination.exists());</span>
<span class="fc" id="L1205">    }</span>

    public void testForceDeleteAFile2() throws Exception {
<span class="fc" id="L1208">        File destination = new File(getTestDirectory(), &quot;copy2.txt&quot;);</span>
<span class="fc" id="L1209">        destination.createNewFile();</span>
<span class="fc" id="L1210">        assertTrue(&quot;Copy2.txt doesn't exist to delete&quot;, destination.exists());</span>
<span class="fc" id="L1211">        FileUtils.forceDelete(destination);</span>
<span class="pc bpc" id="L1212" title="1 of 2 branches missed.">        assertTrue(&quot;Check No Exist&quot;, !destination.exists());</span>
<span class="fc" id="L1213">    }</span>

    public void testForceDeleteAFile3() throws Exception {
<span class="fc" id="L1216">        File destination = new File(getTestDirectory(), &quot;no_such_file&quot;);</span>
<span class="pc bpc" id="L1217" title="1 of 2 branches missed.">        assertTrue(&quot;Check No Exist&quot;, !destination.exists());</span>
        try {
<span class="nc" id="L1219">            FileUtils.forceDelete(destination);</span>
<span class="nc" id="L1220">            fail(&quot;Should generate FileNotFoundException&quot;);</span>
<span class="fc" id="L1221">        } catch (FileNotFoundException ignored){</span>
<span class="nc" id="L1222">        }</span>
<span class="fc" id="L1223">    }</span>

    // copyFileToDirectory

    public void testCopyFile1ToDir() throws Exception {
<span class="fc" id="L1228">        File directory = new File(getTestDirectory(), &quot;subdir&quot;);</span>
<span class="pc bpc" id="L1229" title="1 of 2 branches missed.">        if (!directory.exists()) {</span>
<span class="fc" id="L1230">            directory.mkdirs();</span>
        }
<span class="fc" id="L1232">        File destination = new File(directory, testFile1.getName());</span>
        
        //Thread.sleep(LAST_MODIFIED_DELAY);
        //This is to slow things down so we can catch if 
        //the lastModified date is not ok
        
<span class="fc" id="L1238">        FileUtils.copyFileToDirectory(testFile1, directory);</span>
<span class="fc" id="L1239">        assertTrue(&quot;Check Exist&quot;, destination.exists());</span>
<span class="fc" id="L1240">        assertEquals(&quot;Check Full copy&quot;, testFile1Size, destination.length());</span>
        /* disabled: Thread.sleep doesn't work reliantly for this case
        assertTrue(&quot;Check last modified date preserved&quot;, 
            testFile1.lastModified() == destination.lastModified());*/
            
        try {
<span class="nc" id="L1246">            FileUtils.copyFileToDirectory(destination, directory);</span>
<span class="nc" id="L1247">            fail(&quot;Should not be able to copy a file into the same directory as itself&quot;);    </span>
<span class="fc" id="L1248">        } catch (IOException ioe) {</span>
            //we want that, cannot copy to the same directory as the original file
<span class="nc" id="L1250">        }</span>
<span class="fc" id="L1251">    }</span>

    public void testCopyFile2ToDir() throws Exception {
<span class="fc" id="L1254">        File directory = new File(getTestDirectory(), &quot;subdir&quot;);</span>
<span class="pc bpc" id="L1255" title="1 of 2 branches missed.">        if (!directory.exists()) {</span>
<span class="fc" id="L1256">            directory.mkdirs();</span>
        }
<span class="fc" id="L1258">        File destination = new File(directory, testFile1.getName());</span>
        
        //Thread.sleep(LAST_MODIFIED_DELAY);
        //This is to slow things down so we can catch if 
        //the lastModified date is not ok
        
<span class="fc" id="L1264">        FileUtils.copyFileToDirectory(testFile1, directory);</span>
<span class="fc" id="L1265">        assertTrue(&quot;Check Exist&quot;, destination.exists());</span>
<span class="fc" id="L1266">        assertEquals(&quot;Check Full copy&quot;, testFile2Size, destination.length());</span>
        /* disabled: Thread.sleep doesn't work reliantly for this case
        assertTrue(&quot;Check last modified date preserved&quot;, 
            testFile1.lastModified() == destination.lastModified());*/    
<span class="fc" id="L1270">    }</span>

    // forceDelete

    public void testForceDeleteDir() throws Exception {
<span class="fc" id="L1275">        File testDirectory = getTestDirectory();</span>
<span class="fc" id="L1276">        FileUtils.forceDelete(testDirectory.getParentFile());</span>
<span class="fc" id="L1277">        assertTrue(</span>
            &quot;Check No Exist&quot;,
<span class="pc bpc" id="L1279" title="1 of 2 branches missed.">            !testDirectory.getParentFile().exists());</span>
<span class="fc" id="L1280">    }</span>

    /**
     *  Test the FileUtils implementation.
     */
    public void testFileUtils() throws Exception {
        // Loads file from classpath
<span class="fc" id="L1287">        File file1 = new File(getTestDirectory(), &quot;test.txt&quot;);</span>
<span class="fc" id="L1288">        String filename = file1.getAbsolutePath();</span>
        
        //Create test file on-the-fly (used to be in CVS)
<span class="fc" id="L1291">        OutputStream out = new java.io.FileOutputStream(file1);</span>
        try {
<span class="fc" id="L1293">            out.write(&quot;This is a test&quot;.getBytes(&quot;UTF-8&quot;));</span>
        } finally {
<span class="fc" id="L1295">            out.close();</span>
        }
        
<span class="fc" id="L1298">        File file2 = new File(getTestDirectory(), &quot;test2.txt&quot;);</span>

<span class="fc" id="L1300">        FileUtils.writeStringToFile(file2, filename, &quot;UTF-8&quot;);</span>
<span class="fc" id="L1301">        assertTrue(file2.exists());</span>
<span class="pc bpc" id="L1302" title="1 of 2 branches missed.">        assertTrue(file2.length() &gt; 0);</span>

<span class="fc" id="L1304">        String file2contents = FileUtils.readFileToString(file2, &quot;UTF-8&quot;);</span>
<span class="fc" id="L1305">        assertTrue(</span>
            &quot;Second file's contents correct&quot;,
<span class="fc" id="L1307">            filename.equals(file2contents));</span>

<span class="fc" id="L1309">        assertTrue(file2.delete());</span>
        
<span class="fc" id="L1311">        String contents = FileUtils.readFileToString(new File(filename), &quot;UTF-8&quot;);</span>
<span class="fc" id="L1312">        assertEquals(&quot;FileUtils.fileRead()&quot;, &quot;This is a test&quot;, contents);</span>

<span class="fc" id="L1314">    }</span>

    public void testTouch() throws IOException {
<span class="fc" id="L1317">        File file = new File(getTestDirectory(), &quot;touch.txt&quot;) ;</span>
<span class="pc bpc" id="L1318" title="1 of 2 branches missed.">        if (file.exists()) {</span>
<span class="nc" id="L1319">            file.delete();</span>
        }
<span class="pc bpc" id="L1321" title="1 of 2 branches missed.">        assertTrue(&quot;Bad test: test file still exists&quot;, !file.exists());</span>
<span class="fc" id="L1322">        FileUtils.touch(file);</span>
<span class="fc" id="L1323">        assertTrue(&quot;FileUtils.touch() created file&quot;, file.exists());</span>
<span class="fc" id="L1324">        FileOutputStream out = new FileOutputStream(file) ;</span>
<span class="fc" id="L1325">        assertEquals(&quot;Created empty file.&quot;, 0, file.length());</span>
<span class="fc" id="L1326">        out.write(0) ;</span>
<span class="fc" id="L1327">        out.close();</span>
<span class="fc" id="L1328">        assertEquals(&quot;Wrote one byte to file&quot;, 1, file.length());</span>
<span class="fc" id="L1329">        long y2k = new GregorianCalendar(2000, 0, 1).getTime().getTime();</span>
<span class="fc" id="L1330">        boolean res = file.setLastModified(y2k);  // 0L fails on Win98</span>
<span class="fc" id="L1331">        assertEquals(&quot;Bad test: set lastModified failed&quot;, true, res);</span>
<span class="fc" id="L1332">        assertEquals(&quot;Bad test: set lastModified set incorrect value&quot;, y2k, file.lastModified());</span>
<span class="fc" id="L1333">        long now = System.currentTimeMillis();</span>
<span class="fc" id="L1334">        FileUtils.touch(file) ;</span>
<span class="fc" id="L1335">        assertEquals(&quot;FileUtils.touch() didn't empty the file.&quot;, 1, file.length());</span>
<span class="pc bpc" id="L1336" title="1 of 2 branches missed.">        assertEquals(&quot;FileUtils.touch() changed lastModified&quot;, false, y2k == file.lastModified());</span>
<span class="pc bpc" id="L1337" title="1 of 2 branches missed.">        assertEquals(&quot;FileUtils.touch() changed lastModified to more than now-3s&quot;, true, file.lastModified() &gt;= now - 3000);</span>
<span class="pc bpc" id="L1338" title="1 of 2 branches missed.">        assertEquals(&quot;FileUtils.touch() changed lastModified to less than now+3s&quot;, true, file.lastModified() &lt;= now + 3000);</span>
<span class="fc" id="L1339">    }</span>

    public void testListFiles() throws Exception {
<span class="fc" id="L1342">        File srcDir = getTestDirectory();</span>
<span class="fc" id="L1343">        File subDir = new File(srcDir, &quot;list_test&quot; );</span>
<span class="fc" id="L1344">        subDir.mkdir();</span>

<span class="fc" id="L1346">        File subDir2 = new File(subDir, &quot;subdir&quot; );</span>
<span class="fc" id="L1347">        subDir2.mkdir();</span>

<span class="fc" id="L1349">        String[] fileNames = {&quot;a.txt&quot;, &quot;b.txt&quot;, &quot;c.txt&quot;, &quot;d.txt&quot;, &quot;e.txt&quot;, &quot;f.txt&quot;};</span>
<span class="fc" id="L1350">        int[] fileSizes = {123, 234, 345, 456, 678, 789};</span>

<span class="fc bfc" id="L1352" title="All 2 branches covered.">        for (int i = 0; i &lt; fileNames.length; ++i) {</span>
<span class="fc" id="L1353">            File theFile = new File(subDir, fileNames[i]);</span>
<span class="fc" id="L1354">            createFile(theFile, fileSizes[i]);</span>
        }

<span class="fc" id="L1357">        Collection&lt;File&gt; files = FileUtils.listFiles(subDir,</span>
                                               new WildcardFileFilter(&quot;*.*&quot;),
                                               new WildcardFileFilter(&quot;*&quot;));

<span class="fc" id="L1361">        int count = files.size();</span>
<span class="fc" id="L1362">        Object[] fileObjs = files.toArray();</span>

<span class="fc" id="L1364">        assertEquals(fileNames.length, files.size());</span>

<span class="fc" id="L1366">        Map&lt;String, String&gt; foundFileNames = new HashMap&lt;String, String&gt;();</span>

<span class="fc bfc" id="L1368" title="All 2 branches covered.">        for (int i = 0; i &lt; count; ++i) {</span>
<span class="fc" id="L1369">            boolean found = false;</span>
<span class="pc bpc" id="L1370" title="1 of 4 branches missed.">            for(int j = 0; !found &amp;&amp; j &lt; fileNames.length; ++j) {</span>
<span class="fc bfc" id="L1371" title="All 2 branches covered.">                if ( fileNames[j].equals(((File) fileObjs[i]).getName())) {</span>
<span class="fc" id="L1372">                    foundFileNames.put(fileNames[j], fileNames[j]);</span>
<span class="fc" id="L1373">                    found = true;</span>
                }
            }
        }

<span class="fc" id="L1378">        assertEquals(foundFileNames.size(), fileNames.length);</span>

<span class="fc" id="L1380">        subDir.delete();</span>
<span class="fc" id="L1381">    }</span>
    
    public void testListFilesWithDirs() throws IOException {
<span class="fc" id="L1384">    	File srcDir = getTestDirectory();</span>
    	
<span class="fc" id="L1386">    	File subDir1 = new File(srcDir, &quot;subdir&quot;);</span>
<span class="fc" id="L1387">    	subDir1.mkdir();</span>
    	
<span class="fc" id="L1389">    	File subDir2 = new File(subDir1, &quot;subdir2&quot;);</span>
<span class="fc" id="L1390">    	subDir2.mkdir();</span>
    	
<span class="fc" id="L1392">    	File someFile = new File(subDir2, &quot;a.txt&quot;);</span>
<span class="fc" id="L1393">    	createFile(someFile, 100);</span>
    	
<span class="fc" id="L1395">    	File subDir3 = new File(subDir2, &quot;subdir3&quot;);</span>
<span class="fc" id="L1396">    	subDir3.mkdir();</span>
    	
<span class="fc" id="L1398">    	Collection&lt;File&gt; files = FileUtils.listFilesAndDirs(subDir1, </span>
    						new WildcardFileFilter(&quot;*.*&quot;), new WildcardFileFilter(&quot;*&quot;));
    	
<span class="fc" id="L1401">    	assertEquals(4, files.size());</span>
<span class="fc" id="L1402">    	assertTrue(&quot;Should contain the directory.&quot;, files.contains(subDir1));</span>
<span class="fc" id="L1403">    	assertTrue(&quot;Should contain the directory.&quot;, files.contains(subDir2));</span>
<span class="fc" id="L1404">    	assertTrue(&quot;Should contain the file.&quot;, files.contains(someFile));</span>
<span class="fc" id="L1405">    	assertTrue(&quot;Should contain the directory.&quot;, files.contains(subDir3));</span>
    	
<span class="fc" id="L1407">    	subDir1.delete();</span>
<span class="fc" id="L1408">    }</span>

    public void testIterateFiles() throws Exception {
<span class="fc" id="L1411">        File srcDir = getTestDirectory();</span>
<span class="fc" id="L1412">        File subDir = new File(srcDir, &quot;list_test&quot; );</span>
<span class="fc" id="L1413">        subDir.mkdir();</span>

<span class="fc" id="L1415">        String[] fileNames = {&quot;a.txt&quot;, &quot;b.txt&quot;, &quot;c.txt&quot;, &quot;d.txt&quot;, &quot;e.txt&quot;, &quot;f.txt&quot;};</span>
<span class="fc" id="L1416">        int[] fileSizes = {123, 234, 345, 456, 678, 789};</span>

<span class="fc bfc" id="L1418" title="All 2 branches covered.">        for (int i = 0; i &lt; fileNames.length; ++i) {</span>
<span class="fc" id="L1419">            File theFile = new File(subDir, fileNames[i]);</span>
<span class="fc" id="L1420">            createFile(theFile, fileSizes[i]);</span>
        }

<span class="fc" id="L1423">        Iterator&lt;File&gt; files = FileUtils.iterateFiles(subDir,</span>
                                                new WildcardFileFilter(&quot;*.*&quot;),
                                                new WildcardFileFilter(&quot;*&quot;));

<span class="fc" id="L1427">        Map&lt;String, String&gt; foundFileNames = new HashMap&lt;String, String&gt;();</span>

<span class="fc bfc" id="L1429" title="All 2 branches covered.">        while (files.hasNext()) {</span>
<span class="fc" id="L1430">            boolean found = false;</span>
<span class="fc" id="L1431">            String fileName = files.next().getName();</span>

<span class="pc bpc" id="L1433" title="1 of 4 branches missed.">            for (int j = 0; !found &amp;&amp; j &lt; fileNames.length; ++j) {</span>
<span class="fc bfc" id="L1434" title="All 2 branches covered.">                if ( fileNames[j].equals(fileName)) {</span>
<span class="fc" id="L1435">                    foundFileNames.put(fileNames[j], fileNames[j]);</span>
<span class="fc" id="L1436">                    found = true;</span>
                }
            }
<span class="fc" id="L1439">        }</span>

<span class="fc" id="L1441">        assertEquals(foundFileNames.size(), fileNames.length);</span>

<span class="fc" id="L1443">        subDir.delete();</span>
<span class="fc" id="L1444">    }</span>
    
    public void testIterateFilesAndDirs() throws IOException {
<span class="fc" id="L1447">    	File srcDir = getTestDirectory();</span>
    	
<span class="fc" id="L1449">    	File subDir1 = new File(srcDir, &quot;subdir&quot;);</span>
<span class="fc" id="L1450">    	subDir1.mkdir();</span>
    	
<span class="fc" id="L1452">    	File subDir2 = new File(subDir1, &quot;subdir2&quot;);</span>
<span class="fc" id="L1453">    	subDir2.mkdir();</span>
    	
<span class="fc" id="L1455">    	File someFile = new File(subDir2, &quot;a.txt&quot;);</span>
<span class="fc" id="L1456">    	createFile(someFile, 100);</span>
    	
<span class="fc" id="L1458">    	File subDir3 = new File(subDir2, &quot;subdir3&quot;);</span>
<span class="fc" id="L1459">    	subDir3.mkdir();</span>
    	
<span class="fc" id="L1461">    	Collection&lt;File&gt; filesAndDirs = Arrays.asList(subDir1, subDir2, someFile, subDir3);</span>
    	
<span class="fc" id="L1463">    	int filesCount = 0;</span>
<span class="fc" id="L1464">    	Iterator&lt;File&gt; files = FileUtils.iterateFilesAndDirs(subDir1, </span>
                                                new WildcardFileFilter(&quot;*.*&quot;),
                                                new WildcardFileFilter(&quot;*&quot;));
<span class="fc bfc" id="L1467" title="All 2 branches covered.">        while (files.hasNext()) {</span>
<span class="fc" id="L1468">            filesCount++;</span>
<span class="fc" id="L1469">            File file = files.next();</span>
<span class="fc" id="L1470">            assertTrue(&quot;Should contain the directory/file&quot;, filesAndDirs.contains(file));</span>
<span class="fc" id="L1471">        }</span>
    	
<span class="fc" id="L1473">    	assertEquals(filesCount, filesAndDirs.size());</span>
<span class="fc" id="L1474">    }</span>

    public void testReadFileToStringWithDefaultEncoding() throws Exception {
<span class="fc" id="L1477">        File file = new File(getTestDirectory(), &quot;read.obj&quot;);</span>
<span class="fc" id="L1478">        FileOutputStream out = new FileOutputStream(file);</span>
<span class="fc" id="L1479">        byte[] text = &quot;Hello /u1234&quot;.getBytes();</span>
<span class="fc" id="L1480">        out.write(text);</span>
<span class="fc" id="L1481">        out.close();</span>
        
<span class="fc" id="L1483">        String data = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1484">        assertEquals(&quot;Hello /u1234&quot;, data);</span>
<span class="fc" id="L1485">    }</span>

    public void testReadFileToStringWithEncoding() throws Exception {
<span class="fc" id="L1488">        File file = new File(getTestDirectory(), &quot;read.obj&quot;);</span>
<span class="fc" id="L1489">        FileOutputStream out = new FileOutputStream(file);</span>
<span class="fc" id="L1490">        byte[] text = &quot;Hello /u1234&quot;.getBytes(&quot;UTF8&quot;);</span>
<span class="fc" id="L1491">        out.write(text);</span>
<span class="fc" id="L1492">        out.close();</span>
        
<span class="fc" id="L1494">        String data = FileUtils.readFileToString(file, &quot;UTF8&quot;);</span>
<span class="fc" id="L1495">        assertEquals(&quot;Hello /u1234&quot;, data);</span>
<span class="fc" id="L1496">    }</span>

    public void testReadFileToByteArray() throws Exception {
<span class="fc" id="L1499">        File file = new File(getTestDirectory(), &quot;read.txt&quot;);</span>
<span class="fc" id="L1500">        FileOutputStream out = new FileOutputStream(file);</span>
<span class="fc" id="L1501">        out.write(11);</span>
<span class="fc" id="L1502">        out.write(21);</span>
<span class="fc" id="L1503">        out.write(31);</span>
<span class="fc" id="L1504">        out.close();</span>
        
<span class="fc" id="L1506">        byte[] data = FileUtils.readFileToByteArray(file);</span>
<span class="fc" id="L1507">        assertEquals(3, data.length);</span>
<span class="fc" id="L1508">        assertEquals(11, data[0]);</span>
<span class="fc" id="L1509">        assertEquals(21, data[1]);</span>
<span class="fc" id="L1510">        assertEquals(31, data[2]);</span>
<span class="fc" id="L1511">    }</span>

    public void testReadLines() throws Exception {
<span class="fc" id="L1514">        File file = newFile(&quot;lines.txt&quot;);</span>
        try {
<span class="fc" id="L1516">            String[] data = new String[] {&quot;hello&quot;, &quot;/u1234&quot;, &quot;&quot;, &quot;this is&quot;, &quot;some text&quot;};</span>
<span class="fc" id="L1517">            createLineBasedFile(file, data);</span>
            
<span class="fc" id="L1519">            List&lt;String&gt; lines = FileUtils.readLines(file, &quot;UTF-8&quot;);</span>
<span class="fc" id="L1520">            assertEquals(Arrays.asList(data), lines);</span>
        } finally {
<span class="fc" id="L1522">            deleteFile(file);</span>
        }
<span class="fc" id="L1524">    }</span>

    public void testWriteStringToFile1() throws Exception {
<span class="fc" id="L1527">        File file = new File(getTestDirectory(), &quot;write.txt&quot;);</span>
<span class="fc" id="L1528">        FileUtils.writeStringToFile(file, &quot;Hello /u1234&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1529">        byte[] text = &quot;Hello /u1234&quot;.getBytes(&quot;UTF8&quot;);</span>
<span class="fc" id="L1530">        assertEqualContent(text, file);</span>
<span class="fc" id="L1531">    }</span>

    public void testWriteStringToFile2() throws Exception {
<span class="fc" id="L1534">        File file = new File(getTestDirectory(), &quot;write.txt&quot;);</span>
<span class="fc" id="L1535">        FileUtils.writeStringToFile(file, &quot;Hello /u1234&quot;, null);</span>
<span class="fc" id="L1536">        byte[] text = &quot;Hello /u1234&quot;.getBytes();</span>
<span class="fc" id="L1537">        assertEqualContent(text, file);</span>
<span class="fc" id="L1538">    }</span>

    public void testWriteCharSequence1() throws Exception {
<span class="fc" id="L1541">        File file = new File(getTestDirectory(), &quot;write.txt&quot;);</span>
<span class="fc" id="L1542">        FileUtils.write(file, &quot;Hello /u1234&quot;, &quot;UTF8&quot;);</span>
<span class="fc" id="L1543">        byte[] text = &quot;Hello /u1234&quot;.getBytes(&quot;UTF8&quot;);</span>
<span class="fc" id="L1544">        assertEqualContent(text, file);</span>
<span class="fc" id="L1545">    }</span>

    public void testWriteCharSequence2() throws Exception {
<span class="fc" id="L1548">        File file = new File(getTestDirectory(), &quot;write.txt&quot;);</span>
<span class="fc" id="L1549">        FileUtils.write(file, &quot;Hello /u1234&quot;, (String) null);</span>
<span class="fc" id="L1550">        byte[] text = &quot;Hello /u1234&quot;.getBytes();</span>
<span class="fc" id="L1551">        assertEqualContent(text, file);</span>
<span class="fc" id="L1552">    }</span>

    public void testWriteByteArrayToFile() throws Exception {
<span class="fc" id="L1555">        File file = new File(getTestDirectory(), &quot;write.obj&quot;);</span>
<span class="fc" id="L1556">        byte[] data = new byte[] {11, 21, 31};</span>
<span class="fc" id="L1557">        FileUtils.writeByteArrayToFile(file, data);</span>
<span class="fc" id="L1558">        assertEqualContent(data, file);</span>
<span class="fc" id="L1559">    }</span>

    public void testWriteLines_4arg() throws Exception {
<span class="fc" id="L1562">        Object[] data = new Object[] {</span>
            &quot;hello&quot;, new StringBuffer(&quot;world&quot;), &quot;&quot;, &quot;this is&quot;, null, &quot;some text&quot;};
<span class="fc" id="L1564">        List&lt;Object&gt; list = Arrays.asList(data);</span>
        
<span class="fc" id="L1566">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1567">        FileUtils.writeLines(file, &quot;US-ASCII&quot;, list, &quot;*&quot;);</span>
        
<span class="fc" id="L1569">        String expected = &quot;hello*world**this is**some text*&quot;;</span>
<span class="fc" id="L1570">        String actual = FileUtils.readFileToString(file, &quot;US-ASCII&quot;);</span>
<span class="fc" id="L1571">        assertEquals(expected, actual);</span>
<span class="fc" id="L1572">    }</span>

    public void testWriteLines_4arg_Writer_nullData() throws Exception {
<span class="fc" id="L1575">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1576">        FileUtils.writeLines(file, &quot;US-ASCII&quot;, (List&lt;?&gt;) null, &quot;*&quot;);</span>
        
<span class="fc" id="L1578">        assertEquals(&quot;Sizes differ&quot;, 0, file.length());</span>
<span class="fc" id="L1579">    }</span>

    public void testWriteLines_4arg_nullSeparator() throws Exception {
<span class="fc" id="L1582">        Object[] data = new Object[] {</span>
            &quot;hello&quot;, new StringBuffer(&quot;world&quot;), &quot;&quot;, &quot;this is&quot;, null, &quot;some text&quot;};
<span class="fc" id="L1584">        List&lt;Object&gt; list = Arrays.asList(data);</span>
        
<span class="fc" id="L1586">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1587">        FileUtils.writeLines(file, &quot;US-ASCII&quot;, list, null);</span>
        
<span class="fc" id="L1589">        String expected = &quot;hello&quot; + IOUtils.LINE_SEPARATOR + &quot;world&quot; + IOUtils.LINE_SEPARATOR +</span>
            IOUtils.LINE_SEPARATOR + &quot;this is&quot; + IOUtils.LINE_SEPARATOR +
            IOUtils.LINE_SEPARATOR + &quot;some text&quot; + IOUtils.LINE_SEPARATOR;
<span class="fc" id="L1592">        String actual = FileUtils.readFileToString(file, &quot;US-ASCII&quot;);</span>
<span class="fc" id="L1593">        assertEquals(expected, actual);</span>
<span class="fc" id="L1594">    }</span>

    public void testWriteLines_3arg_nullSeparator() throws Exception {
<span class="fc" id="L1597">        Object[] data = new Object[] {</span>
            &quot;hello&quot;, new StringBuffer(&quot;world&quot;), &quot;&quot;, &quot;this is&quot;, null, &quot;some text&quot;};
<span class="fc" id="L1599">        List&lt;Object&gt; list = Arrays.asList(data);</span>
        
<span class="fc" id="L1601">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1602">        FileUtils.writeLines(file, &quot;US-ASCII&quot;, list);</span>
        
<span class="fc" id="L1604">        String expected = &quot;hello&quot; + IOUtils.LINE_SEPARATOR + &quot;world&quot; + IOUtils.LINE_SEPARATOR +</span>
            IOUtils.LINE_SEPARATOR + &quot;this is&quot; + IOUtils.LINE_SEPARATOR +
            IOUtils.LINE_SEPARATOR + &quot;some text&quot; + IOUtils.LINE_SEPARATOR;
<span class="fc" id="L1607">        String actual = FileUtils.readFileToString(file, &quot;US-ASCII&quot;);</span>
<span class="fc" id="L1608">        assertEquals(expected, actual);</span>
<span class="fc" id="L1609">    }</span>
    
    public void testWriteLines_5argsWithAppendOptionTrue_ShouldNotDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1612">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1613">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1615">        List&lt;String&gt; linesToAppend = Arrays.asList(new String[] {</span>
                &quot;my first line&quot;, &quot;The second Line&quot; });
<span class="fc" id="L1617">        FileUtils.writeLines(file, null, linesToAppend, null, true);</span>

<span class="fc" id="L1619">        String expected = &quot;This line was there before you...&quot;</span>
                + &quot;my first line&quot;
                + IOUtils.LINE_SEPARATOR + &quot;The second Line&quot;
                + IOUtils.LINE_SEPARATOR ;
<span class="fc" id="L1623">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1624">        assertEquals(expected, actual);</span>
<span class="fc" id="L1625">    }</span>

    public void testWriteLines_5argsWithAppendOptionFalse_ShouldDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1628">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1629">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1631">        List&lt;String&gt; linesToAppend = Arrays.asList(new String[] {</span>
                &quot;my first line&quot;, &quot;The second Line&quot; });
<span class="fc" id="L1633">        FileUtils.writeLines(file, null, linesToAppend, null, false);</span>

<span class="fc" id="L1635">        String expected = &quot;my first line&quot;</span>
                + IOUtils.LINE_SEPARATOR + &quot;The second Line&quot;
                + IOUtils.LINE_SEPARATOR ;
<span class="fc" id="L1638">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1639">        assertEquals(expected, actual);</span>
<span class="fc" id="L1640">    }</span>

    public void testWriteLines_4argsWithAppendOptionTrue_ShouldNotDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1643">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1644">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1646">        List&lt;String&gt; linesToAppend = Arrays.asList(new String[] {</span>
                &quot;my first line&quot;, &quot;The second Line&quot; });
<span class="fc" id="L1648">        FileUtils.writeLines(file, linesToAppend, null, true);</span>

<span class="fc" id="L1650">        String expected = &quot;This line was there before you...&quot;</span>
                + &quot;my first line&quot;
                + IOUtils.LINE_SEPARATOR + &quot;The second Line&quot;
                + IOUtils.LINE_SEPARATOR ;
<span class="fc" id="L1654">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1655">        assertEquals(expected, actual);</span>
<span class="fc" id="L1656">    }</span>
    
    public void testWriteLines_4argsWithAppendOptionFalse_ShouldDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1659">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1660">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1662">        List&lt;String&gt; linesToAppend = Arrays.asList(new String[] {</span>
                &quot;my first line&quot;, &quot;The second Line&quot; });
<span class="fc" id="L1664">        FileUtils.writeLines(file, linesToAppend, null, false);</span>

<span class="fc" id="L1666">        String expected = &quot;my first line&quot;</span>
                + IOUtils.LINE_SEPARATOR + &quot;The second Line&quot;
                + IOUtils.LINE_SEPARATOR ;
<span class="fc" id="L1669">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1670">        assertEquals(expected, actual);</span>
<span class="fc" id="L1671">    }</span>


    public void testWriteLinesEncoding_WithAppendOptionTrue_ShouldNotDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1675">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1676">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1678">        List&lt;String&gt; linesToAppend = Arrays.asList(new String[] {</span>
                &quot;my first line&quot;, &quot;The second Line&quot; });
<span class="fc" id="L1680">        FileUtils.writeLines(file, null, linesToAppend, true);</span>

<span class="fc" id="L1682">        String expected = &quot;This line was there before you...&quot;</span>
                + &quot;my first line&quot;
                + IOUtils.LINE_SEPARATOR + &quot;The second Line&quot;
                + IOUtils.LINE_SEPARATOR ;
<span class="fc" id="L1686">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1687">        assertEquals(expected, actual);</span>
<span class="fc" id="L1688">    }</span>
    
    public void testWriteLinesEncoding_WithAppendOptionFalse_ShouldDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1691">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1692">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1694">        List&lt;String&gt; linesToAppend = Arrays.asList(new String[] {</span>
                &quot;my first line&quot;, &quot;The second Line&quot; });
<span class="fc" id="L1696">        FileUtils.writeLines(file, null, linesToAppend, false);</span>

<span class="fc" id="L1698">        String expected = &quot;my first line&quot;</span>
                + IOUtils.LINE_SEPARATOR + &quot;The second Line&quot;
                + IOUtils.LINE_SEPARATOR ;
<span class="fc" id="L1701">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1702">        assertEquals(expected, actual);</span>
<span class="fc" id="L1703">    }</span>
    
    public void testWriteLines_3argsWithAppendOptionTrue_ShouldNotDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1706">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1707">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1709">        List&lt;String&gt; linesToAppend = Arrays.asList(new String[] {</span>
                &quot;my first line&quot;, &quot;The second Line&quot; });
<span class="fc" id="L1711">        FileUtils.writeLines(file, linesToAppend, true);</span>

<span class="fc" id="L1713">        String expected = &quot;This line was there before you...&quot;</span>
                + &quot;my first line&quot;
                + IOUtils.LINE_SEPARATOR + &quot;The second Line&quot;
                + IOUtils.LINE_SEPARATOR ;
<span class="fc" id="L1717">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1718">        assertEquals(expected, actual);</span>
<span class="fc" id="L1719">    }</span>
    
    public void testWriteLines_3argsWithAppendOptionFalse_ShouldDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1722">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1723">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1725">        List&lt;String&gt; linesToAppend = Arrays.asList(new String[] {</span>
                &quot;my first line&quot;, &quot;The second Line&quot; });
<span class="fc" id="L1727">        FileUtils.writeLines(file, linesToAppend, false);</span>

<span class="fc" id="L1729">        String expected = &quot;my first line&quot;</span>
                + IOUtils.LINE_SEPARATOR + &quot;The second Line&quot;
                + IOUtils.LINE_SEPARATOR ;
<span class="fc" id="L1732">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1733">        assertEquals(expected, actual);</span>
<span class="fc" id="L1734">    }</span>

    public void testWriteStringToFileWithEncoding_WithAppendOptionTrue_ShouldNotDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1737">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1738">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1740">        FileUtils.writeStringToFile(file, &quot;this is brand new data&quot;, (String) null, true);</span>

<span class="fc" id="L1742">        String expected = &quot;This line was there before you...&quot;</span>
                + &quot;this is brand new data&quot;;
<span class="fc" id="L1744">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1745">        assertEquals(expected, actual);</span>
<span class="fc" id="L1746">    }</span>

    public void testWriteStringToFileWithEncoding_WithAppendOptionFalse_ShouldDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1749">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1750">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1752">        FileUtils.writeStringToFile(file, &quot;this is brand new data&quot;, (String) null, false);</span>

<span class="fc" id="L1754">        String expected = &quot;this is brand new data&quot;;</span>
<span class="fc" id="L1755">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1756">        assertEquals(expected, actual);</span>
<span class="fc" id="L1757">    }</span>

    public void testWriteStringToFile_WithAppendOptionTrue_ShouldNotDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1760">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1761">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1763">        FileUtils.writeStringToFile(file, &quot;this is brand new data&quot;, true);</span>

<span class="fc" id="L1765">        String expected = &quot;This line was there before you...&quot;</span>
                + &quot;this is brand new data&quot;;
<span class="fc" id="L1767">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1768">        assertEquals(expected, actual);</span>
<span class="fc" id="L1769">    }</span>

    public void testWriteStringToFile_WithAppendOptionFalse_ShouldDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1772">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1773">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1775">        FileUtils.writeStringToFile(file, &quot;this is brand new data&quot;, false);</span>

<span class="fc" id="L1777">        String expected = &quot;this is brand new data&quot;;</span>
<span class="fc" id="L1778">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1779">        assertEquals(expected, actual);</span>
<span class="fc" id="L1780">    }</span>

    public void testWriteWithEncoding_WithAppendOptionTrue_ShouldNotDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1783">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1784">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1786">        FileUtils.write(file, &quot;this is brand new data&quot;, (String) null, true);</span>

<span class="fc" id="L1788">        String expected = &quot;This line was there before you...&quot;</span>
            + &quot;this is brand new data&quot;;
<span class="fc" id="L1790">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1791">        assertEquals(expected, actual);</span>
<span class="fc" id="L1792">    }</span>
    
    public void testWriteWithEncoding_WithAppendOptionFalse_ShouldDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1795">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1796">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1798">        FileUtils.write(file, &quot;this is brand new data&quot;, (String) null, false);</span>

<span class="fc" id="L1800">        String expected = &quot;this is brand new data&quot;;</span>
<span class="fc" id="L1801">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1802">        assertEquals(expected, actual);</span>
<span class="fc" id="L1803">    }</span>
    
    public void testWrite_WithAppendOptionTrue_ShouldNotDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1806">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1807">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1809">        FileUtils.write(file, &quot;this is brand new data&quot;, true);</span>

<span class="fc" id="L1811">        String expected = &quot;This line was there before you...&quot;</span>
            + &quot;this is brand new data&quot;;
<span class="fc" id="L1813">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1814">        assertEquals(expected, actual);</span>
<span class="fc" id="L1815">    }</span>
    
    public void testWrite_WithAppendOptionFalse_ShouldDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1818">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1819">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1821">        FileUtils.write(file, &quot;this is brand new data&quot;, false);</span>

<span class="fc" id="L1823">        String expected = &quot;this is brand new data&quot;;</span>
<span class="fc" id="L1824">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1825">        assertEquals(expected, actual);</span>
<span class="fc" id="L1826">    }</span>
    
    public void testWriteByteArrayToFile_WithAppendOptionTrue_ShouldNotDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1829">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1830">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1832">        FileUtils.writeByteArrayToFile(file, &quot;this is brand new data&quot;.getBytes(), true);</span>

<span class="fc" id="L1834">        String expected = &quot;This line was there before you...&quot;</span>
            + &quot;this is brand new data&quot;;
<span class="fc" id="L1836">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1837">        assertEquals(expected, actual);</span>
<span class="fc" id="L1838">    }</span>
    
    public void testWriteByteArrayToFile_WithAppendOptionFalse_ShouldDeletePreviousFileLines() throws Exception {
<span class="fc" id="L1841">        File file = newFile(&quot;lines.txt&quot;);</span>
<span class="fc" id="L1842">        FileUtils.writeStringToFile(file, &quot;This line was there before you...&quot;);</span>
        
<span class="fc" id="L1844">        FileUtils.writeByteArrayToFile(file, &quot;this is brand new data&quot;.getBytes(), false);</span>

<span class="fc" id="L1846">        String expected = &quot;this is brand new data&quot;;</span>
<span class="fc" id="L1847">        String actual = FileUtils.readFileToString(file);</span>
<span class="fc" id="L1848">        assertEquals(expected, actual);</span>
<span class="fc" id="L1849">    }</span>
    
    //-----------------------------------------------------------------------
    public void testChecksumCRC32() throws Exception {
        // create a test file
<span class="fc" id="L1854">        String text = &quot;Imagination is more important than knowledge - Einstein&quot;;</span>
<span class="fc" id="L1855">        File file = new File(getTestDirectory(), &quot;checksum-test.txt&quot;);</span>
<span class="fc" id="L1856">        FileUtils.writeStringToFile(file, text, &quot;US-ASCII&quot;);</span>
        
        // compute the expected checksum
<span class="fc" id="L1859">        Checksum expectedChecksum = new CRC32();</span>
<span class="fc" id="L1860">        expectedChecksum.update(text.getBytes(&quot;US-ASCII&quot;), 0, text.length());</span>
<span class="fc" id="L1861">        long expectedValue = expectedChecksum.getValue();</span>
        
        // compute the checksum of the file
<span class="fc" id="L1864">        long resultValue = FileUtils.checksumCRC32(file);</span>
        
<span class="fc" id="L1866">        assertEquals(expectedValue, resultValue);</span>
<span class="fc" id="L1867">    }</span>

    public void testChecksum() throws Exception {
        // create a test file
<span class="fc" id="L1871">        String text = &quot;Imagination is more important than knowledge - Einstein&quot;;</span>
<span class="fc" id="L1872">        File file = new File(getTestDirectory(), &quot;checksum-test.txt&quot;);</span>
<span class="fc" id="L1873">        FileUtils.writeStringToFile(file, text, &quot;US-ASCII&quot;);</span>
        
        // compute the expected checksum
<span class="fc" id="L1876">        Checksum expectedChecksum = new CRC32();</span>
<span class="fc" id="L1877">        expectedChecksum.update(text.getBytes(&quot;US-ASCII&quot;), 0, text.length());</span>
<span class="fc" id="L1878">        long expectedValue = expectedChecksum.getValue();</span>
        
        // compute the checksum of the file
<span class="fc" id="L1881">        Checksum testChecksum = new CRC32();</span>
<span class="fc" id="L1882">        Checksum resultChecksum = FileUtils.checksum(file, testChecksum);</span>
<span class="fc" id="L1883">        long resultValue = resultChecksum.getValue();</span>
        
<span class="fc" id="L1885">        assertSame(testChecksum, resultChecksum);</span>
<span class="fc" id="L1886">        assertEquals(expectedValue, resultValue);</span>
<span class="fc" id="L1887">    }</span>

    public void testChecksumOnNullFile() throws Exception {
        try {
<span class="nc" id="L1891">            FileUtils.checksum((File) null, new CRC32());</span>
<span class="nc" id="L1892">            fail();</span>
<span class="fc" id="L1893">        } catch (NullPointerException ex) {</span>
            // expected
<span class="nc" id="L1895">        }</span>
<span class="fc" id="L1896">    }</span>

    public void testChecksumOnNullChecksum() throws Exception {
        // create a test file
<span class="fc" id="L1900">        String text = &quot;Imagination is more important than knowledge - Einstein&quot;;</span>
<span class="fc" id="L1901">        File file = new File(getTestDirectory(), &quot;checksum-test.txt&quot;);</span>
<span class="fc" id="L1902">        FileUtils.writeStringToFile(file, text, &quot;US-ASCII&quot;);</span>
        try {
<span class="nc" id="L1904">            FileUtils.checksum(file, (Checksum) null);</span>
<span class="nc" id="L1905">            fail();</span>
<span class="fc" id="L1906">        } catch (NullPointerException ex) {</span>
            // expected
<span class="nc" id="L1908">        }</span>
<span class="fc" id="L1909">    }</span>

    public void testChecksumOnDirectory() throws Exception {
        try {
<span class="nc" id="L1913">            FileUtils.checksum(new File(&quot;.&quot;), new CRC32());</span>
<span class="nc" id="L1914">            fail();</span>
<span class="fc" id="L1915">        } catch (IllegalArgumentException ex) {</span>
            // expected
<span class="nc" id="L1917">        }</span>
<span class="fc" id="L1918">    }</span>

    public void testChecksumDouble() throws Exception {
        // create a test file
<span class="fc" id="L1922">        String text1 = &quot;Imagination is more important than knowledge - Einstein&quot;;</span>
<span class="fc" id="L1923">        File file1 = new File(getTestDirectory(), &quot;checksum-test.txt&quot;);</span>
<span class="fc" id="L1924">        FileUtils.writeStringToFile(file1, text1, &quot;US-ASCII&quot;);</span>
        
        // create a second test file
<span class="fc" id="L1927">        String text2 = &quot;To be or not to be - Shakespeare&quot;;</span>
<span class="fc" id="L1928">        File file2 = new File(getTestDirectory(), &quot;checksum-test2.txt&quot;);</span>
<span class="fc" id="L1929">        FileUtils.writeStringToFile(file2, text2, &quot;US-ASCII&quot;);</span>
        
        // compute the expected checksum
<span class="fc" id="L1932">        Checksum expectedChecksum = new CRC32();</span>
<span class="fc" id="L1933">        expectedChecksum.update(text1.getBytes(&quot;US-ASCII&quot;), 0, text1.length());</span>
<span class="fc" id="L1934">        expectedChecksum.update(text2.getBytes(&quot;US-ASCII&quot;), 0, text2.length());</span>
<span class="fc" id="L1935">        long expectedValue = expectedChecksum.getValue();</span>
        
        // compute the checksum of the file
<span class="fc" id="L1938">        Checksum testChecksum = new CRC32();</span>
<span class="fc" id="L1939">        FileUtils.checksum(file1, testChecksum);</span>
<span class="fc" id="L1940">        FileUtils.checksum(file2, testChecksum);</span>
<span class="fc" id="L1941">        long resultValue = testChecksum.getValue();</span>
        
<span class="fc" id="L1943">        assertEquals(expectedValue, resultValue);</span>
<span class="fc" id="L1944">    }</span>

    public void testDeleteQuietlyForNull() {
        try {
<span class="fc" id="L1948">            FileUtils.deleteQuietly(null);</span>
<span class="nc" id="L1949">        } catch (Exception ex) {</span>
<span class="nc" id="L1950">            fail(ex.getMessage());</span>
<span class="fc" id="L1951">        }</span>
<span class="fc" id="L1952">    }</span>

    public void testDeleteQuietlyDir() throws IOException {
<span class="fc" id="L1955">        File testDirectory = new File(getTestDirectory(), &quot;testDeleteQuietlyDir&quot;);</span>
<span class="fc" id="L1956">        File testFile= new File(testDirectory, &quot;testDeleteQuietlyFile&quot;);</span>
<span class="fc" id="L1957">        testDirectory.mkdirs();</span>
<span class="fc" id="L1958">        createFile(testFile, 0);</span>

<span class="fc" id="L1960">        assertTrue(testDirectory.exists());</span>
<span class="fc" id="L1961">        assertTrue(testFile.exists());</span>
<span class="fc" id="L1962">        FileUtils.deleteQuietly(testDirectory);</span>
<span class="fc" id="L1963">        assertFalse(&quot;Check No Exist&quot;, testDirectory.exists());</span>
<span class="fc" id="L1964">        assertFalse(&quot;Check No Exist&quot;, testFile.exists());</span>
<span class="fc" id="L1965">    }</span>

    public void testDeleteQuietlyFile() throws IOException {
<span class="fc" id="L1968">        File testFile= new File(getTestDirectory(), &quot;testDeleteQuietlyFile&quot;);</span>
<span class="fc" id="L1969">        createFile(testFile, 0);</span>

<span class="fc" id="L1971">        assertTrue(testFile.exists());</span>
<span class="fc" id="L1972">        FileUtils.deleteQuietly(testFile);</span>
<span class="fc" id="L1973">        assertFalse(&quot;Check No Exist&quot;, testFile.exists());</span>
<span class="fc" id="L1974">    }</span>

    public void testDeleteQuietlyNonExistent() {
<span class="fc" id="L1977">        File testFile = new File(&quot;testDeleteQuietlyNonExistent&quot;);</span>
<span class="fc" id="L1978">        assertFalse(testFile.exists());</span>
        
        try {
<span class="fc" id="L1981">            FileUtils.deleteQuietly(testFile);</span>
<span class="nc" id="L1982">        } catch (Exception ex) {</span>
<span class="nc" id="L1983">            fail(ex.getMessage());</span>
<span class="fc" id="L1984">        }</span>
<span class="fc" id="L1985">    }</span>

    public void testMoveFile_Rename() throws Exception {
<span class="fc" id="L1988">        File destination = new File( getTestDirectory(), &quot;move1.txt&quot; );</span>

<span class="fc" id="L1990">        FileUtils.moveFile( testFile1, destination );</span>
<span class="fc" id="L1991">        assertTrue( &quot;Check Exist&quot;, destination.exists() );</span>
<span class="pc bpc" id="L1992" title="1 of 2 branches missed.">        assertTrue( &quot;Original deleted&quot;, ! testFile1.exists() );</span>
<span class="fc" id="L1993">    }</span>

    public void testMoveFile_CopyDelete() throws Exception {
<span class="fc" id="L1996">        File destination = new File( getTestDirectory(), &quot;move2.txt&quot; );</span>
<span class="fc" id="L1997">        File src = new File( testFile1.getAbsolutePath() ) {</span>
            // Force renameTo to fail, as if destination is on another
            // filesystem
            @Override
            public boolean renameTo( File f ) {
<span class="fc" id="L2002">                return false;</span>
            }
        };
<span class="fc" id="L2005">        FileUtils.moveFile( src, destination );</span>
<span class="fc" id="L2006">        assertTrue( &quot;Check Exist&quot;, destination.exists() );</span>
<span class="pc bpc" id="L2007" title="1 of 2 branches missed.">        assertTrue( &quot;Original deleted&quot;, ! src.exists() );</span>
<span class="fc" id="L2008">    }</span>


    public void testMoveFile_CopyDelete_Failed() throws Exception {
<span class="fc" id="L2012">        File destination = new File( getTestDirectory(), &quot;move3.txt&quot; );</span>
<span class="fc" id="L2013">        File src = new File( testFile1.getAbsolutePath() ) {</span>
            // Force renameTo to fail, as if destination is on another
            // filesystem
            @Override
            public boolean renameTo( File f ) {
<span class="fc" id="L2018">                return false;</span>
            }

            // Force delete failure
            @Override
            public boolean delete() {
<span class="fc" id="L2024">                return false;</span>
            }

        };
        try {
<span class="nc" id="L2029">            FileUtils.moveFile( src, destination );</span>
<span class="nc" id="L2030">            fail( &quot;move should have failed as src has not been deleted&quot; );</span>
<span class="fc" id="L2031">        } catch (IOException e) {</span>
           // exepected
<span class="pc bpc" id="L2033" title="1 of 2 branches missed.">            assertTrue( &quot;Check Rollback&quot;, !destination.exists() );</span>
<span class="fc" id="L2034">            assertTrue( &quot;Original exists&quot;, src.exists() );</span>
<span class="nc" id="L2035">        }</span>
<span class="fc" id="L2036">    }</span>
    public void testMoveFile_Errors() throws Exception {
        try {
<span class="nc" id="L2039">            FileUtils.moveFile(null, new File(&quot;foo&quot;));</span>
<span class="nc" id="L2040">            fail(&quot;Expected NullPointerException when source is null&quot;);</span>
<span class="fc" id="L2041">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2043">        }</span>
        try {
<span class="nc" id="L2045">            FileUtils.moveFile(new File(&quot;foo&quot;), null);</span>
<span class="nc" id="L2046">            fail(&quot;Expected NullPointerException when destination is null&quot;);</span>
<span class="fc" id="L2047">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2049">        }</span>
        try {
<span class="nc" id="L2051">            FileUtils.moveFile(new File(&quot;nonexistant&quot;), new File(&quot;foo&quot;));</span>
<span class="nc" id="L2052">            fail(&quot;Expected FileNotFoundException for source&quot;);</span>
<span class="fc" id="L2053">        } catch (FileNotFoundException e) {</span>
            // expected
<span class="nc" id="L2055">        }</span>
        try {
<span class="nc" id="L2057">            FileUtils.moveFile(getTestDirectory(), new File(&quot;foo&quot;));</span>
<span class="nc" id="L2058">            fail(&quot;Expected IOException when source is a directory&quot;);</span>
<span class="fc" id="L2059">        } catch (IOException e) {</span>
            // expected
<span class="nc" id="L2061">        }</span>
<span class="fc" id="L2062">        File testSourceFile = new File(getTestDirectory(), &quot;testMoveFileSource&quot;);</span>
<span class="fc" id="L2063">        File testDestFile = new File(getTestDirectory(), &quot;testMoveFileSource&quot;);</span>
<span class="fc" id="L2064">        createFile(testSourceFile, 0);</span>
<span class="fc" id="L2065">        createFile(testDestFile, 0);</span>
        try {
<span class="nc" id="L2067">            FileUtils.moveFile(testSourceFile, testDestFile);</span>
<span class="nc" id="L2068">            fail(&quot;Expected FileExistsException when dest already exists&quot;);</span>
<span class="fc" id="L2069">        } catch (FileExistsException e) {</span>
            // expected
<span class="nc" id="L2071">        }</span>

<span class="fc" id="L2073">    }</span>

    public void testMoveFileToDirectory() throws Exception {
<span class="fc" id="L2076">        File destDir = new File( getTestDirectory(), &quot;moveFileDestDir&quot;);</span>
<span class="fc" id="L2077">        File movedFile = new File(destDir, testFile1.getName());</span>
<span class="fc" id="L2078">        assertFalse(&quot;Check Exist before&quot;, destDir.exists());</span>
<span class="fc" id="L2079">        assertFalse(&quot;Check Exist before&quot;, movedFile.exists());</span>

<span class="fc" id="L2081">        FileUtils.moveFileToDirectory(testFile1, destDir, true);</span>
<span class="fc" id="L2082">        assertTrue( &quot;Check Exist after&quot;, movedFile.exists() );</span>
<span class="pc bpc" id="L2083" title="1 of 2 branches missed.">        assertTrue( &quot;Original deleted&quot;, ! testFile1.exists() );</span>
<span class="fc" id="L2084">    }</span>

    public void testMoveFileToDirectory_Errors() throws Exception {
        try {
<span class="nc" id="L2088">            FileUtils.moveFileToDirectory(null, new File(&quot;foo&quot;), true);</span>
<span class="nc" id="L2089">            fail(&quot;Expected NullPointerException when source is null&quot;);</span>
<span class="fc" id="L2090">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2092">        }</span>
        try {
<span class="nc" id="L2094">            FileUtils.moveFileToDirectory(new File(&quot;foo&quot;), null, true);</span>
<span class="nc" id="L2095">            fail(&quot;Expected NullPointerException when destination is null&quot;);</span>
<span class="fc" id="L2096">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2098">        }</span>
<span class="fc" id="L2099">        File testFile1    = new File(getTestDirectory(), &quot;testMoveFileFile1&quot;);</span>
<span class="fc" id="L2100">        File testFile2    = new File(getTestDirectory(), &quot;testMoveFileFile2&quot;);</span>
<span class="fc" id="L2101">        createFile(testFile1, 0);</span>
<span class="fc" id="L2102">        createFile(testFile2, 0);</span>
        try {
<span class="nc" id="L2104">            FileUtils.moveFileToDirectory(testFile1, testFile2, true);</span>
<span class="nc" id="L2105">            fail(&quot;Expected IOException when dest not a directory&quot;);</span>
<span class="fc" id="L2106">        } catch (IOException e) {</span>
            // expected
<span class="nc" id="L2108">        }</span>

<span class="fc" id="L2110">        File nonexistant = new File(getTestDirectory(), &quot;testMoveFileNonExistant&quot;);</span>
        try {
<span class="nc" id="L2112">            FileUtils.moveFileToDirectory(testFile1, nonexistant, false);</span>
<span class="nc" id="L2113">            fail(&quot;Expected IOException when dest does not exist and create=false&quot;);</span>
<span class="fc" id="L2114">        } catch (IOException e) {</span>
            // expected
<span class="nc" id="L2116">        }</span>
<span class="fc" id="L2117">    }</span>


    public void testMoveDirectory_Rename() throws Exception {
<span class="fc" id="L2121">        File dir = getTestDirectory();</span>
<span class="fc" id="L2122">        File src = new File(dir, &quot;testMoveDirectory1Source&quot;);</span>
<span class="fc" id="L2123">        File testDir = new File(src, &quot;foo&quot;);</span>
<span class="fc" id="L2124">        File testFile = new File(testDir, &quot;bar&quot;);</span>
<span class="fc" id="L2125">        testDir.mkdirs();</span>
<span class="fc" id="L2126">        createFile(testFile, 0);</span>
<span class="fc" id="L2127">        File destination = new File(dir, &quot;testMoveDirectory1Dest&quot;);</span>
<span class="fc" id="L2128">        FileUtils.deleteDirectory( destination );</span>

        // Move the directory
<span class="fc" id="L2131">        FileUtils.moveDirectory( src, destination );</span>

        // Check results
<span class="fc" id="L2134">        assertTrue( &quot;Check Exist&quot;, destination.exists() );</span>
<span class="pc bpc" id="L2135" title="1 of 2 branches missed.">        assertTrue( &quot;Original deleted&quot;, ! src.exists() );</span>
<span class="fc" id="L2136">        File movedDir = new File(destination, testDir.getName());</span>
<span class="fc" id="L2137">        File movedFile = new File(movedDir, testFile.getName());</span>
<span class="fc" id="L2138">        assertTrue( &quot;Check dir moved&quot;, movedDir.exists());</span>
<span class="fc" id="L2139">        assertTrue( &quot;Check file moved&quot;, movedFile.exists());</span>
<span class="fc" id="L2140">    }</span>

    public void testMoveDirectory_CopyDelete() throws Exception {

<span class="fc" id="L2144">        File dir = getTestDirectory();</span>
<span class="fc" id="L2145">        File src = new File(dir, &quot;testMoveDirectory2Source&quot;) {</span>

            // Force renameTo to fail
            @Override
            public boolean renameTo( File dest ) {
<span class="fc" id="L2150">                return false;</span>
            }
        };
<span class="fc" id="L2153">        File testDir = new File(src, &quot;foo&quot;);</span>
<span class="fc" id="L2154">        File testFile = new File(testDir, &quot;bar&quot;);</span>
<span class="fc" id="L2155">        testDir.mkdirs();</span>
<span class="fc" id="L2156">        createFile(testFile, 0);</span>
<span class="fc" id="L2157">        File destination = new File(dir, &quot;testMoveDirectory1Dest&quot;);</span>
<span class="fc" id="L2158">        FileUtils.deleteDirectory( destination );</span>

        // Move the directory
<span class="fc" id="L2161">        FileUtils.moveDirectory( src, destination );</span>

        // Check results
<span class="fc" id="L2164">        assertTrue( &quot;Check Exist&quot;, destination.exists() );</span>
<span class="pc bpc" id="L2165" title="1 of 2 branches missed.">        assertTrue( &quot;Original deleted&quot;, ! src.exists() );</span>
<span class="fc" id="L2166">        File movedDir = new File(destination, testDir.getName());</span>
<span class="fc" id="L2167">        File movedFile = new File(movedDir, testFile.getName());</span>
<span class="fc" id="L2168">        assertTrue( &quot;Check dir moved&quot;, movedDir.exists());</span>
<span class="fc" id="L2169">        assertTrue( &quot;Check file moved&quot;, movedFile.exists());</span>
<span class="fc" id="L2170">    }</span>

    public void testMoveDirectory_Errors() throws Exception {
        try {
<span class="nc" id="L2174">            FileUtils.moveDirectory(null, new File(&quot;foo&quot;));</span>
<span class="nc" id="L2175">            fail(&quot;Expected NullPointerException when source is null&quot;);</span>
<span class="fc" id="L2176">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2178">        }</span>
        try {
<span class="nc" id="L2180">            FileUtils.moveDirectory(new File(&quot;foo&quot;), null);</span>
<span class="nc" id="L2181">            fail(&quot;Expected NullPointerException when destination is null&quot;);</span>
<span class="fc" id="L2182">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2184">        }</span>
        try {
<span class="nc" id="L2186">            FileUtils.moveDirectory(new File(&quot;nonexistant&quot;), new File(&quot;foo&quot;));</span>
<span class="nc" id="L2187">            fail(&quot;Expected FileNotFoundException for source&quot;);</span>
<span class="fc" id="L2188">        } catch (FileNotFoundException e) {</span>
            // expected
<span class="nc" id="L2190">        }</span>
<span class="fc" id="L2191">        File testFile = new File(getTestDirectory(), &quot;testMoveDirectoryFile&quot;);</span>
<span class="fc" id="L2192">        createFile(testFile, 0);</span>
        try {
<span class="nc" id="L2194">            FileUtils.moveDirectory(testFile, new File(&quot;foo&quot;));</span>
<span class="nc" id="L2195">            fail(&quot;Expected IOException when source is not a directory&quot;);</span>
<span class="fc" id="L2196">        } catch (IOException e) {</span>
            // expected
<span class="nc" id="L2198">        }</span>
<span class="fc" id="L2199">        File testSrcFile = new File(getTestDirectory(), &quot;testMoveDirectorySource&quot;);</span>
<span class="fc" id="L2200">        File testDestFile = new File(getTestDirectory(), &quot;testMoveDirectoryDest&quot;);</span>
<span class="fc" id="L2201">        testSrcFile.mkdir();</span>
<span class="fc" id="L2202">        testDestFile.mkdir();</span>
        try {
<span class="nc" id="L2204">            FileUtils.moveDirectory(testSrcFile, testDestFile);</span>
<span class="nc" id="L2205">            fail(&quot;Expected FileExistsException when dest already exists&quot;);</span>
<span class="fc" id="L2206">        } catch (FileExistsException e) {</span>
            // expected
<span class="nc" id="L2208">        }</span>

<span class="fc" id="L2210">    }</span>

    public void testMoveDirectoryToDirectory() throws Exception {
<span class="fc" id="L2213">        File dir = getTestDirectory();</span>
<span class="fc" id="L2214">        File src = new File(dir, &quot;testMoveDirectory1Source&quot;);</span>
<span class="fc" id="L2215">        File testChildDir = new File(src, &quot;foo&quot;);</span>
<span class="fc" id="L2216">        File testFile = new File(testChildDir, &quot;bar&quot;);</span>
<span class="fc" id="L2217">        testChildDir.mkdirs();</span>
<span class="fc" id="L2218">        createFile(testFile, 0);</span>
<span class="fc" id="L2219">        File destDir = new File(dir, &quot;testMoveDirectory1Dest&quot;);</span>
<span class="fc" id="L2220">        FileUtils.deleteDirectory( destDir );</span>
<span class="fc" id="L2221">        assertFalse( &quot;Check Exist before&quot;, destDir.exists() );</span>

        // Move the directory
<span class="fc" id="L2224">        FileUtils.moveDirectoryToDirectory(src, destDir, true);</span>

        // Check results
<span class="fc" id="L2227">        assertTrue( &quot;Check Exist after&quot;, destDir.exists() );</span>
<span class="pc bpc" id="L2228" title="1 of 2 branches missed.">        assertTrue( &quot;Original deleted&quot;, ! src.exists() );</span>
<span class="fc" id="L2229">        File movedDir = new File(destDir, src.getName());</span>
<span class="fc" id="L2230">        File movedChildDir = new File(movedDir, testChildDir.getName());</span>
<span class="fc" id="L2231">        File movedFile = new File(movedChildDir, testFile.getName());</span>
<span class="fc" id="L2232">        assertTrue( &quot;Check dir moved&quot;, movedDir.exists());</span>
<span class="fc" id="L2233">        assertTrue( &quot;Check child dir moved&quot;, movedChildDir.exists());</span>
<span class="fc" id="L2234">        assertTrue( &quot;Check file moved&quot;, movedFile.exists());</span>
<span class="fc" id="L2235">    }</span>

    public void testMoveDirectoryToDirectory_Errors() throws Exception {
        try {
<span class="nc" id="L2239">            FileUtils.moveDirectoryToDirectory(null, new File(&quot;foo&quot;), true);</span>
<span class="nc" id="L2240">            fail(&quot;Expected NullPointerException when source is null&quot;);</span>
<span class="fc" id="L2241">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2243">        }</span>
        try {
<span class="nc" id="L2245">            FileUtils.moveDirectoryToDirectory(new File(&quot;foo&quot;), null, true);</span>
<span class="nc" id="L2246">            fail(&quot;Expected NullPointerException when destination is null&quot;);</span>
<span class="fc" id="L2247">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2249">        }</span>
<span class="fc" id="L2250">        File testFile1    = new File(getTestDirectory(), &quot;testMoveFileFile1&quot;);</span>
<span class="fc" id="L2251">        File testFile2    = new File(getTestDirectory(), &quot;testMoveFileFile2&quot;);</span>
<span class="fc" id="L2252">        createFile(testFile1, 0);</span>
<span class="fc" id="L2253">        createFile(testFile2, 0);</span>
        try {
<span class="nc" id="L2255">            FileUtils.moveDirectoryToDirectory(testFile1, testFile2, true);</span>
<span class="nc" id="L2256">            fail(&quot;Expected IOException when dest not a directory&quot;);</span>
<span class="fc" id="L2257">        } catch (IOException e) {</span>
            // expected
<span class="nc" id="L2259">        }</span>

<span class="fc" id="L2261">        File nonexistant = new File(getTestDirectory(), &quot;testMoveFileNonExistant&quot;);</span>
        try {
<span class="nc" id="L2263">            FileUtils.moveDirectoryToDirectory(testFile1, nonexistant, false);</span>
<span class="nc" id="L2264">            fail(&quot;Expected IOException when dest does not exist and create=false&quot;);</span>
<span class="fc" id="L2265">        } catch (IOException e) {</span>
            // expected
<span class="nc" id="L2267">        }</span>
<span class="fc" id="L2268">    }</span>
    public void testMoveToDirectory() throws Exception {
<span class="fc" id="L2270">        File destDir     = new File(getTestDirectory(), &quot;testMoveToDirectoryDestDir&quot;);</span>
<span class="fc" id="L2271">        File testDir     = new File(getTestDirectory(), &quot;testMoveToDirectoryTestDir&quot;);</span>
<span class="fc" id="L2272">        File testFile    = new File(getTestDirectory(), &quot;testMoveToDirectoryTestFile&quot;);</span>
<span class="fc" id="L2273">        testDir.mkdirs();</span>
<span class="fc" id="L2274">        createFile(testFile, 0);</span>
<span class="fc" id="L2275">        File movedFile = new File(destDir, testFile.getName());</span>
<span class="fc" id="L2276">        File movedDir = new File(destDir, testFile.getName());</span>
        
<span class="fc" id="L2278">        assertFalse( &quot;Check File Doesnt exist&quot;, movedFile.exists() );</span>
<span class="fc" id="L2279">        assertFalse( &quot;Check Dir Doesnt exist&quot;, movedDir.exists() );</span>
        
        // Test moving a file
<span class="fc" id="L2282">        FileUtils.moveToDirectory(testFile, destDir, true);</span>
<span class="fc" id="L2283">        assertTrue( &quot;Check File exists&quot;, movedFile.exists() );</span>
<span class="fc" id="L2284">        assertFalse( &quot;Check Original File doesn't exist&quot;, testFile.exists() );</span>
        
        // Test moving a directory
<span class="fc" id="L2287">        FileUtils.moveToDirectory(testDir, destDir, true);</span>
<span class="fc" id="L2288">        assertTrue( &quot;Check Dir exists&quot;, movedDir.exists() );</span>
<span class="fc" id="L2289">        assertFalse( &quot;Check Original Dir doesn't exist&quot;, testDir.exists());</span>
<span class="fc" id="L2290">    }</span>

    public void testMoveToDirectory_Errors() throws Exception {
        try {
<span class="nc" id="L2294">            FileUtils.moveDirectoryToDirectory(null, new File(&quot;foo&quot;), true);</span>
<span class="nc" id="L2295">            fail(&quot;Expected NullPointerException when source is null&quot;);</span>
<span class="fc" id="L2296">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2298">        }</span>
        try {
<span class="nc" id="L2300">            FileUtils.moveDirectoryToDirectory(new File(&quot;foo&quot;), null, true);</span>
<span class="nc" id="L2301">            fail(&quot;Expected NullPointerException when destination is null&quot;);</span>
<span class="fc" id="L2302">        } catch (NullPointerException e) {</span>
            // expected
<span class="nc" id="L2304">        }</span>
<span class="fc" id="L2305">        File nonexistant    = new File(getTestDirectory(), &quot;nonexistant&quot;);</span>
<span class="fc" id="L2306">        File destDir    = new File(getTestDirectory(), &quot;MoveToDirectoryDestDir&quot;);</span>
        try {
<span class="nc" id="L2308">            FileUtils.moveToDirectory(nonexistant, destDir, true);</span>
<span class="nc" id="L2309">            fail(&quot;Expected IOException when source does not exist&quot;);</span>
<span class="fc" id="L2310">        } catch (IOException e) {</span>
            // expected
<span class="nc" id="L2312">        }</span>
<span class="fc" id="L2313">    }</span>

    public void testIO300() throws Exception {
<span class="fc" id="L2316">        final File testDirectory = getTestDirectory();</span>
<span class="fc" id="L2317">        File src = new File(testDirectory, &quot;dir1&quot;);</span>
<span class="fc" id="L2318">        File dest = new File(src,&quot;dir2&quot;);</span>
<span class="fc" id="L2319">        assertTrue(dest.mkdirs());</span>
<span class="fc" id="L2320">        assertTrue(src.exists());</span>
        try {
<span class="nc" id="L2322">            FileUtils.moveDirectoryToDirectory(src, dest, false);</span>
<span class="nc" id="L2323">            fail(&quot;expected IOException&quot;);</span>
<span class="fc" id="L2324">        } catch (IOException ioe) {</span>
            // expected
<span class="nc" id="L2326">        }</span>
<span class="fc" id="L2327">        assertTrue(src.exists());</span>
<span class="fc" id="L2328">    }</span>

    public void testIO276() throws Exception {
<span class="fc" id="L2331">        File dir = new File(&quot;target&quot;, &quot;IO276&quot;);</span>
<span class="nc" id="L2332">        assertTrue(dir + &quot; should not be present&quot;, dir.mkdirs());</span>
<span class="nc" id="L2333">        File file = new File(dir, &quot;IO276.txt&quot;);</span>
<span class="nc" id="L2334">        assertTrue(file + &quot; should not be present&quot;, file.createNewFile());</span>
<span class="nc" id="L2335">        FileUtils.forceDeleteOnExit(dir);</span>
        // If this does not work, test will fail next time (assuming target is not cleaned)
<span class="nc" id="L2337">    }</span>

    /**
     * DirectoryWalker implementation that recursively lists all files and directories.
     */
    static class ListDirectoryWalker extends DirectoryWalker&lt;File&gt; {
        ListDirectoryWalker() {
<span class="fc" id="L2344">            super();</span>
<span class="fc" id="L2345">        }</span>
        List&lt;File&gt; list(File startDirectory) throws IOException {
<span class="fc" id="L2347">            ArrayList&lt;File&gt; files = new ArrayList&lt;File&gt;();</span>
<span class="fc" id="L2348">            walk(startDirectory, files);</span>
<span class="fc" id="L2349">            return files;</span>
        }

        @Override
        protected void handleDirectoryStart(File directory, int depth, Collection&lt;File&gt; results) throws IOException {
            // Add all directories except the starting directory
<span class="fc bfc" id="L2355" title="All 2 branches covered.">            if (depth &gt; 0) {</span>
<span class="fc" id="L2356">                results.add(directory);</span>
            }
<span class="fc" id="L2358">        }</span>

        @Override
        protected void handleFile(File file, int depth, Collection&lt;File&gt; results) throws IOException {
<span class="fc" id="L2362">            results.add(file);</span>
<span class="fc" id="L2363">        }</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>