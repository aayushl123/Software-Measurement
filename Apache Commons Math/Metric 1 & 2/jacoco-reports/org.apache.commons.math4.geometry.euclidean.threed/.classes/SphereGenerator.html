


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: SphereGenerator</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">org.apache.commons.math4.geometry.euclidean.threed</a> ]
</div>

<h1>Coverage Summary for Class: SphereGenerator (org.apache.commons.math4.geometry.euclidean.threed)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">SphereGenerator</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/ 3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (62/ 62)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;/*
<i>2</i>&nbsp; * Licensed to the Apache Software Foundation (ASF) under one or more
<i>3</i>&nbsp; * contributor license agreements.  See the NOTICE file distributed with
<i>4</i>&nbsp; * this work for additional information regarding copyright ownership.
<i>5</i>&nbsp; * The ASF licenses this file to You under the Apache License, Version 2.0
<i>6</i>&nbsp; * (the &quot;License&quot;); you may not use this file except in compliance with
<i>7</i>&nbsp; * the License.  You may obtain a copy of the License at
<i>8</i>&nbsp; *
<i>9</i>&nbsp; *      http://www.apache.org/licenses/LICENSE-2.0
<i>10</i>&nbsp; *
<i>11</i>&nbsp; * Unless required by applicable law or agreed to in writing, software
<i>12</i>&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<i>13</i>&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<i>14</i>&nbsp; * See the License for the specific language governing permissions and
<i>15</i>&nbsp; * limitations under the License.
<i>16</i>&nbsp; */
<i>17</i>&nbsp;package org.apache.commons.math4.geometry.euclidean.threed;
<i>18</i>&nbsp;
<i>19</i>&nbsp;import java.util.Arrays;
<i>20</i>&nbsp;import java.util.List;
<i>21</i>&nbsp;
<i>22</i>&nbsp;import org.apache.commons.math4.fraction.BigFraction;
<i>23</i>&nbsp;import org.apache.commons.math4.geometry.enclosing.EnclosingBall;
<i>24</i>&nbsp;import org.apache.commons.math4.geometry.enclosing.SupportBallGenerator;
<i>25</i>&nbsp;import org.apache.commons.math4.geometry.euclidean.twod.DiskGenerator;
<i>26</i>&nbsp;import org.apache.commons.math4.geometry.euclidean.twod.Euclidean2D;
<i>27</i>&nbsp;import org.apache.commons.math4.geometry.euclidean.twod.Cartesian2D;
<i>28</i>&nbsp;import org.apache.commons.math4.util.FastMath;
<i>29</i>&nbsp;
<i>30</i>&nbsp;/** Class generating an enclosing ball from its support points.
<i>31</i>&nbsp; * @since 3.3
<i>32</i>&nbsp; */
<b class="fc"><i>33</i>&nbsp;public class SphereGenerator implements SupportBallGenerator&lt;Euclidean3D, Cartesian3D&gt; {</b>
<i>34</i>&nbsp;
<i>35</i>&nbsp;    /** {@inheritDoc} */
<i>36</i>&nbsp;    @Override
<i>37</i>&nbsp;    public EnclosingBall&lt;Euclidean3D, Cartesian3D&gt; ballOnSupport(final List&lt;Cartesian3D&gt; support) {
<i>38</i>&nbsp;
<b class="fc"><i>39</i>&nbsp;        if (support.size() &lt; 1) {</b>
<b class="fc"><i>40</i>&nbsp;            return new EnclosingBall&lt;&gt;(Cartesian3D.ZERO, Double.NEGATIVE_INFINITY);</b>
<i>41</i>&nbsp;        } else {
<b class="fc"><i>42</i>&nbsp;            final Cartesian3D vA = support.get(0);</b>
<b class="fc"><i>43</i>&nbsp;            if (support.size() &lt; 2) {</b>
<b class="fc"><i>44</i>&nbsp;                return new EnclosingBall&lt;&gt;(vA, 0, vA);</b>
<i>45</i>&nbsp;            } else {
<b class="fc"><i>46</i>&nbsp;                final Cartesian3D vB = support.get(1);</b>
<b class="fc"><i>47</i>&nbsp;                if (support.size() &lt; 3) {</b>
<b class="fc"><i>48</i>&nbsp;                    return new EnclosingBall&lt;&gt;(new Cartesian3D(0.5, vA, 0.5, vB),</b>
<b class="fc"><i>49</i>&nbsp;                                                                    0.5 * vA.distance(vB),</b>
<i>50</i>&nbsp;                                                                    vA, vB);
<i>51</i>&nbsp;                } else {
<b class="fc"><i>52</i>&nbsp;                    final Cartesian3D vC = support.get(2);</b>
<b class="fc"><i>53</i>&nbsp;                    if (support.size() &lt; 4) {</b>
<i>54</i>&nbsp;
<i>55</i>&nbsp;                        // delegate to 2D disk generator
<b class="fc"><i>56</i>&nbsp;                        final Plane p = new Plane(vA, vB, vC,</b>
<b class="fc"><i>57</i>&nbsp;                                                  1.0e-10 * (vA.getNorm1() + vB.getNorm1() + vC.getNorm1()));</b>
<b class="fc"><i>58</i>&nbsp;                        final EnclosingBall&lt;Euclidean2D, Cartesian2D&gt; disk =</b>
<b class="fc"><i>59</i>&nbsp;                                new DiskGenerator().ballOnSupport(Arrays.asList(p.toSubSpace(vA),</b>
<b class="fc"><i>60</i>&nbsp;                                                                                p.toSubSpace(vB),</b>
<b class="fc"><i>61</i>&nbsp;                                                                                p.toSubSpace(vC)));</b>
<i>62</i>&nbsp;
<i>63</i>&nbsp;                        // convert back to 3D
<b class="fc"><i>64</i>&nbsp;                        return new EnclosingBall&lt;&gt;(p.toSpace(disk.getCenter()),</b>
<b class="fc"><i>65</i>&nbsp;                                                                        disk.getRadius(), vA, vB, vC);</b>
<i>66</i>&nbsp;
<i>67</i>&nbsp;                    } else {
<b class="fc"><i>68</i>&nbsp;                        final Cartesian3D vD = support.get(3);</b>
<i>69</i>&nbsp;                        // a sphere is 3D can be defined as:
<i>70</i>&nbsp;                        // (1)   (x - x_0)^2 + (y - y_0)^2 + (z - z_0)^2 = r^2
<i>71</i>&nbsp;                        // which can be written:
<i>72</i>&nbsp;                        // (2)   (x^2 + y^2 + z^2) - 2 x_0 x - 2 y_0 y - 2 z_0 z + (x_0^2 + y_0^2 + z_0^2 - r^2) = 0
<i>73</i>&nbsp;                        // or simply:
<i>74</i>&nbsp;                        // (3)   (x^2 + y^2 + z^2) + a x + b y + c z + d = 0
<i>75</i>&nbsp;                        // with sphere center coordinates -a/2, -b/2, -c/2
<i>76</i>&nbsp;                        // If the sphere exists, a b, c and d are a non zero solution to
<i>77</i>&nbsp;                        // [ (x^2  + y^2  + z^2)    x    y   z    1 ]   [ 1 ]   [ 0 ]
<i>78</i>&nbsp;                        // [ (xA^2 + yA^2 + zA^2)   xA   yA  zA   1 ]   [ a ]   [ 0 ]
<i>79</i>&nbsp;                        // [ (xB^2 + yB^2 + zB^2)   xB   yB  zB   1 ] * [ b ] = [ 0 ]
<i>80</i>&nbsp;                        // [ (xC^2 + yC^2 + zC^2)   xC   yC  zC   1 ]   [ c ]   [ 0 ]
<i>81</i>&nbsp;                        // [ (xD^2 + yD^2 + zD^2)   xD   yD  zD   1 ]   [ d ]   [ 0 ]
<i>82</i>&nbsp;                        // So the determinant of the matrix is zero. Computing this determinant
<i>83</i>&nbsp;                        // by expanding it using the minors m_ij of first row leads to
<i>84</i>&nbsp;                        // (4)   m_11 (x^2 + y^2 + z^2) - m_12 x + m_13 y - m_14 z + m_15 = 0
<i>85</i>&nbsp;                        // So by identifying equations (2) and (4) we get the coordinates
<i>86</i>&nbsp;                        // of center as:
<i>87</i>&nbsp;                        //      x_0 = +m_12 / (2 m_11)
<i>88</i>&nbsp;                        //      y_0 = -m_13 / (2 m_11)
<i>89</i>&nbsp;                        //      z_0 = +m_14 / (2 m_11)
<i>90</i>&nbsp;                        // Note that the minors m_11, m_12, m_13 and m_14 all have the last column
<i>91</i>&nbsp;                        // filled with 1.0, hence simplifying the computation
<b class="fc"><i>92</i>&nbsp;                        final BigFraction[] c2 = new BigFraction[] {</b>
<b class="fc"><i>93</i>&nbsp;                            new BigFraction(vA.getX()), new BigFraction(vB.getX()),</b>
<b class="fc"><i>94</i>&nbsp;                            new BigFraction(vC.getX()), new BigFraction(vD.getX())</b>
<i>95</i>&nbsp;                        };
<b class="fc"><i>96</i>&nbsp;                        final BigFraction[] c3 = new BigFraction[] {</b>
<b class="fc"><i>97</i>&nbsp;                            new BigFraction(vA.getY()), new BigFraction(vB.getY()),</b>
<b class="fc"><i>98</i>&nbsp;                            new BigFraction(vC.getY()), new BigFraction(vD.getY())</b>
<i>99</i>&nbsp;                        };
<b class="fc"><i>100</i>&nbsp;                        final BigFraction[] c4 = new BigFraction[] {</b>
<b class="fc"><i>101</i>&nbsp;                            new BigFraction(vA.getZ()), new BigFraction(vB.getZ()),</b>
<b class="fc"><i>102</i>&nbsp;                            new BigFraction(vC.getZ()), new BigFraction(vD.getZ())</b>
<i>103</i>&nbsp;                        };
<b class="fc"><i>104</i>&nbsp;                        final BigFraction[] c1 = new BigFraction[] {</b>
<b class="fc"><i>105</i>&nbsp;                            c2[0].multiply(c2[0]).add(c3[0].multiply(c3[0])).add(c4[0].multiply(c4[0])),</b>
<b class="fc"><i>106</i>&nbsp;                            c2[1].multiply(c2[1]).add(c3[1].multiply(c3[1])).add(c4[1].multiply(c4[1])),</b>
<b class="fc"><i>107</i>&nbsp;                            c2[2].multiply(c2[2]).add(c3[2].multiply(c3[2])).add(c4[2].multiply(c4[2])),</b>
<b class="fc"><i>108</i>&nbsp;                            c2[3].multiply(c2[3]).add(c3[3].multiply(c3[3])).add(c4[3].multiply(c4[3]))</b>
<i>109</i>&nbsp;                        };
<b class="fc"><i>110</i>&nbsp;                        final BigFraction twoM11  = minor(c2, c3, c4).multiply(2);</b>
<b class="fc"><i>111</i>&nbsp;                        final BigFraction m12     = minor(c1, c3, c4);</b>
<b class="fc"><i>112</i>&nbsp;                        final BigFraction m13     = minor(c1, c2, c4);</b>
<b class="fc"><i>113</i>&nbsp;                        final BigFraction m14     = minor(c1, c2, c3);</b>
<b class="fc"><i>114</i>&nbsp;                        final BigFraction centerX = m12.divide(twoM11);</b>
<b class="fc"><i>115</i>&nbsp;                        final BigFraction centerY = m13.divide(twoM11).negate();</b>
<b class="fc"><i>116</i>&nbsp;                        final BigFraction centerZ = m14.divide(twoM11);</b>
<b class="fc"><i>117</i>&nbsp;                        final BigFraction dx      = c2[0].subtract(centerX);</b>
<b class="fc"><i>118</i>&nbsp;                        final BigFraction dy      = c3[0].subtract(centerY);</b>
<b class="fc"><i>119</i>&nbsp;                        final BigFraction dz      = c4[0].subtract(centerZ);</b>
<b class="fc"><i>120</i>&nbsp;                        final BigFraction r2      = dx.multiply(dx).add(dy.multiply(dy)).add(dz.multiply(dz));</b>
<b class="fc"><i>121</i>&nbsp;                        return new EnclosingBall&lt;&gt;(new Cartesian3D(centerX.doubleValue(),</b>
<b class="fc"><i>122</i>&nbsp;                                                                                     centerY.doubleValue(),</b>
<b class="fc"><i>123</i>&nbsp;                                                                                     centerZ.doubleValue()),</b>
<b class="fc"><i>124</i>&nbsp;                                                                        FastMath.sqrt(r2.doubleValue()),</b>
<i>125</i>&nbsp;                                                                        vA, vB, vC, vD);
<i>126</i>&nbsp;                    }
<i>127</i>&nbsp;                }
<i>128</i>&nbsp;            }
<i>129</i>&nbsp;        }
<i>130</i>&nbsp;    }
<i>131</i>&nbsp;
<i>132</i>&nbsp;    /** Compute a dimension 4 minor, when 4&lt;sup&gt;th&lt;/sup&gt; column is known to be filled with 1.0.
<i>133</i>&nbsp;     * @param c1 first column
<i>134</i>&nbsp;     * @param c2 second column
<i>135</i>&nbsp;     * @param c3 third column
<i>136</i>&nbsp;     * @return value of the minor computed has an exact fraction
<i>137</i>&nbsp;     */
<i>138</i>&nbsp;    private BigFraction minor(final BigFraction[] c1, final BigFraction[] c2, final BigFraction[] c3) {
<b class="fc"><i>139</i>&nbsp;        return      c2[0].multiply(c3[1]).multiply(c1[2].subtract(c1[3])).</b>
<b class="fc"><i>140</i>&nbsp;                add(c2[0].multiply(c3[2]).multiply(c1[3].subtract(c1[1]))).</b>
<b class="fc"><i>141</i>&nbsp;                add(c2[0].multiply(c3[3]).multiply(c1[1].subtract(c1[2]))).</b>
<b class="fc"><i>142</i>&nbsp;                add(c2[1].multiply(c3[0]).multiply(c1[3].subtract(c1[2]))).</b>
<b class="fc"><i>143</i>&nbsp;                add(c2[1].multiply(c3[2]).multiply(c1[0].subtract(c1[3]))).</b>
<b class="fc"><i>144</i>&nbsp;                add(c2[1].multiply(c3[3]).multiply(c1[2].subtract(c1[0]))).</b>
<b class="fc"><i>145</i>&nbsp;                add(c2[2].multiply(c3[0]).multiply(c1[1].subtract(c1[3]))).</b>
<b class="fc"><i>146</i>&nbsp;                add(c2[2].multiply(c3[1]).multiply(c1[3].subtract(c1[0]))).</b>
<b class="fc"><i>147</i>&nbsp;                add(c2[2].multiply(c3[3]).multiply(c1[0].subtract(c1[1]))).</b>
<b class="fc"><i>148</i>&nbsp;                add(c2[3].multiply(c3[0]).multiply(c1[2].subtract(c1[1]))).</b>
<b class="fc"><i>149</i>&nbsp;                add(c2[3].multiply(c3[1]).multiply(c1[0].subtract(c1[2]))).</b>
<b class="fc"><i>150</i>&nbsp;                add(c2[3].multiply(c3[2]).multiply(c1[1].subtract(c1[0])));</b>
<i>151</i>&nbsp;    }
<i>152</i>&nbsp;
<i>153</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2019-06-04 09:26</div>
</div>
</body>
</html>
