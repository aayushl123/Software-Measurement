<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ObservableGroupJoinTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RxJava_2_x$Unnamed.exec</a> &gt; <a href="index.source.html" class="el_package">io.reactivex.internal.operators.observable</a> &gt; <span class="el_source">ObservableGroupJoinTest.java</span></div><h1>ObservableGroupJoinTest.java</h1><pre class="source lang-java linenums">/**
 * Copyright (c) 2016-present, RxJava Contributors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.reactivex.internal.operators.observable;

import static org.junit.Assert.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.*;

import java.util.*;

import org.junit.*;
import org.mockito.MockitoAnnotations;

import io.reactivex.*;
import io.reactivex.Observable;
import io.reactivex.Observer;
import io.reactivex.disposables.Disposable;
import io.reactivex.exceptions.*;
import io.reactivex.functions.*;
import io.reactivex.internal.functions.Functions;
import io.reactivex.internal.operators.observable.ObservableGroupJoin.*;
import io.reactivex.observers.TestObserver;
import io.reactivex.plugins.RxJavaPlugins;
import io.reactivex.subjects.PublishSubject;

<span class="fc" id="L39">public class ObservableGroupJoinTest {</span>

<span class="fc" id="L41">    Observer&lt;Object&gt; observer = TestHelper.mockObserver();</span>

<span class="fc" id="L43">    BiFunction&lt;Integer, Integer, Integer&gt; add = new BiFunction&lt;Integer, Integer, Integer&gt;() {</span>
        @Override
        public Integer apply(Integer t1, Integer t2) {
<span class="fc" id="L46">            return t1 + t2;</span>
        }
    };

    &lt;T&gt; Function&lt;Integer, Observable&lt;T&gt;&gt; just(final Observable&lt;T&gt; observable) {
<span class="fc" id="L51">        return new Function&lt;Integer, Observable&lt;T&gt;&gt;() {</span>
            @Override
            public Observable&lt;T&gt; apply(Integer t1) {
<span class="fc" id="L54">                return observable;</span>
            }
        };
    }

    &lt;T, R&gt; Function&lt;T, Observable&lt;R&gt;&gt; just2(final Observable&lt;R&gt; observable) {
<span class="fc" id="L60">        return new Function&lt;T, Observable&lt;R&gt;&gt;() {</span>
            @Override
            public Observable&lt;R&gt; apply(T t1) {
<span class="fc" id="L63">                return observable;</span>
            }
        };
    }

<span class="fc" id="L68">    BiFunction&lt;Integer, Observable&lt;Integer&gt;, Observable&lt;Integer&gt;&gt; add2 = new BiFunction&lt;Integer, Observable&lt;Integer&gt;, Observable&lt;Integer&gt;&gt;() {</span>
        @Override
        public Observable&lt;Integer&gt; apply(final Integer leftValue, Observable&lt;Integer&gt; rightValues) {
<span class="fc" id="L71">            return rightValues.map(new Function&lt;Integer, Integer&gt;() {</span>
                @Override
                public Integer apply(Integer rightValue) throws Exception {
<span class="fc" id="L74">                    return add.apply(leftValue, rightValue);</span>
                }
            });
        }

    };

    @Before
    public void before() {
<span class="fc" id="L83">        MockitoAnnotations.initMocks(this);</span>
<span class="fc" id="L84">    }</span>

    @Test
    public void behaveAsJoin() {
<span class="fc" id="L88">        PublishSubject&lt;Integer&gt; source1 = PublishSubject.create();</span>
<span class="fc" id="L89">        PublishSubject&lt;Integer&gt; source2 = PublishSubject.create();</span>

<span class="fc" id="L91">        Observable&lt;Integer&gt; m = Observable.merge(source1.groupJoin(source2,</span>
<span class="fc" id="L92">                just(Observable.never()),</span>
<span class="fc" id="L93">                just(Observable.never()), add2));</span>

<span class="fc" id="L95">        m.subscribe(observer);</span>

<span class="fc" id="L97">        source1.onNext(1);</span>
<span class="fc" id="L98">        source1.onNext(2);</span>
<span class="fc" id="L99">        source1.onNext(4);</span>

<span class="fc" id="L101">        source2.onNext(16);</span>
<span class="fc" id="L102">        source2.onNext(32);</span>
<span class="fc" id="L103">        source2.onNext(64);</span>

<span class="fc" id="L105">        source1.onComplete();</span>
<span class="fc" id="L106">        source2.onComplete();</span>

<span class="fc" id="L108">        verify(observer, times(1)).onNext(17);</span>
<span class="fc" id="L109">        verify(observer, times(1)).onNext(18);</span>
<span class="fc" id="L110">        verify(observer, times(1)).onNext(20);</span>
<span class="fc" id="L111">        verify(observer, times(1)).onNext(33);</span>
<span class="fc" id="L112">        verify(observer, times(1)).onNext(34);</span>
<span class="fc" id="L113">        verify(observer, times(1)).onNext(36);</span>
<span class="fc" id="L114">        verify(observer, times(1)).onNext(65);</span>
<span class="fc" id="L115">        verify(observer, times(1)).onNext(66);</span>
<span class="fc" id="L116">        verify(observer, times(1)).onNext(68);</span>

<span class="fc" id="L118">        verify(observer, times(1)).onComplete(); //Never emitted?</span>
<span class="fc" id="L119">        verify(observer, never()).onError(any(Throwable.class));</span>
<span class="fc" id="L120">    }</span>

    class Person {
        final int id;
        final String name;

<span class="fc" id="L126">        Person(int id, String name) {</span>
<span class="fc" id="L127">            this.id = id;</span>
<span class="fc" id="L128">            this.name = name;</span>
<span class="fc" id="L129">        }</span>
    }

    class PersonFruit {
        final int personId;
        final String fruit;

<span class="fc" id="L136">        PersonFruit(int personId, String fruit) {</span>
<span class="fc" id="L137">            this.personId = personId;</span>
<span class="fc" id="L138">            this.fruit = fruit;</span>
<span class="fc" id="L139">        }</span>
    }

    class PPF {
        final Person person;
        final Observable&lt;PersonFruit&gt; fruits;

<span class="fc" id="L146">        PPF(Person person, Observable&lt;PersonFruit&gt; fruits) {</span>
<span class="fc" id="L147">            this.person = person;</span>
<span class="fc" id="L148">            this.fruits = fruits;</span>
<span class="fc" id="L149">        }</span>
    }

    @Test
    public void normal1() {
<span class="fc" id="L154">        Observable&lt;Person&gt; source1 = Observable.fromIterable(Arrays.asList(</span>
                new Person(1, &quot;Joe&quot;),
                new Person(2, &quot;Mike&quot;),
                new Person(3, &quot;Charlie&quot;)
                ));

<span class="fc" id="L160">        Observable&lt;PersonFruit&gt; source2 = Observable.fromIterable(Arrays.asList(</span>
                new PersonFruit(1, &quot;Strawberry&quot;),
                new PersonFruit(1, &quot;Apple&quot;),
                new PersonFruit(3, &quot;Peach&quot;)
                ));

<span class="fc" id="L166">        Observable&lt;PPF&gt; q = source1.groupJoin(</span>
                source2,
<span class="fc" id="L168">                just2(Observable.&lt;Object&gt; never()),</span>
<span class="fc" id="L169">                just2(Observable.&lt;Object&gt; never()),</span>
<span class="fc" id="L170">                new BiFunction&lt;Person, Observable&lt;PersonFruit&gt;, PPF&gt;() {</span>
                    @Override
                    public PPF apply(Person t1, Observable&lt;PersonFruit&gt; t2) {
<span class="fc" id="L173">                        return new PPF(t1, t2);</span>
                    }
                });

<span class="fc" id="L177">        q.subscribe(</span>
<span class="fc" id="L178">                new Observer&lt;PPF&gt;() {</span>
                    @Override
                    public void onNext(final PPF ppf) {
<span class="fc" id="L181">                        ppf.fruits.filter(new Predicate&lt;PersonFruit&gt;() {</span>
                            @Override
                            public boolean test(PersonFruit t1) {
<span class="fc bfc" id="L184" title="All 2 branches covered.">                                return ppf.person.id == t1.personId;</span>
                            }
<span class="fc" id="L186">                        }).subscribe(new Consumer&lt;PersonFruit&gt;() {</span>
                            @Override
                            public void accept(PersonFruit t1) {
<span class="fc" id="L189">                                observer.onNext(Arrays.asList(ppf.person.name, t1.fruit));</span>
<span class="fc" id="L190">                            }</span>
                        });
<span class="fc" id="L192">                    }</span>

                    @Override
                    public void onError(Throwable e) {
<span class="nc" id="L196">                        observer.onError(e);</span>
<span class="nc" id="L197">                    }</span>

                    @Override
                    public void onComplete() {
<span class="fc" id="L201">                        observer.onComplete();</span>
<span class="fc" id="L202">                    }</span>

                    @Override
                    public void onSubscribe(Disposable d) {
<span class="fc" id="L206">                    }</span>

                }
                );

<span class="fc" id="L211">        verify(observer, times(1)).onNext(Arrays.asList(&quot;Joe&quot;, &quot;Strawberry&quot;));</span>
<span class="fc" id="L212">        verify(observer, times(1)).onNext(Arrays.asList(&quot;Joe&quot;, &quot;Apple&quot;));</span>
<span class="fc" id="L213">        verify(observer, times(1)).onNext(Arrays.asList(&quot;Charlie&quot;, &quot;Peach&quot;));</span>

<span class="fc" id="L215">        verify(observer, times(1)).onComplete();</span>
<span class="fc" id="L216">        verify(observer, never()).onError(any(Throwable.class));</span>
<span class="fc" id="L217">    }</span>

    @Test
    public void leftThrows() {
<span class="fc" id="L221">        PublishSubject&lt;Integer&gt; source1 = PublishSubject.create();</span>
<span class="fc" id="L222">        PublishSubject&lt;Integer&gt; source2 = PublishSubject.create();</span>

<span class="fc" id="L224">        Observable&lt;Observable&lt;Integer&gt;&gt; m = source1.groupJoin(source2,</span>
<span class="fc" id="L225">                just(Observable.never()),</span>
<span class="fc" id="L226">                just(Observable.never()), add2);</span>

<span class="fc" id="L228">        m.subscribe(observer);</span>

<span class="fc" id="L230">        source2.onNext(1);</span>
<span class="fc" id="L231">        source1.onError(new RuntimeException(&quot;Forced failure&quot;));</span>

<span class="fc" id="L233">        verify(observer, times(1)).onError(any(Throwable.class));</span>
<span class="fc" id="L234">        verify(observer, never()).onComplete();</span>
<span class="fc" id="L235">        verify(observer, never()).onNext(any());</span>
<span class="fc" id="L236">    }</span>

    @Test
    public void rightThrows() {
<span class="fc" id="L240">        PublishSubject&lt;Integer&gt; source1 = PublishSubject.create();</span>
<span class="fc" id="L241">        PublishSubject&lt;Integer&gt; source2 = PublishSubject.create();</span>

<span class="fc" id="L243">        Observable&lt;Observable&lt;Integer&gt;&gt; m = source1.groupJoin(source2,</span>
<span class="fc" id="L244">                just(Observable.never()),</span>
<span class="fc" id="L245">                just(Observable.never()), add2);</span>

<span class="fc" id="L247">        m.subscribe(observer);</span>

<span class="fc" id="L249">        source1.onNext(1);</span>
<span class="fc" id="L250">        source2.onError(new RuntimeException(&quot;Forced failure&quot;));</span>

<span class="fc" id="L252">        verify(observer, times(1)).onNext(any(Observable.class));</span>
<span class="fc" id="L253">        verify(observer, times(1)).onError(any(Throwable.class));</span>
<span class="fc" id="L254">        verify(observer, never()).onComplete();</span>
<span class="fc" id="L255">    }</span>

    @Test
    public void leftDurationThrows() {
<span class="fc" id="L259">        PublishSubject&lt;Integer&gt; source1 = PublishSubject.create();</span>
<span class="fc" id="L260">        PublishSubject&lt;Integer&gt; source2 = PublishSubject.create();</span>

<span class="fc" id="L262">        Observable&lt;Integer&gt; duration1 = Observable.&lt;Integer&gt; error(new RuntimeException(&quot;Forced failure&quot;));</span>

<span class="fc" id="L264">        Observable&lt;Observable&lt;Integer&gt;&gt; m = source1.groupJoin(source2,</span>
<span class="fc" id="L265">                just(duration1),</span>
<span class="fc" id="L266">                just(Observable.never()), add2);</span>
<span class="fc" id="L267">        m.subscribe(observer);</span>

<span class="fc" id="L269">        source1.onNext(1);</span>

<span class="fc" id="L271">        verify(observer, times(1)).onError(any(Throwable.class));</span>
<span class="fc" id="L272">        verify(observer, never()).onComplete();</span>
<span class="fc" id="L273">        verify(observer, never()).onNext(any());</span>
<span class="fc" id="L274">    }</span>

    @Test
    public void rightDurationThrows() {
<span class="fc" id="L278">        PublishSubject&lt;Integer&gt; source1 = PublishSubject.create();</span>
<span class="fc" id="L279">        PublishSubject&lt;Integer&gt; source2 = PublishSubject.create();</span>

<span class="fc" id="L281">        Observable&lt;Integer&gt; duration1 = Observable.&lt;Integer&gt; error(new RuntimeException(&quot;Forced failure&quot;));</span>

<span class="fc" id="L283">        Observable&lt;Observable&lt;Integer&gt;&gt; m = source1.groupJoin(source2,</span>
<span class="fc" id="L284">                just(Observable.never()),</span>
<span class="fc" id="L285">                just(duration1), add2);</span>
<span class="fc" id="L286">        m.subscribe(observer);</span>

<span class="fc" id="L288">        source2.onNext(1);</span>

<span class="fc" id="L290">        verify(observer, times(1)).onError(any(Throwable.class));</span>
<span class="fc" id="L291">        verify(observer, never()).onComplete();</span>
<span class="fc" id="L292">        verify(observer, never()).onNext(any());</span>
<span class="fc" id="L293">    }</span>

    @Test
    public void leftDurationSelectorThrows() {
<span class="fc" id="L297">        PublishSubject&lt;Integer&gt; source1 = PublishSubject.create();</span>
<span class="fc" id="L298">        PublishSubject&lt;Integer&gt; source2 = PublishSubject.create();</span>

<span class="fc" id="L300">        Function&lt;Integer, Observable&lt;Integer&gt;&gt; fail = new Function&lt;Integer, Observable&lt;Integer&gt;&gt;() {</span>
            @Override
            public Observable&lt;Integer&gt; apply(Integer t1) {
<span class="fc" id="L303">                throw new RuntimeException(&quot;Forced failure&quot;);</span>
            }
        };

<span class="fc" id="L307">        Observable&lt;Observable&lt;Integer&gt;&gt; m = source1.groupJoin(source2,</span>
                fail,
<span class="fc" id="L309">                just(Observable.never()), add2);</span>
<span class="fc" id="L310">        m.subscribe(observer);</span>

<span class="fc" id="L312">        source1.onNext(1);</span>

<span class="fc" id="L314">        verify(observer, times(1)).onError(any(Throwable.class));</span>
<span class="fc" id="L315">        verify(observer, never()).onComplete();</span>
<span class="fc" id="L316">        verify(observer, never()).onNext(any());</span>
<span class="fc" id="L317">    }</span>

    @Test
    public void rightDurationSelectorThrows() {
<span class="fc" id="L321">        PublishSubject&lt;Integer&gt; source1 = PublishSubject.create();</span>
<span class="fc" id="L322">        PublishSubject&lt;Integer&gt; source2 = PublishSubject.create();</span>

<span class="fc" id="L324">        Function&lt;Integer, Observable&lt;Integer&gt;&gt; fail = new Function&lt;Integer, Observable&lt;Integer&gt;&gt;() {</span>
            @Override
            public Observable&lt;Integer&gt; apply(Integer t1) {
<span class="fc" id="L327">                throw new RuntimeException(&quot;Forced failure&quot;);</span>
            }
        };

<span class="fc" id="L331">        Observable&lt;Observable&lt;Integer&gt;&gt; m = source1.groupJoin(source2,</span>
<span class="fc" id="L332">                just(Observable.never()),</span>
                fail, add2);
<span class="fc" id="L334">        m.subscribe(observer);</span>

<span class="fc" id="L336">        source2.onNext(1);</span>

<span class="fc" id="L338">        verify(observer, times(1)).onError(any(Throwable.class));</span>
<span class="fc" id="L339">        verify(observer, never()).onComplete();</span>
<span class="fc" id="L340">        verify(observer, never()).onNext(any());</span>
<span class="fc" id="L341">    }</span>

    @Test
    public void resultSelectorThrows() {
<span class="fc" id="L345">        PublishSubject&lt;Integer&gt; source1 = PublishSubject.create();</span>
<span class="fc" id="L346">        PublishSubject&lt;Integer&gt; source2 = PublishSubject.create();</span>

<span class="fc" id="L348">        BiFunction&lt;Integer, Observable&lt;Integer&gt;, Integer&gt; fail = new BiFunction&lt;Integer, Observable&lt;Integer&gt;, Integer&gt;() {</span>
            @Override
            public Integer apply(Integer t1, Observable&lt;Integer&gt; t2) {
<span class="fc" id="L351">                throw new RuntimeException(&quot;Forced failure&quot;);</span>
            }
        };

<span class="fc" id="L355">        Observable&lt;Integer&gt; m = source1.groupJoin(source2,</span>
<span class="fc" id="L356">                just(Observable.never()),</span>
<span class="fc" id="L357">                just(Observable.never()), fail);</span>
<span class="fc" id="L358">        m.subscribe(observer);</span>

<span class="fc" id="L360">        source1.onNext(1);</span>
<span class="fc" id="L361">        source2.onNext(2);</span>

<span class="fc" id="L363">        verify(observer, times(1)).onError(any(Throwable.class));</span>
<span class="fc" id="L364">        verify(observer, never()).onComplete();</span>
<span class="fc" id="L365">        verify(observer, never()).onNext(any());</span>
<span class="fc" id="L366">    }</span>

    @Test
    public void dispose() {
<span class="fc" id="L370">        TestHelper.checkDisposed(Observable.just(1).groupJoin(</span>
<span class="fc" id="L371">            Observable.just(2),</span>
<span class="fc" id="L372">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer left) throws Exception {
<span class="nc" id="L375">                    return Observable.never();</span>
                }
            },
<span class="fc" id="L378">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer right) throws Exception {
<span class="nc" id="L381">                    return Observable.never();</span>
                }
            },
<span class="fc" id="L384">            new BiFunction&lt;Integer, Observable&lt;Integer&gt;, Object&gt;() {</span>
                @Override
                public Object apply(Integer r, Observable&lt;Integer&gt; l) throws Exception {
<span class="nc" id="L387">                    return l;</span>
                }
            }
        ));
<span class="fc" id="L391">    }</span>

    @Test
    public void innerCompleteLeft() {
<span class="fc" id="L395">        Observable.just(1)</span>
<span class="fc" id="L396">        .groupJoin(</span>
<span class="fc" id="L397">            Observable.just(2),</span>
<span class="fc" id="L398">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer left) throws Exception {
<span class="fc" id="L401">                    return Observable.empty();</span>
                }
            },
<span class="fc" id="L404">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer right) throws Exception {
<span class="fc" id="L407">                    return Observable.never();</span>
                }
            },
<span class="fc" id="L410">            new BiFunction&lt;Integer, Observable&lt;Integer&gt;, Observable&lt;Integer&gt;&gt;() {</span>
                @Override
                public Observable&lt;Integer&gt; apply(Integer r, Observable&lt;Integer&gt; l) throws Exception {
<span class="fc" id="L413">                    return l;</span>
                }
            }
        )
<span class="fc" id="L417">        .flatMap(Functions.&lt;Observable&lt;Integer&gt;&gt;identity())</span>
<span class="fc" id="L418">        .test()</span>
<span class="fc" id="L419">        .assertResult();</span>
<span class="fc" id="L420">    }</span>

    @Test
    public void innerErrorLeft() {
<span class="fc" id="L424">        Observable.just(1)</span>
<span class="fc" id="L425">        .groupJoin(</span>
<span class="fc" id="L426">            Observable.just(2),</span>
<span class="fc" id="L427">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer left) throws Exception {
<span class="fc" id="L430">                    return Observable.error(new TestException());</span>
                }
            },
<span class="fc" id="L433">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer right) throws Exception {
<span class="nc" id="L436">                    return Observable.never();</span>
                }
            },
<span class="fc" id="L439">            new BiFunction&lt;Integer, Observable&lt;Integer&gt;, Observable&lt;Integer&gt;&gt;() {</span>
                @Override
                public Observable&lt;Integer&gt; apply(Integer r, Observable&lt;Integer&gt; l) throws Exception {
<span class="nc" id="L442">                    return l;</span>
                }
            }
        )
<span class="fc" id="L446">        .flatMap(Functions.&lt;Observable&lt;Integer&gt;&gt;identity())</span>
<span class="fc" id="L447">        .test()</span>
<span class="fc" id="L448">        .assertFailure(TestException.class);</span>
<span class="fc" id="L449">    }</span>

    @Test
    public void innerCompleteRight() {
<span class="fc" id="L453">        Observable.just(1)</span>
<span class="fc" id="L454">        .groupJoin(</span>
<span class="fc" id="L455">            Observable.just(2),</span>
<span class="fc" id="L456">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer left) throws Exception {
<span class="fc" id="L459">                    return Observable.never();</span>
                }
            },
<span class="fc" id="L462">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer right) throws Exception {
<span class="fc" id="L465">                    return Observable.empty();</span>
                }
            },
<span class="fc" id="L468">            new BiFunction&lt;Integer, Observable&lt;Integer&gt;, Observable&lt;Integer&gt;&gt;() {</span>
                @Override
                public Observable&lt;Integer&gt; apply(Integer r, Observable&lt;Integer&gt; l) throws Exception {
<span class="fc" id="L471">                    return l;</span>
                }
            }
        )
<span class="fc" id="L475">        .flatMap(Functions.&lt;Observable&lt;Integer&gt;&gt;identity())</span>
<span class="fc" id="L476">        .test()</span>
<span class="fc" id="L477">        .assertResult(2);</span>
<span class="fc" id="L478">    }</span>

    @Test
    public void innerErrorRight() {
<span class="fc" id="L482">        Observable.just(1)</span>
<span class="fc" id="L483">        .groupJoin(</span>
<span class="fc" id="L484">            Observable.just(2),</span>
<span class="fc" id="L485">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer left) throws Exception {
<span class="fc" id="L488">                    return Observable.never();</span>
                }
            },
<span class="fc" id="L491">            new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Integer right) throws Exception {
<span class="fc" id="L494">                    return Observable.error(new TestException());</span>
                }
            },
<span class="fc" id="L497">            new BiFunction&lt;Integer, Observable&lt;Integer&gt;, Observable&lt;Integer&gt;&gt;() {</span>
                @Override
                public Observable&lt;Integer&gt; apply(Integer r, Observable&lt;Integer&gt; l) throws Exception {
<span class="fc" id="L500">                    return l;</span>
                }
            }
        )
<span class="fc" id="L504">        .flatMap(Functions.&lt;Observable&lt;Integer&gt;&gt;identity())</span>
<span class="fc" id="L505">        .test()</span>
<span class="fc" id="L506">        .assertFailure(TestException.class);</span>
<span class="fc" id="L507">    }</span>

    @Test
    public void innerErrorRace() {
<span class="fc bfc" id="L511" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L512">            final PublishSubject&lt;Object&gt; ps1 = PublishSubject.create();</span>
<span class="fc" id="L513">            final PublishSubject&lt;Object&gt; ps2 = PublishSubject.create();</span>

<span class="fc" id="L515">            List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>

            try {
<span class="fc" id="L518">                TestObserver&lt;Observable&lt;Integer&gt;&gt; to = Observable.just(1)</span>
<span class="fc" id="L519">                .groupJoin(</span>
<span class="fc" id="L520">                    Observable.just(2).concatWith(Observable.&lt;Integer&gt;never()),</span>
<span class="fc" id="L521">                    new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                        @Override
                        public ObservableSource&lt;Object&gt; apply(Integer left) throws Exception {
<span class="fc" id="L524">                            return ps1;</span>
                        }
                    },
<span class="fc" id="L527">                    new Function&lt;Integer, ObservableSource&lt;Object&gt;&gt;() {</span>
                        @Override
                        public ObservableSource&lt;Object&gt; apply(Integer right) throws Exception {
<span class="fc" id="L530">                            return ps2;</span>
                        }
                    },
<span class="fc" id="L533">                    new BiFunction&lt;Integer, Observable&lt;Integer&gt;, Observable&lt;Integer&gt;&gt;() {</span>
                        @Override
                        public Observable&lt;Integer&gt; apply(Integer r, Observable&lt;Integer&gt; l) throws Exception {
<span class="fc" id="L536">                            return l;</span>
                        }
                    }
                )
<span class="fc" id="L540">                .test();</span>

<span class="fc" id="L542">                final TestException ex1 = new TestException();</span>
<span class="fc" id="L543">                final TestException ex2 = new TestException();</span>

<span class="fc" id="L545">                Runnable r1 = new Runnable() {</span>
                    @Override
                    public void run() {
<span class="fc" id="L548">                        ps1.onError(ex1);</span>
<span class="fc" id="L549">                    }</span>
                };
<span class="fc" id="L551">                Runnable r2 = new Runnable() {</span>
                    @Override
                    public void run() {
<span class="fc" id="L554">                        ps2.onError(ex2);</span>
<span class="fc" id="L555">                    }</span>
                };

<span class="fc" id="L558">                TestHelper.race(r1, r2);</span>

<span class="fc" id="L560">                to.assertError(Throwable.class).assertSubscribed().assertNotComplete().assertValueCount(1);</span>

<span class="fc" id="L562">                Throwable exc = to.errors().get(0);</span>

<span class="fc bfc" id="L564" title="All 2 branches covered.">                if (exc instanceof CompositeException) {</span>
<span class="fc" id="L565">                    List&lt;Throwable&gt; es = TestHelper.compositeList(exc);</span>
<span class="fc" id="L566">                    TestHelper.assertError(es, 0, TestException.class);</span>
<span class="fc" id="L567">                    TestHelper.assertError(es, 1, TestException.class);</span>
<span class="fc" id="L568">                } else {</span>
<span class="fc" id="L569">                    to.assertError(TestException.class);</span>
                }

<span class="fc bfc" id="L572" title="All 2 branches covered.">                if (!errors.isEmpty()) {</span>
<span class="fc" id="L573">                    TestHelper.assertUndeliverable(errors, 0, TestException.class);</span>
                }
            } finally {
<span class="fc" id="L576">                RxJavaPlugins.reset();</span>
            }
        }
<span class="fc" id="L579">    }</span>

    @Test
    public void outerErrorRace() {
<span class="fc bfc" id="L583" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L584">            final PublishSubject&lt;Object&gt; ps1 = PublishSubject.create();</span>
<span class="fc" id="L585">            final PublishSubject&lt;Object&gt; ps2 = PublishSubject.create();</span>

<span class="fc" id="L587">            List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>

            try {
<span class="fc" id="L590">                TestObserver&lt;Object&gt; to = ps1</span>
<span class="fc" id="L591">                .groupJoin(</span>
                    ps2,
<span class="fc" id="L593">                    new Function&lt;Object, ObservableSource&lt;Object&gt;&gt;() {</span>
                        @Override
                        public ObservableSource&lt;Object&gt; apply(Object left) throws Exception {
<span class="nc" id="L596">                            return Observable.never();</span>
                        }
                    },
<span class="fc" id="L599">                    new Function&lt;Object, ObservableSource&lt;Object&gt;&gt;() {</span>
                        @Override
                        public ObservableSource&lt;Object&gt; apply(Object right) throws Exception {
<span class="nc" id="L602">                            return Observable.never();</span>
                        }
                    },
<span class="fc" id="L605">                    new BiFunction&lt;Object, Observable&lt;Object&gt;, Observable&lt;Object&gt;&gt;() {</span>
                        @Override
                        public Observable&lt;Object&gt; apply(Object r, Observable&lt;Object&gt; l) throws Exception {
<span class="nc" id="L608">                            return l;</span>
                        }
                    }
                )
<span class="fc" id="L612">                .flatMap(Functions.&lt;Observable&lt;Object&gt;&gt;identity())</span>
<span class="fc" id="L613">                .test();</span>

<span class="fc" id="L615">                final TestException ex1 = new TestException();</span>
<span class="fc" id="L616">                final TestException ex2 = new TestException();</span>

<span class="fc" id="L618">                Runnable r1 = new Runnable() {</span>
                    @Override
                    public void run() {
<span class="fc" id="L621">                        ps1.onError(ex1);</span>
<span class="fc" id="L622">                    }</span>
                };
<span class="fc" id="L624">                Runnable r2 = new Runnable() {</span>
                    @Override
                    public void run() {
<span class="fc" id="L627">                        ps2.onError(ex2);</span>
<span class="fc" id="L628">                    }</span>
                };

<span class="fc" id="L631">                TestHelper.race(r1, r2);</span>

<span class="fc" id="L633">                to.assertError(Throwable.class).assertSubscribed().assertNotComplete().assertNoValues();</span>

<span class="fc" id="L635">                Throwable exc = to.errors().get(0);</span>

<span class="fc bfc" id="L637" title="All 2 branches covered.">                if (exc instanceof CompositeException) {</span>
<span class="fc" id="L638">                    List&lt;Throwable&gt; es = TestHelper.compositeList(exc);</span>
<span class="fc" id="L639">                    TestHelper.assertError(es, 0, TestException.class);</span>
<span class="fc" id="L640">                    TestHelper.assertError(es, 1, TestException.class);</span>
<span class="fc" id="L641">                } else {</span>
<span class="fc" id="L642">                    to.assertError(TestException.class);</span>
                }

<span class="fc bfc" id="L645" title="All 2 branches covered.">                if (!errors.isEmpty()) {</span>
<span class="fc" id="L646">                    TestHelper.assertUndeliverable(errors, 0, TestException.class);</span>
                }
            } finally {
<span class="fc" id="L649">                RxJavaPlugins.reset();</span>
            }
        }
<span class="fc" id="L652">    }</span>

    @Test
    public void rightEmission() {
<span class="fc" id="L656">        final PublishSubject&lt;Object&gt; ps1 = PublishSubject.create();</span>
<span class="fc" id="L657">        final PublishSubject&lt;Object&gt; ps2 = PublishSubject.create();</span>

<span class="fc" id="L659">        TestObserver&lt;Object&gt; to = ps1</span>
<span class="fc" id="L660">        .groupJoin(</span>
            ps2,
<span class="fc" id="L662">            new Function&lt;Object, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Object left) throws Exception {
<span class="fc" id="L665">                    return Observable.never();</span>
                }
            },
<span class="fc" id="L668">            new Function&lt;Object, ObservableSource&lt;Object&gt;&gt;() {</span>
                @Override
                public ObservableSource&lt;Object&gt; apply(Object right) throws Exception {
<span class="fc" id="L671">                    return Observable.never();</span>
                }
            },
<span class="fc" id="L674">            new BiFunction&lt;Object, Observable&lt;Object&gt;, Observable&lt;Object&gt;&gt;() {</span>
                @Override
                public Observable&lt;Object&gt; apply(Object r, Observable&lt;Object&gt; l) throws Exception {
<span class="fc" id="L677">                    return l;</span>
                }
            }
        )
<span class="fc" id="L681">        .flatMap(Functions.&lt;Observable&lt;Object&gt;&gt;identity())</span>
<span class="fc" id="L682">        .test();</span>

<span class="fc" id="L684">        ps2.onNext(2);</span>

<span class="fc" id="L686">        ps1.onNext(1);</span>
<span class="fc" id="L687">        ps1.onComplete();</span>

<span class="fc" id="L689">        ps2.onComplete();</span>

<span class="fc" id="L691">        to.assertResult(2);</span>
<span class="fc" id="L692">    }</span>

    @Test
    public void leftRightState() {
<span class="fc" id="L696">        JoinSupport js = mock(JoinSupport.class);</span>

<span class="fc" id="L698">        LeftRightObserver o = new LeftRightObserver(js, false);</span>

<span class="fc" id="L700">        assertFalse(o.isDisposed());</span>

<span class="fc" id="L702">        o.onNext(1);</span>
<span class="fc" id="L703">        o.onNext(2);</span>

<span class="fc" id="L705">        o.dispose();</span>

<span class="fc" id="L707">        assertTrue(o.isDisposed());</span>

<span class="fc" id="L709">        verify(js).innerValue(false, 1);</span>
<span class="fc" id="L710">        verify(js).innerValue(false, 2);</span>
<span class="fc" id="L711">    }</span>

    @Test
    public void leftRightEndState() {
<span class="fc" id="L715">        JoinSupport js = mock(JoinSupport.class);</span>

<span class="fc" id="L717">        LeftRightEndObserver o = new LeftRightEndObserver(js, false, 0);</span>

<span class="fc" id="L719">        assertFalse(o.isDisposed());</span>

<span class="fc" id="L721">        o.onNext(1);</span>
<span class="fc" id="L722">        o.onNext(2);</span>

<span class="fc" id="L724">        assertTrue(o.isDisposed());</span>

<span class="fc" id="L726">        verify(js).innerClose(false, o);</span>
<span class="fc" id="L727">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>