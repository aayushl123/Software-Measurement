<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ObservableSequenceEqualTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RxJava_2_x$Unnamed.exec</a> &gt; <a href="index.source.html" class="el_package">io.reactivex.internal.operators.observable</a> &gt; <span class="el_source">ObservableSequenceEqualTest.java</span></div><h1>ObservableSequenceEqualTest.java</h1><pre class="source lang-java linenums">/**
 * Copyright (c) 2016-present, RxJava Contributors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is
 * distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See
 * the License for the specific language governing permissions and limitations under the License.
 */

package io.reactivex.internal.operators.observable;

import static org.mockito.ArgumentMatchers.isA;
import static org.mockito.Mockito.*;

import org.junit.*;
import org.mockito.InOrder;

import io.reactivex.*;
import io.reactivex.exceptions.TestException;
import io.reactivex.functions.BiPredicate;
import io.reactivex.observers.TestObserver;
import io.reactivex.subjects.PublishSubject;

<span class="fc" id="L28">public class ObservableSequenceEqualTest {</span>

    @Test
    public void test1Observable() {
<span class="fc" id="L32">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L33">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;),</span>
<span class="fc" id="L34">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;)).toObservable();</span>
<span class="fc" id="L35">        verifyResult(o, true);</span>
<span class="fc" id="L36">    }</span>

    @Test
    public void test2Observable() {
<span class="fc" id="L40">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L41">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;),</span>
<span class="fc" id="L42">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;)).toObservable();</span>
<span class="fc" id="L43">        verifyResult(o, false);</span>
<span class="fc" id="L44">    }</span>

    @Test
    public void test3Observable() {
<span class="fc" id="L48">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L49">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;),</span>
<span class="fc" id="L50">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;)).toObservable();</span>
<span class="fc" id="L51">        verifyResult(o, false);</span>
<span class="fc" id="L52">    }</span>

    @Test
    public void testWithError1Observable() {
<span class="fc" id="L56">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L57">                Observable.concat(Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L58">                        Observable.&lt;String&gt; error(new TestException())),</span>
<span class="fc" id="L59">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;)).toObservable();</span>
<span class="fc" id="L60">        verifyError(o);</span>
<span class="fc" id="L61">    }</span>

    @Test
    public void testWithError2Observable() {
<span class="fc" id="L65">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L66">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;),</span>
<span class="fc" id="L67">                Observable.concat(Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L68">                        Observable.&lt;String&gt; error(new TestException()))).toObservable();</span>
<span class="fc" id="L69">        verifyError(o);</span>
<span class="fc" id="L70">    }</span>

    @Test
    public void testWithError3Observable() {
<span class="fc" id="L74">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L75">                Observable.concat(Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L76">                        Observable.&lt;String&gt; error(new TestException())),</span>
<span class="fc" id="L77">                Observable.concat(Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L78">                        Observable.&lt;String&gt; error(new TestException()))).toObservable();</span>
<span class="fc" id="L79">        verifyError(o);</span>
<span class="fc" id="L80">    }</span>

    @Test
    public void testWithEmpty1Observable() {
<span class="fc" id="L84">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L85">                Observable.&lt;String&gt; empty(),</span>
<span class="fc" id="L86">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;)).toObservable();</span>
<span class="fc" id="L87">        verifyResult(o, false);</span>
<span class="fc" id="L88">    }</span>

    @Test
    public void testWithEmpty2Observable() {
<span class="fc" id="L92">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L93">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;),</span>
<span class="fc" id="L94">                Observable.&lt;String&gt; empty()).toObservable();</span>
<span class="fc" id="L95">        verifyResult(o, false);</span>
<span class="fc" id="L96">    }</span>

    @Test
    public void testWithEmpty3Observable() {
<span class="fc" id="L100">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L101">                Observable.&lt;String&gt; empty(), Observable.&lt;String&gt; empty()).toObservable();</span>
<span class="fc" id="L102">        verifyResult(o, true);</span>
<span class="fc" id="L103">    }</span>

    @Test
    @Ignore(&quot;Null values not allowed&quot;)
    public void testWithNull1Observable() {
<span class="nc" id="L108">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="nc" id="L109">                Observable.just((String) null), Observable.just(&quot;one&quot;)).toObservable();</span>
<span class="nc" id="L110">        verifyResult(o, false);</span>
<span class="nc" id="L111">    }</span>

    @Test
    @Ignore(&quot;Null values not allowed&quot;)
    public void testWithNull2Observable() {
<span class="nc" id="L116">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="nc" id="L117">                Observable.just((String) null), Observable.just((String) null)).toObservable();</span>
<span class="nc" id="L118">        verifyResult(o, true);</span>
<span class="nc" id="L119">    }</span>

    @Test
    public void testWithEqualityErrorObservable() {
<span class="fc" id="L123">        Observable&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L124">                Observable.just(&quot;one&quot;), Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L125">                new BiPredicate&lt;String, String&gt;() {</span>
                    @Override
                    public boolean test(String t1, String t2) {
<span class="fc" id="L128">                        throw new TestException();</span>
                    }
<span class="fc" id="L130">                }).toObservable();</span>
<span class="fc" id="L131">        verifyError(o);</span>
<span class="fc" id="L132">    }</span>

    private void verifyResult(Single&lt;Boolean&gt; o, boolean result) {
<span class="fc" id="L135">        SingleObserver&lt;Boolean&gt; observer = TestHelper.mockSingleObserver();</span>

<span class="fc" id="L137">        o.subscribe(observer);</span>

<span class="fc" id="L139">        InOrder inOrder = inOrder(observer);</span>
<span class="fc" id="L140">        inOrder.verify(observer, times(1)).onSuccess(result);</span>
<span class="fc" id="L141">        inOrder.verifyNoMoreInteractions();</span>
<span class="fc" id="L142">    }</span>

    private void verifyError(Observable&lt;Boolean&gt; observable) {
<span class="fc" id="L145">        Observer&lt;Boolean&gt; observer = TestHelper.mockObserver();</span>
<span class="fc" id="L146">        observable.subscribe(observer);</span>

<span class="fc" id="L148">        InOrder inOrder = inOrder(observer);</span>
<span class="fc" id="L149">        inOrder.verify(observer, times(1)).onError(isA(TestException.class));</span>
<span class="fc" id="L150">        inOrder.verifyNoMoreInteractions();</span>
<span class="fc" id="L151">    }</span>

    private void verifyError(Single&lt;Boolean&gt; single) {
<span class="fc" id="L154">        SingleObserver&lt;Boolean&gt; observer = TestHelper.mockSingleObserver();</span>
<span class="fc" id="L155">        single.subscribe(observer);</span>

<span class="fc" id="L157">        InOrder inOrder = inOrder(observer);</span>
<span class="fc" id="L158">        inOrder.verify(observer, times(1)).onError(isA(TestException.class));</span>
<span class="fc" id="L159">        inOrder.verifyNoMoreInteractions();</span>
<span class="fc" id="L160">    }</span>

    @Test
    public void prefetchObservable() {
<span class="fc" id="L164">        Observable.sequenceEqual(Observable.range(1, 20), Observable.range(1, 20), 2)</span>
<span class="fc" id="L165">        .toObservable()</span>
<span class="fc" id="L166">        .test()</span>
<span class="fc" id="L167">        .assertResult(true);</span>
<span class="fc" id="L168">    }</span>

    @Test
    public void disposedObservable() {
<span class="fc" id="L172">        TestHelper.checkDisposed(Observable.sequenceEqual(Observable.just(1), Observable.just(2)).toObservable());</span>
<span class="fc" id="L173">    }</span>

    @Test
    public void test1() {
<span class="fc" id="L177">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L178">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;),</span>
<span class="fc" id="L179">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;));</span>
<span class="fc" id="L180">        verifyResult(o, true);</span>
<span class="fc" id="L181">    }</span>

    @Test
    public void test2() {
<span class="fc" id="L185">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L186">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;),</span>
<span class="fc" id="L187">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;));</span>
<span class="fc" id="L188">        verifyResult(o, false);</span>
<span class="fc" id="L189">    }</span>

    @Test
    public void test3() {
<span class="fc" id="L193">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L194">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;),</span>
<span class="fc" id="L195">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;));</span>
<span class="fc" id="L196">        verifyResult(o, false);</span>
<span class="fc" id="L197">    }</span>

    @Test
    public void testWithError1() {
<span class="fc" id="L201">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L202">                Observable.concat(Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L203">                        Observable.&lt;String&gt; error(new TestException())),</span>
<span class="fc" id="L204">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;));</span>
<span class="fc" id="L205">        verifyError(o);</span>
<span class="fc" id="L206">    }</span>

    @Test
    public void testWithError2() {
<span class="fc" id="L210">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L211">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;),</span>
<span class="fc" id="L212">                Observable.concat(Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L213">                        Observable.&lt;String&gt; error(new TestException())));</span>
<span class="fc" id="L214">        verifyError(o);</span>
<span class="fc" id="L215">    }</span>

    @Test
    public void testWithError3() {
<span class="fc" id="L219">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L220">                Observable.concat(Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L221">                        Observable.&lt;String&gt; error(new TestException())),</span>
<span class="fc" id="L222">                Observable.concat(Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L223">                        Observable.&lt;String&gt; error(new TestException())));</span>
<span class="fc" id="L224">        verifyError(o);</span>
<span class="fc" id="L225">    }</span>

    @Test
    public void testWithEmpty1() {
<span class="fc" id="L229">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L230">                Observable.&lt;String&gt; empty(),</span>
<span class="fc" id="L231">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;));</span>
<span class="fc" id="L232">        verifyResult(o, false);</span>
<span class="fc" id="L233">    }</span>

    @Test
    public void testWithEmpty2() {
<span class="fc" id="L237">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L238">                Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;),</span>
<span class="fc" id="L239">                Observable.&lt;String&gt; empty());</span>
<span class="fc" id="L240">        verifyResult(o, false);</span>
<span class="fc" id="L241">    }</span>

    @Test
    public void testWithEmpty3() {
<span class="fc" id="L245">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L246">                Observable.&lt;String&gt; empty(), Observable.&lt;String&gt; empty());</span>
<span class="fc" id="L247">        verifyResult(o, true);</span>
<span class="fc" id="L248">    }</span>

    @Test
    @Ignore(&quot;Null values not allowed&quot;)
    public void testWithNull1() {
<span class="nc" id="L253">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="nc" id="L254">                Observable.just((String) null), Observable.just(&quot;one&quot;));</span>
<span class="nc" id="L255">        verifyResult(o, false);</span>
<span class="nc" id="L256">    }</span>

    @Test
    @Ignore(&quot;Null values not allowed&quot;)
    public void testWithNull2() {
<span class="nc" id="L261">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="nc" id="L262">                Observable.just((String) null), Observable.just((String) null));</span>
<span class="nc" id="L263">        verifyResult(o, true);</span>
<span class="nc" id="L264">    }</span>

    @Test
    public void testWithEqualityError() {
<span class="fc" id="L268">        Single&lt;Boolean&gt; o = Observable.sequenceEqual(</span>
<span class="fc" id="L269">                Observable.just(&quot;one&quot;), Observable.just(&quot;one&quot;),</span>
<span class="fc" id="L270">                new BiPredicate&lt;String, String&gt;() {</span>
                    @Override
                    public boolean test(String t1, String t2) {
<span class="fc" id="L273">                        throw new TestException();</span>
                    }
                });
<span class="fc" id="L276">        verifyError(o);</span>
<span class="fc" id="L277">    }</span>

    private void verifyResult(Observable&lt;Boolean&gt; o, boolean result) {
<span class="fc" id="L280">        Observer&lt;Boolean&gt; observer = TestHelper.mockObserver();</span>

<span class="fc" id="L282">        o.subscribe(observer);</span>

<span class="fc" id="L284">        InOrder inOrder = inOrder(observer);</span>
<span class="fc" id="L285">        inOrder.verify(observer, times(1)).onNext(result);</span>
<span class="fc" id="L286">        inOrder.verify(observer).onComplete();</span>
<span class="fc" id="L287">        inOrder.verifyNoMoreInteractions();</span>
<span class="fc" id="L288">    }</span>

    @Test
    public void prefetch() {
<span class="fc" id="L292">        Observable.sequenceEqual(Observable.range(1, 20), Observable.range(1, 20), 2)</span>
<span class="fc" id="L293">        .test()</span>
<span class="fc" id="L294">        .assertResult(true);</span>
<span class="fc" id="L295">    }</span>

    @Test
    public void disposed() {
<span class="fc" id="L299">        TestHelper.checkDisposed(Observable.sequenceEqual(Observable.just(1), Observable.just(2)));</span>
<span class="fc" id="L300">    }</span>

    @Test
    public void simpleInequal() {
<span class="fc" id="L304">        Observable.sequenceEqual(Observable.just(1), Observable.just(2))</span>
<span class="fc" id="L305">        .test()</span>
<span class="fc" id="L306">        .assertResult(false);</span>
<span class="fc" id="L307">    }</span>

    @Test
    public void simpleInequalObservable() {
<span class="fc" id="L311">        Observable.sequenceEqual(Observable.just(1), Observable.just(2))</span>
<span class="fc" id="L312">        .toObservable()</span>
<span class="fc" id="L313">        .test()</span>
<span class="fc" id="L314">        .assertResult(false);</span>
<span class="fc" id="L315">    }</span>

    @Test
    public void onNextCancelRace() {
<span class="fc bfc" id="L319" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L320">            final PublishSubject&lt;Integer&gt; ps = PublishSubject.create();</span>

<span class="fc" id="L322">            final TestObserver&lt;Boolean&gt; to = Observable.sequenceEqual(Observable.never(), ps).test();</span>

<span class="fc" id="L324">            Runnable r1 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L327">                    to.cancel();</span>
<span class="fc" id="L328">                }</span>
            };

<span class="fc" id="L331">            Runnable r2 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L334">                    ps.onNext(1);</span>
<span class="fc" id="L335">                }</span>
            };

<span class="fc" id="L338">            TestHelper.race(r1, r2);</span>

<span class="fc" id="L340">            to.assertEmpty();</span>
        }
<span class="fc" id="L342">    }</span>

    @Test
    public void onNextCancelRaceObservable() {
<span class="fc bfc" id="L346" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L347">            final PublishSubject&lt;Integer&gt; ps = PublishSubject.create();</span>

<span class="fc" id="L349">            final TestObserver&lt;Boolean&gt; to = Observable.sequenceEqual(Observable.never(), ps).toObservable().test();</span>

<span class="fc" id="L351">            Runnable r1 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L354">                    to.cancel();</span>
<span class="fc" id="L355">                }</span>
            };

<span class="fc" id="L358">            Runnable r2 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L361">                    ps.onNext(1);</span>
<span class="fc" id="L362">                }</span>
            };

<span class="fc" id="L365">            TestHelper.race(r1, r2);</span>

<span class="fc" id="L367">            to.assertEmpty();</span>
        }
<span class="fc" id="L369">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>