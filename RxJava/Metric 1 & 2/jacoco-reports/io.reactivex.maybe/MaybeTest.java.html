<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MaybeTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RxJava_2_x$Unnamed.exec</a> &gt; <a href="index.source.html" class="el_package">io.reactivex.maybe</a> &gt; <span class="el_source">MaybeTest.java</span></div><h1>MaybeTest.java</h1><pre class="source lang-java linenums">/**
 * Copyright (c) 2016-present, RxJava Contributors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is
 * distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See
 * the License for the specific language governing permissions and limitations under the License.
 */

package io.reactivex.maybe;

import static org.junit.Assert.*;

import java.io.IOException;
import java.lang.management.*;
import java.util.*;
import java.util.concurrent.*;
import java.util.concurrent.atomic.AtomicInteger;

import org.junit.Test;
import org.reactivestreams.Publisher;

import io.reactivex.*;
import io.reactivex.Observable;
import io.reactivex.disposables.*;
import io.reactivex.exceptions.*;
import io.reactivex.functions.*;
import io.reactivex.internal.functions.Functions;
import io.reactivex.internal.fuseable.QueueFuseable;
import io.reactivex.internal.operators.flowable.FlowableZipTest.ArgsToString;
import io.reactivex.internal.operators.maybe.*;
import io.reactivex.observers.TestObserver;
import io.reactivex.plugins.RxJavaPlugins;
import io.reactivex.processors.PublishProcessor;
import io.reactivex.schedulers.Schedulers;
import io.reactivex.subjects.PublishSubject;
import io.reactivex.subscribers.*;

<span class="fc" id="L43">public class MaybeTest {</span>
    @Test
    public void fromFlowableEmpty() {

<span class="fc" id="L47">        Flowable.empty()</span>
<span class="fc" id="L48">        .singleElement()</span>
<span class="fc" id="L49">        .test()</span>
<span class="fc" id="L50">        .assertResult();</span>
<span class="fc" id="L51">    }</span>

    @Test
    public void fromFlowableJust() {

<span class="fc" id="L56">        Flowable.just(1)</span>
<span class="fc" id="L57">        .singleElement()</span>
<span class="fc" id="L58">        .test()</span>
<span class="fc" id="L59">        .assertResult(1);</span>
<span class="fc" id="L60">    }</span>

    @Test
    public void fromFlowableError() {

<span class="fc" id="L65">        Flowable.error(new TestException())</span>
<span class="fc" id="L66">        .singleElement()</span>
<span class="fc" id="L67">        .test()</span>
<span class="fc" id="L68">        .assertFailure(TestException.class);</span>
<span class="fc" id="L69">    }</span>

    @Test
    public void fromFlowableValueAndError() {
<span class="fc" id="L73">        Flowable.just(1).concatWith(Flowable.&lt;Integer&gt;error(new TestException()))</span>
<span class="fc" id="L74">        .singleElement()</span>
<span class="fc" id="L75">        .test()</span>
<span class="fc" id="L76">        .assertFailure(TestException.class);</span>
<span class="fc" id="L77">    }</span>

    @Test
    public void fromFlowableMany() {

<span class="fc" id="L82">        Flowable.range(1, 2)</span>
<span class="fc" id="L83">        .singleElement()</span>
<span class="fc" id="L84">        .test()</span>
<span class="fc" id="L85">        .assertFailure(IllegalArgumentException.class);</span>
<span class="fc" id="L86">    }</span>

    @Test
    public void fromFlowableDisposeComposesThrough() {
<span class="fc" id="L90">        PublishProcessor&lt;Integer&gt; pp = PublishProcessor.create();</span>

<span class="fc" id="L92">        TestObserver&lt;Integer&gt; to = pp.singleElement().test();</span>

<span class="fc" id="L94">        assertTrue(pp.hasSubscribers());</span>

<span class="fc" id="L96">        to.cancel();</span>

<span class="fc" id="L98">        assertFalse(pp.hasSubscribers());</span>
<span class="fc" id="L99">    }</span>

    @Test
    public void fromObservableEmpty() {

<span class="fc" id="L104">        Observable.empty()</span>
<span class="fc" id="L105">        .singleElement()</span>
<span class="fc" id="L106">        .test()</span>
<span class="fc" id="L107">        .assertResult();</span>
<span class="fc" id="L108">    }</span>

    @Test
    public void fromObservableJust() {

<span class="fc" id="L113">        Observable.just(1)</span>
<span class="fc" id="L114">        .singleElement()</span>
<span class="fc" id="L115">        .test()</span>
<span class="fc" id="L116">        .assertResult(1);</span>
<span class="fc" id="L117">    }</span>

    @Test
    public void fromObservableError() {

<span class="fc" id="L122">        Observable.error(new TestException())</span>
<span class="fc" id="L123">        .singleElement()</span>
<span class="fc" id="L124">        .test()</span>
<span class="fc" id="L125">        .assertFailure(TestException.class);</span>
<span class="fc" id="L126">    }</span>

    @Test
    public void fromObservableValueAndError() {
<span class="fc" id="L130">        Flowable.just(1).concatWith(Flowable.&lt;Integer&gt;error(new TestException()))</span>
<span class="fc" id="L131">        .singleElement()</span>
<span class="fc" id="L132">        .test()</span>
<span class="fc" id="L133">        .assertFailure(TestException.class);</span>
<span class="fc" id="L134">    }</span>

    @Test
    public void fromObservableMany() {

<span class="fc" id="L139">        Observable.range(1, 2)</span>
<span class="fc" id="L140">        .singleElement()</span>
<span class="fc" id="L141">        .test()</span>
<span class="fc" id="L142">        .assertFailure(IllegalArgumentException.class);</span>
<span class="fc" id="L143">    }</span>

    @Test
    public void fromObservableDisposeComposesThrough() {
<span class="fc" id="L147">        PublishSubject&lt;Integer&gt; ps = PublishSubject.create();</span>

<span class="fc" id="L149">        TestObserver&lt;Integer&gt; to = ps.singleElement().test(false);</span>

<span class="fc" id="L151">        assertTrue(ps.hasObservers());</span>

<span class="fc" id="L153">        to.cancel();</span>

<span class="fc" id="L155">        assertFalse(ps.hasObservers());</span>
<span class="fc" id="L156">    }</span>

    @Test
    public void fromObservableDisposeComposesThroughImmediatelyCancelled() {
<span class="fc" id="L160">        PublishSubject&lt;Integer&gt; ps = PublishSubject.create();</span>

<span class="fc" id="L162">        ps.singleElement().test(true);</span>

<span class="fc" id="L164">        assertFalse(ps.hasObservers());</span>
<span class="fc" id="L165">    }</span>

    @Test
    public void just() {
<span class="fc" id="L169">        Maybe.just(1)</span>
<span class="fc" id="L170">        .test()</span>
<span class="fc" id="L171">        .assertResult(1);</span>
<span class="fc" id="L172">    }</span>

    @Test(expected = NullPointerException.class)
    public void justNull() {
<span class="nc" id="L176">        Maybe.just(null);</span>
<span class="nc" id="L177">    }</span>

    @Test
    public void empty() {
<span class="fc" id="L181">        Maybe.empty()</span>
<span class="fc" id="L182">        .test()</span>
<span class="fc" id="L183">        .assertResult();</span>
<span class="fc" id="L184">    }</span>

    @Test
    public void never() {
<span class="fc" id="L188">        Maybe.never()</span>
<span class="fc" id="L189">        .test()</span>
<span class="fc" id="L190">        .assertSubscribed()</span>
<span class="fc" id="L191">        .assertNoValues()</span>
<span class="fc" id="L192">        .assertNoErrors()</span>
<span class="fc" id="L193">        .assertNotComplete();</span>
<span class="fc" id="L194">    }</span>

    @Test(expected = NullPointerException.class)
    public void errorNull() {
<span class="nc" id="L198">        Maybe.error((Throwable)null);</span>
<span class="nc" id="L199">    }</span>

    @Test(expected = NullPointerException.class)
    public void errorCallableNull() {
<span class="nc" id="L203">        Maybe.error((Callable&lt;Throwable&gt;)null);</span>
<span class="nc" id="L204">    }</span>

    @Test
    public void error() {
<span class="fc" id="L208">        Maybe.error(new TestException())</span>
<span class="fc" id="L209">        .test()</span>
<span class="fc" id="L210">        .assertFailure(TestException.class);</span>
<span class="fc" id="L211">    }</span>

    @Test
    public void errorCallable() {
<span class="fc" id="L215">        Maybe.error(Functions.justCallable(new TestException()))</span>
<span class="fc" id="L216">        .test()</span>
<span class="fc" id="L217">        .assertFailure(TestException.class);</span>
<span class="fc" id="L218">    }</span>

    @Test
    public void errorCallableReturnsNull() {
<span class="fc" id="L222">        Maybe.error(Functions.justCallable((Throwable)null))</span>
<span class="fc" id="L223">        .test()</span>
<span class="fc" id="L224">        .assertFailure(NullPointerException.class);</span>
<span class="fc" id="L225">    }</span>

    @Test
    public void wrapCustom() {
<span class="fc" id="L229">        Maybe.wrap(new MaybeSource&lt;Integer&gt;() {</span>
            @Override
            public void subscribe(MaybeObserver&lt;? super Integer&gt; observer) {
<span class="fc" id="L232">                observer.onSubscribe(Disposables.empty());</span>
<span class="fc" id="L233">                observer.onSuccess(1);</span>
<span class="fc" id="L234">            }</span>
        })
<span class="fc" id="L236">        .test()</span>
<span class="fc" id="L237">        .assertResult(1);</span>
<span class="fc" id="L238">    }</span>

    @Test
    public void wrapMaybe() {
<span class="fc" id="L242">        assertSame(Maybe.empty(), Maybe.wrap(Maybe.empty()));</span>
<span class="fc" id="L243">    }</span>

    @Test(expected = NullPointerException.class)
    public void wrapNull() {
<span class="nc" id="L247">        Maybe.wrap(null);</span>
<span class="nc" id="L248">    }</span>

    @Test
    public void emptySingleton() {
<span class="fc" id="L252">        assertSame(Maybe.empty(), Maybe.empty());</span>
<span class="fc" id="L253">    }</span>

    @Test
    public void neverSingleton() {
<span class="fc" id="L257">        assertSame(Maybe.never(), Maybe.never());</span>
<span class="fc" id="L258">    }</span>

    @Test(expected = NullPointerException.class)
    public void liftNull() {
<span class="nc" id="L262">        Maybe.just(1).lift(null);</span>
<span class="nc" id="L263">    }</span>

    @Test
    public void liftJust() {
<span class="fc" id="L267">        Maybe.just(1).lift(new MaybeOperator&lt;Integer, Integer&gt;() {</span>
            @Override
            public MaybeObserver&lt;? super Integer&gt; apply(MaybeObserver&lt;? super Integer&gt; t) throws Exception {
<span class="fc" id="L270">                return t;</span>
            }
        })
<span class="fc" id="L273">        .test()</span>
<span class="fc" id="L274">        .assertResult(1);</span>
<span class="fc" id="L275">    }</span>

    @Test
    public void liftThrows() {
<span class="fc" id="L279">        Maybe.just(1).lift(new MaybeOperator&lt;Integer, Integer&gt;() {</span>
            @Override
            public MaybeObserver&lt;? super Integer&gt; apply(MaybeObserver&lt;? super Integer&gt; t) throws Exception {
<span class="fc" id="L282">                throw new TestException();</span>
            }
        })
<span class="fc" id="L285">        .test()</span>
<span class="fc" id="L286">        .assertFailure(TestException.class);</span>
<span class="fc" id="L287">    }</span>

    @Test(expected = NullPointerException.class)
    public void deferNull() {
<span class="nc" id="L291">        Maybe.defer(null);</span>
<span class="nc" id="L292">    }</span>

    @Test
    public void deferThrows() {
<span class="fc" id="L296">        Maybe.defer(new Callable&lt;Maybe&lt;Integer&gt;&gt;() {</span>
            @Override
            public Maybe&lt;Integer&gt; call() throws Exception {
<span class="fc" id="L299">                throw new TestException();</span>
            }
        })
<span class="fc" id="L302">        .test()</span>
<span class="fc" id="L303">        .assertFailure(TestException.class);</span>
<span class="fc" id="L304">    }</span>

    @Test
    public void deferReturnsNull() {
<span class="fc" id="L308">        Maybe.defer(new Callable&lt;Maybe&lt;Integer&gt;&gt;() {</span>
            @Override
            public Maybe&lt;Integer&gt; call() throws Exception {
<span class="fc" id="L311">                return null;</span>
            }
        })
<span class="fc" id="L314">        .test()</span>
<span class="fc" id="L315">        .assertFailure(NullPointerException.class);</span>
<span class="fc" id="L316">    }</span>

    @Test
    public void defer() {
<span class="fc" id="L320">        Maybe&lt;Integer&gt; source = Maybe.defer(new Callable&lt;Maybe&lt;Integer&gt;&gt;() {</span>
            int count;
            @Override
            public Maybe&lt;Integer&gt; call() throws Exception {
<span class="fc" id="L324">                return Maybe.just(count++);</span>
            }
        });

<span class="fc bfc" id="L328" title="All 2 branches covered.">        for (int i = 0; i &lt; 128; i++) {</span>
<span class="fc" id="L329">            source.test().assertResult(i);</span>
        }
<span class="fc" id="L331">    }</span>

    @Test
    public void flowableMaybeFlowable() {
<span class="fc" id="L335">        Flowable.just(1).singleElement().toFlowable().test().assertResult(1);</span>
<span class="fc" id="L336">    }</span>

    @Test
    public void obervableMaybeobervable() {
<span class="fc" id="L340">        Observable.just(1).singleElement().toObservable().test().assertResult(1);</span>
<span class="fc" id="L341">    }</span>

    @Test
    public void singleMaybeSingle() {
<span class="fc" id="L345">        Single.just(1).toMaybe().toSingle().test().assertResult(1);</span>
<span class="fc" id="L346">    }</span>

    @Test
    public void completableMaybeCompletable() {
<span class="fc" id="L350">        Completable.complete().toMaybe().ignoreElement().test().assertResult();</span>
<span class="fc" id="L351">    }</span>

    @Test
    public void unsafeCreate() {
<span class="fc" id="L355">        Maybe.unsafeCreate(new MaybeSource&lt;Integer&gt;() {</span>
            @Override
            public void subscribe(MaybeObserver&lt;? super Integer&gt; observer) {
<span class="fc" id="L358">                observer.onSubscribe(Disposables.empty());</span>
<span class="fc" id="L359">                observer.onSuccess(1);</span>
<span class="fc" id="L360">            }</span>
        })
<span class="fc" id="L362">        .test()</span>
<span class="fc" id="L363">        .assertResult(1);</span>
<span class="fc" id="L364">    }</span>

    @Test(expected = NullPointerException.class)
    public void unsafeCreateNull() {
<span class="nc" id="L368">        Maybe.unsafeCreate(null);</span>
<span class="nc" id="L369">    }</span>

    @Test
    public void to() {
<span class="fc" id="L373">        Maybe.just(1).to(new Function&lt;Maybe&lt;Integer&gt;, Flowable&lt;Integer&gt;&gt;() {</span>
            @Override
            public Flowable&lt;Integer&gt; apply(Maybe&lt;Integer&gt; v) throws Exception {
<span class="fc" id="L376">                return v.toFlowable();</span>
            }
        })
<span class="fc" id="L379">        .test()</span>
<span class="fc" id="L380">        .assertResult(1);</span>
<span class="fc" id="L381">    }</span>

    @Test
    public void as() {
<span class="fc" id="L385">        Maybe.just(1).as(new MaybeConverter&lt;Integer, Flowable&lt;Integer&gt;&gt;() {</span>
            @Override
            public Flowable&lt;Integer&gt; apply(Maybe&lt;Integer&gt; v) {
<span class="fc" id="L388">                return v.toFlowable();</span>
            }
        })
<span class="fc" id="L391">        .test()</span>
<span class="fc" id="L392">        .assertResult(1);</span>
<span class="fc" id="L393">    }</span>

    @Test(expected = NullPointerException.class)
    public void toNull() {
<span class="nc" id="L397">        Maybe.just(1).to(null);</span>
<span class="nc" id="L398">    }</span>

    @Test(expected = NullPointerException.class)
    public void asNull() {
<span class="nc" id="L402">        Maybe.just(1).as(null);</span>
<span class="nc" id="L403">    }</span>

    @Test
    public void compose() {
<span class="fc" id="L407">        Maybe.just(1).compose(new MaybeTransformer&lt;Integer, Integer&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Maybe&lt;Integer&gt; m) {
<span class="fc" id="L410">                return m.map(new Function&lt;Integer, Integer&gt;() {</span>
                    @Override
                    public Integer apply(Integer w) throws Exception {
<span class="fc" id="L413">                        return w + 1;</span>
                    }
                });
            }
        })
<span class="fc" id="L418">        .test()</span>
<span class="fc" id="L419">        .assertResult(2);</span>
<span class="fc" id="L420">    }</span>

    @Test(expected = NullPointerException.class)
    public void composeNull() {
<span class="nc" id="L424">        Maybe.just(1).compose(null);</span>
<span class="nc" id="L425">    }</span>

    @Test(expected = NullPointerException.class)
    public void mapNull() {
<span class="nc" id="L429">        Maybe.just(1).map(null);</span>
<span class="nc" id="L430">    }</span>

    @Test
    public void mapReturnNull() {
<span class="fc" id="L434">        Maybe.just(1).map(new Function&lt;Integer, Object&gt;() {</span>
            @Override
            public Object apply(Integer v) throws Exception {
<span class="fc" id="L437">                return null;</span>
            }
<span class="fc" id="L439">        }).test().assertFailure(NullPointerException.class);</span>
<span class="fc" id="L440">    }</span>

    @Test
    public void mapThrows() {
<span class="fc" id="L444">        Maybe.just(1).map(new Function&lt;Integer, Object&gt;() {</span>
            @Override
            public Object apply(Integer v) throws Exception {
<span class="fc" id="L447">                throw new IOException();</span>
            }
<span class="fc" id="L449">        }).test().assertFailure(IOException.class);</span>
<span class="fc" id="L450">    }</span>

    @Test
    public void map() {
<span class="fc" id="L454">        Maybe.just(1).map(new Function&lt;Integer, String&gt;() {</span>
            @Override
            public String apply(Integer v) throws Exception {
<span class="fc" id="L457">                return v.toString();</span>
            }
<span class="fc" id="L459">        }).test().assertResult(&quot;1&quot;);</span>
<span class="fc" id="L460">    }</span>

    @Test(expected = NullPointerException.class)
    public void filterNull() {
<span class="nc" id="L464">        Maybe.just(1).filter(null);</span>
<span class="nc" id="L465">    }</span>

    @Test
    public void filterThrows() {
<span class="fc" id="L469">        Maybe.just(1).filter(new Predicate&lt;Integer&gt;() {</span>
            @Override
            public boolean test(Integer v) throws Exception {
<span class="fc" id="L472">                throw new IOException();</span>
            }
<span class="fc" id="L474">        }).test().assertFailure(IOException.class);</span>
<span class="fc" id="L475">    }</span>

    @Test
    public void filterTrue() {
<span class="fc" id="L479">        Maybe.just(1).filter(new Predicate&lt;Integer&gt;() {</span>
            @Override
            public boolean test(Integer v) throws Exception {
<span class="pc bpc" id="L482" title="1 of 2 branches missed.">                return v == 1;</span>
            }
<span class="fc" id="L484">        }).test().assertResult(1);</span>
<span class="fc" id="L485">    }</span>

    @Test
    public void filterFalse() {
<span class="fc" id="L489">        Maybe.just(2).filter(new Predicate&lt;Integer&gt;() {</span>
            @Override
            public boolean test(Integer v) throws Exception {
<span class="pc bpc" id="L492" title="1 of 2 branches missed.">                return v == 1;</span>
            }
<span class="fc" id="L494">        }).test().assertResult();</span>
<span class="fc" id="L495">    }</span>

    @Test
    public void filterEmpty() {
<span class="fc" id="L499">        Maybe.&lt;Integer&gt;empty().filter(new Predicate&lt;Integer&gt;() {</span>
            @Override
            public boolean test(Integer v) throws Exception {
<span class="nc bnc" id="L502" title="All 2 branches missed.">                return v == 1;</span>
            }
<span class="fc" id="L504">        }).test().assertResult();</span>
<span class="fc" id="L505">    }</span>

    @Test(expected = NullPointerException.class)
    public void singleFilterNull() {
<span class="nc" id="L509">        Single.just(1).filter(null);</span>
<span class="nc" id="L510">    }</span>

    @Test
    public void singleFilterThrows() {
<span class="fc" id="L514">        Single.just(1).filter(new Predicate&lt;Integer&gt;() {</span>
            @Override
            public boolean test(Integer v) throws Exception {
<span class="fc" id="L517">                throw new IOException();</span>
            }
<span class="fc" id="L519">        }).test().assertFailure(IOException.class);</span>
<span class="fc" id="L520">    }</span>

    @Test
    public void singleFilterTrue() {
<span class="fc" id="L524">        Single.just(1).filter(new Predicate&lt;Integer&gt;() {</span>
            @Override
            public boolean test(Integer v) throws Exception {
<span class="pc bpc" id="L527" title="1 of 2 branches missed.">                return v == 1;</span>
            }
<span class="fc" id="L529">        }).test().assertResult(1);</span>
<span class="fc" id="L530">    }</span>

    @Test
    public void singleFilterFalse() {
<span class="fc" id="L534">        Single.just(2).filter(new Predicate&lt;Integer&gt;() {</span>
            @Override
            public boolean test(Integer v) throws Exception {
<span class="pc bpc" id="L537" title="1 of 2 branches missed.">                return v == 1;</span>
            }
<span class="fc" id="L539">        }).test().assertResult();</span>
<span class="fc" id="L540">    }</span>

    @Test
    public void cast() {
<span class="fc" id="L544">        TestObserver&lt;Number&gt; to = Maybe.just(1).cast(Number.class).test();</span>
        // don'n inline this due to the generic type
<span class="fc" id="L546">        to.assertResult((Number)1);</span>
<span class="fc" id="L547">    }</span>

    @Test(expected = NullPointerException.class)
    public void observeOnNull() {
<span class="nc" id="L551">        Maybe.just(1).observeOn(null);</span>
<span class="nc" id="L552">    }</span>

    @Test(expected = NullPointerException.class)
    public void subscribeOnNull() {
<span class="nc" id="L556">        Maybe.just(1).observeOn(null);</span>
<span class="nc" id="L557">    }</span>

    @Test
    public void observeOnSuccess() {
<span class="fc" id="L561">        String main = Thread.currentThread().getName();</span>
<span class="fc" id="L562">        Maybe.just(1)</span>
<span class="fc" id="L563">        .observeOn(Schedulers.single())</span>
<span class="fc" id="L564">        .map(new Function&lt;Integer, String&gt;() {</span>
            @Override
            public String apply(Integer v) throws Exception {
<span class="fc" id="L567">                return v + &quot;: &quot; + Thread.currentThread().getName();</span>
            }
        })
<span class="fc" id="L570">        .test()</span>
<span class="fc" id="L571">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L572">        .assertOf(TestHelper.observerSingleNot(&quot;1: &quot; + main))</span>
        ;
<span class="fc" id="L574">    }</span>

    @Test
    public void observeOnError() {
<span class="fc" id="L578">        Maybe.error(new TestException())</span>
<span class="fc" id="L579">        .observeOn(Schedulers.single())</span>
<span class="fc" id="L580">        .test()</span>
<span class="fc" id="L581">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L582">        .assertFailure(TestException.class)</span>
        ;
<span class="fc" id="L584">    }</span>

    @Test
    public void observeOnComplete() {
<span class="fc" id="L588">        Maybe.empty()</span>
<span class="fc" id="L589">        .observeOn(Schedulers.single())</span>
<span class="fc" id="L590">        .test()</span>
<span class="fc" id="L591">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L592">        .assertResult()</span>
        ;
<span class="fc" id="L594">    }</span>

    @Test
    public void observeOnDispose2() {
<span class="fc" id="L598">        TestHelper.checkDisposed(Maybe.empty().observeOn(Schedulers.single()));</span>
<span class="fc" id="L599">    }</span>

    @Test
    public void observeOnDoubleSubscribe() {
<span class="fc" id="L603">        TestHelper.checkDoubleOnSubscribeMaybe(new Function&lt;Maybe&lt;Object&gt;, MaybeSource&lt;Object&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Object&gt; apply(Maybe&lt;Object&gt; m) throws Exception {
<span class="fc" id="L606">                return m.observeOn(Schedulers.single());</span>
            }
        });
<span class="fc" id="L609">    }</span>

    @Test
    public void subscribeOnSuccess() {
<span class="fc" id="L613">        String main = Thread.currentThread().getName();</span>
<span class="fc" id="L614">        Maybe.fromCallable(new Callable&lt;String&gt;() {</span>
            @Override
            public String call() throws Exception {
<span class="fc" id="L617">                return Thread.currentThread().getName();</span>
            }
        })
<span class="fc" id="L620">        .subscribeOn(Schedulers.single())</span>
<span class="fc" id="L621">        .test()</span>
<span class="fc" id="L622">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L623">        .assertOf(TestHelper.observerSingleNot(main))</span>
        ;
<span class="fc" id="L625">    }</span>

    @Test
    public void observeOnErrorThread() {
<span class="fc" id="L629">        String main = Thread.currentThread().getName();</span>

<span class="fc" id="L631">        final String[] name = { null };</span>

<span class="fc" id="L633">        Maybe.error(new TestException()).observeOn(Schedulers.single())</span>
<span class="fc" id="L634">        .doOnError(new Consumer&lt;Throwable&gt;() {</span>
            @Override
            public void accept(Throwable e) throws Exception {
<span class="fc" id="L637">                name[0] = Thread.currentThread().getName();</span>
<span class="fc" id="L638">            }</span>
        })
<span class="fc" id="L640">        .test()</span>
<span class="fc" id="L641">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L642">        .assertFailure(TestException.class)</span>
        ;

<span class="fc" id="L645">        assertNotEquals(main, name[0]);</span>
<span class="fc" id="L646">    }</span>

    @Test
    public void observeOnCompleteThread() {
<span class="fc" id="L650">        String main = Thread.currentThread().getName();</span>

<span class="fc" id="L652">        final String[] name = { null };</span>

<span class="fc" id="L654">        Maybe.empty().observeOn(Schedulers.single())</span>
<span class="fc" id="L655">        .doOnComplete(new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="fc" id="L658">                name[0] = Thread.currentThread().getName();</span>
<span class="fc" id="L659">            }</span>
        })
<span class="fc" id="L661">        .test()</span>
<span class="fc" id="L662">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L663">        .assertResult()</span>
        ;

<span class="fc" id="L666">        assertNotEquals(main, name[0]);</span>
<span class="fc" id="L667">    }</span>

    @Test
    public void subscribeOnError() {
<span class="fc" id="L671">        Maybe.error(new TestException())</span>
<span class="fc" id="L672">        .subscribeOn(Schedulers.single())</span>
<span class="fc" id="L673">        .test()</span>
<span class="fc" id="L674">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L675">        .assertFailure(TestException.class)</span>
        ;
<span class="fc" id="L677">    }</span>

    @Test
    public void subscribeOnComplete() {
<span class="fc" id="L681">        Maybe.empty()</span>
<span class="fc" id="L682">        .subscribeOn(Schedulers.single())</span>
<span class="fc" id="L683">        .test()</span>
<span class="fc" id="L684">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L685">        .assertResult()</span>
        ;
<span class="fc" id="L687">    }</span>

    @Test
    public void fromAction() {
<span class="fc" id="L691">        final int[] call = { 0 };</span>

<span class="fc" id="L693">        Maybe.fromAction(new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="fc" id="L696">                call[0]++;</span>
<span class="fc" id="L697">            }</span>
        })
<span class="fc" id="L699">        .test()</span>
<span class="fc" id="L700">        .assertResult();</span>

<span class="fc" id="L702">        assertEquals(1, call[0]);</span>
<span class="fc" id="L703">    }</span>

    @Test
    public void fromActionThrows() {
<span class="fc" id="L707">        Maybe.fromAction(new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="fc" id="L710">                throw new TestException();</span>
            }
        })
<span class="fc" id="L713">        .test()</span>
<span class="fc" id="L714">        .assertFailure(TestException.class);</span>
<span class="fc" id="L715">    }</span>

    @Test
    public void fromRunnable() {
<span class="fc" id="L719">        final int[] call = { 0 };</span>

<span class="fc" id="L721">        Maybe.fromRunnable(new Runnable() {</span>
            @Override
            public void run() {
<span class="fc" id="L724">                call[0]++;</span>
<span class="fc" id="L725">            }</span>
        })
<span class="fc" id="L727">        .test()</span>
<span class="fc" id="L728">        .assertResult();</span>

<span class="fc" id="L730">        assertEquals(1, call[0]);</span>
<span class="fc" id="L731">    }</span>

    @Test
    public void fromRunnableThrows() {
<span class="fc" id="L735">        Maybe.fromRunnable(new Runnable() {</span>
            @Override
            public void run() {
<span class="fc" id="L738">                throw new TestException();</span>
            }
        })
<span class="fc" id="L741">        .test()</span>
<span class="fc" id="L742">        .assertFailure(TestException.class);</span>
<span class="fc" id="L743">    }</span>

    @Test
    public void fromCallableThrows() {
<span class="fc" id="L747">        Maybe.fromCallable(new Callable&lt;Object&gt;() {</span>
            @Override
            public Object call() throws Exception {
<span class="fc" id="L750">                throw new TestException();</span>
            }
        })
<span class="fc" id="L753">        .test()</span>
<span class="fc" id="L754">        .assertFailure(TestException.class);</span>
<span class="fc" id="L755">    }</span>

    @Test
    public void doOnSuccess() {
<span class="fc" id="L759">        final Integer[] value = { null };</span>

<span class="fc" id="L761">        Maybe.just(1).doOnSuccess(new Consumer&lt;Integer&gt;() {</span>
            @Override
            public void accept(Integer v) throws Exception {
<span class="fc" id="L764">                value[0] = v;</span>
<span class="fc" id="L765">            }</span>
        })
<span class="fc" id="L767">        .test()</span>
<span class="fc" id="L768">        .assertResult(1);</span>

<span class="fc" id="L770">        assertEquals(1, value[0].intValue());</span>
<span class="fc" id="L771">    }</span>

    @Test
    public void doOnSuccessEmpty() {
<span class="fc" id="L775">        final Integer[] value = { null };</span>

<span class="fc" id="L777">        Maybe.&lt;Integer&gt;empty().doOnSuccess(new Consumer&lt;Integer&gt;() {</span>
            @Override
            public void accept(Integer v) throws Exception {
<span class="nc" id="L780">                value[0] = v;</span>
<span class="nc" id="L781">            }</span>
        })
<span class="fc" id="L783">        .test()</span>
<span class="fc" id="L784">        .assertResult();</span>

<span class="fc" id="L786">        assertNull(value[0]);</span>
<span class="fc" id="L787">    }</span>

    @Test
    public void doOnSuccessThrows() {
<span class="fc" id="L791">        Maybe.just(1).doOnSuccess(new Consumer&lt;Integer&gt;() {</span>
            @Override
            public void accept(Integer v) throws Exception {
<span class="fc" id="L794">                throw new TestException();</span>
            }
        })
<span class="fc" id="L797">        .test()</span>
<span class="fc" id="L798">        .assertFailure(TestException.class);</span>
<span class="fc" id="L799">    }</span>

    @Test
    public void doOnSubscribe() {
<span class="fc" id="L803">        final Disposable[] value = { null };</span>

<span class="fc" id="L805">        Maybe.just(1).doOnSubscribe(new Consumer&lt;Disposable&gt;() {</span>
            @Override
            public void accept(Disposable v) throws Exception {
<span class="fc" id="L808">                value[0] = v;</span>
<span class="fc" id="L809">            }</span>
        })
<span class="fc" id="L811">        .test()</span>
<span class="fc" id="L812">        .assertResult(1);</span>

<span class="fc" id="L814">        assertNotNull(value[0]);</span>
<span class="fc" id="L815">    }</span>

    @Test
    public void doOnSubscribeThrows() {
<span class="fc" id="L819">        Maybe.just(1).doOnSubscribe(new Consumer&lt;Disposable&gt;() {</span>
            @Override
            public void accept(Disposable v) throws Exception {
<span class="fc" id="L822">                throw new TestException();</span>
            }
        })
<span class="fc" id="L825">        .test()</span>
<span class="fc" id="L826">        .assertFailure(TestException.class);</span>
<span class="fc" id="L827">    }</span>

    @Test
    public void doOnCompleteThrows() {
<span class="fc" id="L831">        Maybe.empty().doOnComplete(new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="fc" id="L834">                throw new TestException();</span>
            }
        })
<span class="fc" id="L837">        .test()</span>
<span class="fc" id="L838">        .assertFailure(TestException.class);</span>
<span class="fc" id="L839">    }</span>

    @Test
    public void doOnDispose() {
<span class="fc" id="L843">        final int[] call = { 0 };</span>

<span class="fc" id="L845">        Maybe.just(1).doOnDispose(new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="fc" id="L848">                call[0]++;</span>
<span class="fc" id="L849">            }</span>
        })
<span class="fc" id="L851">        .test(true)</span>
<span class="fc" id="L852">        .assertSubscribed()</span>
<span class="fc" id="L853">        .assertNoValues()</span>
<span class="fc" id="L854">        .assertNoErrors()</span>
<span class="fc" id="L855">        .assertNotComplete();</span>

<span class="fc" id="L857">        assertEquals(1, call[0]);</span>
<span class="fc" id="L858">    }</span>

    @Test
    public void doOnDisposeThrows() {
<span class="fc" id="L862">        List&lt;Throwable&gt; list = TestHelper.trackPluginErrors();</span>

        try {
<span class="fc" id="L865">            PublishProcessor&lt;Integer&gt; pp = PublishProcessor.create();</span>

<span class="fc" id="L867">            TestObserver&lt;Integer&gt; to = pp.singleElement().doOnDispose(new Action() {</span>
                @Override
                public void run() throws Exception {
<span class="fc" id="L870">                    throw new TestException();</span>
                }
            })
<span class="fc" id="L873">            .test();</span>

<span class="fc" id="L875">            assertTrue(pp.hasSubscribers());</span>

<span class="fc" id="L877">            to.cancel();</span>

<span class="fc" id="L879">            assertFalse(pp.hasSubscribers());</span>

<span class="fc" id="L881">            to.assertSubscribed()</span>
<span class="fc" id="L882">            .assertNoValues()</span>
<span class="fc" id="L883">            .assertNoErrors()</span>
<span class="fc" id="L884">            .assertNotComplete();</span>

<span class="fc" id="L886">            TestHelper.assertUndeliverable(list, 0, TestException.class);</span>
        } finally {
<span class="fc" id="L888">            RxJavaPlugins.reset();</span>
        }
<span class="fc" id="L890">    }</span>

    @Test
    public void observeOnDispose() throws Exception {
<span class="fc" id="L894">        final TestSubscriber&lt;Integer&gt; ts = new TestSubscriber&lt;Integer&gt;();</span>

<span class="fc" id="L896">        final CountDownLatch cdl = new CountDownLatch(1);</span>

<span class="fc" id="L898">        Maybe.just(1)</span>
<span class="fc" id="L899">        .observeOn(Schedulers.single())</span>
<span class="fc" id="L900">        .doOnSuccess(new Consumer&lt;Integer&gt;() {</span>
            @Override
            public void accept(Integer v) throws Exception {
<span class="nc bnc" id="L903" title="All 2 branches missed.">                if (!cdl.await(5, TimeUnit.SECONDS)) {</span>
<span class="nc" id="L904">                    throw new TimeoutException();</span>
                }
<span class="nc" id="L906">            }</span>
        })
<span class="fc" id="L908">        .toFlowable().subscribe(ts);</span>

<span class="fc" id="L910">        Thread.sleep(250);</span>

<span class="fc" id="L912">        ts.cancel();</span>

<span class="fc" id="L914">        ts.awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L915">        .assertFailure(InterruptedException.class);</span>
<span class="fc" id="L916">    }</span>

    @Test
    public void doAfterTerminateSuccess() {
<span class="fc" id="L920">        final int[] call = { 0 };</span>

<span class="fc" id="L922">        Maybe.just(1)</span>
<span class="fc" id="L923">        .doOnSuccess(new Consumer&lt;Integer&gt;() {</span>
            @Override
            public void accept(Integer v) throws Exception {
<span class="fc" id="L926">                call[0]++;</span>
<span class="fc" id="L927">            }</span>
        })
<span class="fc" id="L929">        .doAfterTerminate(new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="pc bpc" id="L932" title="1 of 2 branches missed.">                if (call[0] == 1) {</span>
<span class="fc" id="L933">                    call[0] = -1;</span>
                }
<span class="fc" id="L935">            }</span>
        })
<span class="fc" id="L937">        .test()</span>
<span class="fc" id="L938">        .assertResult(1);</span>

<span class="fc" id="L940">        assertEquals(-1, call[0]);</span>
<span class="fc" id="L941">    }</span>

    @Test
    public void doAfterTerminateError() {
<span class="fc" id="L945">        final int[] call = { 0 };</span>

<span class="fc" id="L947">        Maybe.error(new TestException())</span>
<span class="fc" id="L948">        .doOnError(new Consumer&lt;Object&gt;() {</span>
            @Override
            public void accept(Object v) throws Exception {
<span class="fc" id="L951">                call[0]++;</span>
<span class="fc" id="L952">            }</span>
        })
<span class="fc" id="L954">        .doAfterTerminate(new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="pc bpc" id="L957" title="1 of 2 branches missed.">                if (call[0] == 1) {</span>
<span class="fc" id="L958">                    call[0] = -1;</span>
                }
<span class="fc" id="L960">            }</span>
        })
<span class="fc" id="L962">        .test()</span>
<span class="fc" id="L963">        .assertFailure(TestException.class);</span>

<span class="fc" id="L965">        assertEquals(-1, call[0]);</span>
<span class="fc" id="L966">    }</span>

    @Test
    public void doAfterTerminateComplete() {
<span class="fc" id="L970">        final int[] call = { 0 };</span>

<span class="fc" id="L972">        Maybe.empty()</span>
<span class="fc" id="L973">        .doOnComplete(new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="fc" id="L976">                call[0]++;</span>
<span class="fc" id="L977">            }</span>
        })
<span class="fc" id="L979">        .doAfterTerminate(new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="pc bpc" id="L982" title="1 of 2 branches missed.">                if (call[0] == 1) {</span>
<span class="fc" id="L983">                    call[0] = -1;</span>
                }
<span class="fc" id="L985">            }</span>
        })
<span class="fc" id="L987">        .test()</span>
<span class="fc" id="L988">        .assertResult();</span>

<span class="fc" id="L990">        assertEquals(-1, call[0]);</span>
<span class="fc" id="L991">    }</span>

    @Test
    public void sourceThrowsNPE() {
        try {
<span class="fc" id="L996">            Maybe.unsafeCreate(new MaybeSource&lt;Object&gt;() {</span>
                @Override
                public void subscribe(MaybeObserver&lt;? super Object&gt; observer) {
<span class="fc" id="L999">                    throw new NullPointerException(&quot;Forced failure&quot;);</span>
                }
<span class="nc" id="L1001">            }).test();</span>

<span class="nc" id="L1003">            fail(&quot;Should have thrown!&quot;);</span>
<span class="fc" id="L1004">        } catch (NullPointerException ex) {</span>
<span class="fc" id="L1005">            assertEquals(&quot;Forced failure&quot;, ex.getMessage());</span>
<span class="nc" id="L1006">        }</span>
<span class="fc" id="L1007">    }</span>

    @Test
    public void sourceThrowsIAE() {
        try {
<span class="fc" id="L1012">            Maybe.unsafeCreate(new MaybeSource&lt;Object&gt;() {</span>
                @Override
                public void subscribe(MaybeObserver&lt;? super Object&gt; observer) {
<span class="fc" id="L1015">                    throw new IllegalArgumentException(&quot;Forced failure&quot;);</span>
                }
<span class="nc" id="L1017">            }).test();</span>

<span class="nc" id="L1019">            fail(&quot;Should have thrown!&quot;);</span>
<span class="fc" id="L1020">        } catch (NullPointerException ex) {</span>
<span class="fc" id="L1021">            assertTrue(ex.toString(), ex.getCause() instanceof IllegalArgumentException);</span>
<span class="fc" id="L1022">            assertEquals(&quot;Forced failure&quot;, ex.getCause().getMessage());</span>
<span class="nc" id="L1023">        }</span>
<span class="fc" id="L1024">    }</span>

    @Test
    public void flatMap() {
<span class="fc" id="L1028">        Maybe.just(1).flatMap(new Function&lt;Integer, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L1031">                return Maybe.just(v * 10);</span>
            }
        })
<span class="fc" id="L1034">        .test()</span>
<span class="fc" id="L1035">        .assertResult(10);</span>
<span class="fc" id="L1036">    }</span>

    @Test
    public void concatMap() {
<span class="fc" id="L1040">        Maybe.just(1).concatMap(new Function&lt;Integer, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L1043">                return Maybe.just(v * 10);</span>
            }
        })
<span class="fc" id="L1046">        .test()</span>
<span class="fc" id="L1047">        .assertResult(10);</span>
<span class="fc" id="L1048">    }</span>

    @Test
    public void flatMapEmpty() {
<span class="fc" id="L1052">        Maybe.just(1).flatMap(new Function&lt;Integer, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L1055">                return Maybe.empty();</span>
            }
        })
<span class="fc" id="L1058">        .test()</span>
<span class="fc" id="L1059">        .assertResult();</span>
<span class="fc" id="L1060">    }</span>

    @Test
    public void flatMapError() {
<span class="fc" id="L1064">        Maybe.just(1).flatMap(new Function&lt;Integer, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L1067">                return Maybe.error(new TestException());</span>
            }
        })
<span class="fc" id="L1070">        .test()</span>
<span class="fc" id="L1071">        .assertFailure(TestException.class);</span>
<span class="fc" id="L1072">    }</span>

    @Test
    public void flatMapNotifySuccess() {
<span class="fc" id="L1076">        Maybe.just(1)</span>
<span class="fc" id="L1077">        .flatMap(new Function&lt;Integer, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L1080">                return Maybe.just(v * 10);</span>
            }
        },
<span class="fc" id="L1083">        new Function&lt;Throwable, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Throwable v) throws Exception {
<span class="nc" id="L1086">                return Maybe.just(100);</span>
            }
        },

<span class="fc" id="L1090">        new Callable&lt;MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; call() throws Exception {
<span class="nc" id="L1093">                return Maybe.just(200);</span>
            }
        })
<span class="fc" id="L1096">        .test()</span>
<span class="fc" id="L1097">        .assertResult(10);</span>
<span class="fc" id="L1098">    }</span>

    @Test
    public void flatMapNotifyError() {
<span class="fc" id="L1102">        Maybe.&lt;Integer&gt;error(new TestException())</span>
<span class="fc" id="L1103">        .flatMap(new Function&lt;Integer, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="nc" id="L1106">                return Maybe.just(v * 10);</span>
            }
        },
<span class="fc" id="L1109">        new Function&lt;Throwable, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Throwable v) throws Exception {
<span class="fc" id="L1112">                return Maybe.just(100);</span>
            }
        },

<span class="fc" id="L1116">        new Callable&lt;MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; call() throws Exception {
<span class="nc" id="L1119">                return Maybe.just(200);</span>
            }
        })
<span class="fc" id="L1122">        .test()</span>
<span class="fc" id="L1123">        .assertResult(100);</span>
<span class="fc" id="L1124">    }</span>

    @Test
    public void flatMapNotifyComplete() {
<span class="fc" id="L1128">        Maybe.&lt;Integer&gt;empty()</span>
<span class="fc" id="L1129">        .flatMap(new Function&lt;Integer, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="nc" id="L1132">                return Maybe.just(v * 10);</span>
            }
        },
<span class="fc" id="L1135">        new Function&lt;Throwable, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Throwable v) throws Exception {
<span class="nc" id="L1138">                return Maybe.just(100);</span>
            }
        },

<span class="fc" id="L1142">        new Callable&lt;MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; call() throws Exception {
<span class="fc" id="L1145">                return Maybe.just(200);</span>
            }
        })
<span class="fc" id="L1148">        .test()</span>
<span class="fc" id="L1149">        .assertResult(200);</span>
<span class="fc" id="L1150">    }</span>

    @Test
    public void ignoreElementSuccess() {
<span class="fc" id="L1154">        Maybe.just(1)</span>
<span class="fc" id="L1155">        .ignoreElement()</span>
<span class="fc" id="L1156">        .test()</span>
<span class="fc" id="L1157">        .assertResult();</span>
<span class="fc" id="L1158">    }</span>

    @Test
    public void ignoreElementError() {
<span class="fc" id="L1162">        Maybe.error(new TestException())</span>
<span class="fc" id="L1163">        .ignoreElement()</span>
<span class="fc" id="L1164">        .test()</span>
<span class="fc" id="L1165">        .assertFailure(TestException.class);</span>
<span class="fc" id="L1166">    }</span>

    @Test
    public void ignoreElementComplete() {
<span class="fc" id="L1170">        Maybe.empty()</span>
<span class="fc" id="L1171">        .ignoreElement()</span>
<span class="fc" id="L1172">        .test()</span>
<span class="fc" id="L1173">        .assertResult();</span>
<span class="fc" id="L1174">    }</span>

    @Test
    public void ignoreElementSuccessMaybe() {
<span class="fc" id="L1178">        Maybe.just(1)</span>
<span class="fc" id="L1179">        .ignoreElement()</span>
<span class="fc" id="L1180">        .toMaybe()</span>
<span class="fc" id="L1181">        .test()</span>
<span class="fc" id="L1182">        .assertResult();</span>
<span class="fc" id="L1183">    }</span>

    @Test
    public void ignoreElementErrorMaybe() {
<span class="fc" id="L1187">        Maybe.error(new TestException())</span>
<span class="fc" id="L1188">        .ignoreElement()</span>
<span class="fc" id="L1189">        .toMaybe()</span>
<span class="fc" id="L1190">        .test()</span>
<span class="fc" id="L1191">        .assertFailure(TestException.class);</span>
<span class="fc" id="L1192">    }</span>

    @Test
    public void ignoreElementCompleteMaybe() {
<span class="fc" id="L1196">        Maybe.empty()</span>
<span class="fc" id="L1197">        .ignoreElement()</span>
<span class="fc" id="L1198">        .toMaybe()</span>
<span class="fc" id="L1199">        .test()</span>
<span class="fc" id="L1200">        .assertResult();</span>
<span class="fc" id="L1201">    }</span>

    @Test
    public void singleToMaybe() {
<span class="fc" id="L1205">        Single.just(1)</span>
<span class="fc" id="L1206">        .toMaybe()</span>
<span class="fc" id="L1207">        .test()</span>
<span class="fc" id="L1208">        .assertResult(1);</span>
<span class="fc" id="L1209">    }</span>

    @Test
    public void singleToMaybeError() {
<span class="fc" id="L1213">        Single.error(new TestException())</span>
<span class="fc" id="L1214">        .toMaybe()</span>
<span class="fc" id="L1215">        .test()</span>
<span class="fc" id="L1216">        .assertFailure(TestException.class);</span>
<span class="fc" id="L1217">    }</span>

    @Test
    public void completableToMaybe() {
<span class="fc" id="L1221">        Completable.complete()</span>
<span class="fc" id="L1222">        .toMaybe()</span>
<span class="fc" id="L1223">        .test()</span>
<span class="fc" id="L1224">        .assertResult();</span>
<span class="fc" id="L1225">    }</span>

    @Test
    public void completableToMaybeError() {
<span class="fc" id="L1229">        Completable.error(new TestException())</span>
<span class="fc" id="L1230">        .toMaybe()</span>
<span class="fc" id="L1231">        .test()</span>
<span class="fc" id="L1232">        .assertFailure(TestException.class);</span>
<span class="fc" id="L1233">    }</span>

    @Test
    public void emptyToSingle() {
<span class="fc" id="L1237">        Maybe.empty()</span>
<span class="fc" id="L1238">        .toSingle()</span>
<span class="fc" id="L1239">        .test()</span>
<span class="fc" id="L1240">        .assertFailure(NoSuchElementException.class);</span>
<span class="fc" id="L1241">    }</span>

    @Test
    public void errorToSingle() {
<span class="fc" id="L1245">        Maybe.error(new TestException())</span>
<span class="fc" id="L1246">        .toSingle()</span>
<span class="fc" id="L1247">        .test()</span>
<span class="fc" id="L1248">        .assertFailure(TestException.class);</span>
<span class="fc" id="L1249">    }</span>

    @Test
    public void emptyToCompletable() {
<span class="fc" id="L1253">        Maybe.empty()</span>
<span class="fc" id="L1254">        .ignoreElement()</span>
<span class="fc" id="L1255">        .test()</span>
<span class="fc" id="L1256">        .assertResult();</span>
<span class="fc" id="L1257">    }</span>

    @Test
    public void errorToCompletable() {
<span class="fc" id="L1261">        Maybe.error(new TestException())</span>
<span class="fc" id="L1262">        .ignoreElement()</span>
<span class="fc" id="L1263">        .test()</span>
<span class="fc" id="L1264">        .assertFailure(TestException.class);</span>
<span class="fc" id="L1265">    }</span>

    @Test
    public void concat2() {
<span class="fc" id="L1269">        Maybe.concat(Maybe.just(1), Maybe.just(2))</span>
<span class="fc" id="L1270">        .test()</span>
<span class="fc" id="L1271">        .assertResult(1, 2);</span>
<span class="fc" id="L1272">    }</span>

    @Test
    public void concat2Empty() {
<span class="fc" id="L1276">        Maybe.concat(Maybe.empty(), Maybe.empty())</span>
<span class="fc" id="L1277">        .test()</span>
<span class="fc" id="L1278">        .assertResult();</span>
<span class="fc" id="L1279">    }</span>

    @Test
    public void concat2Backpressured() {
<span class="fc" id="L1283">        TestSubscriber&lt;Integer&gt; ts = Maybe.concat(Maybe.just(1), Maybe.just(2))</span>
<span class="fc" id="L1284">        .test(0L);</span>

<span class="fc" id="L1286">        ts.assertEmpty();</span>

<span class="fc" id="L1288">        ts.request(1);</span>

<span class="fc" id="L1290">        ts.assertValue(1);</span>

<span class="fc" id="L1292">        ts.request(1);</span>

<span class="fc" id="L1294">        ts.assertResult(1, 2);</span>
<span class="fc" id="L1295">    }</span>

    @Test
    public void concat2BackpressuredNonEager() {
<span class="fc" id="L1299">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1300">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1302">        TestSubscriber&lt;Integer&gt; ts = Maybe.concat(pp1.singleElement(), pp2.singleElement())</span>
<span class="fc" id="L1303">        .test(0L);</span>

<span class="fc" id="L1305">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1306">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1308">        ts.assertEmpty();</span>

<span class="fc" id="L1310">        ts.request(1);</span>

<span class="fc" id="L1312">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1313">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1315">        pp1.onNext(1);</span>
<span class="fc" id="L1316">        pp1.onComplete();</span>

<span class="fc" id="L1318">        ts.assertValue(1);</span>

<span class="fc" id="L1320">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1321">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1323">        ts.request(1);</span>

<span class="fc" id="L1325">        ts.assertValue(1);</span>

<span class="fc" id="L1327">        pp2.onNext(2);</span>
<span class="fc" id="L1328">        pp2.onComplete();</span>

<span class="fc" id="L1330">        ts.assertResult(1, 2);</span>

<span class="fc" id="L1332">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1333">        assertFalse(pp2.hasSubscribers());</span>
<span class="fc" id="L1334">    }</span>

    @Test
    public void concat3() {
<span class="fc" id="L1338">        Maybe.concat(Maybe.just(1), Maybe.just(2), Maybe.just(3))</span>
<span class="fc" id="L1339">        .test()</span>
<span class="fc" id="L1340">        .assertResult(1, 2, 3);</span>
<span class="fc" id="L1341">    }</span>

    @Test
    public void concat3Empty() {
<span class="fc" id="L1345">        Maybe.concat(Maybe.empty(), Maybe.empty(), Maybe.empty())</span>
<span class="fc" id="L1346">        .test()</span>
<span class="fc" id="L1347">        .assertResult();</span>
<span class="fc" id="L1348">    }</span>

    @Test
    public void concat3Mixed1() {
<span class="fc" id="L1352">        Maybe.concat(Maybe.just(1), Maybe.empty(), Maybe.just(3))</span>
<span class="fc" id="L1353">        .test()</span>
<span class="fc" id="L1354">        .assertResult(1, 3);</span>
<span class="fc" id="L1355">    }</span>

    @Test
    public void concat3Mixed2() {
<span class="fc" id="L1359">        Maybe.concat(Maybe.just(1), Maybe.just(2), Maybe.empty())</span>
<span class="fc" id="L1360">        .test()</span>
<span class="fc" id="L1361">        .assertResult(1, 2);</span>
<span class="fc" id="L1362">    }</span>

    @Test
    public void concat3Backpressured() {
<span class="fc" id="L1366">        TestSubscriber&lt;Integer&gt; ts = Maybe.concat(Maybe.just(1), Maybe.just(2), Maybe.just(3))</span>
<span class="fc" id="L1367">        .test(0L);</span>

<span class="fc" id="L1369">        ts.assertEmpty();</span>

<span class="fc" id="L1371">        ts.request(1);</span>

<span class="fc" id="L1373">        ts.assertValue(1);</span>

<span class="fc" id="L1375">        ts.request(2);</span>

<span class="fc" id="L1377">        ts.assertResult(1, 2, 3);</span>
<span class="fc" id="L1378">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatArrayZero() {
<span class="fc" id="L1383">        assertSame(Flowable.empty(), Maybe.concatArray());</span>
<span class="fc" id="L1384">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatArrayOne() {
<span class="fc" id="L1389">        Maybe.concatArray(Maybe.just(1)).test().assertResult(1);</span>
<span class="fc" id="L1390">    }</span>

    @Test
    public void concat4() {
<span class="fc" id="L1394">        Maybe.concat(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.just(4))</span>
<span class="fc" id="L1395">        .test()</span>
<span class="fc" id="L1396">        .assertResult(1, 2, 3, 4);</span>
<span class="fc" id="L1397">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatIterable() {
<span class="fc" id="L1402">        Maybe.concat(Arrays.asList(Maybe.just(1), Maybe.just(2)))</span>
<span class="fc" id="L1403">        .test()</span>
<span class="fc" id="L1404">        .assertResult(1, 2);</span>
<span class="fc" id="L1405">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatIterableEmpty() {
<span class="fc" id="L1410">        Maybe.concat(Arrays.asList(Maybe.empty(), Maybe.empty()))</span>
<span class="fc" id="L1411">        .test()</span>
<span class="fc" id="L1412">        .assertResult();</span>
<span class="fc" id="L1413">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatIterableBackpressured() {
<span class="fc" id="L1418">        TestSubscriber&lt;Integer&gt; ts = Maybe.concat(Arrays.asList(Maybe.just(1), Maybe.just(2)))</span>
<span class="fc" id="L1419">        .test(0L);</span>

<span class="fc" id="L1421">        ts.assertEmpty();</span>

<span class="fc" id="L1423">        ts.request(1);</span>

<span class="fc" id="L1425">        ts.assertValue(1);</span>

<span class="fc" id="L1427">        ts.request(1);</span>

<span class="fc" id="L1429">        ts.assertResult(1, 2);</span>
<span class="fc" id="L1430">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatIterableBackpressuredNonEager() {
<span class="fc" id="L1435">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1436">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1438">        TestSubscriber&lt;Integer&gt; ts = Maybe.concat(Arrays.asList(pp1.singleElement(), pp2.singleElement()))</span>
<span class="fc" id="L1439">        .test(0L);</span>

<span class="fc" id="L1441">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1442">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1444">        ts.assertEmpty();</span>

<span class="fc" id="L1446">        ts.request(1);</span>

<span class="fc" id="L1448">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1449">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1451">        pp1.onNext(1);</span>
<span class="fc" id="L1452">        pp1.onComplete();</span>

<span class="fc" id="L1454">        ts.assertValue(1);</span>

<span class="fc" id="L1456">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1457">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1459">        ts.request(1);</span>

<span class="fc" id="L1461">        ts.assertValue(1);</span>

<span class="fc" id="L1463">        pp2.onNext(2);</span>
<span class="fc" id="L1464">        pp2.onComplete();</span>

<span class="fc" id="L1466">        ts.assertResult(1, 2);</span>

<span class="fc" id="L1468">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1469">        assertFalse(pp2.hasSubscribers());</span>
<span class="fc" id="L1470">    }</span>

    @Test
    public void concatIterableZero() {
<span class="fc" id="L1474">        Maybe.concat(Collections.&lt;Maybe&lt;Integer&gt;&gt;emptyList()).test().assertResult();</span>
<span class="fc" id="L1475">    }</span>

    @Test
    public void concatIterableOne() {
<span class="fc" id="L1479">        Maybe.concat(Collections.&lt;Maybe&lt;Integer&gt;&gt;singleton(Maybe.just(1))).test().assertResult(1);</span>
<span class="fc" id="L1480">    }</span>

    @Test
    public void concatPublisher() {
<span class="fc" id="L1484">        Maybe.concat(Flowable.just(Maybe.just(1), Maybe.just(2))).test().assertResult(1, 2);</span>
<span class="fc" id="L1485">    }</span>

    @Test
    public void concatPublisherPrefetch() {
<span class="fc" id="L1489">        Maybe.concat(Flowable.just(Maybe.just(1), Maybe.just(2)), 1).test().assertResult(1, 2);</span>
<span class="fc" id="L1490">    }</span>

    @Test(expected = NullPointerException.class)
    public void nullArgument() {
<span class="nc" id="L1494">        Maybe.create(null);</span>
<span class="nc" id="L1495">    }</span>

    @Test
    public void basic() {
<span class="fc" id="L1499">        List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>
        try {
<span class="fc" id="L1501">            final Disposable d = Disposables.empty();</span>

<span class="fc" id="L1503">            Maybe.&lt;Integer&gt;create(new MaybeOnSubscribe&lt;Integer&gt;() {</span>
                @Override
                public void subscribe(MaybeEmitter&lt;Integer&gt; e) throws Exception {
<span class="fc" id="L1506">                    e.setDisposable(d);</span>

<span class="fc" id="L1508">                    e.onSuccess(1);</span>
<span class="fc" id="L1509">                    e.onError(new TestException());</span>
<span class="fc" id="L1510">                    e.onSuccess(2);</span>
<span class="fc" id="L1511">                    e.onError(new TestException());</span>
<span class="fc" id="L1512">                    e.onComplete();</span>
<span class="fc" id="L1513">                }</span>
            })
<span class="fc" id="L1515">            .test()</span>
<span class="fc" id="L1516">            .assertResult(1);</span>

<span class="fc" id="L1518">            assertTrue(d.isDisposed());</span>

<span class="fc" id="L1520">            TestHelper.assertUndeliverable(errors, 0, TestException.class);</span>
<span class="fc" id="L1521">            TestHelper.assertUndeliverable(errors, 1, TestException.class);</span>
        } finally {
<span class="fc" id="L1523">            RxJavaPlugins.reset();</span>
        }
<span class="fc" id="L1525">    }</span>

    @Test
    public void basicWithError() {
<span class="fc" id="L1529">        List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>
        try {
<span class="fc" id="L1531">            final Disposable d = Disposables.empty();</span>

<span class="fc" id="L1533">            Maybe.&lt;Integer&gt;create(new MaybeOnSubscribe&lt;Integer&gt;() {</span>
                @Override
                public void subscribe(MaybeEmitter&lt;Integer&gt; e) throws Exception {
<span class="fc" id="L1536">                    e.setDisposable(d);</span>

<span class="fc" id="L1538">                    e.onError(new TestException());</span>
<span class="fc" id="L1539">                    e.onSuccess(2);</span>
<span class="fc" id="L1540">                    e.onError(new TestException());</span>
<span class="fc" id="L1541">                    e.onComplete();</span>
<span class="fc" id="L1542">                }</span>
            })
<span class="fc" id="L1544">            .test()</span>
<span class="fc" id="L1545">            .assertFailure(TestException.class);</span>

<span class="fc" id="L1547">            assertTrue(d.isDisposed());</span>

<span class="fc" id="L1549">            TestHelper.assertUndeliverable(errors, 0, TestException.class);</span>
        } finally {
<span class="fc" id="L1551">            RxJavaPlugins.reset();</span>
        }
<span class="fc" id="L1553">    }</span>

    @Test
    public void basicWithComplete() {
<span class="fc" id="L1557">        List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>
        try {
<span class="fc" id="L1559">            final Disposable d = Disposables.empty();</span>

<span class="fc" id="L1561">            Maybe.&lt;Integer&gt;create(new MaybeOnSubscribe&lt;Integer&gt;() {</span>
                @Override
                public void subscribe(MaybeEmitter&lt;Integer&gt; e) throws Exception {
<span class="fc" id="L1564">                    e.setDisposable(d);</span>

<span class="fc" id="L1566">                    e.onComplete();</span>
<span class="fc" id="L1567">                    e.onSuccess(1);</span>
<span class="fc" id="L1568">                    e.onError(new TestException());</span>
<span class="fc" id="L1569">                    e.onComplete();</span>
<span class="fc" id="L1570">                    e.onSuccess(2);</span>
<span class="fc" id="L1571">                    e.onError(new TestException());</span>
<span class="fc" id="L1572">                }</span>
            })
<span class="fc" id="L1574">            .test()</span>
<span class="fc" id="L1575">            .assertResult();</span>

<span class="fc" id="L1577">            assertTrue(d.isDisposed());</span>

<span class="fc" id="L1579">            TestHelper.assertUndeliverable(errors, 0, TestException.class);</span>
<span class="fc" id="L1580">            TestHelper.assertUndeliverable(errors, 1, TestException.class);</span>
        } finally {
<span class="fc" id="L1582">            RxJavaPlugins.reset();</span>
        }
<span class="fc" id="L1584">    }</span>

    @Test(expected = IllegalArgumentException.class)
    public void unsafeCreateWithMaybe() {
<span class="nc" id="L1588">        Maybe.unsafeCreate(Maybe.just(1));</span>
<span class="nc" id="L1589">    }</span>

    @Test
    public void maybeToPublisherEnum() {
<span class="fc" id="L1593">        TestHelper.checkEnum(MaybeToPublisher.class);</span>
<span class="fc" id="L1594">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArrayOneIsNull() {
<span class="fc" id="L1599">        Maybe.ambArray(null, Maybe.just(1))</span>
<span class="fc" id="L1600">                .test()</span>
<span class="fc" id="L1601">                .assertError(NullPointerException.class);</span>
<span class="fc" id="L1602">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArrayEmpty() {
<span class="fc" id="L1607">        assertSame(Maybe.empty(), Maybe.ambArray());</span>
<span class="fc" id="L1608">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArrayOne() {
<span class="fc" id="L1613">        assertSame(Maybe.never(), Maybe.ambArray(Maybe.never()));</span>
<span class="fc" id="L1614">    }</span>

    @Test
    public void ambWithOrder() {
<span class="fc" id="L1618">        Maybe&lt;Integer&gt; error = Maybe.error(new RuntimeException());</span>
<span class="fc" id="L1619">        Maybe.just(1).ambWith(error).test().assertValue(1);</span>
<span class="fc" id="L1620">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterableOrder() {
<span class="fc" id="L1625">        Maybe&lt;Integer&gt; error = Maybe.error(new RuntimeException());</span>
<span class="fc" id="L1626">        Maybe.amb(Arrays.asList(Maybe.just(1), error)).test().assertValue(1);</span>
<span class="fc" id="L1627">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArrayOrder() {
<span class="fc" id="L1632">        Maybe&lt;Integer&gt; error = Maybe.error(new RuntimeException());</span>
<span class="fc" id="L1633">        Maybe.ambArray(Maybe.just(1), error).test().assertValue(1);</span>
<span class="fc" id="L1634">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArray1SignalsSuccess() {
<span class="fc" id="L1639">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1640">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1642">        TestObserver&lt;Integer&gt; to = Maybe.ambArray(pp1.singleElement(), pp2.singleElement())</span>
<span class="fc" id="L1643">        .test();</span>

<span class="fc" id="L1645">        to.assertEmpty();</span>

<span class="fc" id="L1647">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1648">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1650">        pp1.onNext(1);</span>
<span class="fc" id="L1651">        pp1.onComplete();</span>

<span class="fc" id="L1653">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1654">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1656">        to.assertResult(1);</span>
<span class="fc" id="L1657">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArray2SignalsSuccess() {
<span class="fc" id="L1662">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1663">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1665">        TestObserver&lt;Integer&gt; to = Maybe.ambArray(pp1.singleElement(), pp2.singleElement())</span>
<span class="fc" id="L1666">        .test();</span>

<span class="fc" id="L1668">        to.assertEmpty();</span>

<span class="fc" id="L1670">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1671">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1673">        pp2.onNext(2);</span>
<span class="fc" id="L1674">        pp2.onComplete();</span>

<span class="fc" id="L1676">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1677">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1679">        to.assertResult(2);</span>
<span class="fc" id="L1680">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArray1SignalsError() {
<span class="fc" id="L1685">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1686">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1688">        TestObserver&lt;Integer&gt; to = Maybe.ambArray(pp1.singleElement(), pp2.singleElement())</span>
<span class="fc" id="L1689">        .test();</span>

<span class="fc" id="L1691">        to.assertEmpty();</span>

<span class="fc" id="L1693">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1694">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1696">        pp1.onError(new TestException());</span>

<span class="fc" id="L1698">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1699">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1701">        to.assertFailure(TestException.class);</span>
<span class="fc" id="L1702">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArray2SignalsError() {
<span class="fc" id="L1707">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1708">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1710">        TestObserver&lt;Integer&gt; to = Maybe.ambArray(pp1.singleElement(), pp2.singleElement())</span>
<span class="fc" id="L1711">        .test();</span>

<span class="fc" id="L1713">        to.assertEmpty();</span>

<span class="fc" id="L1715">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1716">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1718">        pp2.onError(new TestException());</span>

<span class="fc" id="L1720">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1721">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1723">        to.assertFailure(TestException.class);</span>
<span class="fc" id="L1724">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArray1SignalsComplete() {
<span class="fc" id="L1729">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1730">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1732">        TestObserver&lt;Integer&gt; to = Maybe.ambArray(pp1.singleElement(), pp2.singleElement())</span>
<span class="fc" id="L1733">        .test();</span>

<span class="fc" id="L1735">        to.assertEmpty();</span>

<span class="fc" id="L1737">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1738">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1740">        pp1.onComplete();</span>

<span class="fc" id="L1742">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1743">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1745">        to.assertResult();</span>
<span class="fc" id="L1746">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambArray2SignalsComplete() {
<span class="fc" id="L1751">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1752">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1754">        TestObserver&lt;Integer&gt; to = Maybe.ambArray(pp1.singleElement(), pp2.singleElement())</span>
<span class="fc" id="L1755">        .test();</span>

<span class="fc" id="L1757">        to.assertEmpty();</span>

<span class="fc" id="L1759">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1760">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1762">        pp2.onComplete();</span>

<span class="fc" id="L1764">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1765">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1767">        to.assertResult();</span>
<span class="fc" id="L1768">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterable1SignalsSuccess() {
<span class="fc" id="L1773">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1774">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1776">        TestObserver&lt;Integer&gt; to = Maybe.amb(Arrays.asList(pp1.singleElement(), pp2.singleElement()))</span>
<span class="fc" id="L1777">        .test();</span>

<span class="fc" id="L1779">        to.assertEmpty();</span>

<span class="fc" id="L1781">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1782">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1784">        pp1.onNext(1);</span>
<span class="fc" id="L1785">        pp1.onComplete();</span>

<span class="fc" id="L1787">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1788">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1790">        to.assertResult(1);</span>
<span class="fc" id="L1791">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterable2SignalsSuccess() {
<span class="fc" id="L1796">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1797">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1799">        TestObserver&lt;Integer&gt; to = Maybe.amb(Arrays.asList(pp1.singleElement(), pp2.singleElement()))</span>
<span class="fc" id="L1800">        .test();</span>

<span class="fc" id="L1802">        to.assertEmpty();</span>

<span class="fc" id="L1804">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1805">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1807">        pp2.onNext(2);</span>
<span class="fc" id="L1808">        pp2.onComplete();</span>

<span class="fc" id="L1810">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1811">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1813">        to.assertResult(2);</span>
<span class="fc" id="L1814">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterable2SignalsSuccessWithOverlap() {
<span class="fc" id="L1819">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1820">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1822">        TestObserver&lt;Integer&gt; to = Maybe.amb(Arrays.asList(pp1.singleElement(), pp2.singleElement()))</span>
<span class="fc" id="L1823">                .test();</span>

<span class="fc" id="L1825">        to.assertEmpty();</span>

<span class="fc" id="L1827">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1828">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1830">        pp2.onNext(2);</span>
<span class="fc" id="L1831">        pp1.onNext(1);</span>
<span class="fc" id="L1832">        pp2.onComplete();</span>

<span class="fc" id="L1834">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1835">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1837">        to.assertResult(2);</span>
<span class="fc" id="L1838">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterable1SignalsError() {
<span class="fc" id="L1843">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1844">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1846">        TestObserver&lt;Integer&gt; to = Maybe.amb(Arrays.asList(pp1.singleElement(), pp2.singleElement()))</span>
<span class="fc" id="L1847">        .test();</span>

<span class="fc" id="L1849">        to.assertEmpty();</span>

<span class="fc" id="L1851">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1852">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1854">        pp1.onError(new TestException());</span>

<span class="fc" id="L1856">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1857">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1859">        to.assertFailure(TestException.class);</span>
<span class="fc" id="L1860">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterable2SignalsError() {
<span class="fc" id="L1865">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1866">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1868">        TestObserver&lt;Integer&gt; to = Maybe.amb(Arrays.asList(pp1.singleElement(), pp2.singleElement()))</span>
<span class="fc" id="L1869">        .test();</span>

<span class="fc" id="L1871">        to.assertEmpty();</span>

<span class="fc" id="L1873">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1874">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1876">        pp2.onError(new TestException());</span>

<span class="fc" id="L1878">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1879">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1881">        to.assertFailure(TestException.class);</span>
<span class="fc" id="L1882">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterable2SignalsErrorWithOverlap() {
<span class="fc" id="L1887">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1888">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1890">        TestObserver&lt;Integer&gt; to = Maybe.amb(Arrays.asList(pp1.singleElement(), pp2.singleElement()))</span>
<span class="fc" id="L1891">                .test();</span>

<span class="fc" id="L1893">        to.assertEmpty();</span>

<span class="fc" id="L1895">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1896">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1898">        pp2.onError(new TestException(&quot;2&quot;));</span>
<span class="fc" id="L1899">        pp1.onError(new TestException(&quot;1&quot;));</span>

<span class="fc" id="L1901">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1902">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1904">        to.assertFailureAndMessage(TestException.class, &quot;2&quot;);</span>
<span class="fc" id="L1905">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterable1SignalsComplete() {
<span class="fc" id="L1910">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1911">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1913">        TestObserver&lt;Integer&gt; to = Maybe.amb(Arrays.asList(pp1.singleElement(), pp2.singleElement()))</span>
<span class="fc" id="L1914">        .test();</span>

<span class="fc" id="L1916">        to.assertEmpty();</span>

<span class="fc" id="L1918">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1919">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1921">        pp1.onComplete();</span>

<span class="fc" id="L1923">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1924">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1926">        to.assertResult();</span>
<span class="fc" id="L1927">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterable2SignalsComplete() {
<span class="fc" id="L1932">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L1933">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L1935">        TestObserver&lt;Integer&gt; to = Maybe.amb(Arrays.asList(pp1.singleElement(), pp2.singleElement()))</span>
<span class="fc" id="L1936">        .test();</span>

<span class="fc" id="L1938">        to.assertEmpty();</span>

<span class="fc" id="L1940">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L1941">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L1943">        pp2.onComplete();</span>

<span class="fc" id="L1945">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L1946">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L1948">        to.assertResult();</span>
<span class="fc" id="L1949">    }</span>

    @Test(expected = NullPointerException.class)
    public void ambIterableNull() {
<span class="nc" id="L1953">        Maybe.amb((Iterable&lt;Maybe&lt;Integer&gt;&gt;)null);</span>
<span class="nc" id="L1954">    }</span>

    @Test
    public void ambIterableIteratorNull() {
<span class="fc" id="L1958">        Maybe.amb(new Iterable&lt;Maybe&lt;Object&gt;&gt;() {</span>
            @Override
            public Iterator&lt;Maybe&lt;Object&gt;&gt; iterator() {
<span class="fc" id="L1961">                return null;</span>
            }
<span class="fc" id="L1963">        }).test().assertError(NullPointerException.class);</span>
<span class="fc" id="L1964">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void ambIterableOneIsNull() {
<span class="fc" id="L1969">        Maybe.amb(Arrays.asList(null, Maybe.just(1)))</span>
<span class="fc" id="L1970">                .test()</span>
<span class="fc" id="L1971">                .assertError(NullPointerException.class);</span>
<span class="fc" id="L1972">    }</span>

    @Test
    public void ambIterableEmpty() {
<span class="fc" id="L1976">        Maybe.amb(Collections.&lt;Maybe&lt;Integer&gt;&gt;emptyList()).test().assertResult();</span>
<span class="fc" id="L1977">    }</span>

    @Test
    public void ambIterableOne() {
<span class="fc" id="L1981">        Maybe.amb(Collections.singleton(Maybe.just(1))).test().assertResult(1);</span>
<span class="fc" id="L1982">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArray() {
<span class="fc" id="L1987">        Maybe.mergeArray(Maybe.just(1), Maybe.just(2), Maybe.just(3))</span>
<span class="fc" id="L1988">        .test()</span>
<span class="fc" id="L1989">        .assertResult(1, 2, 3);</span>
<span class="fc" id="L1990">    }</span>

    @Test
    public void merge2() {
<span class="fc" id="L1994">        Maybe.merge(Maybe.just(1), Maybe.just(2))</span>
<span class="fc" id="L1995">        .test()</span>
<span class="fc" id="L1996">        .assertResult(1, 2);</span>
<span class="fc" id="L1997">    }</span>

    @Test
    public void merge3() {
<span class="fc" id="L2001">        Maybe.merge(Maybe.just(1), Maybe.just(2), Maybe.just(3))</span>
<span class="fc" id="L2002">        .test()</span>
<span class="fc" id="L2003">        .assertResult(1, 2, 3);</span>
<span class="fc" id="L2004">    }</span>

    @Test
    public void merge4() {
<span class="fc" id="L2008">        Maybe.merge(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.just(4))</span>
<span class="fc" id="L2009">        .test()</span>
<span class="fc" id="L2010">        .assertResult(1, 2, 3, 4);</span>
<span class="fc" id="L2011">    }</span>

    @Test
    public void merge4Take2() {
<span class="fc" id="L2015">        Maybe.merge(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.just(4))</span>
<span class="fc" id="L2016">        .take(2)</span>
<span class="fc" id="L2017">        .test()</span>
<span class="fc" id="L2018">        .assertResult(1, 2);</span>
<span class="fc" id="L2019">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArrayBackpressured() {
<span class="fc" id="L2024">        TestSubscriber&lt;Integer&gt; ts = Maybe.mergeArray(Maybe.just(1), Maybe.just(2), Maybe.just(3))</span>
<span class="fc" id="L2025">        .test(0L);</span>

<span class="fc" id="L2027">        ts.assertEmpty();</span>

<span class="fc" id="L2029">        ts.request(1);</span>

<span class="fc" id="L2031">        ts.assertValue(1);</span>

<span class="fc" id="L2033">        ts.request(1);</span>

<span class="fc" id="L2035">        ts.assertValues(1, 2);</span>

<span class="fc" id="L2037">        ts.request(1);</span>
<span class="fc" id="L2038">        ts.assertResult(1, 2, 3);</span>
<span class="fc" id="L2039">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArrayBackpressuredMixed1() {
<span class="fc" id="L2044">        TestSubscriber&lt;Integer&gt; ts = Maybe.mergeArray(Maybe.just(1), Maybe.&lt;Integer&gt;empty(), Maybe.just(3))</span>
<span class="fc" id="L2045">        .test(0L);</span>

<span class="fc" id="L2047">        ts.assertEmpty();</span>

<span class="fc" id="L2049">        ts.request(1);</span>

<span class="fc" id="L2051">        ts.assertValue(1);</span>

<span class="fc" id="L2053">        ts.request(1);</span>

<span class="fc" id="L2055">        ts.assertResult(1, 3);</span>
<span class="fc" id="L2056">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArrayBackpressuredMixed2() {
<span class="fc" id="L2061">        TestSubscriber&lt;Integer&gt; ts = Maybe.mergeArray(Maybe.just(1), Maybe.just(2), Maybe.&lt;Integer&gt;empty())</span>
<span class="fc" id="L2062">        .test(0L);</span>

<span class="fc" id="L2064">        ts.assertEmpty();</span>

<span class="fc" id="L2066">        ts.request(1);</span>

<span class="fc" id="L2068">        ts.assertValue(1);</span>

<span class="fc" id="L2070">        ts.request(1);</span>

<span class="fc" id="L2072">        ts.assertResult(1, 2);</span>
<span class="fc" id="L2073">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArrayBackpressuredMixed3() {
<span class="fc" id="L2078">        TestSubscriber&lt;Integer&gt; ts = Maybe.mergeArray(Maybe.&lt;Integer&gt;empty(), Maybe.just(2), Maybe.just(3))</span>
<span class="fc" id="L2079">        .test(0L);</span>

<span class="fc" id="L2081">        ts.assertEmpty();</span>

<span class="fc" id="L2083">        ts.request(1);</span>

<span class="fc" id="L2085">        ts.assertValue(2);</span>

<span class="fc" id="L2087">        ts.request(1);</span>

<span class="fc" id="L2089">        ts.assertResult(2, 3);</span>
<span class="fc" id="L2090">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArrayFused() {
<span class="fc" id="L2095">        TestSubscriber&lt;Integer&gt; ts = SubscriberFusion.newTest(QueueFuseable.ANY);</span>

<span class="fc" id="L2097">        Maybe.mergeArray(Maybe.just(1), Maybe.just(2), Maybe.just(3)).subscribe(ts);</span>

<span class="fc" id="L2099">        ts.assertSubscribed()</span>
<span class="fc" id="L2100">        .assertOf(SubscriberFusion.&lt;Integer&gt;assertFuseable())</span>
<span class="fc" id="L2101">        .assertOf(SubscriberFusion.&lt;Integer&gt;assertFusionMode(QueueFuseable.ASYNC))</span>
<span class="fc" id="L2102">        .assertResult(1, 2, 3);</span>
<span class="fc" id="L2103">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArrayFusedRace() {
<span class="fc bfc" id="L2108" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L2109">            final PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L2110">            final PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L2112">            TestSubscriber&lt;Integer&gt; ts = SubscriberFusion.newTest(QueueFuseable.ANY);</span>

<span class="fc" id="L2114">            Maybe.mergeArray(pp1.singleElement(), pp2.singleElement()).subscribe(ts);</span>

<span class="fc" id="L2116">            ts.assertSubscribed()</span>
<span class="fc" id="L2117">            .assertOf(SubscriberFusion.&lt;Integer&gt;assertFuseable())</span>
<span class="fc" id="L2118">            .assertOf(SubscriberFusion.&lt;Integer&gt;assertFusionMode(QueueFuseable.ASYNC))</span>
            ;

<span class="fc" id="L2121">            TestHelper.race(new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L2124">                    pp1.onNext(1);</span>
<span class="fc" id="L2125">                    pp1.onComplete();</span>
<span class="fc" id="L2126">                }</span>
<span class="fc" id="L2127">            }, new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L2130">                    pp2.onNext(1);</span>
<span class="fc" id="L2131">                    pp2.onComplete();</span>
<span class="fc" id="L2132">                }</span>
            });

<span class="fc" id="L2135">            ts</span>
<span class="fc" id="L2136">            .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L2137">            .assertResult(1, 1);</span>
        }
<span class="fc" id="L2139">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArrayZero() {
<span class="fc" id="L2144">        assertSame(Flowable.empty(), Maybe.mergeArray());</span>
<span class="fc" id="L2145">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArrayOne() {
<span class="fc" id="L2150">        Maybe.mergeArray(Maybe.just(1)).test().assertResult(1);</span>
<span class="fc" id="L2151">    }</span>

    @Test
    public void mergePublisher() {
<span class="fc" id="L2155">        Maybe.merge(Flowable.just(Maybe.just(1), Maybe.just(2), Maybe.just(3)))</span>
<span class="fc" id="L2156">        .test()</span>
<span class="fc" id="L2157">        .assertResult(1, 2, 3);</span>
<span class="fc" id="L2158">    }</span>

    @Test
    public void mergePublisherMaxConcurrent() {
<span class="fc" id="L2162">        final PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L2163">        final PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L2165">        TestSubscriber&lt;Integer&gt; ts = Maybe.merge(Flowable.just(pp1.singleElement(), pp2.singleElement()), 1).test(0L);</span>

<span class="fc" id="L2167">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L2168">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L2170">        pp1.onNext(1);</span>
<span class="fc" id="L2171">        pp1.onComplete();</span>

<span class="fc" id="L2173">        ts.request(1);</span>

<span class="fc" id="L2175">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L2176">        assertTrue(pp2.hasSubscribers());</span>
<span class="fc" id="L2177">    }</span>

    @Test
    public void mergeMaybe() {
<span class="fc" id="L2181">        Maybe.merge(Maybe.just(Maybe.just(1)))</span>
<span class="fc" id="L2182">        .test()</span>
<span class="fc" id="L2183">        .assertResult(1);</span>
<span class="fc" id="L2184">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeIterable() {
<span class="fc" id="L2189">        Maybe.merge(Arrays.asList(Maybe.just(1), Maybe.just(2), Maybe.just(3)))</span>
<span class="fc" id="L2190">        .test()</span>
<span class="fc" id="L2191">        .assertResult(1, 2, 3);</span>
<span class="fc" id="L2192">    }</span>

    @Test
    public void mergeALot() {
        @SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L2197">        Maybe&lt;Integer&gt;[] sources = new Maybe[Flowable.bufferSize() * 2];</span>
<span class="fc" id="L2198">        Arrays.fill(sources, Maybe.just(1));</span>

<span class="fc" id="L2200">        Maybe.mergeArray(sources)</span>
<span class="fc" id="L2201">        .test()</span>
<span class="fc" id="L2202">        .assertSubscribed()</span>
<span class="fc" id="L2203">        .assertValueCount(sources.length)</span>
<span class="fc" id="L2204">        .assertNoErrors()</span>
<span class="fc" id="L2205">        .assertComplete();</span>
<span class="fc" id="L2206">    }</span>

    @Test
    public void mergeALotLastEmpty() {
        @SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L2211">        Maybe&lt;Integer&gt;[] sources = new Maybe[Flowable.bufferSize() * 2];</span>
<span class="fc" id="L2212">        Arrays.fill(sources, Maybe.just(1));</span>
<span class="fc" id="L2213">        sources[sources.length - 1] = Maybe.empty();</span>

<span class="fc" id="L2215">        Maybe.mergeArray(sources)</span>
<span class="fc" id="L2216">        .test()</span>
<span class="fc" id="L2217">        .assertSubscribed()</span>
<span class="fc" id="L2218">        .assertValueCount(sources.length - 1)</span>
<span class="fc" id="L2219">        .assertNoErrors()</span>
<span class="fc" id="L2220">        .assertComplete();</span>
<span class="fc" id="L2221">    }</span>

    @Test
    public void mergeALotFused() {
        @SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L2226">        Maybe&lt;Integer&gt;[] sources = new Maybe[Flowable.bufferSize() * 2];</span>
<span class="fc" id="L2227">        Arrays.fill(sources, Maybe.just(1));</span>

<span class="fc" id="L2229">        TestSubscriber&lt;Integer&gt; ts = SubscriberFusion.newTest(QueueFuseable.ANY);</span>

<span class="fc" id="L2231">        Maybe.mergeArray(sources).subscribe(ts);</span>

<span class="fc" id="L2233">        ts</span>
<span class="fc" id="L2234">        .assertSubscribed()</span>
<span class="fc" id="L2235">        .assertOf(SubscriberFusion.&lt;Integer&gt;assertFuseable())</span>
<span class="fc" id="L2236">        .assertOf(SubscriberFusion.&lt;Integer&gt;assertFusionMode(QueueFuseable.ASYNC))</span>
<span class="fc" id="L2237">        .assertValueCount(sources.length)</span>
<span class="fc" id="L2238">        .assertNoErrors()</span>
<span class="fc" id="L2239">        .assertComplete();</span>
<span class="fc" id="L2240">    }</span>

    @Test
    public void mergeErrorSuccess() {
<span class="fc" id="L2244">        Maybe.merge(Maybe.error(new TestException()), Maybe.just(1))</span>
<span class="fc" id="L2245">        .test()</span>
<span class="fc" id="L2246">        .assertFailure(TestException.class);</span>
<span class="fc" id="L2247">    }</span>

    @Test
    public void mergeSuccessError() {
<span class="fc" id="L2251">        Maybe.merge(Maybe.just(1), Maybe.error(new TestException()))</span>
<span class="fc" id="L2252">        .test()</span>
<span class="fc" id="L2253">        .assertFailure(TestException.class, 1);</span>
<span class="fc" id="L2254">    }</span>

    @Test
    public void subscribeZero() {
<span class="fc" id="L2258">        assertTrue(Maybe.just(1)</span>
<span class="fc" id="L2259">        .subscribe().isDisposed());</span>
<span class="fc" id="L2260">    }</span>

    @Test
    public void subscribeZeroError() {
<span class="fc" id="L2264">        List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>

        try {
<span class="fc" id="L2267">            assertTrue(Maybe.error(new TestException())</span>
<span class="fc" id="L2268">            .subscribe().isDisposed());</span>

<span class="fc" id="L2270">            TestHelper.assertError(errors, 0, OnErrorNotImplementedException.class);</span>
<span class="fc" id="L2271">            Throwable c = errors.get(0).getCause();</span>
<span class="fc" id="L2272">            assertTrue(&quot;&quot; + c, c instanceof TestException);</span>
        } finally {
<span class="fc" id="L2274">            RxJavaPlugins.reset();</span>
        }
<span class="fc" id="L2276">    }</span>

    @Test
    public void subscribeToOnSuccess() {
<span class="fc" id="L2280">        final List&lt;Integer&gt; values = new ArrayList&lt;Integer&gt;();</span>

<span class="fc" id="L2282">        Consumer&lt;Integer&gt; onSuccess = new Consumer&lt;Integer&gt;() {</span>
            @Override
            public void accept(Integer e) throws Exception {
<span class="fc" id="L2285">                values.add(e);</span>
<span class="fc" id="L2286">            }</span>
        };

<span class="fc" id="L2289">        Maybe&lt;Integer&gt; source = Maybe.just(1);</span>

<span class="fc" id="L2291">        source.subscribe(onSuccess);</span>
<span class="fc" id="L2292">        source.subscribe(onSuccess, Functions.emptyConsumer());</span>
<span class="fc" id="L2293">        source.subscribe(onSuccess, Functions.emptyConsumer(), Functions.EMPTY_ACTION);</span>

<span class="fc" id="L2295">        assertEquals(Arrays.asList(1, 1, 1), values);</span>
<span class="fc" id="L2296">    }</span>

    @Test
    public void subscribeToOnError() {
<span class="fc" id="L2300">        final List&lt;Throwable&gt; values = new ArrayList&lt;Throwable&gt;();</span>

<span class="fc" id="L2302">        Consumer&lt;Throwable&gt; onError = new Consumer&lt;Throwable&gt;() {</span>
            @Override
            public void accept(Throwable e) throws Exception {
<span class="fc" id="L2305">                values.add(e);</span>
<span class="fc" id="L2306">            }</span>
        };

<span class="fc" id="L2309">        TestException ex = new TestException();</span>

<span class="fc" id="L2311">        Maybe&lt;Integer&gt; source = Maybe.error(ex);</span>

<span class="fc" id="L2313">        source.subscribe(Functions.emptyConsumer(), onError);</span>
<span class="fc" id="L2314">        source.subscribe(Functions.emptyConsumer(), onError, Functions.EMPTY_ACTION);</span>

<span class="fc" id="L2316">        assertEquals(Arrays.asList(ex, ex), values);</span>
<span class="fc" id="L2317">    }</span>

    @Test
    public void subscribeToOnComplete() {
<span class="fc" id="L2321">        final List&lt;Integer&gt; values = new ArrayList&lt;Integer&gt;();</span>

<span class="fc" id="L2323">        Action onComplete = new Action() {</span>
            @Override
            public void run() throws Exception {
<span class="fc" id="L2326">                values.add(100);</span>
<span class="fc" id="L2327">            }</span>
        };

<span class="fc" id="L2330">        Maybe&lt;Integer&gt; source = Maybe.empty();</span>

<span class="fc" id="L2332">        source.subscribe(Functions.emptyConsumer(), Functions.emptyConsumer(), onComplete);</span>

<span class="fc" id="L2334">        assertEquals(Arrays.asList(100), values);</span>
<span class="fc" id="L2335">    }</span>

    @Test
    public void subscribeWith() {
<span class="fc" id="L2339">        MaybeObserver&lt;Integer&gt; mo = new MaybeObserver&lt;Integer&gt;() {</span>

            @Override
            public void onSubscribe(Disposable d) {

<span class="fc" id="L2344">            }</span>

            @Override
            public void onSuccess(Integer value) {

<span class="fc" id="L2349">            }</span>

            @Override
            public void onError(Throwable e) {

<span class="nc" id="L2354">            }</span>

            @Override
            public void onComplete() {

<span class="nc" id="L2359">            }</span>

        };

<span class="fc" id="L2363">        assertSame(mo, Maybe.just(1).subscribeWith(mo));</span>
<span class="fc" id="L2364">    }</span>

    @Test
    public void doOnEventSuccess() {
<span class="fc" id="L2368">        final List&lt;Object&gt; list = new ArrayList&lt;Object&gt;();</span>

<span class="fc" id="L2370">        assertTrue(Maybe.just(1)</span>
<span class="fc" id="L2371">        .doOnEvent(new BiConsumer&lt;Integer, Throwable&gt;() {</span>
            @Override
            public void accept(Integer v, Throwable e) throws Exception {
<span class="fc" id="L2374">                list.add(v);</span>
<span class="fc" id="L2375">                list.add(e);</span>
<span class="fc" id="L2376">            }</span>
        })
<span class="fc" id="L2378">        .subscribe().isDisposed());</span>

<span class="fc" id="L2380">        assertEquals(Arrays.asList(1, null), list);</span>
<span class="fc" id="L2381">    }</span>

    @Test
    public void doOnEventError() {
<span class="fc" id="L2385">        List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>
        try {
<span class="fc" id="L2387">            final List&lt;Object&gt; list = new ArrayList&lt;Object&gt;();</span>

<span class="fc" id="L2389">            TestException ex = new TestException();</span>

<span class="fc" id="L2391">            assertTrue(Maybe.&lt;Integer&gt;error(ex)</span>
<span class="fc" id="L2392">            .doOnEvent(new BiConsumer&lt;Integer, Throwable&gt;() {</span>
                @Override
                public void accept(Integer v, Throwable e) throws Exception {
<span class="fc" id="L2395">                    list.add(v);</span>
<span class="fc" id="L2396">                    list.add(e);</span>
<span class="fc" id="L2397">                }</span>
            })
<span class="fc" id="L2399">            .subscribe().isDisposed());</span>

<span class="fc" id="L2401">            assertEquals(Arrays.asList(null, ex), list);</span>

<span class="fc" id="L2403">            TestHelper.assertError(errors, 0, OnErrorNotImplementedException.class);</span>
        } finally {
<span class="fc" id="L2405">            RxJavaPlugins.reset();</span>
        }
<span class="fc" id="L2407">    }</span>

    @Test
    public void doOnEventComplete() {
<span class="fc" id="L2411">        final List&lt;Object&gt; list = new ArrayList&lt;Object&gt;();</span>

<span class="fc" id="L2413">        assertTrue(Maybe.&lt;Integer&gt;empty()</span>
<span class="fc" id="L2414">        .doOnEvent(new BiConsumer&lt;Integer, Throwable&gt;() {</span>
            @Override
            public void accept(Integer v, Throwable e) throws Exception {
<span class="fc" id="L2417">                list.add(v);</span>
<span class="fc" id="L2418">                list.add(e);</span>
<span class="fc" id="L2419">            }</span>
        })
<span class="fc" id="L2421">        .subscribe().isDisposed());</span>

<span class="fc" id="L2423">        assertEquals(Arrays.asList(null, null), list);</span>
<span class="fc" id="L2424">    }</span>

    @Test(expected = NullPointerException.class)
    public void doOnEventNull() {
<span class="nc" id="L2428">        Maybe.just(1).doOnEvent(null);</span>
<span class="nc" id="L2429">    }</span>

    @Test
    public void doOnEventSuccessThrows() {
<span class="fc" id="L2433">        Maybe.just(1)</span>
<span class="fc" id="L2434">        .doOnEvent(new BiConsumer&lt;Integer, Throwable&gt;() {</span>
            @Override
            public void accept(Integer v, Throwable e) throws Exception {
<span class="fc" id="L2437">                throw new TestException();</span>
            }
        })
<span class="fc" id="L2440">        .test()</span>
<span class="fc" id="L2441">        .assertFailure(TestException.class);</span>
<span class="fc" id="L2442">    }</span>

    @Test
    public void doOnEventErrorThrows() {
<span class="fc" id="L2446">        TestObserver&lt;Integer&gt; to = Maybe.&lt;Integer&gt;error(new TestException(&quot;Outer&quot;))</span>
<span class="fc" id="L2447">        .doOnEvent(new BiConsumer&lt;Integer, Throwable&gt;() {</span>
            @Override
            public void accept(Integer v, Throwable e) throws Exception {
<span class="fc" id="L2450">                throw new TestException(&quot;Inner&quot;);</span>
            }
        })
<span class="fc" id="L2453">        .test()</span>
<span class="fc" id="L2454">        .assertFailure(CompositeException.class);</span>

<span class="fc" id="L2456">        List&lt;Throwable&gt; list = TestHelper.compositeList(to.errors().get(0));</span>
<span class="fc" id="L2457">        TestHelper.assertError(list, 0, TestException.class, &quot;Outer&quot;);</span>
<span class="fc" id="L2458">        TestHelper.assertError(list, 1, TestException.class, &quot;Inner&quot;);</span>
<span class="fc" id="L2459">        assertEquals(2, list.size());</span>
<span class="fc" id="L2460">    }</span>

    @Test
    public void doOnEventCompleteThrows() {
<span class="fc" id="L2464">        Maybe.&lt;Integer&gt;empty()</span>
<span class="fc" id="L2465">        .doOnEvent(new BiConsumer&lt;Integer, Throwable&gt;() {</span>
            @Override
            public void accept(Integer v, Throwable e) throws Exception {
<span class="fc" id="L2468">                throw new TestException();</span>
            }
        })
<span class="fc" id="L2471">        .test()</span>
<span class="fc" id="L2472">        .assertFailure(TestException.class);</span>
<span class="fc" id="L2473">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatArrayDelayError() {
<span class="fc" id="L2478">        Maybe.concatArrayDelayError(Maybe.empty(), Maybe.just(1), Maybe.error(new TestException()))</span>
<span class="fc" id="L2479">        .test()</span>
<span class="fc" id="L2480">        .assertFailure(TestException.class, 1);</span>

<span class="fc" id="L2482">        Maybe.concatArrayDelayError(Maybe.error(new TestException()), Maybe.empty(), Maybe.just(1))</span>
<span class="fc" id="L2483">        .test()</span>
<span class="fc" id="L2484">        .assertFailure(TestException.class, 1);</span>

<span class="fc" id="L2486">        assertSame(Flowable.empty(), Maybe.concatArrayDelayError());</span>

<span class="fc" id="L2488">        assertFalse(Maybe.concatArrayDelayError(Maybe.never()) instanceof MaybeConcatArrayDelayError);</span>
<span class="fc" id="L2489">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatIterableDelayError() {
<span class="fc" id="L2494">        Maybe.concatDelayError(Arrays.asList(Maybe.empty(), Maybe.just(1), Maybe.error(new TestException())))</span>
<span class="fc" id="L2495">        .test()</span>
<span class="fc" id="L2496">        .assertFailure(TestException.class, 1);</span>

<span class="fc" id="L2498">        Maybe.concatDelayError(Arrays.asList(Maybe.error(new TestException()), Maybe.empty(), Maybe.just(1)))</span>
<span class="fc" id="L2499">        .test()</span>
<span class="fc" id="L2500">        .assertFailure(TestException.class, 1);</span>
<span class="fc" id="L2501">    }</span>

    @Test
    public void concatPublisherDelayError() {
<span class="fc" id="L2505">        Maybe.concatDelayError(Flowable.just(Maybe.empty(), Maybe.just(1), Maybe.error(new TestException())))</span>
<span class="fc" id="L2506">        .test()</span>
<span class="fc" id="L2507">        .assertFailure(TestException.class, 1);</span>

<span class="fc" id="L2509">        Maybe.concatDelayError(Flowable.just(Maybe.error(new TestException()), Maybe.empty(), Maybe.just(1)))</span>
<span class="fc" id="L2510">        .test()</span>
<span class="fc" id="L2511">        .assertFailure(TestException.class, 1);</span>
<span class="fc" id="L2512">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatEagerArray() {
<span class="fc" id="L2517">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L2518">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L2520">        TestSubscriber&lt;Integer&gt; ts = Maybe.concatArrayEager(pp1.singleElement(), pp2.singleElement()).test();</span>

<span class="fc" id="L2522">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L2523">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L2525">        pp2.onNext(2);</span>
<span class="fc" id="L2526">        pp2.onComplete();</span>

<span class="fc" id="L2528">        ts.assertEmpty();</span>

<span class="fc" id="L2530">        pp1.onNext(1);</span>
<span class="fc" id="L2531">        pp1.onComplete();</span>

<span class="fc" id="L2533">        ts.assertResult(1, 2);</span>

<span class="fc" id="L2535">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void concatEagerIterable() {
<span class="fc" id="L2540">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L2541">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L2543">        TestSubscriber&lt;Integer&gt; ts = Maybe.concatEager(Arrays.asList(pp1.singleElement(), pp2.singleElement())).test();</span>

<span class="fc" id="L2545">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L2546">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L2548">        pp2.onNext(2);</span>
<span class="fc" id="L2549">        pp2.onComplete();</span>

<span class="fc" id="L2551">        ts.assertEmpty();</span>

<span class="fc" id="L2553">        pp1.onNext(1);</span>
<span class="fc" id="L2554">        pp1.onComplete();</span>

<span class="fc" id="L2556">        ts.assertResult(1, 2);</span>

<span class="fc" id="L2558">    }</span>

    @Test
    public void concatEagerPublisher() {
<span class="fc" id="L2562">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L2563">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L2565">        TestSubscriber&lt;Integer&gt; ts = Maybe.concatEager(Flowable.just(pp1.singleElement(), pp2.singleElement())).test();</span>

<span class="fc" id="L2567">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L2568">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L2570">        pp2.onNext(2);</span>
<span class="fc" id="L2571">        pp2.onComplete();</span>

<span class="fc" id="L2573">        ts.assertEmpty();</span>

<span class="fc" id="L2575">        pp1.onNext(1);</span>
<span class="fc" id="L2576">        pp1.onComplete();</span>

<span class="fc" id="L2578">        ts.assertResult(1, 2);</span>

<span class="fc" id="L2580">    }</span>

    static Future&lt;Integer&gt; emptyFuture() {
<span class="fc" id="L2583">        final ScheduledExecutorService exec = Executors.newSingleThreadScheduledExecutor();</span>

<span class="fc" id="L2585">        return exec.schedule(new Callable&lt;Integer&gt;() {</span>

            @Override
            public Integer call() throws Exception {
<span class="fc" id="L2589">                exec.shutdown();</span>
<span class="fc" id="L2590">                return null;</span>
            }
        }, 200, TimeUnit.MILLISECONDS);
    }

    @Test
    public void fromFuture() {
<span class="fc" id="L2597">        Maybe.fromFuture(Flowable.just(1).delay(200, TimeUnit.MILLISECONDS).toFuture())</span>
<span class="fc" id="L2598">        .test()</span>
<span class="fc" id="L2599">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L2600">        .assertResult(1)</span>
        ;

<span class="fc" id="L2603">        Maybe.fromFuture(emptyFuture())</span>
<span class="fc" id="L2604">        .test()</span>
<span class="fc" id="L2605">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L2606">        .assertResult()</span>
        ;

<span class="fc" id="L2609">        Maybe.fromFuture(Flowable.error(new TestException()).delay(200, TimeUnit.MILLISECONDS, true).toFuture())</span>
<span class="fc" id="L2610">        .test()</span>
<span class="fc" id="L2611">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L2612">        .assertFailure(TestException.class)</span>
        ;

<span class="fc" id="L2615">        Maybe.fromFuture(Flowable.empty().delay(10, TimeUnit.SECONDS).toFuture(), 100, TimeUnit.MILLISECONDS)</span>
<span class="fc" id="L2616">        .test()</span>
<span class="fc" id="L2617">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L2618">        .assertFailure(TimeoutException.class)</span>
        ;
<span class="fc" id="L2620">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeArrayDelayError() {
<span class="fc" id="L2625">        Maybe.mergeArrayDelayError(Maybe.empty(), Maybe.just(1), Maybe.error(new TestException()))</span>
<span class="fc" id="L2626">        .test()</span>
<span class="fc" id="L2627">        .assertFailure(TestException.class, 1);</span>

<span class="fc" id="L2629">        Maybe.mergeArrayDelayError(Maybe.error(new TestException()), Maybe.empty(), Maybe.just(1))</span>
<span class="fc" id="L2630">        .test()</span>
<span class="fc" id="L2631">        .assertFailure(TestException.class, 1);</span>

<span class="fc" id="L2633">        assertSame(Flowable.empty(), Maybe.mergeArrayDelayError());</span>
<span class="fc" id="L2634">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void mergeIterableDelayError() {
<span class="fc" id="L2639">        Maybe.mergeDelayError(Arrays.asList(Maybe.empty(), Maybe.just(1), Maybe.error(new TestException())))</span>
<span class="fc" id="L2640">        .test()</span>
<span class="fc" id="L2641">        .assertFailure(TestException.class, 1);</span>

<span class="fc" id="L2643">        Maybe.mergeDelayError(Arrays.asList(Maybe.error(new TestException()), Maybe.empty(), Maybe.just(1)))</span>
<span class="fc" id="L2644">        .test()</span>
<span class="fc" id="L2645">        .assertFailure(TestException.class, 1);</span>
<span class="fc" id="L2646">    }</span>

    @Test
    public void mergePublisherDelayError() {
<span class="fc" id="L2650">        Maybe.mergeDelayError(Flowable.just(Maybe.empty(), Maybe.just(1), Maybe.error(new TestException())))</span>
<span class="fc" id="L2651">        .test()</span>
<span class="fc" id="L2652">        .assertFailure(TestException.class, 1);</span>

<span class="fc" id="L2654">        Maybe.mergeDelayError(Flowable.just(Maybe.error(new TestException()), Maybe.empty(), Maybe.just(1)))</span>
<span class="fc" id="L2655">        .test()</span>
<span class="fc" id="L2656">        .assertFailure(TestException.class, 1);</span>
<span class="fc" id="L2657">    }</span>

    @Test
    public void mergeDelayError2() {
<span class="fc" id="L2661">        Maybe.mergeDelayError(Maybe.just(1), Maybe.error(new TestException()))</span>
<span class="fc" id="L2662">        .test()</span>
<span class="fc" id="L2663">        .assertFailure(TestException.class, 1);</span>

<span class="fc" id="L2665">        Maybe.mergeDelayError(Maybe.error(new TestException()), Maybe.just(1))</span>
<span class="fc" id="L2666">        .test()</span>
<span class="fc" id="L2667">        .assertFailure(TestException.class, 1);</span>
<span class="fc" id="L2668">    }</span>

    @Test
    public void mergeDelayError3() {
<span class="fc" id="L2672">        Maybe.mergeDelayError(Maybe.just(1), Maybe.error(new TestException()), Maybe.just(2))</span>
<span class="fc" id="L2673">        .test()</span>
<span class="fc" id="L2674">        .assertFailure(TestException.class, 1, 2);</span>

<span class="fc" id="L2676">        Maybe.mergeDelayError(Maybe.error(new TestException()), Maybe.just(1), Maybe.just(2))</span>
<span class="fc" id="L2677">        .test()</span>
<span class="fc" id="L2678">        .assertFailure(TestException.class, 1, 2);</span>

<span class="fc" id="L2680">        Maybe.mergeDelayError(Maybe.just(1), Maybe.just(2), Maybe.error(new TestException()))</span>
<span class="fc" id="L2681">        .test()</span>
<span class="fc" id="L2682">        .assertFailure(TestException.class, 1, 2);</span>
<span class="fc" id="L2683">    }</span>

    @Test
    public void mergeDelayError4() {
<span class="fc" id="L2687">        Maybe.mergeDelayError(Maybe.just(1), Maybe.error(new TestException()), Maybe.just(2), Maybe.just(3))</span>
<span class="fc" id="L2688">        .test()</span>
<span class="fc" id="L2689">        .assertFailure(TestException.class, 1, 2, 3);</span>

<span class="fc" id="L2691">        Maybe.mergeDelayError(Maybe.error(new TestException()), Maybe.just(1), Maybe.just(2), Maybe.just(3))</span>
<span class="fc" id="L2692">        .test()</span>
<span class="fc" id="L2693">        .assertFailure(TestException.class, 1, 2, 3);</span>

<span class="fc" id="L2695">        Maybe.mergeDelayError(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.error(new TestException()))</span>
<span class="fc" id="L2696">        .test()</span>
<span class="fc" id="L2697">        .assertFailure(TestException.class, 1, 2, 3);</span>
<span class="fc" id="L2698">    }</span>

    @Test
    public void sequenceEqual() {
<span class="fc" id="L2702">        Maybe.sequenceEqual(Maybe.just(1), Maybe.just(new Integer(1))).test().assertResult(true);</span>

<span class="fc" id="L2704">        Maybe.sequenceEqual(Maybe.just(1), Maybe.just(2)).test().assertResult(false);</span>

<span class="fc" id="L2706">        Maybe.sequenceEqual(Maybe.just(1), Maybe.empty()).test().assertResult(false);</span>

<span class="fc" id="L2708">        Maybe.sequenceEqual(Maybe.empty(), Maybe.just(2)).test().assertResult(false);</span>

<span class="fc" id="L2710">        Maybe.sequenceEqual(Maybe.empty(), Maybe.empty()).test().assertResult(true);</span>

<span class="fc" id="L2712">        Maybe.sequenceEqual(Maybe.just(1), Maybe.error(new TestException())).test().assertFailure(TestException.class);</span>

<span class="fc" id="L2714">        Maybe.sequenceEqual(Maybe.error(new TestException()), Maybe.just(1)).test().assertFailure(TestException.class);</span>

<span class="fc" id="L2716">        List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>

        try {
<span class="fc" id="L2719">            Maybe.sequenceEqual(Maybe.error(new TestException(&quot;One&quot;)), Maybe.error(new TestException(&quot;Two&quot;))).test().assertFailureAndMessage(TestException.class, &quot;One&quot;);</span>

<span class="fc" id="L2721">            TestHelper.assertUndeliverable(errors, 0, TestException.class, &quot;Two&quot;);</span>
        } finally {
<span class="fc" id="L2723">            RxJavaPlugins.reset();</span>
        }

<span class="fc" id="L2726">        Maybe.sequenceEqual(Maybe.just(1), Maybe.error(new TestException()), new BiPredicate&lt;Object, Object&gt;() {</span>
            @Override
            public boolean test(Object t1, Object t2) throws Exception {
<span class="nc" id="L2729">                throw new TestException();</span>
            }
        })
<span class="fc" id="L2732">        .test().assertFailure(TestException.class);</span>
<span class="fc" id="L2733">    }</span>

    @Test
    public void timer() {
<span class="fc" id="L2737">        Maybe.timer(100, TimeUnit.MILLISECONDS)</span>
<span class="fc" id="L2738">        .test()</span>
<span class="fc" id="L2739">        .awaitDone(5, TimeUnit.SECONDS)</span>
<span class="fc" id="L2740">        .assertResult(0L);</span>
<span class="fc" id="L2741">    }</span>

    @Test
    public void blockingGet() {
<span class="fc" id="L2745">        assertEquals(1, Maybe.just(1).blockingGet().intValue());</span>

<span class="fc" id="L2747">        assertEquals(100, Maybe.empty().blockingGet(100));</span>

        try {
<span class="nc" id="L2750">            Maybe.error(new TestException()).blockingGet();</span>
<span class="nc" id="L2751">            fail(&quot;Should have thrown!&quot;);</span>
<span class="fc" id="L2752">        } catch (TestException ex) {</span>
            // expected
<span class="nc" id="L2754">        }</span>

        try {
<span class="nc" id="L2757">            Maybe.error(new TestException()).blockingGet(100);</span>
<span class="nc" id="L2758">            fail(&quot;Should have thrown!&quot;);</span>
<span class="fc" id="L2759">        } catch (TestException ex) {</span>
            // expected
<span class="nc" id="L2761">        }</span>
<span class="fc" id="L2762">    }</span>

    @Test
    public void toSingleDefault() {
<span class="fc" id="L2766">        Maybe.just(1).toSingle(100)</span>
<span class="fc" id="L2767">        .test().assertResult(1);</span>

<span class="fc" id="L2769">        Maybe.empty().toSingle(100)</span>
<span class="fc" id="L2770">        .test().assertResult(100);</span>
<span class="fc" id="L2771">    }</span>

    @Test
    public void flatMapContinuation() {
<span class="fc" id="L2775">        Maybe.just(1).flatMapCompletable(new Function&lt;Integer, Completable&gt;() {</span>
            @Override
            public Completable apply(Integer v) throws Exception {
<span class="fc" id="L2778">                return Completable.complete();</span>
            }
        })
<span class="fc" id="L2781">        .test().assertResult();</span>

<span class="fc" id="L2783">        Maybe.just(1).flatMapCompletable(new Function&lt;Integer, Completable&gt;() {</span>
            @Override
            public Completable apply(Integer v) throws Exception {
<span class="fc" id="L2786">                return Completable.error(new TestException());</span>
            }
        })
<span class="fc" id="L2789">        .test().assertFailure(TestException.class);</span>

<span class="fc" id="L2791">        Maybe.just(1).flatMapPublisher(new Function&lt;Integer, Publisher&lt;Integer&gt;&gt;() {</span>
            @Override
            public Publisher&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L2794">                return Flowable.range(1, 5);</span>
            }
        })
<span class="fc" id="L2797">        .test().assertResult(1, 2, 3, 4, 5);</span>

<span class="fc" id="L2799">        Maybe.just(1).flatMapPublisher(new Function&lt;Integer, Publisher&lt;Integer&gt;&gt;() {</span>
            @Override
            public Publisher&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L2802">                return Flowable.error(new TestException());</span>
            }
        })
<span class="fc" id="L2805">        .test().assertFailure(TestException.class);</span>

<span class="fc" id="L2807">        Maybe.just(1).flatMapObservable(new Function&lt;Integer, Observable&lt;Integer&gt;&gt;() {</span>
            @Override
            public Observable&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L2810">                return Observable.range(1, 5);</span>
            }
        })
<span class="fc" id="L2813">        .test().assertResult(1, 2, 3, 4, 5);</span>

<span class="fc" id="L2815">        Maybe.just(1).flatMapObservable(new Function&lt;Integer, Observable&lt;Integer&gt;&gt;() {</span>
            @Override
            public Observable&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L2818">                return Observable.error(new TestException());</span>
            }
        })
<span class="fc" id="L2821">        .test().assertFailure(TestException.class);</span>
<span class="fc" id="L2822">    }</span>

    @Test
    public void using() {
<span class="fc" id="L2826">        final AtomicInteger disposeCount = new AtomicInteger();</span>

<span class="fc" id="L2828">        Maybe.using(Functions.justCallable(1), new Function&lt;Integer, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L2831">                return Maybe.just(v);</span>
            }
<span class="fc" id="L2833">        }, new Consumer&lt;Integer&gt;() {</span>
            @Override
            public void accept(Integer d) throws Exception {
<span class="fc" id="L2836">                disposeCount.set(d);</span>
<span class="fc" id="L2837">            }</span>
        })
<span class="fc" id="L2839">        .map(new Function&lt;Integer, Object&gt;() {</span>
            @Override
            public String apply(Integer v) throws Exception {
<span class="fc" id="L2842">                return &quot;&quot; + disposeCount.get() + v * 10;</span>
            }
        })
<span class="fc" id="L2845">        .test()</span>
<span class="fc" id="L2846">        .assertResult(&quot;110&quot;);</span>
<span class="fc" id="L2847">    }</span>

    @Test
    public void usingNonEager() {
<span class="fc" id="L2851">        final AtomicInteger disposeCount = new AtomicInteger();</span>

<span class="fc" id="L2853">        Maybe.using(Functions.justCallable(1), new Function&lt;Integer, MaybeSource&lt;Integer&gt;&gt;() {</span>
            @Override
            public MaybeSource&lt;Integer&gt; apply(Integer v) throws Exception {
<span class="fc" id="L2856">                return Maybe.just(v);</span>
            }
<span class="fc" id="L2858">        }, new Consumer&lt;Integer&gt;() {</span>
            @Override
            public void accept(Integer d) throws Exception {
<span class="fc" id="L2861">                disposeCount.set(d);</span>
<span class="fc" id="L2862">            }</span>
        }, false)
<span class="fc" id="L2864">        .map(new Function&lt;Integer, Object&gt;() {</span>
            @Override
            public String apply(Integer v) throws Exception {
<span class="fc" id="L2867">                return &quot;&quot; + disposeCount.get() + v * 10;</span>
            }
        })
<span class="fc" id="L2870">        .test()</span>
<span class="fc" id="L2871">        .assertResult(&quot;010&quot;);</span>

<span class="fc" id="L2873">        assertEquals(1, disposeCount.get());</span>
<span class="fc" id="L2874">    }</span>

<span class="fc" id="L2876">    Function&lt;Object[], String&gt; arrayToString = new Function&lt;Object[], String&gt;() {</span>
        @Override
        public String apply(Object[] a) throws Exception {
<span class="fc" id="L2879">            return Arrays.toString(a);</span>
        }
    };

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zipArray() {
<span class="fc" id="L2886">        Maybe.zipArray(arrayToString, Maybe.just(1), Maybe.just(2))</span>
<span class="fc" id="L2887">        .test()</span>
<span class="fc" id="L2888">        .assertResult(&quot;[1, 2]&quot;);</span>

<span class="fc" id="L2890">        Maybe.zipArray(arrayToString, Maybe.just(1), Maybe.empty())</span>
<span class="fc" id="L2891">        .test()</span>
<span class="fc" id="L2892">        .assertResult();</span>

<span class="fc" id="L2894">        Maybe.zipArray(arrayToString, Maybe.just(1), Maybe.error(new TestException()))</span>
<span class="fc" id="L2895">        .test()</span>
<span class="fc" id="L2896">        .assertFailure(TestException.class);</span>

<span class="fc" id="L2898">        assertSame(Maybe.empty(), Maybe.zipArray(ArgsToString.INSTANCE));</span>

<span class="fc" id="L2900">        Maybe.zipArray(arrayToString, Maybe.just(1))</span>
<span class="fc" id="L2901">        .test()</span>
<span class="fc" id="L2902">        .assertResult(&quot;[1]&quot;);</span>
<span class="fc" id="L2903">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zipIterable() {
<span class="fc" id="L2908">        Maybe.zip(</span>
<span class="fc" id="L2909">        Arrays.asList(Maybe.just(1), Maybe.just(2)),</span>
        arrayToString)
<span class="fc" id="L2911">        .test()</span>
<span class="fc" id="L2912">        .assertResult(&quot;[1, 2]&quot;);</span>

<span class="fc" id="L2914">        Maybe.zip(Collections.&lt;Maybe&lt;Integer&gt;&gt;emptyList(), arrayToString)</span>
<span class="fc" id="L2915">        .test()</span>
<span class="fc" id="L2916">        .assertResult();</span>

<span class="fc" id="L2918">        Maybe.zip(Collections.singletonList(Maybe.just(1)), arrayToString)</span>
<span class="fc" id="L2919">        .test()</span>
<span class="fc" id="L2920">        .assertResult(&quot;[1]&quot;);</span>
<span class="fc" id="L2921">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zip2() {
<span class="fc" id="L2926">        Maybe.zip(Maybe.just(1), Maybe.just(2), ArgsToString.INSTANCE)</span>
<span class="fc" id="L2927">        .test()</span>
<span class="fc" id="L2928">        .assertResult(&quot;12&quot;);</span>
<span class="fc" id="L2929">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zipWith() {
<span class="fc" id="L2934">        Maybe.just(1).zipWith(Maybe.just(2), ArgsToString.INSTANCE)</span>
<span class="fc" id="L2935">        .test()</span>
<span class="fc" id="L2936">        .assertResult(&quot;12&quot;);</span>
<span class="fc" id="L2937">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zip3() {
<span class="fc" id="L2942">        Maybe.zip(Maybe.just(1), Maybe.just(2), Maybe.just(3),</span>
            ArgsToString.INSTANCE)
<span class="fc" id="L2944">        .test()</span>
<span class="fc" id="L2945">        .assertResult(&quot;123&quot;);</span>
<span class="fc" id="L2946">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zip4() {
<span class="fc" id="L2951">        Maybe.zip(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.just(4),</span>
            ArgsToString.INSTANCE)
<span class="fc" id="L2953">        .test()</span>
<span class="fc" id="L2954">        .assertResult(&quot;1234&quot;);</span>
<span class="fc" id="L2955">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zip5() {
<span class="fc" id="L2960">        Maybe.zip(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.just(4),</span>
<span class="fc" id="L2961">                Maybe.just(5),</span>
            ArgsToString.INSTANCE)
<span class="fc" id="L2963">        .test()</span>
<span class="fc" id="L2964">        .assertResult(&quot;12345&quot;);</span>
<span class="fc" id="L2965">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zip6() {
<span class="fc" id="L2970">        Maybe.zip(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.just(4),</span>
<span class="fc" id="L2971">                Maybe.just(5), Maybe.just(6),</span>
            ArgsToString.INSTANCE)
<span class="fc" id="L2973">        .test()</span>
<span class="fc" id="L2974">        .assertResult(&quot;123456&quot;);</span>
<span class="fc" id="L2975">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zip7() {
<span class="fc" id="L2980">        Maybe.zip(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.just(4),</span>
<span class="fc" id="L2981">                Maybe.just(5), Maybe.just(6), Maybe.just(7),</span>
            ArgsToString.INSTANCE)
<span class="fc" id="L2983">        .test()</span>
<span class="fc" id="L2984">        .assertResult(&quot;1234567&quot;);</span>
<span class="fc" id="L2985">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zip8() {
<span class="fc" id="L2990">        Maybe.zip(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.just(4),</span>
<span class="fc" id="L2991">                Maybe.just(5), Maybe.just(6), Maybe.just(7), Maybe.just(8),</span>
            ArgsToString.INSTANCE)
<span class="fc" id="L2993">        .test()</span>
<span class="fc" id="L2994">        .assertResult(&quot;12345678&quot;);</span>
<span class="fc" id="L2995">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    @Test
    public void zip9() {
<span class="fc" id="L3000">        Maybe.zip(Maybe.just(1), Maybe.just(2), Maybe.just(3), Maybe.just(4),</span>
<span class="fc" id="L3001">                Maybe.just(5), Maybe.just(6), Maybe.just(7), Maybe.just(8), Maybe.just(9),</span>
            ArgsToString.INSTANCE)
<span class="fc" id="L3003">        .test()</span>
<span class="fc" id="L3004">        .assertResult(&quot;123456789&quot;);</span>
<span class="fc" id="L3005">    }</span>

    @Test
    public void ambWith1SignalsSuccess() {
<span class="fc" id="L3009">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L3010">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L3012">        TestObserver&lt;Integer&gt; to = pp1.singleElement().ambWith(pp2.singleElement())</span>
<span class="fc" id="L3013">        .test();</span>

<span class="fc" id="L3015">        to.assertEmpty();</span>

<span class="fc" id="L3017">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L3018">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L3020">        pp1.onNext(1);</span>
<span class="fc" id="L3021">        pp1.onComplete();</span>

<span class="fc" id="L3023">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L3024">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L3026">        to.assertResult(1);</span>
<span class="fc" id="L3027">    }</span>

    @Test
    public void ambWith2SignalsSuccess() {
<span class="fc" id="L3031">        PublishProcessor&lt;Integer&gt; pp1 = PublishProcessor.create();</span>
<span class="fc" id="L3032">        PublishProcessor&lt;Integer&gt; pp2 = PublishProcessor.create();</span>

<span class="fc" id="L3034">        TestObserver&lt;Integer&gt; to = pp1.singleElement().ambWith(pp2.singleElement())</span>
<span class="fc" id="L3035">        .test();</span>

<span class="fc" id="L3037">        to.assertEmpty();</span>

<span class="fc" id="L3039">        assertTrue(pp1.hasSubscribers());</span>
<span class="fc" id="L3040">        assertTrue(pp2.hasSubscribers());</span>

<span class="fc" id="L3042">        pp2.onNext(2);</span>
<span class="fc" id="L3043">        pp2.onComplete();</span>

<span class="fc" id="L3045">        assertFalse(pp1.hasSubscribers());</span>
<span class="fc" id="L3046">        assertFalse(pp2.hasSubscribers());</span>

<span class="fc" id="L3048">        to.assertResult(2);</span>
<span class="fc" id="L3049">    }</span>

    @Test
    public void zipIterableObject() {
        @SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L3054">        final List&lt;Maybe&lt;Integer&gt;&gt; maybes = Arrays.asList(Maybe.just(1), Maybe.just(4));</span>
<span class="fc" id="L3055">        Maybe.zip(maybes, new Function&lt;Object[], Object&gt;() {</span>
            @Override
            public Object apply(final Object[] o) throws Exception {
<span class="fc" id="L3058">                int sum = 0;</span>
<span class="fc bfc" id="L3059" title="All 2 branches covered.">                for (Object i : o) {</span>
<span class="fc" id="L3060">                    sum += (Integer) i;</span>
                }
<span class="fc" id="L3062">                return sum;</span>
            }
<span class="fc" id="L3064">        }).test().assertResult(5);</span>
<span class="fc" id="L3065">    }</span>

    static long usedMemoryNow() {
<span class="fc" id="L3068">        MemoryMXBean memoryMXBean = ManagementFactory.getMemoryMXBean();</span>

<span class="fc" id="L3070">        MemoryUsage heapMemoryUsage = memoryMXBean.getHeapMemoryUsage();</span>

<span class="fc" id="L3072">        return heapMemoryUsage.getUsed();</span>
    }

    @Test
    public void onTerminateDetach() throws Exception {
<span class="fc" id="L3077">        System.gc();</span>

<span class="fc" id="L3079">        Thread.sleep(150);</span>

<span class="fc" id="L3081">        long before = usedMemoryNow();</span>

<span class="fc" id="L3083">        Maybe&lt;Object&gt; source = Flowable.just((Object)new Object[10000000]).singleElement();</span>

<span class="fc" id="L3085">        long middle = usedMemoryNow();</span>

<span class="fc" id="L3087">        MaybeObserver&lt;Object&gt; observer = new MaybeObserver&lt;Object&gt;() {</span>
            @SuppressWarnings(&quot;unused&quot;)
            Disposable u;

            @Override
            public void onSubscribe(Disposable d) {
<span class="fc" id="L3093">                this.u = d;</span>
<span class="fc" id="L3094">            }</span>

            @Override
            public void onSuccess(Object value) {

<span class="fc" id="L3099">            }</span>

            @Override
            public void onError(Throwable e) {

<span class="nc" id="L3104">            }</span>

            @Override
            public void onComplete() {

<span class="nc" id="L3109">            }</span>

        };
<span class="fc" id="L3112">        source.onTerminateDetach().subscribe(observer);</span>

<span class="fc" id="L3114">        source = null;</span>

<span class="fc" id="L3116">        System.gc();</span>

<span class="fc" id="L3118">        Thread.sleep(250);</span>

<span class="fc" id="L3120">        long after = usedMemoryNow();</span>

<span class="fc" id="L3122">        String log = String.format(&quot;%.2f MB -&gt; %.2f MB -&gt; %.2f MB%n&quot;,</span>
<span class="fc" id="L3123">                before / 1024.0 / 1024.0,</span>
<span class="fc" id="L3124">                middle / 1024.0 / 1024.0,</span>
<span class="fc" id="L3125">                after / 1024.0 / 1024.0);</span>

<span class="fc" id="L3127">        System.out.printf(log);</span>

<span class="pc bpc" id="L3129" title="1 of 2 branches missed.">        if (before * 1.3 &lt; after) {</span>
<span class="nc" id="L3130">            fail(&quot;There seems to be a memory leak: &quot; + log);</span>
        }

<span class="fc" id="L3133">        assertNotNull(observer); // hold onto the reference to prevent premature GC</span>
<span class="fc" id="L3134">    }</span>

    @Test
    public void repeat() {
<span class="fc" id="L3138">        Maybe.just(1).repeat().take(5).test().assertResult(1, 1, 1, 1, 1);</span>

<span class="fc" id="L3140">        Maybe.just(1).repeat(5).test().assertResult(1, 1, 1, 1, 1);</span>

<span class="fc" id="L3142">        Maybe.just(1).repeatUntil(new BooleanSupplier() {</span>
            @Override
            public boolean getAsBoolean() throws Exception {
<span class="fc" id="L3145">                return false;</span>
            }
<span class="fc" id="L3147">        }).take(5).test().assertResult(1, 1, 1, 1, 1);</span>

<span class="fc" id="L3149">        Maybe.just(1).repeatWhen(new Function&lt;Flowable&lt;Object&gt;, Publisher&lt;Object&gt;&gt;() {</span>
            @Override
            public Publisher&lt;Object&gt; apply(Flowable&lt;Object&gt; v) throws Exception {
<span class="fc" id="L3152">                return v;</span>
            }
<span class="fc" id="L3154">        }).take(5).test().assertResult(1, 1, 1, 1, 1);</span>
<span class="fc" id="L3155">    }</span>

    @Test
    public void retry() {
<span class="fc" id="L3159">        Maybe.just(1).retry().test().assertResult(1);</span>

<span class="fc" id="L3161">        Maybe.just(1).retry(5).test().assertResult(1);</span>

<span class="fc" id="L3163">        Maybe.just(1).retry(Functions.alwaysTrue()).test().assertResult(1);</span>

<span class="fc" id="L3165">        Maybe.just(1).retry(5, Functions.alwaysTrue()).test().assertResult(1);</span>

<span class="fc" id="L3167">        Maybe.just(1).retry(new BiPredicate&lt;Integer, Throwable&gt;() {</span>
            @Override
            public boolean test(Integer a, Throwable e) throws Exception {
<span class="nc" id="L3170">                return true;</span>
            }
<span class="fc" id="L3172">        }).test().assertResult(1);</span>

<span class="fc" id="L3174">        Maybe.just(1).retryUntil(new BooleanSupplier() {</span>
            @Override
            public boolean getAsBoolean() throws Exception {
<span class="nc" id="L3177">                return false;</span>
            }
<span class="fc" id="L3179">        }).test().assertResult(1);</span>

<span class="fc" id="L3181">        Maybe.just(1).retryWhen(new Function&lt;Flowable&lt;? extends Throwable&gt;, Publisher&lt;Object&gt;&gt;() {</span>
            @SuppressWarnings({ &quot;rawtypes&quot;, &quot;unchecked&quot; })
            @Override
            public Publisher&lt;Object&gt; apply(Flowable&lt;? extends Throwable&gt; v) throws Exception {
<span class="fc" id="L3185">                return (Publisher)v;</span>
            }
<span class="fc" id="L3187">        }).test().assertResult(1);</span>

<span class="fc" id="L3189">        final AtomicInteger calls = new AtomicInteger();</span>
        try {
<span class="fc" id="L3191">            Maybe.error(new Callable&lt;Throwable&gt;() {</span>
                @Override
                public Throwable call() {
<span class="fc" id="L3194">                    calls.incrementAndGet();</span>
<span class="fc" id="L3195">                    return new TestException();</span>
                }
<span class="fc" id="L3197">            }).retry(5).test();</span>
        } finally {
<span class="fc" id="L3199">            assertEquals(6, calls.get());</span>
        }
<span class="fc" id="L3201">    }</span>

    @Test
    public void onErrorResumeNextEmpty() {
<span class="fc" id="L3205">        Maybe.empty()</span>
<span class="fc" id="L3206">            .onErrorResumeNext(Maybe.just(1))</span>
<span class="fc" id="L3207">            .test()</span>
<span class="fc" id="L3208">            .assertNoValues()</span>
<span class="fc" id="L3209">            .assertNoErrors()</span>
<span class="fc" id="L3210">            .assertComplete();</span>
<span class="fc" id="L3211">    }</span>

    @Test
    public void onErrorResumeNextValue() {
<span class="fc" id="L3215">        Maybe.just(1)</span>
<span class="fc" id="L3216">            .onErrorResumeNext(Maybe.&lt;Integer&gt;empty())</span>
<span class="fc" id="L3217">            .test()</span>
<span class="fc" id="L3218">            .assertNoErrors()</span>
<span class="fc" id="L3219">            .assertValue(1);</span>
<span class="fc" id="L3220">    }</span>

    @Test
    public void onErrorResumeNextError() {
<span class="fc" id="L3224">        Maybe.error(new RuntimeException(&quot;some error&quot;))</span>
<span class="fc" id="L3225">            .onErrorResumeNext(Maybe.empty())</span>
<span class="fc" id="L3226">            .test()</span>
<span class="fc" id="L3227">            .assertNoValues()</span>
<span class="fc" id="L3228">            .assertNoErrors()</span>
<span class="fc" id="L3229">            .assertComplete();</span>
<span class="fc" id="L3230">    }</span>

    @Test
    public void valueConcatWithValue() {
<span class="fc" id="L3234">        Maybe.just(1)</span>
<span class="fc" id="L3235">            .concatWith(Maybe.just(2))</span>
<span class="fc" id="L3236">            .test()</span>
<span class="fc" id="L3237">            .assertNoErrors()</span>
<span class="fc" id="L3238">            .assertComplete()</span>
<span class="fc" id="L3239">            .assertValues(1, 2);</span>
<span class="fc" id="L3240">    }</span>

    @Test
    public void errorConcatWithValue() {
<span class="fc" id="L3244">        Maybe.&lt;Integer&gt;error(new RuntimeException(&quot;error&quot;))</span>
<span class="fc" id="L3245">            .concatWith(Maybe.just(2))</span>
<span class="fc" id="L3246">            .test()</span>
<span class="fc" id="L3247">            .assertError(RuntimeException.class)</span>
<span class="fc" id="L3248">            .assertErrorMessage(&quot;error&quot;)</span>
<span class="fc" id="L3249">            .assertNoValues();</span>
<span class="fc" id="L3250">    }</span>

    @Test
    public void valueConcatWithError() {
<span class="fc" id="L3254">        Maybe.just(1)</span>
<span class="fc" id="L3255">            .concatWith(Maybe.&lt;Integer&gt;error(new RuntimeException(&quot;error&quot;)))</span>
<span class="fc" id="L3256">            .test()</span>
<span class="fc" id="L3257">            .assertValue(1)</span>
<span class="fc" id="L3258">            .assertError(RuntimeException.class)</span>
<span class="fc" id="L3259">            .assertErrorMessage(&quot;error&quot;);</span>
<span class="fc" id="L3260">    }</span>

    @Test
    public void emptyConcatWithValue() {
<span class="fc" id="L3264">        Maybe.&lt;Integer&gt;empty()</span>
<span class="fc" id="L3265">            .concatWith(Maybe.just(2))</span>
<span class="fc" id="L3266">            .test()</span>
<span class="fc" id="L3267">            .assertNoErrors()</span>
<span class="fc" id="L3268">            .assertComplete()</span>
<span class="fc" id="L3269">            .assertValues(2);</span>
<span class="fc" id="L3270">    }</span>

    @Test
    public void emptyConcatWithError() {
<span class="fc" id="L3274">        Maybe.&lt;Integer&gt;empty()</span>
<span class="fc" id="L3275">            .concatWith(Maybe.&lt;Integer&gt;error(new RuntimeException(&quot;error&quot;)))</span>
<span class="fc" id="L3276">            .test()</span>
<span class="fc" id="L3277">            .assertNoValues()</span>
<span class="fc" id="L3278">            .assertError(RuntimeException.class)</span>
<span class="fc" id="L3279">            .assertErrorMessage(&quot;error&quot;);</span>
<span class="fc" id="L3280">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>