<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SerializedProcessorTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RxJava_2_x$Unnamed.exec</a> &gt; <a href="index.source.html" class="el_package">io.reactivex.processors</a> &gt; <span class="el_source">SerializedProcessorTest.java</span></div><h1>SerializedProcessorTest.java</h1><pre class="source lang-java linenums">/**
 * Copyright (c) 2016-present, RxJava Contributors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is
 * distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See
 * the License for the specific language governing permissions and limitations under the License.
 */

package io.reactivex.processors;

import static org.junit.Assert.*;

import java.util.*;

import org.junit.Test;

import io.reactivex.*;
import io.reactivex.exceptions.TestException;
import io.reactivex.internal.subscriptions.BooleanSubscription;
import io.reactivex.plugins.RxJavaPlugins;
import io.reactivex.subscribers.TestSubscriber;

<span class="fc" id="L28">public class SerializedProcessorTest {</span>

    @Test
    public void testBasic() {
<span class="fc" id="L32">        SerializedProcessor&lt;String&gt; processor = new SerializedProcessor&lt;String&gt;(PublishProcessor.&lt;String&gt; create());</span>
<span class="fc" id="L33">        TestSubscriber&lt;String&gt; ts = new TestSubscriber&lt;String&gt;();</span>
<span class="fc" id="L34">        processor.subscribe(ts);</span>
<span class="fc" id="L35">        processor.onNext(&quot;hello&quot;);</span>
<span class="fc" id="L36">        processor.onComplete();</span>
<span class="fc" id="L37">        ts.awaitTerminalEvent();</span>
<span class="fc" id="L38">        ts.assertValue(&quot;hello&quot;);</span>
<span class="fc" id="L39">    }</span>

    @SuppressWarnings(&quot;deprecation&quot;)
    @Test
    public void testAsyncSubjectValueRelay() {
<span class="fc" id="L44">        AsyncProcessor&lt;Integer&gt; async = AsyncProcessor.create();</span>
<span class="fc" id="L45">        async.onNext(1);</span>
<span class="fc" id="L46">        async.onComplete();</span>
<span class="fc" id="L47">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L49">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L50">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L51">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L52">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L53">        assertEquals((Integer)1, async.getValue());</span>
<span class="fc" id="L54">        assertTrue(async.hasValue());</span>
<span class="fc" id="L55">        assertArrayEquals(new Object[] { 1 }, async.getValues());</span>
<span class="fc" id="L56">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L57">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L58">        assertArrayEquals(new Integer[] { 1, null }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L59">    }</span>

    @SuppressWarnings(&quot;deprecation&quot;)
    @Test
    public void testAsyncSubjectValueEmpty() {
<span class="fc" id="L64">        AsyncProcessor&lt;Integer&gt; async = AsyncProcessor.create();</span>
<span class="fc" id="L65">        async.onComplete();</span>
<span class="fc" id="L66">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L68">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L69">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L70">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L71">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L72">        assertNull(async.getValue());</span>
<span class="fc" id="L73">        assertFalse(async.hasValue());</span>
<span class="fc" id="L74">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L75">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L76">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L77">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L78">    }</span>

    @SuppressWarnings(&quot;deprecation&quot;)
    @Test
    public void testAsyncSubjectValueError() {
<span class="fc" id="L83">        AsyncProcessor&lt;Integer&gt; async = AsyncProcessor.create();</span>
<span class="fc" id="L84">        TestException te = new TestException();</span>
<span class="fc" id="L85">        async.onError(te);</span>
<span class="fc" id="L86">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L88">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L89">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L90">        assertTrue(serial.hasThrowable());</span>
<span class="fc" id="L91">        assertSame(te, serial.getThrowable());</span>
<span class="fc" id="L92">        assertNull(async.getValue());</span>
<span class="fc" id="L93">        assertFalse(async.hasValue());</span>
<span class="fc" id="L94">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L95">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L96">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L97">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L98">    }</span>

    @Test
    public void testPublishSubjectValueRelay() {
<span class="fc" id="L102">        PublishProcessor&lt;Integer&gt; async = PublishProcessor.create();</span>
<span class="fc" id="L103">        async.onNext(1);</span>
<span class="fc" id="L104">        async.onComplete();</span>
<span class="fc" id="L105">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L107">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L108">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L109">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L110">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L111">    }</span>

    @Test
    public void testPublishSubjectValueEmpty() {
<span class="fc" id="L115">        PublishProcessor&lt;Integer&gt; async = PublishProcessor.create();</span>
<span class="fc" id="L116">        async.onComplete();</span>
<span class="fc" id="L117">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L119">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L120">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L121">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L122">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L123">    }</span>

    @Test
    public void testPublishSubjectValueError() {
<span class="fc" id="L127">        PublishProcessor&lt;Integer&gt; async = PublishProcessor.create();</span>
<span class="fc" id="L128">        TestException te = new TestException();</span>
<span class="fc" id="L129">        async.onError(te);</span>
<span class="fc" id="L130">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L132">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L133">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L134">        assertTrue(serial.hasThrowable());</span>
<span class="fc" id="L135">        assertSame(te, serial.getThrowable());</span>
<span class="fc" id="L136">    }</span>

    @SuppressWarnings(&quot;deprecation&quot;)
    @Test
    public void testBehaviorSubjectValueRelay() {
<span class="fc" id="L141">        BehaviorProcessor&lt;Integer&gt; async = BehaviorProcessor.create();</span>
<span class="fc" id="L142">        async.onNext(1);</span>
<span class="fc" id="L143">        async.onComplete();</span>
<span class="fc" id="L144">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L146">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L147">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L148">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L149">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L150">        assertNull(async.getValue());</span>
<span class="fc" id="L151">        assertFalse(async.hasValue());</span>
<span class="fc" id="L152">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L153">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L154">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L155">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L156">    }</span>

    @SuppressWarnings(&quot;deprecation&quot;)
    @Test
    public void testBehaviorSubjectValueRelayIncomplete() {
<span class="fc" id="L161">        BehaviorProcessor&lt;Integer&gt; async = BehaviorProcessor.create();</span>
<span class="fc" id="L162">        async.onNext(1);</span>
<span class="fc" id="L163">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L165">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L166">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L167">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L168">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L169">        assertEquals((Integer)1, async.getValue());</span>
<span class="fc" id="L170">        assertTrue(async.hasValue());</span>
<span class="fc" id="L171">        assertArrayEquals(new Object[] { 1 }, async.getValues());</span>
<span class="fc" id="L172">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L173">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L174">        assertArrayEquals(new Integer[] { 1, null }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L175">    }</span>

    @SuppressWarnings(&quot;deprecation&quot;)
    @Test
    public void testBehaviorSubjectIncompleteEmpty() {
<span class="fc" id="L180">        BehaviorProcessor&lt;Integer&gt; async = BehaviorProcessor.create();</span>
<span class="fc" id="L181">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L183">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L184">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L185">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L186">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L187">        assertNull(async.getValue());</span>
<span class="fc" id="L188">        assertFalse(async.hasValue());</span>
<span class="fc" id="L189">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L190">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L191">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L192">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L193">    }</span>

    @SuppressWarnings(&quot;deprecation&quot;)
    @Test
    public void testBehaviorSubjectEmpty() {
<span class="fc" id="L198">        BehaviorProcessor&lt;Integer&gt; async = BehaviorProcessor.create();</span>
<span class="fc" id="L199">        async.onComplete();</span>
<span class="fc" id="L200">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L202">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L203">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L204">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L205">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L206">        assertNull(async.getValue());</span>
<span class="fc" id="L207">        assertFalse(async.hasValue());</span>
<span class="fc" id="L208">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L209">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L210">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L211">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L212">    }</span>

    @SuppressWarnings(&quot;deprecation&quot;)
    @Test
    public void testBehaviorSubjectError() {
<span class="fc" id="L217">        BehaviorProcessor&lt;Integer&gt; async = BehaviorProcessor.create();</span>
<span class="fc" id="L218">        TestException te = new TestException();</span>
<span class="fc" id="L219">        async.onError(te);</span>
<span class="fc" id="L220">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L222">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L223">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L224">        assertTrue(serial.hasThrowable());</span>
<span class="fc" id="L225">        assertSame(te, serial.getThrowable());</span>
<span class="fc" id="L226">        assertNull(async.getValue());</span>
<span class="fc" id="L227">        assertFalse(async.hasValue());</span>
<span class="fc" id="L228">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L229">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L230">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L231">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L232">    }</span>

    @Test
    public void testReplaySubjectValueRelay() {
<span class="fc" id="L236">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.create();</span>
<span class="fc" id="L237">        async.onNext(1);</span>
<span class="fc" id="L238">        async.onComplete();</span>
<span class="fc" id="L239">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L241">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L242">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L243">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L244">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L245">        assertEquals((Integer)1, async.getValue());</span>
<span class="fc" id="L246">        assertTrue(async.hasValue());</span>
<span class="fc" id="L247">        assertArrayEquals(new Object[] { 1 }, async.getValues());</span>
<span class="fc" id="L248">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L249">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L250">        assertArrayEquals(new Integer[] { 1, null }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L251">    }</span>

    @Test
    public void testReplaySubjectValueRelayIncomplete() {
<span class="fc" id="L255">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.create();</span>
<span class="fc" id="L256">        async.onNext(1);</span>
<span class="fc" id="L257">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L259">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L260">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L261">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L262">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L263">        assertEquals((Integer)1, async.getValue());</span>
<span class="fc" id="L264">        assertTrue(async.hasValue());</span>
<span class="fc" id="L265">        assertArrayEquals(new Object[] { 1 }, async.getValues());</span>
<span class="fc" id="L266">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L267">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L268">        assertArrayEquals(new Integer[] { 1, null }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L269">    }</span>

    @Test
    public void testReplaySubjectValueRelayBounded() {
<span class="fc" id="L273">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.createWithSize(1);</span>
<span class="fc" id="L274">        async.onNext(0);</span>
<span class="fc" id="L275">        async.onNext(1);</span>
<span class="fc" id="L276">        async.onComplete();</span>
<span class="fc" id="L277">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L279">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L280">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L281">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L282">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L283">        assertEquals((Integer)1, async.getValue());</span>
<span class="fc" id="L284">        assertTrue(async.hasValue());</span>
<span class="fc" id="L285">        assertArrayEquals(new Object[] { 1 }, async.getValues());</span>
<span class="fc" id="L286">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L287">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L288">        assertArrayEquals(new Integer[] { 1, null }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L289">    }</span>

    @Test
    public void testReplaySubjectValueRelayBoundedIncomplete() {
<span class="fc" id="L293">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.createWithSize(1);</span>
<span class="fc" id="L294">        async.onNext(0);</span>
<span class="fc" id="L295">        async.onNext(1);</span>
<span class="fc" id="L296">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L298">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L299">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L300">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L301">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L302">        assertEquals((Integer)1, async.getValue());</span>
<span class="fc" id="L303">        assertTrue(async.hasValue());</span>
<span class="fc" id="L304">        assertArrayEquals(new Object[] { 1 }, async.getValues());</span>
<span class="fc" id="L305">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L306">        assertArrayEquals(new Integer[] { 1 }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L307">        assertArrayEquals(new Integer[] { 1, null }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L308">    }</span>

    @Test
    public void testReplaySubjectValueRelayBoundedEmptyIncomplete() {
<span class="fc" id="L312">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.createWithSize(1);</span>
<span class="fc" id="L313">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L315">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L316">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L317">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L318">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L319">        assertNull(async.getValue());</span>
<span class="fc" id="L320">        assertFalse(async.hasValue());</span>
<span class="fc" id="L321">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L322">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L323">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L324">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L325">    }</span>

    @Test
    public void testReplaySubjectValueRelayEmptyIncomplete() {
<span class="fc" id="L329">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.create();</span>
<span class="fc" id="L330">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L332">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L333">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L334">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L335">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L336">        assertNull(async.getValue());</span>
<span class="fc" id="L337">        assertFalse(async.hasValue());</span>
<span class="fc" id="L338">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L339">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L340">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L341">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L342">    }</span>

    @Test
    public void testReplaySubjectEmpty() {
<span class="fc" id="L346">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.create();</span>
<span class="fc" id="L347">        async.onComplete();</span>
<span class="fc" id="L348">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L350">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L351">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L352">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L353">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L354">        assertNull(async.getValue());</span>
<span class="fc" id="L355">        assertFalse(async.hasValue());</span>
<span class="fc" id="L356">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L357">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L358">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L359">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L360">    }</span>

    @Test
    public void testReplaySubjectError() {
<span class="fc" id="L364">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.create();</span>
<span class="fc" id="L365">        TestException te = new TestException();</span>
<span class="fc" id="L366">        async.onError(te);</span>
<span class="fc" id="L367">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L369">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L370">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L371">        assertTrue(serial.hasThrowable());</span>
<span class="fc" id="L372">        assertSame(te, serial.getThrowable());</span>
<span class="fc" id="L373">        assertNull(async.getValue());</span>
<span class="fc" id="L374">        assertFalse(async.hasValue());</span>
<span class="fc" id="L375">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L376">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L377">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L378">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L379">    }</span>

    @Test
    public void testReplaySubjectBoundedEmpty() {
<span class="fc" id="L383">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.createWithSize(1);</span>
<span class="fc" id="L384">        async.onComplete();</span>
<span class="fc" id="L385">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L387">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L388">        assertTrue(serial.hasComplete());</span>
<span class="fc" id="L389">        assertFalse(serial.hasThrowable());</span>
<span class="fc" id="L390">        assertNull(serial.getThrowable());</span>
<span class="fc" id="L391">        assertNull(async.getValue());</span>
<span class="fc" id="L392">        assertFalse(async.hasValue());</span>
<span class="fc" id="L393">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L394">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L395">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L396">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L397">    }</span>

    @Test
    public void testReplaySubjectBoundedError() {
<span class="fc" id="L401">        ReplayProcessor&lt;Integer&gt; async = ReplayProcessor.createWithSize(1);</span>
<span class="fc" id="L402">        TestException te = new TestException();</span>
<span class="fc" id="L403">        async.onError(te);</span>
<span class="fc" id="L404">        FlowableProcessor&lt;Integer&gt; serial = async.toSerialized();</span>

<span class="fc" id="L406">        assertFalse(serial.hasSubscribers());</span>
<span class="fc" id="L407">        assertFalse(serial.hasComplete());</span>
<span class="fc" id="L408">        assertTrue(serial.hasThrowable());</span>
<span class="fc" id="L409">        assertSame(te, serial.getThrowable());</span>
<span class="fc" id="L410">        assertNull(async.getValue());</span>
<span class="fc" id="L411">        assertFalse(async.hasValue());</span>
<span class="fc" id="L412">        assertArrayEquals(new Object[] { }, async.getValues());</span>
<span class="fc" id="L413">        assertArrayEquals(new Integer[] { }, async.getValues(new Integer[0]));</span>
<span class="fc" id="L414">        assertArrayEquals(new Integer[] { null }, async.getValues(new Integer[] { 0 }));</span>
<span class="fc" id="L415">        assertArrayEquals(new Integer[] { null, 0 }, async.getValues(new Integer[] { 0, 0 }));</span>
<span class="fc" id="L416">    }</span>

    @Test
    public void testDontWrapSerializedSubjectAgain() {
<span class="fc" id="L420">        PublishProcessor&lt;Object&gt; s = PublishProcessor.create();</span>
<span class="fc" id="L421">        FlowableProcessor&lt;Object&gt; s1 = s.toSerialized();</span>
<span class="fc" id="L422">        FlowableProcessor&lt;Object&gt; s2 = s1.toSerialized();</span>
<span class="fc" id="L423">        assertSame(s1, s2);</span>
<span class="fc" id="L424">    }</span>

    @Test
    public void normal() {
<span class="fc" id="L428">        FlowableProcessor&lt;Integer&gt; s = PublishProcessor.&lt;Integer&gt;create().toSerialized();</span>

<span class="fc" id="L430">        TestSubscriber&lt;Integer&gt; ts = s.test();</span>

<span class="fc" id="L432">        Flowable.range(1, 10).subscribe(s);</span>

<span class="fc" id="L434">        ts.assertResult(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);</span>

<span class="fc" id="L436">        assertFalse(s.hasSubscribers());</span>

<span class="fc" id="L438">        s.onNext(11);</span>

<span class="fc" id="L440">        List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>
        try {
<span class="fc" id="L442">            s.onError(new TestException());</span>

<span class="fc" id="L444">            TestHelper.assertUndeliverable(errors, 0, TestException.class);</span>
        } finally {
<span class="fc" id="L446">            RxJavaPlugins.reset();</span>
        }
<span class="fc" id="L448">        s.onComplete();</span>

<span class="fc" id="L450">        BooleanSubscription bs = new BooleanSubscription();</span>
<span class="fc" id="L451">        s.onSubscribe(bs);</span>
<span class="fc" id="L452">        assertTrue(bs.isCancelled());</span>
<span class="fc" id="L453">    }</span>

    @Test
    public void onNextOnNextRace() {
<span class="fc bfc" id="L457" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L458">            final FlowableProcessor&lt;Integer&gt; s = PublishProcessor.&lt;Integer&gt;create().toSerialized();</span>

<span class="fc" id="L460">            TestSubscriber&lt;Integer&gt; ts = s.test();</span>

<span class="fc" id="L462">            Runnable r1 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L465">                    s.onNext(1);</span>
<span class="fc" id="L466">                }</span>
            };

<span class="fc" id="L469">            Runnable r2 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L472">                    s.onNext(2);</span>
<span class="fc" id="L473">                }</span>
            };

<span class="fc" id="L476">            TestHelper.race(r1, r2);</span>

<span class="fc" id="L478">            ts.assertSubscribed().assertNoErrors().assertNotComplete()</span>
<span class="fc" id="L479">            .assertValueSet(Arrays.asList(1, 2));</span>
        }
<span class="fc" id="L481">    }</span>

    @Test
    public void onNextOnErrorRace() {
<span class="fc bfc" id="L485" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L486">            final FlowableProcessor&lt;Integer&gt; s = PublishProcessor.&lt;Integer&gt;create().toSerialized();</span>

<span class="fc" id="L488">            TestSubscriber&lt;Integer&gt; ts = s.test();</span>

<span class="fc" id="L490">            final TestException ex = new TestException();</span>

<span class="fc" id="L492">            Runnable r1 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L495">                    s.onNext(1);</span>
<span class="fc" id="L496">                }</span>
            };

<span class="fc" id="L499">            Runnable r2 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L502">                    s.onError(ex);</span>
<span class="fc" id="L503">                }</span>
            };

<span class="fc" id="L506">            TestHelper.race(r1, r2);</span>

<span class="fc" id="L508">            ts.assertError(ex).assertNotComplete();</span>

<span class="fc bfc" id="L510" title="All 2 branches covered.">            if (ts.valueCount() != 0) {</span>
<span class="fc" id="L511">                ts.assertValue(1);</span>
            }
        }
<span class="fc" id="L514">    }</span>

    @Test
    public void onNextOnCompleteRace() {
<span class="fc bfc" id="L518" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L519">            final FlowableProcessor&lt;Integer&gt; s = PublishProcessor.&lt;Integer&gt;create().toSerialized();</span>

<span class="fc" id="L521">            TestSubscriber&lt;Integer&gt; ts = s.test();</span>

<span class="fc" id="L523">            Runnable r1 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L526">                    s.onNext(1);</span>
<span class="fc" id="L527">                }</span>
            };

<span class="fc" id="L530">            Runnable r2 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L533">                    s.onComplete();</span>
<span class="fc" id="L534">                }</span>
            };

<span class="fc" id="L537">            TestHelper.race(r1, r2);</span>

<span class="fc" id="L539">            ts.assertComplete().assertNoErrors();</span>

<span class="fc bfc" id="L541" title="All 2 branches covered.">            if (ts.valueCount() != 0) {</span>
<span class="fc" id="L542">                ts.assertValue(1);</span>
            }
        }
<span class="fc" id="L545">    }</span>

    @Test
    public void onNextOnSubscribeRace() {
<span class="fc bfc" id="L549" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L550">            final FlowableProcessor&lt;Integer&gt; s = PublishProcessor.&lt;Integer&gt;create().toSerialized();</span>

<span class="fc" id="L552">            TestSubscriber&lt;Integer&gt; ts = s.test();</span>

<span class="fc" id="L554">            final BooleanSubscription bs = new BooleanSubscription();</span>

<span class="fc" id="L556">            Runnable r1 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L559">                    s.onNext(1);</span>
<span class="fc" id="L560">                }</span>
            };

<span class="fc" id="L563">            Runnable r2 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L566">                    s.onSubscribe(bs);</span>
<span class="fc" id="L567">                }</span>
            };

<span class="fc" id="L570">            TestHelper.race(r1, r2);</span>

<span class="fc" id="L572">            ts.assertValue(1).assertNotComplete().assertNoErrors();</span>
        }
<span class="fc" id="L574">    }</span>

    @Test
    public void onCompleteOnSubscribeRace() {
<span class="fc bfc" id="L578" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L579">            final FlowableProcessor&lt;Integer&gt; s = PublishProcessor.&lt;Integer&gt;create().toSerialized();</span>

<span class="fc" id="L581">            TestSubscriber&lt;Integer&gt; ts = s.test();</span>

<span class="fc" id="L583">            final BooleanSubscription bs = new BooleanSubscription();</span>

<span class="fc" id="L585">            Runnable r1 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L588">                    s.onComplete();</span>
<span class="fc" id="L589">                }</span>
            };

<span class="fc" id="L592">            Runnable r2 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L595">                    s.onSubscribe(bs);</span>
<span class="fc" id="L596">                }</span>
            };

<span class="fc" id="L599">            TestHelper.race(r1, r2);</span>

<span class="fc" id="L601">            ts.assertResult();</span>
        }
<span class="fc" id="L603">    }</span>

    @Test
    public void onCompleteOnCompleteRace() {
<span class="fc bfc" id="L607" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L608">            final FlowableProcessor&lt;Integer&gt; s = PublishProcessor.&lt;Integer&gt;create().toSerialized();</span>

<span class="fc" id="L610">            TestSubscriber&lt;Integer&gt; ts = s.test();</span>

<span class="fc" id="L612">            Runnable r1 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L615">                    s.onComplete();</span>
<span class="fc" id="L616">                }</span>
            };

<span class="fc" id="L619">            Runnable r2 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L622">                    s.onComplete();</span>
<span class="fc" id="L623">                }</span>
            };

<span class="fc" id="L626">            TestHelper.race(r1, r2);</span>

<span class="fc" id="L628">            ts.assertResult();</span>
        }
<span class="fc" id="L630">    }</span>

    @Test
    public void onErrorOnErrorRace() {
<span class="fc bfc" id="L634" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L635">            final FlowableProcessor&lt;Integer&gt; s = PublishProcessor.&lt;Integer&gt;create().toSerialized();</span>

<span class="fc" id="L637">            TestSubscriber&lt;Integer&gt; ts = s.test();</span>

<span class="fc" id="L639">            final TestException ex = new TestException();</span>

<span class="fc" id="L641">            List&lt;Throwable&gt; errors = TestHelper.trackPluginErrors();</span>
            try {
<span class="fc" id="L643">                Runnable r1 = new Runnable() {</span>
                    @Override
                    public void run() {
<span class="fc" id="L646">                        s.onError(ex);</span>
<span class="fc" id="L647">                    }</span>
                };

<span class="fc" id="L650">                Runnable r2 = new Runnable() {</span>
                    @Override
                    public void run() {
<span class="fc" id="L653">                        s.onError(ex);</span>
<span class="fc" id="L654">                    }</span>
                };

<span class="fc" id="L657">                TestHelper.race(r1, r2);</span>

<span class="fc" id="L659">                ts.assertFailure(TestException.class);</span>

<span class="fc" id="L661">                TestHelper.assertUndeliverable(errors, 0, TestException.class);</span>
            } finally {
<span class="fc" id="L663">                RxJavaPlugins.reset();</span>
            }
        }
<span class="fc" id="L666">    }</span>

    @Test
    public void onSubscribeOnSubscribeRace() {
<span class="fc bfc" id="L670" title="All 2 branches covered.">        for (int i = 0; i &lt; TestHelper.RACE_DEFAULT_LOOPS; i++) {</span>
<span class="fc" id="L671">            final FlowableProcessor&lt;Integer&gt; s = PublishProcessor.&lt;Integer&gt;create().toSerialized();</span>

<span class="fc" id="L673">            TestSubscriber&lt;Integer&gt; ts = s.test();</span>

<span class="fc" id="L675">            final BooleanSubscription bs1 = new BooleanSubscription();</span>
<span class="fc" id="L676">            final BooleanSubscription bs2 = new BooleanSubscription();</span>

<span class="fc" id="L678">            Runnable r1 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L681">                    s.onSubscribe(bs1);</span>
<span class="fc" id="L682">                }</span>
            };

<span class="fc" id="L685">            Runnable r2 = new Runnable() {</span>
                @Override
                public void run() {
<span class="fc" id="L688">                    s.onSubscribe(bs2);</span>
<span class="fc" id="L689">                }</span>
            };

<span class="fc" id="L692">            TestHelper.race(r1, r2);</span>

<span class="fc" id="L694">            ts.assertEmpty();</span>
        }
<span class="fc" id="L696">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>